import{a6 as S,w as u,ap as U,a7 as _,a8 as j,a9 as s,aa as t,O as w,ab as m,aq as B,ac as O,ad as l,ar as R,af as g,ae as z,ah as A,ai as p,N as I,B as k,al as E}from"./index-DXh3Z4_f.js";import{M as F}from"./ModelSelector-CcjaxuBy.js";import{N as M}from"./Switch-C_AAH6JD.js";import"./Checkbox-C_x1OZs5.js";const L={__name:"Settings",setup(T){const r=S(),v=u(!1),f=u(!1),a=U({llm:{defaultModel:""},thinking:{enableReasoning:!1,defaultLevel:"low"},streaming:{enabled:!0}}),c=u([]),i=u(!1);async function b(){v.value=!0;try{const n=await m.get("/api/config");if(n.data.code===0){const e=n.data.data;e.llm&&Object.assign(a.llm,e.llm),e.thinking&&Object.assign(a.thinking,e.thinking),e.streaming&&Object.assign(a.streaming,e.streaming);const d=await m.get("/api/channels/list");if(d.data.code===0){const o=d.data.data,y=new Set;o.forEach(h=>{h.models&&h.models.forEach(C=>y.add(C))}),c.value=Array.from(y).sort()}}}catch(n){r.error("加载配置失败: "+n.message)}finally{v.value=!1}}async function N(){f.value=!0;try{const n={llm:{...a.llm},thinking:{...a.thinking},streaming:{...a.streaming}},e=await m.post("/api/config",n);e.data.code===0?(r.success("配置已保存"),b()):r.error("保存失败: "+e.data.message)}catch(n){r.error("保存失败: "+n.message)}finally{f.value=!1}}function x(n){n.length>0&&(a.llm.defaultModel=n[0]),i.value=!1}return _(()=>{b()}),(n,e)=>{const d=B("n-modal");return O(),j(t(w),{vertical:"",size:"large"},{default:s(()=>[l(t(R),{type:"info",title:"提示",style:{"margin-bottom":"16px"}},{default:s(()=>[...e[6]||(e[6]=[g(" API Key 和渠道配置请前往「渠道管理」页面进行设置 ",-1)])]),_:1}),l(t(z),{title:"全局设置"},{default:s(()=>[l(t(A),{"label-placement":"left","label-width":"140"},{default:s(()=>[l(t(p),{label:"默认模型"},{default:s(()=>[l(t(I),{value:a.llm.defaultModel,"onUpdate:value":e[1]||(e[1]=o=>a.llm.defaultModel=o),placeholder:"选择或输入模型名称",readonly:"",onClick:e[2]||(e[2]=o=>i.value=!0)},{suffix:s(()=>[l(t(k),{size:"small",onClick:e[0]||(e[0]=E(o=>i.value=!0,["stop"]))},{default:s(()=>[...e[7]||(e[7]=[g("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(t(p),{label:"启用推理 (Thinking)"},{default:s(()=>[l(t(M),{value:a.thinking.enableReasoning,"onUpdate:value":e[3]||(e[3]=o=>a.thinking.enableReasoning=o)},null,8,["value"])]),_:1}),l(t(p),{label:"流式传输 (Streaming)"},{default:s(()=>[l(t(M),{value:a.streaming.enabled,"onUpdate:value":e[4]||(e[4]=o=>a.streaming.enabled=o)},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(t(w),{justify:"end"},{default:s(()=>[l(t(k),{type:"primary",size:"large",onClick:N,loading:f.value},{default:s(()=>[...e[8]||(e[8]=[g(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1}),l(d,{show:i.value,"onUpdate:show":e[5]||(e[5]=o=>i.value=o),preset:"card",title:"选择模型",style:{width:"800px","max-height":"85vh"}},{default:s(()=>[l(F,{"all-models":c.value,value:a.llm.defaultModel?[a.llm.defaultModel]:[],multiple:!1,"onUpdate:value":x},null,8,["all-models","value"])]),_:1},8,["show"])]),_:1})}}};export{L as default};
