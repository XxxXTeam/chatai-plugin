import{S as T,w as v,T as B,U as S,V as u,W as t,O as y,X as c,Y as g,Z as l,$ as E,B as i,a0 as N,a1 as P,a2 as V,aM as O,a3 as o,N as p,aI as R,h as m,M as $}from"./index-BPZ3RAI7.js";import{N as F,b as I}from"./DataTable-Cp9IH1uV.js";import{N as J}from"./Popconfirm-C1o9AYCO.js";import"./Checkbox-CCWyWjIx.js";const A={__name:"McpServers",setup(q){const n=T(),k=v([]),d=v(!1);v(!1);const b=v(null),a=v({name:"",type:"stdio",command:"",args:"",url:"",env:""}),h={name:{required:!0,message:"请输入名称",trigger:"blur"},type:{required:!0,message:"请选择类型",trigger:"change"}},C=[{title:"名称",key:"name"},{title:"类型",key:"type"},{title:"状态",key:"status",render(s){return m($,{type:s.status==="connected"?"success":"error"},{default:()=>s.status})}},{title:"工具数",key:"toolsCount"},{title:"资源数",key:"resourcesCount"},{title:"操作",key:"actions",render(s){return m(y,{},{default:()=>[m(i,{size:"small",onClick:()=>U(s)},{default:()=>"重连"}),m(J,{onPositiveClick:()=>M(s)},{trigger:()=>m(i,{size:"small",type:"error"},{default:()=>"删除"}),default:()=>"确定要删除吗？"})]})}}];async function f(){try{const s=await c.get("/api/mcp/servers");s.data.code===0&&(k.value=s.data.data)}catch{n.error("获取服务器列表失败")}}function w(){a.value={name:"",type:"stdio",command:"",args:"",url:"",env:""},d.value=!0}async function U(s){try{const e=await c.post(`/api/mcp/servers/${s.name}/reconnect`,{});e.data.code===0?(n.success("重连成功"),f()):n.error(e.data.message)}catch{n.error("重连失败")}}async function M(s){try{const e=await c.delete(`/api/mcp/servers/${s.name}`);e.data.code===0?(n.success("删除成功"),f()):n.error(e.data.message)}catch{n.error("删除失败")}}async function x(){b.value?.validate(async s=>{if(!s)try{const e={type:a.value.type};if(e.type==="stdio"){if(e.command=a.value.command,a.value.args&&(e.args=a.value.args.split(" ")),a.value.env)try{e.env=JSON.parse(a.value.env)}catch{n.error("环境变量格式错误 (JSON)");return}}else e.url=a.value.url;const r=await c.post("/api/mcp/servers",{name:a.value.name,config:e});r.data.code===0?(n.success("添加成功"),d.value=!1,f()):n.error(r.data.message)}catch{n.error("添加失败")}})}return B(()=>{f()}),(s,e)=>(g(),S(t(y),{vertical:""},{default:u(()=>[l(t(E),{title:"MCP 服务器管理"},{"header-extra":u(()=>[l(t(i),{type:"primary",onClick:w},{default:u(()=>[...e[8]||(e[8]=[N("添加服务器",-1)])]),_:1})]),default:u(()=>[l(t(F),{columns:C,data:k.value},null,8,["data"])]),_:1}),l(t(P),{show:d.value,"onUpdate:show":e[7]||(e[7]=r=>d.value=r),preset:"card",title:"添加 MCP 服务器",style:{width:"600px"}},{footer:u(()=>[l(t(y),{justify:"end"},{default:u(()=>[l(t(i),{onClick:e[6]||(e[6]=r=>d.value=!1)},{default:u(()=>[...e[9]||(e[9]=[N("取消",-1)])]),_:1}),l(t(i),{type:"primary",onClick:x},{default:u(()=>[...e[10]||(e[10]=[N("保存",-1)])]),_:1})]),_:1})]),default:u(()=>[l(t(V),{ref_key:"formRef",ref:b,model:a.value,rules:h,"label-placement":"left","label-width":"100"},{default:u(()=>[l(t(o),{label:"名称",path:"name"},{default:u(()=>[l(t(p),{value:a.value.name,"onUpdate:value":e[0]||(e[0]=r=>a.value.name=r),placeholder:"请输入服务器名称"},null,8,["value"])]),_:1}),l(t(o),{label:"类型",path:"type"},{default:u(()=>[l(t(I),{value:a.value.type,"onUpdate:value":e[1]||(e[1]=r=>a.value.type=r),options:[{label:"Stdio (本地进程)",value:"stdio"},{label:"SSE (Server-Sent Events)",value:"sse"},{label:"HTTP",value:"http"}]},null,8,["value"])]),_:1}),a.value.type==="stdio"?(g(),O(R,{key:0},[l(t(o),{label:"命令",path:"command"},{default:u(()=>[l(t(p),{value:a.value.command,"onUpdate:value":e[2]||(e[2]=r=>a.value.command=r),placeholder:"例如: node, python"},null,8,["value"])]),_:1}),l(t(o),{label:"参数",path:"args"},{default:u(()=>[l(t(p),{value:a.value.args,"onUpdate:value":e[3]||(e[3]=r=>a.value.args=r),placeholder:"空格分隔的参数"},null,8,["value"])]),_:1}),l(t(o),{label:"环境变量",path:"env"},{default:u(()=>[l(t(p),{value:a.value.env,"onUpdate:value":e[4]||(e[4]=r=>a.value.env=r),type:"textarea",placeholder:'JSON格式, 例如: {"KEY": "VALUE"}'},null,8,["value"])]),_:1})],64)):(g(),S(t(o),{key:1,label:"URL",path:"url"},{default:u(()=>[l(t(p),{value:a.value.url,"onUpdate:value":e[5]||(e[5]=r=>a.value.url=r),placeholder:"服务器地址"},null,8,["value"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["show"])]),_:1}))}};export{A as default};
