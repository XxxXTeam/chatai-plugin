import{S as P,w as f,a7 as A,T as V,U as E,V as o,W as e,O as y,X as x,Y as F,Z as a,a8 as D,a0 as u,$ as w,a2 as U,a3 as d,N as m,B as r,a6 as v,a1 as K}from"./index-BPZ3RAI7.js";import{b as L,M as W}from"./ModelSelector-DmvH9XzG.js";import{N as g,a as R}from"./Switch-h307EVvr.js";import{N}from"./InputNumber-p5CE_I_f.js";import"./Checkbox-CCWyWjIx.js";const J={__name:"Settings",setup(X){const p=P(),C=f(!1),M=f(!1),n=A({llm:{defaultModel:"",chatModel:"",codeModel:"",translationModel:"",embeddingModel:"text-embedding-3-small"},bym:{enable:!1,probability:.02,temperature:.9,maxTokens:100,recall:!1,model:"",systemPrompt:""},thinking:{enableReasoning:!1,defaultLevel:"low"},streaming:{enabled:!0}}),S=f([]),b=f(!1),k=f("defaultModel");async function $(){C.value=!0;try{const s=await x.get("/api/config");if(s.data.code===0){const l=s.data.data;l.llm&&Object.assign(n.llm,l.llm),l.bym&&Object.assign(n.bym,l.bym),l.thinking&&Object.assign(n.thinking,l.thinking),l.streaming&&Object.assign(n.streaming,l.streaming);const t=await x.get("/api/channels/list");if(t.data.code===0){const B=t.data.data,z=new Set;B.forEach(T=>{T.models&&T.models.forEach(I=>z.add(I))}),S.value=Array.from(z).sort()}}}catch(s){p.error("加载配置失败: "+s.message)}finally{C.value=!1}}async function j(){M.value=!0;try{const s={llm:{...n.llm},bym:{...n.bym},thinking:{...n.thinking},streaming:{...n.streaming}},l=await x.post("/api/config",s);l.data.code===0?(p.success("配置已保存"),$()):p.error("保存失败: "+l.data.message)}catch(s){p.error("保存失败: "+s.message)}finally{M.value=!1}}function i(s){k.value=s,b.value=!0}function O(s){s.length>0&&(k.value==="bymModel"?n.bym.model=s[0]:n.llm[k.value]=s[0]),b.value=!1}return V(()=>{$()}),(s,l)=>(F(),E(e(y),{vertical:"",size:"large"},{default:o(()=>[a(e(D),{type:"info",title:"提示",style:{"margin-bottom":"16px"}},{default:o(()=>[...l[27]||(l[27]=[u(" API Key 和渠道配置请前往「渠道管理」页面进行设置 ",-1)])]),_:1}),a(e(w),{title:"模型配置"},{default:o(()=>[a(e(U),{"label-placement":"left","label-width":"140"},{default:o(()=>[a(e(d),{label:"默认模型"},{default:o(()=>[a(e(m),{value:n.llm.defaultModel,"onUpdate:value":l[1]||(l[1]=t=>n.llm.defaultModel=t),placeholder:"选择模型",readonly:"",onClick:l[2]||(l[2]=t=>i("defaultModel"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[0]||(l[0]=v(t=>i("defaultModel"),["stop"]))},{default:o(()=>[...l[28]||(l[28]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(L),{"title-placement":"left"},{default:o(()=>[...l[29]||(l[29]=[u("场景模式模型 (可选)",-1)])]),_:1}),a(e(d),{label:"对话模式"},{default:o(()=>[a(e(m),{value:n.llm.chatModel,"onUpdate:value":l[4]||(l[4]=t=>n.llm.chatModel=t),placeholder:"留空使用默认模型",readonly:"",onClick:l[5]||(l[5]=t=>i("chatModel"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[3]||(l[3]=v(t=>i("chatModel"),["stop"]))},{default:o(()=>[...l[30]||(l[30]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"代码模式"},{default:o(()=>[a(e(m),{value:n.llm.codeModel,"onUpdate:value":l[7]||(l[7]=t=>n.llm.codeModel=t),placeholder:"留空使用默认模型",readonly:"",onClick:l[8]||(l[8]=t=>i("codeModel"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[6]||(l[6]=v(t=>i("codeModel"),["stop"]))},{default:o(()=>[...l[31]||(l[31]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"翻译模式"},{default:o(()=>[a(e(m),{value:n.llm.translationModel,"onUpdate:value":l[10]||(l[10]=t=>n.llm.translationModel=t),placeholder:"留空使用默认模型",readonly:"",onClick:l[11]||(l[11]=t=>i("translationModel"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[9]||(l[9]=v(t=>i("translationModel"),["stop"]))},{default:o(()=>[...l[32]||(l[32]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"嵌入模型"},{default:o(()=>[a(e(m),{value:n.llm.embeddingModel,"onUpdate:value":l[12]||(l[12]=t=>n.llm.embeddingModel=t),placeholder:"text-embedding-3-small"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(w),{title:"伪人模式"},{default:o(()=>[a(e(U),{"label-placement":"left","label-width":"140"},{default:o(()=>[a(e(d),{label:"启用"},{default:o(()=>[a(e(g),{value:n.bym.enable,"onUpdate:value":l[13]||(l[13]=t=>n.bym.enable=t)},null,8,["value"])]),_:1}),a(e(d),{label:"触发概率"},{default:o(()=>[a(e(y),{vertical:"",style:{width:"100%"}},{default:o(()=>[a(e(R),{value:n.bym.probability,"onUpdate:value":l[14]||(l[14]=t=>n.bym.probability=t),min:0,max:1,step:.01,marks:{0:"0%",.5:"50%",1:"100%"}},null,8,["value"]),a(e(N),{value:n.bym.probability,"onUpdate:value":l[15]||(l[15]=t=>n.bym.probability=t),min:0,max:1,step:.01,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),a(e(d),{label:"回复温度"},{default:o(()=>[a(e(y),{vertical:"",style:{width:"100%"}},{default:o(()=>[a(e(R),{value:n.bym.temperature,"onUpdate:value":l[16]||(l[16]=t=>n.bym.temperature=t),min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}},null,8,["value"]),a(e(N),{value:n.bym.temperature,"onUpdate:value":l[17]||(l[17]=t=>n.bym.temperature=t),min:0,max:2,step:.1,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),a(e(d),{label:"最大 Token"},{default:o(()=>[a(e(N),{value:n.bym.maxTokens,"onUpdate:value":l[18]||(l[18]=t=>n.bym.maxTokens=t),min:10,max:1e3,step:10,style:{width:"100%"}},null,8,["value"])]),_:1}),a(e(d),{label:"启用记忆"},{default:o(()=>[a(e(g),{value:n.bym.recall,"onUpdate:value":l[19]||(l[19]=t=>n.bym.recall=t)},null,8,["value"])]),_:1}),a(e(d),{label:"使用模型"},{default:o(()=>[a(e(m),{value:n.bym.model,"onUpdate:value":l[21]||(l[21]=t=>n.bym.model=t),placeholder:"留空使用默认模型",readonly:"",onClick:l[22]||(l[22]=t=>i("bymModel"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[20]||(l[20]=v(t=>i("bymModel"),["stop"]))},{default:o(()=>[...l[33]||(l[33]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"系统提示词"},{default:o(()=>[a(e(m),{value:n.bym.systemPrompt,"onUpdate:value":l[23]||(l[23]=t=>n.bym.systemPrompt=t),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"伪人模式的系统提示词"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(w),{title:"全局设置"},{default:o(()=>[a(e(U),{"label-placement":"left","label-width":"140"},{default:o(()=>[a(e(d),{label:"启用推理 (Thinking)"},{default:o(()=>[a(e(g),{value:n.thinking.enableReasoning,"onUpdate:value":l[24]||(l[24]=t=>n.thinking.enableReasoning=t)},null,8,["value"])]),_:1}),a(e(d),{label:"流式传输 (Streaming)"},{default:o(()=>[a(e(g),{value:n.streaming.enabled,"onUpdate:value":l[25]||(l[25]=t=>n.streaming.enabled=t)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(y),{justify:"end"},{default:o(()=>[a(e(r),{type:"primary",size:"large",onClick:j,loading:M.value},{default:o(()=>[...l[34]||(l[34]=[u(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1}),a(e(K),{show:b.value,"onUpdate:show":l[26]||(l[26]=t=>b.value=t),preset:"card",title:"选择模型",style:{width:"800px","max-height":"85vh"}},{default:o(()=>[a(W,{"all-models":S.value,value:[],multiple:!1,"onUpdate:value":O},null,8,["all-models"])]),_:1},8,["show"])]),_:1}))}};export{J as default};
