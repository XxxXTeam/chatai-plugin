import{a6 as E,w as u,a7 as F,a8 as V,a9 as o,aa as l,O as N,ab as i,ac as $,ad as r,ae as q,B as m,af as g,ag as z,ah as O,ai as p,N as h,h as f}from"./index-DXh3Z4_f.js";import{N as R,b as T}from"./DataTable-Cp3cJh0-.js";import{N as _}from"./InputNumber-GWzkv0wX.js";import{N as j}from"./Popconfirm-JzZfKPdA.js";import"./Checkbox-C_x1OZs5.js";const Q={__name:"Presets",setup(D){const n=E(),P=u([]),k=u([]),v=u([]),d=u(!1),c=u(!1),y=u(""),w=u(null),s=u({name:"",description:"",systemPrompt:"",model:"",temperature:.7}),x={name:{required:!0,message:"请输入名称",trigger:"blur"},systemPrompt:{required:!0,message:"请输入系统提示词",trigger:"blur"}},C=[{title:"名称",key:"name"},{title:"描述",key:"description"},{title:"模型",key:"model"},{title:"操作",key:"actions",render(a){return f(N,null,{default:()=>[f(m,{size:"small",onClick:()=>I(a)},{default:()=>"编辑"}),f(j,{onPositiveClick:()=>M(a.id)},{trigger:()=>f(m,{size:"small",type:"error",disabled:a.id==="default"},{default:()=>"删除"}),default:()=>"确定删除该预设吗？"})]})}}];async function b(){try{const a=await i.get("/api/preset/list");a.data.code===0&&(P.value=a.data.data)}catch{n.error("获取预设列表失败")}}async function U(){try{const a=await i.get("/api/channels/list");if(a.data.code===0){k.value=a.data.data;const e=new Set;k.value.forEach(t=>{t.models&&Array.isArray(t.models)&&t.models.forEach(A=>e.add(A))}),v.value=Array.from(e).map(t=>({label:t,value:t})),v.value.unshift({label:"使用默认模型",value:""})}}catch(a){console.error("Failed to fetch channels",a)}}function B(){c.value=!1,y.value="",s.value={name:"",description:"",systemPrompt:"",model:"",temperature:.7},d.value=!0}function I(a){c.value=!0,y.value=a.id,s.value={...a},d.value=!0}async function M(a){try{const e=await i.delete(`/api/preset/${a}`);e.data.code===0?(n.success("删除成功"),b()):n.error(e.data.message)}catch{n.error("删除失败")}}async function S(){w.value?.validate(async a=>{if(!a)try{let e;c.value?e=await i.put(`/api/preset/${y.value}`,s.value):e=await i.post("/api/preset/",s.value),e.data.code===0?(n.success("保存成功"),d.value=!1,b()):n.error(e.data.message)}catch{n.error("保存失败")}})}return F(()=>{b(),U()}),(a,e)=>($(),V(l(N),{vertical:""},{default:o(()=>[r(l(q),{title:"预设管理"},{"header-extra":o(()=>[r(l(m),{type:"primary",onClick:B},{default:o(()=>[...e[7]||(e[7]=[g("添加预设",-1)])]),_:1})]),default:o(()=>[r(l(R),{columns:C,data:P.value},null,8,["data"])]),_:1}),r(l(z),{show:d.value,"onUpdate:show":e[6]||(e[6]=t=>d.value=t),preset:"card",title:"预设配置",style:{width:"600px"}},{footer:o(()=>[r(l(N),{justify:"end"},{default:o(()=>[r(l(m),{onClick:e[5]||(e[5]=t=>d.value=!1)},{default:o(()=>[...e[8]||(e[8]=[g("取消",-1)])]),_:1}),r(l(m),{type:"primary",onClick:S},{default:o(()=>[...e[9]||(e[9]=[g("保存",-1)])]),_:1})]),_:1})]),default:o(()=>[r(l(O),{ref_key:"formRef",ref:w,model:s.value,rules:x,"label-placement":"left","label-width":"100"},{default:o(()=>[r(l(p),{label:"名称",path:"name"},{default:o(()=>[r(l(h),{value:s.value.name,"onUpdate:value":e[0]||(e[0]=t=>s.value.name=t),placeholder:"请输入名称"},null,8,["value"])]),_:1}),r(l(p),{label:"描述",path:"description"},{default:o(()=>[r(l(h),{value:s.value.description,"onUpdate:value":e[1]||(e[1]=t=>s.value.description=t),placeholder:"请输入描述"},null,8,["value"])]),_:1}),r(l(p),{label:"系统提示词",path:"systemPrompt"},{default:o(()=>[r(l(h),{value:s.value.systemPrompt,"onUpdate:value":e[2]||(e[2]=t=>s.value.systemPrompt=t),type:"textarea",placeholder:"请输入系统提示词",rows:5},null,8,["value"])]),_:1}),r(l(p),{label:"模型",path:"model"},{default:o(()=>[r(l(T),{value:s.value.model,"onUpdate:value":e[3]||(e[3]=t=>s.value.model=t),options:v.value,placeholder:"留空使用默认模型",filterable:"",tag:""},null,8,["value","options"])]),_:1}),r(l(p),{label:"温度",path:"temperature"},{default:o(()=>[r(l(_),{value:s.value.temperature,"onUpdate:value":e[4]||(e[4]=t=>s.value.temperature=t),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]),_:1}))}};export{Q as default};
