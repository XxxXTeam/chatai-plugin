import{S,w as d,U as $,V as o,W as t,O as c,Y as x,Z as l,$ as B,N as f,B as p,a0 as y,a1 as b,a2 as C,a3 as w,X as g}from"./index-BPZ3RAI7.js";import{N as D}from"./DataTable-Cp9IH1uV.js";import"./Checkbox-CCWyWjIx.js";const O={__name:"MemoryView",setup(U){const n=S(),s=d(""),k=d([]),i=d(!1),m=d(!1),u=d({content:"",metadata:"{}"}),N=[{title:"ID",key:"id"},{title:"内容",key:"content"},{title:"时间",key:"timestamp",render:a=>new Date(a.timestamp).toLocaleString()},{title:"操作",key:"actions",render(a){return h(p,{size:"small",type:"error",onClick:()=>M(a.id)},{default:()=>"删除"})}}];async function v(){if(!s.value){n.warning("请输入用户ID");return}i.value=!0;try{const a=localStorage.getItem("token"),e=await g.get(`/api/memory/${s.value}`,{headers:{Authorization:`Bearer ${a}`}});k.value=e.data.data}catch(a){n.error("获取记忆失败: "+(a.response?.data?.message||a.message))}finally{i.value=!1}}async function I(){try{const a=localStorage.getItem("token");let e={};try{e=JSON.parse(u.value.metadata)}catch{}await g.post("/api/memory",{userId:s.value,content:u.value.content,metadata:e},{headers:{Authorization:`Bearer ${a}`}}),n.success("添加成功"),m.value=!1,v()}catch(a){n.error("添加失败: "+(a.response?.data?.message||a.message))}}async function M(a){try{const e=localStorage.getItem("token");await g.delete(`/api/memory/${s.value}/${a}`,{headers:{Authorization:`Bearer ${e}`}}),n.success("删除成功"),v()}catch(e){n.error("删除失败: "+(e.response?.data?.message||e.message))}}return(a,e)=>(x(),$(t(c),{vertical:""},{default:o(()=>[l(t(B),{title:"记忆管理"},{default:o(()=>[l(t(c),{vertical:""},{default:o(()=>[l(t(c),null,{default:o(()=>[l(t(f),{value:s.value,"onUpdate:value":e[0]||(e[0]=r=>s.value=r),placeholder:"输入用户ID"},null,8,["value"]),l(t(p),{type:"primary",onClick:v,loading:i.value},{default:o(()=>[...e[5]||(e[5]=[y("查询",-1)])]),_:1},8,["loading"]),l(t(p),{type:"success",onClick:e[1]||(e[1]=r=>m.value=!0),disabled:!s.value},{default:o(()=>[...e[6]||(e[6]=[y("添加记忆",-1)])]),_:1},8,["disabled"])]),_:1}),l(t(D),{columns:N,data:k.value,loading:i.value},null,8,["data","loading"])]),_:1})]),_:1}),l(t(b),{show:m.value,"onUpdate:show":e[4]||(e[4]=r=>m.value=r),preset:"dialog",title:"添加记忆"},{default:o(()=>[l(t(C),null,{default:o(()=>[l(t(w),{label:"内容"},{default:o(()=>[l(t(f),{value:u.value.content,"onUpdate:value":e[2]||(e[2]=r=>u.value.content=r),type:"textarea"},null,8,["value"])]),_:1}),l(t(w),{label:"元数据 (JSON)"},{default:o(()=>[l(t(f),{value:u.value.metadata,"onUpdate:value":e[3]||(e[3]=r=>u.value.metadata=r),type:"textarea",placeholder:"{}"},null,8,["value"])]),_:1}),l(t(p),{type:"primary",block:"",onClick:I},{default:o(()=>[...e[7]||(e[7]=[y("提交",-1)])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1}))}};export{O as default};
