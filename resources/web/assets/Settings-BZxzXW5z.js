import{K as W,w,a5 as D,L as Q,M as P,O as a,P as e,Q as C,R as S,S as R,T as t,a6 as I,V as s,U as b,X as p,a1 as A,Y as r,a7 as d,N as f,B as g,a8 as v,Z as y,W as X}from"./index-CRsLZEUK.js";import{N as E,M as Y}from"./ModelSelector-Cv7SkxSi.js";import{N as Z}from"./Select-BkVODdDG.js";import{N as n}from"./Switch-0kKvCj_4.js";import{N as x}from"./text-DZW4LatM.js";import{N as M}from"./InputNumber-B0m6FRs6.js";import"./SearchOutlined-D6Wzddq_.js";import"./Add-D_PtYc48.js";const al={__name:"Settings",setup(G){const k=W(),T=w(!1),N=w(!1),o=D({basic:{toggleMode:"at",togglePrefix:"#chat",commandPrefix:"#ai",debug:!1,showThinkingMessage:!0,debugToConsoleOnly:!0,quoteReply:!0,autoRecall:{enabled:!1,delay:60,recallError:!0}},llm:{defaultModel:"",embeddingModel:"text-embedding-3-small",models:{chat:"",roleplay:"",toolCall:"",search:"",reasoning:""},chatModel:"",codeModel:"",translationModel:""},bym:{enable:!1,probability:.02,temperature:.9,maxTokens:100,recall:!1,model:"",systemPrompt:"",exclusiveFeatures:["groupSummary","userPortrait"]},tools:{showCallLogs:!0,useForwardMsg:!0},thinking:{showThinkingContent:!0,useForwardMsg:!0},features:{groupSummary:{enabled:!0,maxMessages:100},userPortrait:{enabled:!0,minMessages:10}},memory:{enabled:!1,autoExtract:!0}}),O=w([]),U=w(!1),$=w("defaultModel");async function z(){T.value=!0;try{const i=await S.get("/api/config");if(i.data.code===0){const l=i.data.data;l.basic&&(Object.assign(o.basic,l.basic),l.basic.autoRecall&&Object.assign(o.basic.autoRecall,l.basic.autoRecall)),l.llm&&(Object.assign(o.llm,l.llm),l.llm.models&&Object.assign(o.llm.models,l.llm.models)),l.bym&&Object.assign(o.bym,l.bym),l.tools&&Object.assign(o.tools,l.tools),l.thinking&&Object.assign(o.thinking,l.thinking),l.features&&(l.features.groupSummary&&Object.assign(o.features.groupSummary,l.features.groupSummary),l.features.userPortrait&&Object.assign(o.features.userPortrait,l.features.userPortrait)),l.memory&&Object.assign(o.memory,l.memory);const u=await S.get("/api/channels/list");if(u.data.code===0){const q=u.data.data,j=new Set;q.forEach(F=>{F.models&&F.models.forEach(K=>j.add(K))}),O.value=Array.from(j).sort()}}}catch(i){k.error("加载配置失败: "+i.message)}finally{T.value=!1}}async function B(){N.value=!0;try{const i={basic:{...o.basic},llm:{...o.llm},bym:{...o.bym},tools:{...o.tools},thinking:{...o.thinking},features:{...o.features},memory:{...o.memory}},l=await S.post("/api/config",i);l.data.code===0?(k.success("配置已保存"),z()):k.error("保存失败: "+l.data.message)}catch(i){k.error("保存失败: "+i.message)}finally{N.value=!1}}function m(i){$.value=i,U.value=!0}function V(i){if(i.length>0){const l=$.value;if(l==="bymModel")o.bym.model=i[0];else if(l.startsWith("models.")){const u=l.replace("models.","");o.llm.models[u]=i[0]}else o.llm[l]=i[0]}U.value=!1}const L=[{label:"仅@触发",value:"at"},{label:"仅前缀触发",value:"prefix"},{label:"@和前缀都触发",value:"both"}];return Q(()=>{z()}),(i,l)=>(R(),P(e(C),{vertical:"",size:"large"},{default:a(()=>[t(e(I),{type:"info",title:"提示",style:{"margin-bottom":"16px"}},{default:a(()=>[...l[51]||(l[51]=[s(" API Key 和渠道配置请前往「渠道管理」页面进行设置 ",-1)])]),_:1}),t(e(b),{title:"触发模式"},{default:a(()=>[t(e(p),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"触发方式"},{default:a(()=>[t(e(Z),{value:o.basic.toggleMode,"onUpdate:value":l[0]||(l[0]=u=>o.basic.toggleMode=u),options:L,placeholder:"选择触发方式"},null,8,["value"])]),_:1}),t(e(r),{label:"触发前缀"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(f),{value:o.basic.togglePrefix,"onUpdate:value":l[1]||(l[1]=u=>o.basic.togglePrefix=u),placeholder:"#chat",disabled:o.basic.toggleMode==="at"},null,8,["value","disabled"])]),default:a(()=>[l[52]||(l[52]=s(" 当触发方式包含前缀时，用户发送此前缀开头的消息会触发AI对话 ",-1))]),_:1})]),_:1}),t(e(r),{label:"命令前缀"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(f),{value:o.basic.commandPrefix,"onUpdate:value":l[2]||(l[2]=u=>o.basic.commandPrefix=u),placeholder:"#ai"},null,8,["value"])]),default:a(()=>[l[53]||(l[53]=s(" 管理命令的前缀，如 #ai帮助、#ai状态 等 ",-1))]),_:1})]),_:1}),t(e(r),{label:"调试模式"},{default:a(()=>[t(e(n),{value:o.basic.debug,"onUpdate:value":l[3]||(l[3]=u=>o.basic.debug=u)},null,8,["value"])]),_:1}),t(e(r),{label:"思考提示"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.showThinkingMessage,"onUpdate:value":l[4]||(l[4]=u=>o.basic.showThinkingMessage=u)},null,8,["value"])]),default:a(()=>[l[54]||(l[54]=s(' 开启后，AI处理时会先发送"思考中..."提示 ',-1))]),_:1})]),_:1}),t(e(r),{label:"调试仅控制台"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.debugToConsoleOnly,"onUpdate:value":l[5]||(l[5]=u=>o.basic.debugToConsoleOnly=u)},null,8,["value"])]),default:a(()=>[l[55]||(l[55]=s(" 开启后，调试信息仅输出到控制台，不发送到聊天 ",-1))]),_:1})]),_:1}),t(e(r),{label:"引用回复"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.quoteReply,"onUpdate:value":l[6]||(l[6]=u=>o.basic.quoteReply=u)},null,8,["value"])]),default:a(()=>[l[56]||(l[56]=s(" 开启后，AI回复会引用触发消息 ",-1))]),_:1})]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[57]||(l[57]=[s("自动撤回",-1)])]),_:1}),t(e(r),{label:"启用自动撤回"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.autoRecall.enabled,"onUpdate:value":l[7]||(l[7]=u=>o.basic.autoRecall.enabled=u)},null,8,["value"])]),default:a(()=>[l[58]||(l[58]=s(" 开启后，AI回复会在指定时间后自动撤回 ",-1))]),_:1})]),_:1}),o.basic.autoRecall.enabled?(R(),P(e(r),{key:0,label:"撤回延迟(秒)"},{default:a(()=>[t(e(M),{value:o.basic.autoRecall.delay,"onUpdate:value":l[8]||(l[8]=u=>o.basic.autoRecall.delay=u),min:5,max:300},null,8,["value"])]),_:1})):A("",!0),o.basic.autoRecall.enabled?(R(),P(e(r),{key:1,label:"撤回错误消息"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.autoRecall.recallError,"onUpdate:value":l[9]||(l[9]=u=>o.basic.autoRecall.recallError=u)},null,8,["value"])]),default:a(()=>[l[59]||(l[59]=s(" 开启后，错误提示也会自动撤回 ",-1))]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1}),t(e(b),{title:"模型配置"},{default:a(()=>[t(e(p),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"默认模型"},{default:a(()=>[t(e(f),{value:o.llm.defaultModel,"onUpdate:value":l[11]||(l[11]=u=>o.llm.defaultModel=u),placeholder:"选择模型",readonly:"",onClick:l[12]||(l[12]=u=>m("defaultModel"))},{suffix:a(()=>[t(e(g),{size:"small",onClick:l[10]||(l[10]=v(u=>m("defaultModel"),["stop"]))},{default:a(()=>[...l[60]||(l[60]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[61]||(l[61]=[s("模型分类 (可选，留空使用默认模型)",-1)])]),_:1}),t(e(r),{label:"对话模型"},{default:a(()=>[t(e(f),{value:o.llm.models.chat,"onUpdate:value":l[14]||(l[14]=u=>o.llm.models.chat=u),placeholder:"普通聊天使用的模型",readonly:"",onClick:l[15]||(l[15]=u=>m("models.chat"))},{suffix:a(()=>[t(e(g),{size:"small",onClick:l[13]||(l[13]=v(u=>m("models.chat"),["stop"]))},{default:a(()=>[...l[62]||(l[62]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"伪人模型"},{default:a(()=>[t(e(f),{value:o.llm.models.roleplay,"onUpdate:value":l[17]||(l[17]=u=>o.llm.models.roleplay=u),placeholder:"模拟真人回复的模型",readonly:"",onClick:l[18]||(l[18]=u=>m("models.roleplay"))},{suffix:a(()=>[t(e(g),{size:"small",onClick:l[16]||(l[16]=v(u=>m("models.roleplay"),["stop"]))},{default:a(()=>[...l[63]||(l[63]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"工具调用模型"},{default:a(()=>[t(e(f),{value:o.llm.models.toolCall,"onUpdate:value":l[20]||(l[20]=u=>o.llm.models.toolCall=u),placeholder:"Function Calling 模型",readonly:"",onClick:l[21]||(l[21]=u=>m("models.toolCall"))},{suffix:a(()=>[t(e(g),{size:"small",onClick:l[19]||(l[19]=v(u=>m("models.toolCall"),["stop"]))},{default:a(()=>[...l[64]||(l[64]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"搜索模型"},{default:a(()=>[t(e(f),{value:o.llm.models.search,"onUpdate:value":l[23]||(l[23]=u=>o.llm.models.search=u),placeholder:"联网搜索使用的模型",readonly:"",onClick:l[24]||(l[24]=u=>m("models.search"))},{suffix:a(()=>[t(e(g),{size:"small",onClick:l[22]||(l[22]=v(u=>m("models.search"),["stop"]))},{default:a(()=>[...l[65]||(l[65]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"思考模型"},{default:a(()=>[t(e(f),{value:o.llm.models.reasoning,"onUpdate:value":l[26]||(l[26]=u=>o.llm.models.reasoning=u),placeholder:"深度推理使用的模型",readonly:"",onClick:l[27]||(l[27]=u=>m("models.reasoning"))},{suffix:a(()=>[t(e(g),{size:"small",onClick:l[25]||(l[25]=v(u=>m("models.reasoning"),["stop"]))},{default:a(()=>[...l[66]||(l[66]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[67]||(l[67]=[s("其他配置",-1)])]),_:1}),t(e(r),{label:"嵌入模型"},{default:a(()=>[t(e(f),{value:o.llm.embeddingModel,"onUpdate:value":l[28]||(l[28]=u=>o.llm.embeddingModel=u),placeholder:"text-embedding-3-small"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(b),{title:"伪人模式"},{default:a(()=>[t(e(p),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"启用"},{default:a(()=>[t(e(n),{value:o.bym.enable,"onUpdate:value":l[29]||(l[29]=u=>o.bym.enable=u)},null,8,["value"])]),_:1}),t(e(r),{label:"触发概率"},{default:a(()=>[t(e(C),{vertical:"",style:{width:"100%"}},{default:a(()=>[t(e(E),{value:o.bym.probability,"onUpdate:value":l[30]||(l[30]=u=>o.bym.probability=u),min:0,max:1,step:.01,marks:{0:"0%",.5:"50%",1:"100%"}},null,8,["value"]),t(e(M),{value:o.bym.probability,"onUpdate:value":l[31]||(l[31]=u=>o.bym.probability=u),min:0,max:1,step:.01,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),t(e(r),{label:"回复温度"},{default:a(()=>[t(e(C),{vertical:"",style:{width:"100%"}},{default:a(()=>[t(e(E),{value:o.bym.temperature,"onUpdate:value":l[32]||(l[32]=u=>o.bym.temperature=u),min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}},null,8,["value"]),t(e(M),{value:o.bym.temperature,"onUpdate:value":l[33]||(l[33]=u=>o.bym.temperature=u),min:0,max:2,step:.1,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),t(e(r),{label:"最大 Token"},{default:a(()=>[t(e(M),{value:o.bym.maxTokens,"onUpdate:value":l[34]||(l[34]=u=>o.bym.maxTokens=u),min:10,max:1e3,step:10,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(r),{label:"启用记忆"},{default:a(()=>[t(e(n),{value:o.bym.recall,"onUpdate:value":l[35]||(l[35]=u=>o.bym.recall=u)},null,8,["value"])]),_:1}),t(e(r),{label:"使用模型"},{default:a(()=>[t(e(f),{value:o.bym.model,"onUpdate:value":l[37]||(l[37]=u=>o.bym.model=u),placeholder:"留空使用默认模型",readonly:"",onClick:l[38]||(l[38]=u=>m("bymModel"))},{suffix:a(()=>[t(e(g),{size:"small",onClick:l[36]||(l[36]=v(u=>m("bymModel"),["stop"]))},{default:a(()=>[...l[68]||(l[68]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"系统提示词"},{default:a(()=>[t(e(f),{value:o.bym.systemPrompt,"onUpdate:value":l[39]||(l[39]=u=>o.bym.systemPrompt=u),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"伪人模式的系统提示词"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(b),{title:"工具调用"},{default:a(()=>[t(e(p),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"显示调用日志"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.tools.showCallLogs,"onUpdate:value":l[40]||(l[40]=u=>o.tools.showCallLogs=u)},null,8,["value"])]),default:a(()=>[l[69]||(l[69]=s(" 开启后，显示工具调用的详细日志 ",-1))]),_:1})]),_:1}),t(e(r),{label:"日志合并转发"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.tools.useForwardMsg,"onUpdate:value":l[41]||(l[41]=u=>o.tools.useForwardMsg=u)},null,8,["value"])]),default:a(()=>[l[70]||(l[70]=s(" 开启后，工具调用日志使用合并转发发送 ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(b),{title:"深度思考"},{default:a(()=>[t(e(p),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"显示思考内容"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.thinking.showThinkingContent,"onUpdate:value":l[42]||(l[42]=u=>o.thinking.showThinkingContent=u)},null,8,["value"])]),default:a(()=>[l[71]||(l[71]=s(" 开启后，显示AI的思考过程 ",-1))]),_:1})]),_:1}),t(e(r),{label:"思考合并转发"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.thinking.useForwardMsg,"onUpdate:value":l[43]||(l[43]=u=>o.thinking.useForwardMsg=u)},null,8,["value"])]),default:a(()=>[l[72]||(l[72]=s(" 开启后，思考内容使用合并转发发送 ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(b),{title:"高级功能"},{default:a(()=>[t(e(p),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(x),{"title-placement":"left"},{default:a(()=>[...l[73]||(l[73]=[s("群聊总结",-1)])]),_:1}),t(e(r),{label:"启用"},{default:a(()=>[t(e(n),{value:o.features.groupSummary.enabled,"onUpdate:value":l[44]||(l[44]=u=>o.features.groupSummary.enabled=u)},null,8,["value"])]),_:1}),t(e(r),{label:"最大消息数"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(M),{value:o.features.groupSummary.maxMessages,"onUpdate:value":l[45]||(l[45]=u=>o.features.groupSummary.maxMessages=u),min:10,max:500,step:10,style:{width:"150px"}},null,8,["value"])]),default:a(()=>[l[74]||(l[74]=s(" 总结时分析的最大消息数量 ",-1))]),_:1})]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[75]||(l[75]=[s("个人画像",-1)])]),_:1}),t(e(r),{label:"启用"},{default:a(()=>[t(e(n),{value:o.features.userPortrait.enabled,"onUpdate:value":l[46]||(l[46]=u=>o.features.userPortrait.enabled=u)},null,8,["value"])]),_:1}),t(e(r),{label:"最少消息数"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(M),{value:o.features.userPortrait.minMessages,"onUpdate:value":l[47]||(l[47]=u=>o.features.userPortrait.minMessages=u),min:5,max:100,step:5,style:{width:"150px"}},null,8,["value"])]),default:a(()=>[l[76]||(l[76]=s(" 生成画像需要的最少消息数量 ",-1))]),_:1})]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[77]||(l[77]=[s("长期记忆",-1)])]),_:1}),t(e(r),{label:"启用记忆"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.memory.enabled,"onUpdate:value":l[48]||(l[48]=u=>o.memory.enabled=u)},null,8,["value"])]),default:a(()=>[l[78]||(l[78]=s(" 启用后，AI会记住用户透露的个人信息和偏好 ",-1))]),_:1})]),_:1}),t(e(r),{label:"自动提取"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.memory.autoExtract,"onUpdate:value":l[49]||(l[49]=u=>o.memory.autoExtract=u),disabled:!o.memory.enabled},null,8,["value","disabled"])]),default:a(()=>[l[79]||(l[79]=s(" 自动从对话中提取值得记忆的信息 ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(I),{type:"info",title:"命令提示",style:{"margin-top":"8px"}},{default:a(()=>[...l[80]||(l[80]=[y("div",null,[s("• "),y("strong",null,"#群聊总结"),s(" - 总结群聊消息")],-1),y("div",null,[s("• "),y("strong",null,"#个人画像"),s(" - 分析自己的用户画像")],-1),y("div",null,[s("• "),y("strong",null,"#分析 @用户"),s(" - 分析指定用户的画像")],-1)])]),_:1}),t(e(C),{justify:"end",style:{"margin-top":"16px"}},{default:a(()=>[t(e(g),{type:"primary",size:"large",onClick:B,loading:N.value},{default:a(()=>[...l[81]||(l[81]=[s(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1}),t(e(X),{show:U.value,"onUpdate:show":l[50]||(l[50]=u=>U.value=u),preset:"card",title:"选择模型",style:{width:"800px","max-height":"85vh"}},{default:a(()=>[t(Y,{"all-models":O.value,value:[],multiple:!1,"onUpdate:value":V},null,8,["all-models"])]),_:1},8,["show"])]),_:1}))}};export{al as default};
