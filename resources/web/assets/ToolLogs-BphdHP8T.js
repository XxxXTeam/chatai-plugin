import{K as V,x as i,L as K,M as r,O as t,P as a,Q as L,R as M,S as u,T as l,U as k,ar as Q,h as b,a1 as p,N as J,aQ as R,aq as S,B as D,V as d,aM as $,W as j,a0 as _,$ as m}from"./index-BqjRKREt.js";import{C as z}from"./CodeBlock-DJkyKkbM.js";import{S as q}from"./SearchOutlined-BwOKtiyt.js";import{D as A}from"./DeleteOutlined-CSkwbzxo.js";import{N as E,a as f}from"./DescriptionsItem-qcNo_h3l.js";import{N as P}from"./DataTable-BU0dPw-Q.js";import{N as W}from"./Select-DX174aVp.js";import"./prop-NnGblK-3.js";const le={__name:"ToolLogs",setup(F){const w=V(),v=i(!1),c=i([]),g=i(""),y=i(null),x=i(!1),s=i(null),O=[{title:"时间",key:"timestamp",width:160,render:e=>T(e.timestamp)},{title:"工具",key:"toolName",width:180,render:e=>b(_,{type:"info",size:"small"},()=>e.toolName)},{title:"用户",key:"userId",width:120,ellipsis:{tooltip:!0}},{title:"状态",key:"success",width:80,render:e=>b(_,{type:e.success?"success":"error",size:"small"},()=>e.success?"成功":"失败")},{title:"耗时",key:"duration",width:80,render:e=>e.duration?`${e.duration}ms`:"-"},{title:"操作",key:"actions",width:80,render:e=>b(D,{size:"small",onClick:()=>B(e)},()=>"详情")}],C=i([]);async function h(){v.value=!0;try{const e={};y.value&&(e.tool=y.value),g.value&&(e.search=g.value);const o=await M.get("/api/tools/logs",{params:e});if(o.data.code===0){c.value=o.data.data||[];const n=new Set(c.value.map(N=>N.toolName));C.value=Array.from(n).map(N=>({label:N,value:N}))}}catch(e){w.error("获取日志失败: "+e.message)}finally{v.value=!1}}function B(e){s.value=e,x.value=!0}async function U(){try{(await M.delete("/api/tools/logs")).data.code===0&&(w.success("日志已清空"),c.value=[])}catch(e){w.error("清空失败: "+e.message)}}function T(e){return e?new Date(e).toLocaleString("zh-CN"):"-"}function I(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}return K(()=>{h()}),(e,o)=>(u(),r(a(L),{vertical:"",size:"large"},{default:t(()=>[l(a(k),{title:"工具调用日志"},{"header-extra":t(()=>[l(a(L),null,{default:t(()=>[l(a(W),{value:y.value,"onUpdate:value":[o[0]||(o[0]=n=>y.value=n),h],options:C.value,placeholder:"筛选工具",clearable:"",style:{width:"180px"}},null,8,["value","options"]),l(a(J),{value:g.value,"onUpdate:value":o[1]||(o[1]=n=>g.value=n),placeholder:"搜索...",clearable:"",style:{width:"150px"},onKeyup:R(h,["enter"])},{prefix:t(()=>[l(a(S),null,{default:t(()=>[l(a(q))]),_:1})]),_:1},8,["value"]),l(a(D),{onClick:h,loading:v.value},{icon:t(()=>[l(a(S),null,{default:t(()=>[l(a($))]),_:1})]),default:t(()=>[o[3]||(o[3]=d(" 刷新 ",-1))]),_:1},8,["loading"]),c.value.length>0?(u(),r(a(D),{key:0,type:"error",onClick:U},{icon:t(()=>[l(a(S),null,{default:t(()=>[l(a(A))]),_:1})]),default:t(()=>[o[4]||(o[4]=d(" 清空 ",-1))]),_:1})):p("",!0)]),_:1})]),default:t(()=>[c.value.length===0?(u(),r(a(Q),{key:0,description:"暂无日志记录"})):(u(),r(a(P),{key:1,columns:O,data:c.value,loading:v.value,pagination:{pageSize:50},bordered:!1,striped:"","max-height":"60vh"},null,8,["data","loading"]))]),_:1}),l(a(j),{show:x.value,"onUpdate:show":o[2]||(o[2]=n=>x.value=n),preset:"card",title:"调用详情",style:{width:"700px"}},{default:t(()=>[s.value?(u(),r(a(E),{key:0,column:2,"label-placement":"left",bordered:""},{default:t(()=>[l(a(f),{label:"工具名称"},{default:t(()=>[l(a(_),{type:"info"},{default:t(()=>[d(m(s.value.toolName),1)]),_:1})]),_:1}),l(a(f),{label:"状态"},{default:t(()=>[l(a(_),{type:s.value.success?"success":"error"},{default:t(()=>[d(m(s.value.success?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),l(a(f),{label:"用户ID"},{default:t(()=>[d(m(s.value.userId||"-"),1)]),_:1}),l(a(f),{label:"耗时"},{default:t(()=>[d(m(s.value.duration?s.value.duration+"ms":"-"),1)]),_:1}),l(a(f),{label:"时间",span:2},{default:t(()=>[d(m(T(s.value.timestamp)),1)]),_:1})]),_:1})):p("",!0),s.value?.arguments?(u(),r(a(k),{key:1,title:"请求参数",size:"small",style:{"margin-top":"16px"}},{default:t(()=>[l(z,{code:I(s.value.arguments),language:"json"},null,8,["code"])]),_:1})):p("",!0),s.value?.result?(u(),r(a(k),{key:2,title:"返回结果",size:"small",style:{"margin-top":"16px"}},{default:t(()=>[l(z,{code:I(s.value.result),language:"json","max-height":"300px"},null,8,["code"])]),_:1})):p("",!0),s.value?.error?(u(),r(a(k),{key:3,title:"错误信息",size:"small",style:{"margin-top":"16px"}},{default:t(()=>[l(z,{code:s.value.error,language:"text"},null,8,["code"])]),_:1})):p("",!0)]),_:1},8,["show"])]),_:1}))}};export{le as default};
