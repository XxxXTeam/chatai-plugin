import{K as L,w as d,A as V,L as $,M as b,O as a,P as t,Q as N,R as I,S as h,T as l,U as O,ar as P,N as q,aq as U,B as f,V as o,b7 as F,W as x,a1 as Q,$ as i,a0 as S,X as R,Y as j,Z as E,h as c}from"./index-B2LdyV3q.js";import{S as K}from"./SearchOutlined-g7Tu8wVe.js";import{N as W}from"./DataTable-BT0ImAqy.js";import{N as X,a as n}from"./DescriptionsItem-CDmnTqXH.js";import{N as Y}from"./Switch-DCPZ4aqg.js";import{N as Z}from"./Popconfirm-DM5xIF5w.js";import"./Select-_h7lzeeB.js";const G={style:{"margin-left":"10px",color:"#999"}},oe={__name:"Users",setup(H){const v=L(),y=d(!1),g=d([]),k=d(""),_=d(!1),r=d(null),p=d(!1),m=d({blocked:!1}),z=[{title:"用户ID",key:"userId",width:150,ellipsis:{tooltip:!0}},{title:"昵称",key:"nickname",width:120,ellipsis:{tooltip:!0}},{title:"对话数",key:"conversationCount",width:80,align:"center"},{title:"消息数",key:"messageCount",width:80,align:"center"},{title:"最后活动",key:"lastActivity",width:140,render:e=>C(e.lastActivity)},{title:"状态",key:"status",width:80,render:e=>e.blocked?c(S,{type:"error",size:"small"},()=>"已封禁"):c(S,{type:"success",size:"small"},()=>"正常")},{title:"操作",key:"actions",width:180,render:e=>c(N,{size:"small"},()=>[c(f,{size:"small",onClick:()=>M(e)},()=>"详情"),c(f,{size:"small",type:"info",onClick:()=>T(e)},()=>"设置"),c(Z,{onPositiveClick:()=>B(e.userId)},{trigger:()=>c(f,{size:"small",type:"warning"},()=>"清除"),default:()=>"确定清除该用户的所有数据？"})])}],D=V(()=>{if(!k.value)return g.value;const e=k.value.toLowerCase();return g.value.filter(s=>s.userId?.toLowerCase().includes(e)||s.nickname?.toLowerCase().includes(e))});async function w(){y.value=!0;try{const e=await I.get("/api/users/list");e.data.code===0&&(g.value=e.data.data||[])}catch(e){v.error("获取用户列表失败: "+e.message)}finally{y.value=!1}}function M(e){r.value=e,_.value=!0}function T(e){r.value=e,m.value={blocked:e.blocked||!1},p.value=!0}async function A(){try{(await I.put(`/api/users/${r.value.userId}/settings`,m.value)).data.code===0&&(v.success("设置已保存"),p.value=!1,w())}catch(e){v.error("保存失败: "+e.message)}}async function B(e){try{(await I.delete(`/api/users/${e}/data`)).data.code===0&&(v.success("用户数据已清除"),w())}catch(s){v.error("清除失败: "+s.message)}}function C(e){return e?new Date(e).toLocaleString("zh-CN"):"-"}return $(()=>{w()}),(e,s)=>(h(),b(t(N),{vertical:"",size:"large"},{default:a(()=>[l(t(O),{title:"用户管理"},{"header-extra":a(()=>[l(t(N),null,{default:a(()=>[l(t(q),{value:k.value,"onUpdate:value":s[0]||(s[0]=u=>k.value=u),placeholder:"搜索用户ID或昵称",clearable:"",style:{width:"200px"}},{prefix:a(()=>[l(t(U),null,{default:a(()=>[l(t(K))]),_:1})]),_:1},8,["value"]),l(t(f),{onClick:w,loading:y.value},{icon:a(()=>[l(t(U),null,{default:a(()=>[l(t(F))]),_:1})]),default:a(()=>[s[5]||(s[5]=o(" 刷新 ",-1))]),_:1},8,["loading"])]),_:1})]),default:a(()=>[g.value.length===0?(h(),b(t(P),{key:0,description:"暂无用户数据"})):(h(),b(t(W),{key:1,columns:z,data:D.value,loading:y.value,pagination:{pageSize:20},bordered:!1,striped:""},null,8,["data","loading"]))]),_:1}),l(t(x),{show:_.value,"onUpdate:show":s[1]||(s[1]=u=>_.value=u),preset:"card",title:"用户详情",style:{width:"500px"}},{default:a(()=>[r.value?(h(),b(t(X),{key:0,column:1,"label-placement":"left",bordered:""},{default:a(()=>[l(t(n),{label:"用户ID"},{default:a(()=>[o(i(r.value.userId),1)]),_:1}),l(t(n),{label:"昵称"},{default:a(()=>[o(i(r.value.nickname||"-"),1)]),_:1}),l(t(n),{label:"对话数"},{default:a(()=>[o(i(r.value.conversationCount||0),1)]),_:1}),l(t(n),{label:"消息数"},{default:a(()=>[o(i(r.value.messageCount||0),1)]),_:1}),l(t(n),{label:"Token使用"},{default:a(()=>[o(i(r.value.tokenUsage||0),1)]),_:1}),l(t(n),{label:"首次活动"},{default:a(()=>[o(i(C(r.value.firstActivity)),1)]),_:1}),l(t(n),{label:"最后活动"},{default:a(()=>[o(i(C(r.value.lastActivity)),1)]),_:1}),l(t(n),{label:"状态"},{default:a(()=>[l(t(S),{type:r.value.blocked?"error":"success",size:"small"},{default:a(()=>[o(i(r.value.blocked?"已封禁":"正常"),1)]),_:1},8,["type"])]),_:1})]),_:1})):Q("",!0)]),_:1},8,["show"]),l(t(x),{show:p.value,"onUpdate:show":s[4]||(s[4]=u=>p.value=u),preset:"card",title:"用户设置",style:{width:"350px"}},{footer:a(()=>[l(t(N),{justify:"end"},{default:a(()=>[l(t(f),{onClick:s[3]||(s[3]=u=>p.value=!1)},{default:a(()=>[...s[6]||(s[6]=[o("取消",-1)])]),_:1}),l(t(f),{type:"primary",onClick:A},{default:a(()=>[...s[7]||(s[7]=[o("保存",-1)])]),_:1})]),_:1})]),default:a(()=>[l(t(R),{"label-placement":"left","label-width":"80"},{default:a(()=>[l(t(j),{label:"封禁用户"},{default:a(()=>[l(t(Y),{value:m.value.blocked,"onUpdate:value":s[2]||(s[2]=u=>m.value.blocked=u)},null,8,["value"]),E("span",G,i(m.value.blocked?"已封禁":"正常"),1)]),_:1})]),_:1})]),_:1},8,["show"])]),_:1}))}};export{oe as default};
