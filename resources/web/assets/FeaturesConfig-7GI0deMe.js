import{K as O,x as T,L as h,a2 as C,T as a,O as u,P as e,Q as U,R as g,S as i,U as p,a6 as _,V as m,B as x,$ as B,X as y,a1 as b,Y as r,a3 as M,M as R,at as z,au as k,N as V}from"./index-C-g6fVkQ.js";import{N as d}from"./Switch-C9jqgi4b.js";import{N as L}from"./Select-DCQcYpn3.js";import{N as Q}from"./InputNumber-CTGRQPAb.js";import"./Add-CPzzEKz0.js";const D={__name:"FeaturesConfig",setup(q){const s=O(),w=T(!1),N=T(!1),t=T({voiceReply:{enabled:!1,triggerOnTool:!0,triggerAlways:!1,ttsProvider:"miao",maxTextLength:500},groupContext:{enabled:!0,maxMessages:20},autoMemory:{enabled:!0,extractOnChat:!0},replyQuote:{enabled:!0,handleText:!0,handleImage:!0,handleFile:!0,handleForward:!0},atTrigger:{enabled:!0,requireAt:!0,prefix:""}}),v=T({hasPermanentToken:!1,tempTokenCount:0}),F=[{label:"Miao-Yunzai TTS",value:"miao"},{label:"VITS",value:"vits"},{label:"Edge TTS",value:"edge"},{label:"OpenAI TTS",value:"openai"},{label:"系统默认",value:"system"}],f=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`});async function P(){w.value=!0;try{const[o,l]=await Promise.all([g.get("/api/features",{headers:f()}),g.get("/api/auth/token/status",{headers:f()})]);o.data?.data&&(t.value={...t.value,...o.data.data}),l.data?.data&&(v.value=l.data.data)}catch(o){s.error("加载配置失败: "+o.message)}finally{w.value=!1}}async function S(){N.value=!0;try{await g.put("/api/features",t.value,{headers:f()}),s.success("配置已保存")}catch(o){s.error("保存失败: "+o.message)}finally{N.value=!1}}async function A(){try{const o=await g.post("/api/auth/token/permanent",{},{headers:f()});o.data?.data?.token&&(s.success("永久Token已生成"),v.value.hasPermanentToken=!0,await navigator.clipboard.writeText(o.data.data.token),s.info("Token已复制到剪贴板"))}catch(o){s.error("生成失败: "+o.message)}}async function I(){try{await g.delete("/api/auth/token/permanent",{headers:f()}),s.success("永久Token已撤销"),v.value.hasPermanentToken=!1}catch(o){s.error("撤销失败: "+o.message)}}return h(()=>{P()}),(o,l)=>(i(),C("div",null,[a(e(U),{vertical:"",size:"large"},{default:u(()=>[a(e(p),{title:"管理面板认证"},{default:u(()=>[a(e(_),{type:"info",style:{"margin-bottom":"16px"}},{default:u(()=>[...l[17]||(l[17]=[m(" 永久Token可以让你无需每次都重新获取临时链接即可访问管理面板。 ",-1)])]),_:1}),a(e(U),null,{default:u(()=>[a(e(x),{type:"primary",onClick:A,disabled:v.value.hasPermanentToken},{default:u(()=>[m(B(v.value.hasPermanentToken?"已有永久Token":"生成永久Token"),1)]),_:1},8,["disabled"]),a(e(x),{type:"error",onClick:I,disabled:!v.value.hasPermanentToken},{default:u(()=>[...l[18]||(l[18]=[m(" 撤销永久Token ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),a(e(p),{title:"语音回复"},{default:u(()=>[a(e(y),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(e(r),{label:"启用语音回复"},{default:u(()=>[a(e(d),{value:t.value.voiceReply.enabled,"onUpdate:value":l[0]||(l[0]=n=>t.value.voiceReply.enabled=n)},null,8,["value"])]),_:1}),t.value.voiceReply.enabled?(i(),C(M,{key:0},[a(e(r),{label:"工具调用后触发"},{default:u(()=>[a(e(d),{value:t.value.voiceReply.triggerOnTool,"onUpdate:value":l[1]||(l[1]=n=>t.value.voiceReply.triggerOnTool=n)},null,8,["value"])]),_:1}),a(e(r),{label:"始终语音回复"},{default:u(()=>[a(e(d),{value:t.value.voiceReply.triggerAlways,"onUpdate:value":l[2]||(l[2]=n=>t.value.voiceReply.triggerAlways=n)},null,8,["value"])]),_:1}),a(e(r),{label:"TTS 提供者"},{default:u(()=>[a(e(L),{value:t.value.voiceReply.ttsProvider,"onUpdate:value":l[3]||(l[3]=n=>t.value.voiceReply.ttsProvider=n),options:F,style:{width:"200px"}},null,8,["value"])]),_:1}),a(e(r),{label:"最大文本长度"},{default:u(()=>[a(e(Q),{value:t.value.voiceReply.maxTextLength,"onUpdate:value":l[4]||(l[4]=n=>t.value.voiceReply.maxTextLength=n),min:100,max:2e3,style:{width:"150px"}},null,8,["value"])]),_:1})],64)):b("",!0)]),_:1})]),_:1}),a(e(p),{title:"引用消息处理"},{default:u(()=>[a(e(y),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(e(r),{label:"启用引用处理"},{default:u(()=>[a(e(d),{value:t.value.replyQuote.enabled,"onUpdate:value":l[5]||(l[5]=n=>t.value.replyQuote.enabled=n)},null,8,["value"])]),_:1}),t.value.replyQuote.enabled?(i(),R(e(z),{key:0,cols:2,"x-gap":24},{default:u(()=>[a(e(k),null,{default:u(()=>[a(e(r),{label:"处理引用文本"},{default:u(()=>[a(e(d),{value:t.value.replyQuote.handleText,"onUpdate:value":l[6]||(l[6]=n=>t.value.replyQuote.handleText=n)},null,8,["value"])]),_:1})]),_:1}),a(e(k),null,{default:u(()=>[a(e(r),{label:"处理引用图片"},{default:u(()=>[a(e(d),{value:t.value.replyQuote.handleImage,"onUpdate:value":l[7]||(l[7]=n=>t.value.replyQuote.handleImage=n)},null,8,["value"])]),_:1})]),_:1}),a(e(k),null,{default:u(()=>[a(e(r),{label:"处理引用文件"},{default:u(()=>[a(e(d),{value:t.value.replyQuote.handleFile,"onUpdate:value":l[8]||(l[8]=n=>t.value.replyQuote.handleFile=n)},null,8,["value"])]),_:1})]),_:1}),a(e(k),null,{default:u(()=>[a(e(r),{label:"处理转发消息"},{default:u(()=>[a(e(d),{value:t.value.replyQuote.handleForward,"onUpdate:value":l[9]||(l[9]=n=>t.value.replyQuote.handleForward=n)},null,8,["value"])]),_:1})]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1}),a(e(p),{title:"@触发配置"},{default:u(()=>[a(e(y),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(e(r),{label:"启用@触发"},{default:u(()=>[a(e(d),{value:t.value.atTrigger.enabled,"onUpdate:value":l[10]||(l[10]=n=>t.value.atTrigger.enabled=n)},null,8,["value"])]),_:1}),t.value.atTrigger.enabled?(i(),C(M,{key:0},[a(e(r),{label:"需要@机器人"},{default:u(()=>[a(e(d),{value:t.value.atTrigger.requireAt,"onUpdate:value":l[11]||(l[11]=n=>t.value.atTrigger.requireAt=n)},null,8,["value"])]),_:1}),a(e(r),{label:"触发前缀"},{default:u(()=>[a(e(V),{value:t.value.atTrigger.prefix,"onUpdate:value":l[12]||(l[12]=n=>t.value.atTrigger.prefix=n),placeholder:"可选，如 #ai",style:{width:"200px"}},null,8,["value"])]),_:1})],64)):b("",!0)]),_:1})]),_:1}),a(e(p),{title:"群聊上下文"},{default:u(()=>[a(e(y),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(e(r),{label:"启用群聊上下文"},{default:u(()=>[a(e(d),{value:t.value.groupContext.enabled,"onUpdate:value":l[13]||(l[13]=n=>t.value.groupContext.enabled=n)},null,8,["value"])]),_:1}),t.value.groupContext.enabled?(i(),R(e(r),{key:0,label:"最大消息数"},{default:u(()=>[a(e(Q),{value:t.value.groupContext.maxMessages,"onUpdate:value":l[14]||(l[14]=n=>t.value.groupContext.maxMessages=n),min:5,max:100,style:{width:"150px"}},null,8,["value"])]),_:1})):b("",!0)]),_:1})]),_:1}),a(e(p),{title:"自动记忆"},{default:u(()=>[a(e(y),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(e(r),{label:"启用自动记忆"},{default:u(()=>[a(e(d),{value:t.value.autoMemory.enabled,"onUpdate:value":l[15]||(l[15]=n=>t.value.autoMemory.enabled=n)},null,8,["value"])]),_:1}),t.value.autoMemory.enabled?(i(),R(e(r),{key:0,label:"聊天时自动提取"},{default:u(()=>[a(e(d),{value:t.value.autoMemory.extractOnChat,"onUpdate:value":l[16]||(l[16]=n=>t.value.autoMemory.extractOnChat=n)},null,8,["value"])]),_:1})):b("",!0)]),_:1})]),_:1}),a(e(U),{justify:"center"},{default:u(()=>[a(e(x),{type:"primary",size:"large",onClick:S,loading:N.value},{default:u(()=>[...l[19]||(l[19]=[m(" 保存所有配置 ",-1)])]),_:1},8,["loading"]),a(e(x),{size:"large",onClick:P,loading:w.value},{default:u(()=>[...l[20]||(l[20]=[m(" 重新加载 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]))}};export{D as default};
