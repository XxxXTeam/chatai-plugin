import{K as V,x as T,L,a2 as N,T as a,O as u,P as e,Q as y,R as p,S as g,U as m,a6 as M,V as d,B as k,$ as C,X as b,a1 as x,Y as n,a3 as Q,M as R,aw as h,ax as I,N as q,Z as F}from"./index-CNHZuXR0.js";import{N as r}from"./Switch-WgLNg2WF.js";import{N as D}from"./Select-DMfqE7AC.js";import{N as S}from"./InputNumber-3m_ocw6I.js";import{N as A}from"./Divider-C7wFyvzq.js";import"./Add-CFEAcTeM.js";const E={style:{color:"#888","font-size":"13px"}},G={style:{color:"#888","font-size":"13px"}},J={__name:"FeaturesConfig",setup(Y){const i=V(),U=T(!1),w=T(!1),t=T({voiceReply:{enabled:!1,triggerOnTool:!0,triggerAlways:!1,ttsProvider:"miao",maxTextLength:500},groupContext:{enabled:!0,maxMessages:20},autoMemory:{enabled:!0,extractOnChat:!0},replyQuote:{enabled:!0,handleText:!0,handleImage:!0,handleFile:!0,handleForward:!0},atTrigger:{enabled:!0,requireAt:!0,prefix:""},contextIsolation:{groupUserIsolation:!1,privateIsolation:!0}}),f=T({hasPermanentToken:!1,tempTokenCount:0}),O=[{label:"Miao-Yunzai TTS",value:"miao"},{label:"VITS",value:"vits"},{label:"Edge TTS",value:"edge"},{label:"OpenAI TTS",value:"openai"},{label:"系统默认",value:"system"}],v=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`});async function P(){U.value=!0;try{const[s,l,o]=await Promise.all([p.get("/api/features",{headers:v()}),p.get("/api/auth/token/status",{headers:v()}),p.get("/api/config/context",{headers:v()})]);s.data?.data&&(t.value={...t.value,...s.data.data}),l.data?.data&&(f.value=l.data.data),o.data?.data?.isolation&&(t.value.contextIsolation={groupUserIsolation:o.data.data.isolation.groupUserIsolation??!1,privateIsolation:o.data.data.isolation.privateIsolation??!0})}catch(s){i.error("加载配置失败: "+s.message)}finally{U.value=!1}}async function _(){w.value=!0;try{await p.put("/api/features",t.value,{headers:v()}),await p.patch("/api/config/context",{isolation:t.value.contextIsolation},{headers:v()}),i.success("配置已保存")}catch(s){i.error("保存失败: "+s.message)}finally{w.value=!1}}async function z(){try{const s=await p.post("/api/auth/token/permanent",{},{headers:v()});s.data?.data?.token&&(i.success("永久Token已生成"),f.value.hasPermanentToken=!0,await navigator.clipboard.writeText(s.data.data.token),i.info("Token已复制到剪贴板"))}catch(s){i.error("生成失败: "+s.message)}}async function B(){try{await p.delete("/api/auth/token/permanent",{headers:v()}),i.success("永久Token已撤销"),f.value.hasPermanentToken=!1}catch(s){i.error("撤销失败: "+s.message)}}return L(()=>{P()}),(s,l)=>(g(),N("div",null,[a(e(y),{vertical:"",size:"large"},{default:u(()=>[a(e(m),{title:"管理面板认证"},{default:u(()=>[a(e(M),{type:"info",style:{"margin-bottom":"16px"}},{default:u(()=>[...l[19]||(l[19]=[d(" 永久Token可以让你无需每次都重新获取临时链接即可访问管理面板。 ",-1)])]),_:1}),a(e(y),null,{default:u(()=>[a(e(k),{type:"primary",onClick:z,disabled:f.value.hasPermanentToken},{default:u(()=>[d(C(f.value.hasPermanentToken?"已有永久Token":"生成永久Token"),1)]),_:1},8,["disabled"]),a(e(k),{type:"error",onClick:B,disabled:!f.value.hasPermanentToken},{default:u(()=>[...l[20]||(l[20]=[d(" 撤销永久Token ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),a(e(m),{title:"语音回复"},{default:u(()=>[a(e(b),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(e(n),{label:"启用语音回复"},{default:u(()=>[a(e(r),{value:t.value.voiceReply.enabled,"onUpdate:value":l[0]||(l[0]=o=>t.value.voiceReply.enabled=o)},null,8,["value"])]),_:1}),t.value.voiceReply.enabled?(g(),N(Q,{key:0},[a(e(n),{label:"工具调用后触发"},{default:u(()=>[a(e(r),{value:t.value.voiceReply.triggerOnTool,"onUpdate:value":l[1]||(l[1]=o=>t.value.voiceReply.triggerOnTool=o)},null,8,["value"])]),_:1}),a(e(n),{label:"始终语音回复"},{default:u(()=>[a(e(r),{value:t.value.voiceReply.triggerAlways,"onUpdate:value":l[2]||(l[2]=o=>t.value.voiceReply.triggerAlways=o)},null,8,["value"])]),_:1}),a(e(n),{label:"TTS 提供者"},{default:u(()=>[a(e(D),{value:t.value.voiceReply.ttsProvider,"onUpdate:value":l[3]||(l[3]=o=>t.value.voiceReply.ttsProvider=o),options:O,style:{width:"200px"}},null,8,["value"])]),_:1}),a(e(n),{label:"最大文本长度"},{default:u(()=>[a(e(S),{value:t.value.voiceReply.maxTextLength,"onUpdate:value":l[4]||(l[4]=o=>t.value.voiceReply.maxTextLength=o),min:100,max:2e3,style:{width:"150px"}},null,8,["value"])]),_:1})],64)):x("",!0)]),_:1})]),_:1}),a(e(m),{title:"引用消息处理"},{default:u(()=>[a(e(b),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(e(n),{label:"启用引用处理"},{default:u(()=>[a(e(r),{value:t.value.replyQuote.enabled,"onUpdate:value":l[5]||(l[5]=o=>t.value.replyQuote.enabled=o)},null,8,["value"])]),_:1}),t.value.replyQuote.enabled?(g(),R(e(h),{key:0,cols:2,"x-gap":24},{default:u(()=>[a(e(I),null,{default:u(()=>[a(e(n),{label:"处理引用文本"},{default:u(()=>[a(e(r),{value:t.value.replyQuote.handleText,"onUpdate:value":l[6]||(l[6]=o=>t.value.replyQuote.handleText=o)},null,8,["value"])]),_:1})]),_:1}),a(e(I),null,{default:u(()=>[a(e(n),{label:"处理引用图片"},{default:u(()=>[a(e(r),{value:t.value.replyQuote.handleImage,"onUpdate:value":l[7]||(l[7]=o=>t.value.replyQuote.handleImage=o)},null,8,["value"])]),_:1})]),_:1}),a(e(I),null,{default:u(()=>[a(e(n),{label:"处理引用文件"},{default:u(()=>[a(e(r),{value:t.value.replyQuote.handleFile,"onUpdate:value":l[8]||(l[8]=o=>t.value.replyQuote.handleFile=o)},null,8,["value"])]),_:1})]),_:1}),a(e(I),null,{default:u(()=>[a(e(n),{label:"处理转发消息"},{default:u(()=>[a(e(r),{value:t.value.replyQuote.handleForward,"onUpdate:value":l[9]||(l[9]=o=>t.value.replyQuote.handleForward=o)},null,8,["value"])]),_:1})]),_:1})]),_:1})):x("",!0)]),_:1})]),_:1}),a(e(m),{title:"@触发配置"},{default:u(()=>[a(e(b),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(e(n),{label:"启用@触发"},{default:u(()=>[a(e(r),{value:t.value.atTrigger.enabled,"onUpdate:value":l[10]||(l[10]=o=>t.value.atTrigger.enabled=o)},null,8,["value"])]),_:1}),t.value.atTrigger.enabled?(g(),N(Q,{key:0},[a(e(n),{label:"需要@机器人"},{default:u(()=>[a(e(r),{value:t.value.atTrigger.requireAt,"onUpdate:value":l[11]||(l[11]=o=>t.value.atTrigger.requireAt=o)},null,8,["value"])]),_:1}),a(e(n),{label:"触发前缀"},{default:u(()=>[a(e(q),{value:t.value.atTrigger.prefix,"onUpdate:value":l[12]||(l[12]=o=>t.value.atTrigger.prefix=o),placeholder:"可选，如 #ai",style:{width:"200px"}},null,8,["value"])]),_:1})],64)):x("",!0)]),_:1})]),_:1}),a(e(m),{title:"上下文与隔离"},{default:u(()=>[a(e(M),{type:"info",style:{"margin-bottom":"16px"}},{default:u(()=>[...l[21]||(l[21]=[d(" 上下文隔离决定了不同用户/群聊是否共享对话历史。 ",-1)])]),_:1}),a(e(b),{"label-placement":"left","label-width":"180px"},{default:u(()=>[a(e(A),{"title-placement":"left"},{default:u(()=>[...l[22]||(l[22]=[d("上下文配置",-1)])]),_:1}),a(e(n),{label:"启用群聊上下文"},{default:u(()=>[a(e(r),{value:t.value.groupContext.enabled,"onUpdate:value":l[13]||(l[13]=o=>t.value.groupContext.enabled=o)},null,8,["value"])]),_:1}),t.value.groupContext.enabled?(g(),R(e(n),{key:0,label:"最大消息数"},{default:u(()=>[a(e(S),{value:t.value.groupContext.maxMessages,"onUpdate:value":l[14]||(l[14]=o=>t.value.groupContext.maxMessages=o),min:5,max:100,style:{width:"150px"}},null,8,["value"])]),_:1})):x("",!0),a(e(A),{"title-placement":"left"},{default:u(()=>[...l[23]||(l[23]=[d("隔离模式",-1)])]),_:1}),a(e(n),{label:"群聊用户隔离"},{default:u(()=>[a(e(y),{align:"center"},{default:u(()=>[a(e(r),{value:t.value.contextIsolation.groupUserIsolation,"onUpdate:value":l[15]||(l[15]=o=>t.value.contextIsolation.groupUserIsolation=o)},null,8,["value"]),F("span",E,C(t.value.contextIsolation.groupUserIsolation?"每个用户独立上下文":"同群用户共享上下文（会添加用户标签区分）"),1)]),_:1})]),_:1}),a(e(n),{label:"私聊用户隔离"},{default:u(()=>[a(e(y),{align:"center"},{default:u(()=>[a(e(r),{value:t.value.contextIsolation.privateIsolation,"onUpdate:value":l[16]||(l[16]=o=>t.value.contextIsolation.privateIsolation=o)},null,8,["value"]),F("span",G,C(t.value.contextIsolation.privateIsolation?"每个用户独立上下文":"所有私聊共享上下文"),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(e(m),{title:"自动记忆"},{default:u(()=>[a(e(b),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(e(n),{label:"启用自动记忆"},{default:u(()=>[a(e(r),{value:t.value.autoMemory.enabled,"onUpdate:value":l[17]||(l[17]=o=>t.value.autoMemory.enabled=o)},null,8,["value"])]),_:1}),t.value.autoMemory.enabled?(g(),R(e(n),{key:0,label:"聊天时自动提取"},{default:u(()=>[a(e(r),{value:t.value.autoMemory.extractOnChat,"onUpdate:value":l[18]||(l[18]=o=>t.value.autoMemory.extractOnChat=o)},null,8,["value"])]),_:1})):x("",!0)]),_:1})]),_:1}),a(e(y),{justify:"center"},{default:u(()=>[a(e(k),{type:"primary",size:"large",onClick:_,loading:w.value},{default:u(()=>[...l[24]||(l[24]=[d(" 保存所有配置 ",-1)])]),_:1},8,["loading"]),a(e(k),{size:"large",onClick:P,loading:U.value},{default:u(()=>[...l[25]||(l[25]=[d(" 重新加载 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]))}};export{J as default};
