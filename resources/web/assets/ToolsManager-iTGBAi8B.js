import{d as gl,h as c,ae as yl,x as d,A as bl,_ as wl,C as q,a2 as ee,S as y,Z as n,af as hl,ag as kl,K as xl,L as Sl,M as $,O as s,P as t,Q as i,R as g,ah as Tl,T as a,a8 as Be,a9 as re,U as O,ai as ce,N as U,B as f,V as o,a1 as M,a6 as V,X as ve,Y as x,$ as C,a3 as ge,a4 as Ue,ad as Nl,W as Z,a0 as S}from"./index-BDK2Knud.js";import{C as oe}from"./CodeBlock-BQNeydBS.js";import{N as Cl,a as ne}from"./DescriptionsItem-BOtbfrY8.js";import{N as zl,a as X}from"./Tabs-K7ULBpHF.js";import{N as ye}from"./Select-CWE4u-Bm.js";import{N as ue}from"./DataTable-Dgq0C0vF.js";import{N as Se}from"./Switch-CPc_tZoJ.js";import{N as Te}from"./DynamicTags-BUlSrW1A.js";import{N as G}from"./text-CXMtoSGu.js";import{N as Ne,a as Ce}from"./CollapseItem-BwlrT48U.js";import{N as jl}from"./Divider-Du8DunKT.js";import{N as ze}from"./Popconfirm-CFa-dZgS.js";import"./Add-BPG2yJa0.js";import"./prop-NnGblK-3.js";const Jl=Object.assign(Object.assign({},bl.props),{trigger:String,xScrollable:Boolean,onScroll:Function,contentClass:String,contentStyle:[Object,String],size:Number,yPlacement:{type:String,default:"right"},xPlacement:{type:String,default:"bottom"}}),Pe=gl({name:"Scrollbar",props:Jl,setup(){const D=d(null);return Object.assign(Object.assign({},{scrollTo:(...h)=>{var T;(T=D.value)===null||T===void 0||T.scrollTo(h[0],h[1])},scrollBy:(...h)=>{var T;(T=D.value)===null||T===void 0||T.scrollBy(h[0],h[1])}}),{scrollbarInstRef:D})},render(){return c(yl,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}}),$l={class:"code-editor"},_l=["innerHTML"],Ol=["placeholder","rows","readonly"],Bl={__name:"CodeEditor",props:{modelValue:{type:String,default:""},language:{type:String,default:"javascript"},placeholder:{type:String,default:""},rows:{type:Number,default:10},readonly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(D,{emit:u}){const h=D,T=u,L=d(null),E=d(null),A=q({get:()=>h.modelValue,set:p=>T("update:modelValue",p)}),K=q(()=>{if(!h.modelValue)return"";let p=ie(h.modelValue);return h.language==="javascript"||h.language==="js"?p=le(p):h.language==="json"&&(p=j(p)),p+`
`});function ie(p){return p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function le(p){const k=/\b(const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|try|catch|finally|throw|new|typeof|instanceof|class|extends|async|await|import|export|default|from|of|in)\b/g,b=/\b(console|Math|JSON|Date|Array|Object|String|Number|Boolean|Promise|Error|runtime|args|ctx|fetch|Bot|logger|config|Redis)\b/g,_=/(["'`])(?:(?!\1)[^\\]|\\.)*?\1/g,m=/(\/\/.*$|\/\*[\s\S]*?\*\/)/gm,v=/\b(\d+\.?\d*)\b/g,ae=/\b(true|false|null|undefined)\b/g;return p.replace(m,'<span class="hl-comment">$1</span>').replace(_,'<span class="hl-string">$&</span>').replace(k,'<span class="hl-keyword">$1</span>').replace(b,'<span class="hl-builtin">$1</span>').replace(ae,'<span class="hl-bool">$1</span>').replace(v,'<span class="hl-number">$1</span>')}function j(p){return p.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,k=>{let b="hl-number";return/^"/.test(k)?/:$/.test(k)?b="hl-key":b="hl-string":/true|false/.test(k)?b="hl-bool":/null/.test(k)&&(b="hl-null"),`<span class="${b}">${k}</span>`})}function te(){E.value&&L.value&&(E.value.scrollTop=L.value.scrollTop,E.value.scrollLeft=L.value.scrollLeft)}function F(p){if(p.key==="Tab"){p.preventDefault();const k=p.target.selectionStart,b=p.target.selectionEnd,_=p.target.value;p.target.value=_.substring(0,k)+"  "+_.substring(b),p.target.selectionStart=p.target.selectionEnd=k+2,A.value=p.target.value}}return(p,k)=>(y(),ee("div",$l,[n("pre",{ref_key:"highlightRef",ref:E,class:"highlight-layer",innerHTML:K.value,"aria-hidden":"true"},null,8,_l),hl(n("textarea",{ref_key:"textareaRef",ref:L,"onUpdate:modelValue":k[0]||(k[0]=b=>A.value=b),class:"input-layer",placeholder:D.placeholder,rows:D.rows,readonly:D.readonly,spellcheck:"false",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onScroll:te,onKeydown:F},null,40,Ol),[[kl,A.value]])]))}},je=wl(Bl,[["__scopeId","data-v-c9dc239f"]]),Ul={key:0},Wl={__name:"ToolsManager",setup(D){const u=xl(),h=d(!1),T=d([]),L=d([]),E=d(""),A=d(null),K=d(null),ie=d("tools"),le=d(!1),j=d(null),te=d(!1),F=d("{}"),p=d(""),k=d(!1),b=d(!1),_=d(!1),m=d({name:"",type:"stdio",command:"",args:"",url:"",env:"",scriptPath:""}),v=d({enabled:!0,allowedTools:[],disabledTools:[],dangerousTools:["kick_member","mute_member","recall_message","set_group_ban","set_group_whole_ban"],allowDangerous:!1}),ae=d([]),Q=d(!1),R=d(!1),w=d({name:"",description:"",parameters:"{}",handler:""}),Je=[{name:"hello_world",label:"Hello World (åŸºç¡€ç¤ºä¾‹)",description:"ä¸€ä¸ªç®€å•çš„é—®å€™å·¥å…·ï¼Œè¿”å›žé—®å€™è¯­",parameters:JSON.stringify({type:"object",properties:{name:{type:"string",description:"è¦é—®å€™çš„åå­—"}},required:["name"]},null,2),handler:`// è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å·¥å…·
// args åŒ…å«ç”¨æˆ·ä¼ å…¥çš„å‚æ•°
// ctx åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆbot, event ç­‰ï¼‰

const { name } = args
return {
  text: \`ä½ å¥½ï¼Œ\${name}ï¼æ¬¢è¿Žä½¿ç”¨è‡ªå®šä¹‰å·¥å…·ã€‚\`,
  greeting: true,
  timestamp: Date.now()
}`},{name:"random_number",label:"éšæœºæ•°ç”Ÿæˆå™¨",description:"ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°",parameters:JSON.stringify({type:"object",properties:{min:{type:"number",description:"æœ€å°å€¼",default:1},max:{type:"number",description:"æœ€å¤§å€¼",default:100}}},null,2),handler:`const min = args.min || 1
const max = args.max || 100
const result = Math.floor(Math.random() * (max - min + 1)) + min

return {
  text: \`ç”Ÿæˆçš„éšæœºæ•°æ˜¯: \${result}\`,
  number: result,
  range: { min, max }
}`},{name:"fetch_api",label:"API è¯·æ±‚å·¥å…·",description:"å‘é€ HTTP è¯·æ±‚èŽ·å–æ•°æ®",parameters:JSON.stringify({type:"object",properties:{url:{type:"string",description:"è¯·æ±‚çš„ URL"},method:{type:"string",description:"è¯·æ±‚æ–¹æ³•",enum:["GET","POST"],default:"GET"}},required:["url"]},null,2),handler:`// ä½¿ç”¨ fetch å‘é€è¯·æ±‚
const { url, method = 'GET' } = args

try {
  const response = await fetch(url, { method })
  const data = await response.json()
  return {
    text: \`è¯·æ±‚æˆåŠŸï¼ŒçŠ¶æ€ç : \${response.status}\`,
    data,
    status: response.status
  }
} catch (error) {
  return {
    error: \`è¯·æ±‚å¤±è´¥: \${error.message}\`,
    url
  }
}`},{name:"send_message_tool",label:"å‘é€æ¶ˆæ¯å·¥å…·",description:"ä½¿ç”¨ Bot å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šç¾¤",parameters:JSON.stringify({type:"object",properties:{group_id:{type:"string",description:"ç¾¤å·"},message:{type:"string",description:"æ¶ˆæ¯å†…å®¹"}},required:["group_id","message"]},null,2),handler:`// ä½¿ç”¨ ctx.getBot() èŽ·å– Bot å®žä¾‹
const bot = ctx.getBot()
const { group_id, message } = args

try {
  const group = bot.pickGroup(parseInt(group_id))
  const result = await group.sendMsg(message)
  return {
    text: \`æ¶ˆæ¯å·²å‘é€åˆ°ç¾¤ \${group_id}\`,
    success: true,
    message_id: result.message_id
  }
} catch (error) {
  return {
    error: \`å‘é€å¤±è´¥: \${error.message}\`
  }
}`},{name:"current_time",label:"å½“å‰æ—¶é—´",description:"èŽ·å–å½“å‰æ—¶é—´ä¿¡æ¯",parameters:JSON.stringify({type:"object",properties:{format:{type:"string",description:"æ—¶é—´æ ¼å¼",enum:["full","date","time"],default:"full"}}},null,2),handler:`const now = new Date()
const format = args.format || 'full'

let result
switch (format) {
  case 'date':
    result = now.toLocaleDateString('zh-CN')
    break
  case 'time':
    result = now.toLocaleTimeString('zh-CN')
    break
  default:
    result = now.toLocaleString('zh-CN')
}

return {
  text: \`å½“å‰æ—¶é—´: \${result}\`,
  timestamp: now.getTime(),
  formatted: result
}`},{name:"redis_cache",label:"Redis ç¼“å­˜æ“ä½œ",description:"ä½¿ç”¨ Redis å­˜å–æ•°æ®",parameters:JSON.stringify({type:"object",properties:{action:{type:"string",description:"æ“ä½œç±»åž‹",enum:["get","set","del"]},key:{type:"string",description:"ç¼“å­˜é”®å"},value:{type:"string",description:"ç¼“å­˜å€¼ï¼ˆsetæ—¶éœ€è¦ï¼‰"},ttl:{type:"number",description:"è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰",default:3600}},required:["action","key"]},null,2),handler:`const { action, key, value, ttl = 3600 } = args

await runtime.Redis.init()

switch (action) {
  case 'get': {
    const data = await runtime.Redis.get(key)
    return { text: data ? \`èŽ·å–æˆåŠŸ: \${data}\` : 'é”®ä¸å­˜åœ¨', data }
  }
  case 'set': {
    await runtime.Redis.set(key, value, ttl)
    return { text: \`å·²è®¾ç½® \${key}ï¼Œæœ‰æ•ˆæœŸ \${ttl} ç§’\` }
  }
  case 'del': {
    await runtime.Redis.del(key)
    return { text: \`å·²åˆ é™¤ \${key}\` }
  }
  default:
    return { error: 'æœªçŸ¥æ“ä½œ' }
}`},{name:"call_other_tool",label:"è°ƒç”¨å…¶ä»–å·¥å…·",description:"é“¾å¼è°ƒç”¨å…¶ä»–MCPå·¥å…·",parameters:JSON.stringify({type:"object",properties:{tool_name:{type:"string",description:"è¦è°ƒç”¨çš„å·¥å…·åç§°"},tool_args:{type:"object",description:"ä¼ é€’ç»™å·¥å…·çš„å‚æ•°"}},required:["tool_name"]},null,2),handler:`const { tool_name, tool_args = {} } = args

try {
  const result = await runtime.mcp.callTool(tool_name, tool_args)
  return {
    text: \`å·¥å…· \${tool_name} æ‰§è¡Œå®Œæˆ\`,
    result
  }
} catch (error) {
  return { error: \`è°ƒç”¨å¤±è´¥: \${error.message}\` }
}`},{name:"execute_command",label:"æ‰§è¡Œç³»ç»Ÿå‘½ä»¤",description:"æ‰§è¡Œshellå‘½ä»¤ï¼ˆæ³¨æ„å®‰å…¨ï¼‰",parameters:JSON.stringify({type:"object",properties:{command:{type:"string",description:"è¦æ‰§è¡Œçš„å‘½ä»¤"}},required:["command"]},null,2),handler:`const { command } = args

// å®‰å…¨æ£€æŸ¥ - ç¦æ­¢å±é™©å‘½ä»¤
const dangerous = ['rm -rf', 'mkfs', 'dd if=', ':(){', 'chmod -R 777']
if (dangerous.some(d => command.includes(d))) {
  return { error: 'æ£€æµ‹åˆ°å±é™©å‘½ä»¤ï¼Œå·²æ‹’ç»æ‰§è¡Œ' }
}

try {
  const { stdout, stderr } = await runtime.utils.exec(command)
  return {
    text: stdout || 'å‘½ä»¤æ‰§è¡Œå®Œæˆ',
    stdout,
    stderr
  }
} catch (error) {
  return { error: \`æ‰§è¡Œå¤±è´¥: \${error.message}\` }
}`}],Me=q(()=>{const l=new Set(["builtin"]);return T.value.forEach(e=>{e.serverName&&l.add(e.serverName)}),[{label:"å…¨éƒ¨",value:null},...Array.from(l).map(e=>({label:e,value:e}))]}),De=[{label:"å…¨éƒ¨",value:null},{label:"å†…ç½®å·¥å…·",value:"builtin"},{label:"MCPå·¥å…·",value:"mcp"}],Le=q(()=>{let l=T.value;if(E.value){const e=E.value.toLowerCase();l=l.filter(z=>z.name.toLowerCase().includes(e)||z.description?.toLowerCase().includes(e))}return K.value&&(l=l.filter(e=>(e.serverName||"builtin")===K.value)),A.value==="builtin"?l=l.filter(e=>e.isBuiltin):A.value==="mcp"&&(l=l.filter(e=>!e.isBuiltin)),l}),Ee=q(()=>T.value.filter(l=>l.isBuiltin).length),Ve=q(()=>T.value.filter(l=>!l.isBuiltin).length),Ae=q(()=>L.value.filter(l=>l.status==="connected").length),Re=[{title:"åç§°",key:"name",width:180,ellipsis:{tooltip:!0}},{title:"æè¿°",key:"description",ellipsis:{tooltip:!0}},{title:"ç±»åž‹",key:"type",width:80,render:l=>l.isBuiltin?c(S,{type:"success",size:"small"},{default:()=>"å†…ç½®"}):c(S,{type:"info",size:"small"},{default:()=>"MCP"})},{title:"æ¥æº",key:"serverName",width:120,render:l=>l.serverName||"builtin"},{title:"å±é™©",key:"dangerous",width:60,render:l=>v.value.dangerousTools?.includes(l.name)?c(S,{type:"error",size:"small"},{default:()=>"æ˜¯"}):""},{title:"çŠ¶æ€",key:"enabled",width:80,render:l=>{if(!l.isBuiltin)return"-";const e=v.value.disabledTools?.includes(l.name);return c(Se,{size:"small",value:!e,onUpdateValue:()=>Ge(l.name)})}},{title:"æ“ä½œ",key:"actions",width:150,render:l=>c(i,{size:"small"},{default:()=>[c(f,{size:"small",onClick:()=>Ke(l)},{default:()=>"è¯¦æƒ…"}),c(f,{size:"small",type:"primary",onClick:()=>be(l)},{default:()=>"æµ‹è¯•"})]})}],Ie=[{title:"åç§°",key:"name",width:150},{title:"ç±»åž‹",key:"type",width:100,render:l=>({stdio:"æœ¬åœ°è¿›ç¨‹",sse:"SSE",http:"HTTP",js:"JSè„šæœ¬"})[l.type]||l.type},{title:"çŠ¶æ€",key:"status",width:100,render:l=>{const e=l.status==="connected"?"success":l.status==="error"?"error":"warning";return c(S,{type:e,size:"small"},{default:()=>l.status||"unknown"})}},{title:"å·¥å…·æ•°",key:"toolsCount",width:80},{title:"èµ„æºæ•°",key:"resourcesCount",width:80},{title:"æ“ä½œ",key:"actions",width:200,render:l=>{const e=l.name==="builtin";return c(i,{size:"small"},{default:()=>[c(f,{size:"small",onClick:()=>Ze(l),disabled:e},{default:()=>"é‡è¿ž"}),c(f,{size:"small",onClick:()=>Ye(l),disabled:e},{default:()=>"ç¼–è¾‘"}),c(ze,{onPositiveClick:()=>Xe(l)},{trigger:()=>c(f,{size:"small",type:"error",disabled:e},{default:()=>"åˆ é™¤"}),default:()=>"ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ"})]})}}];async function J(){h.value=!0;try{const l=await g.get("/api/tools/list");l.data.code===0&&(T.value=l.data.data||[])}catch{u.error("èŽ·å–å·¥å…·åˆ—è¡¨å¤±è´¥")}finally{h.value=!1}}async function de(){try{const l=await g.get("/api/mcp/servers");l.data.code===0&&(L.value=l.data.data||[])}catch{u.error("èŽ·å–æœåŠ¡å™¨åˆ—è¡¨å¤±è´¥")}}async function qe(){try{const l=await g.get("/api/tools/builtin/config");l.data.code===0&&(v.value={...v.value,...l.data.data})}catch(l){console.error("Failed to fetch builtin config",l)}}async function pe(){try{(await g.put("/api/tools/builtin/config",v.value)).data.code===0&&(u.success("âœ“ é…ç½®å·²ä¿å­˜",{duration:2e3}),await J())}catch(l){u.error("ä¿å­˜å¤±è´¥: "+l.message)}}function Fe(){v.value.disabledTools=[],v.value.allowedTools=[],pe()}function He(){v.value.disabledTools=[...v.value.dangerousTools],v.value.allowDangerous=!1,pe()}function Ge(l){const e=v.value.disabledTools.indexOf(l);e>=0?v.value.disabledTools.splice(e,1):v.value.disabledTools.push(l),pe()}function Ke(l){j.value=l,le.value=!0}function be(l){j.value=l,F.value=JSON.stringify($e(l),null,2),p.value="",te.value=!0}function $e(l){const e=l.inputSchema||l.parameters||{},z={};return e.properties&&Object.keys(e.properties).forEach(r=>{const P=e.properties[r];P.default!==void 0?z[r]=P.default:P.type==="string"?z[r]="":P.type==="number"||P.type==="integer"?z[r]=0:P.type==="boolean"&&(z[r]=!1)}),z}async function Qe(){k.value=!0,p.value="";try{const l=JSON.parse(F.value),e=await g.post("/api/tools/test",{toolName:j.value.name,arguments:l});e.data.code===0?(p.value=JSON.stringify(e.data.data,null,2),u.success("âœ“ æ‰§è¡ŒæˆåŠŸ",{duration:2e3})):(p.value=`Error: ${e.data.message}`,u.error("æ‰§è¡Œå¤±è´¥"))}catch(l){p.value=`Error: ${l.message}`,u.error("æ‰§è¡Œå¤±è´¥: "+l.message)}finally{k.value=!1}}function We(){_.value=!1,m.value={name:"",type:"stdio",command:"",args:"",url:"",env:"",scriptPath:""},b.value=!0}function Ye(l){_.value=!0,m.value={name:l.name,type:l.type||"stdio",command:l.config?.command||"",args:l.config?.args?.join(" ")||"",url:l.config?.url||"",env:l.config?.env?JSON.stringify(l.config.env):"",scriptPath:l.config?.scriptPath||""},b.value=!0}async function Ze(l){try{const e=await g.post(`/api/mcp/servers/${l.name}/reconnect`);e.data.code===0?(u.success("é‡è¿žæˆåŠŸ"),de(),J()):u.error(e.data.message)}catch(e){u.error("é‡è¿žå¤±è´¥: "+e.message)}}async function Xe(l){try{const e=await g.delete(`/api/mcp/servers/${l.name}`);e.data.code===0?(u.success("åˆ é™¤æˆåŠŸ"),de(),J()):u.error(e.data.message)}catch{u.error("åˆ é™¤å¤±è´¥")}}async function el(){try{const l={type:m.value.type};m.value.type==="stdio"?(l.command=m.value.command,m.value.args&&(l.args=m.value.args.split(" ").filter(Boolean)),m.value.env&&(l.env=JSON.parse(m.value.env))):m.value.type==="js"?l.scriptPath=m.value.scriptPath:l.url=m.value.url;const e=_.value?`/api/mcp/servers/${m.value.name}`:"/api/mcp/servers",z=_.value?"put":"post",r=await g[z](e,{name:m.value.name,config:l});r.data.code===0?(u.success(_.value?"æ›´æ–°æˆåŠŸ":"æ·»åŠ æˆåŠŸ"),b.value=!1,de(),J()):u.error(r.data.message)}catch(l){u.error("æ“ä½œå¤±è´¥: "+l.message)}}async function ll(){try{const l=await g.post("/api/tools/builtin/refresh");l.data.code===0&&(u.success(`å·²åˆ·æ–° ${l.data.data?.count||0} ä¸ªå†…ç½®å·¥å…·`),await J())}catch{u.error("åˆ·æ–°å¤±è´¥")}}async function we(){try{const l=await g.get("/api/tools/custom");l.data.code===0&&(ae.value=l.data.data||[])}catch(l){console.error("Failed to fetch custom tools",l)}}function _e(){R.value=!1,w.value={name:"",description:"",parameters:JSON.stringify({type:"object",properties:{},required:[]},null,2),handler:`// åœ¨è¿™é‡Œç¼–å†™å·¥å…·é€»è¾‘
// args: ç”¨æˆ·ä¼ å…¥çš„å‚æ•°å¯¹è±¡
// ctx: ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ŒåŒ…å« getBot(), getEvent() ç­‰æ–¹æ³•

return {
  text: 'å·¥å…·æ‰§è¡ŒæˆåŠŸ',
  data: args
}`},Q.value=!0}function tl(l){R.value=!0,w.value={name:l.name,description:l.description,parameters:typeof l.parameters=="string"?l.parameters:JSON.stringify(l.parameters||{},null,2),handler:l.handler||""},Q.value=!0}function Oe(l){w.value={name:l.name,description:l.description,parameters:l.parameters,handler:l.handler},u.success(`å·²åº”ç”¨æ¨¡æ¿: ${l.label}`)}async function al(){if(!w.value.name||!w.value.description){u.error("åç§°å’Œæè¿°ä¸èƒ½ä¸ºç©º");return}try{let l;try{l=JSON.parse(w.value.parameters)}catch{u.error("å‚æ•°æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ JSON");return}const e={name:w.value.name,description:w.value.description,parameters:l,handler:w.value.handler},z=R.value?`/api/tools/custom/${w.value.name}`:"/api/tools/custom",r=R.value?"put":"post",P=await g[r](z,e);P.data.code===0?(u.success(R.value?"æ›´æ–°æˆåŠŸ":"åˆ›å»ºæˆåŠŸ"),Q.value=!1,await we(),await J()):u.error(P.data.message)}catch(l){u.error("ä¿å­˜å¤±è´¥: "+l.message)}}async function sl(l){try{const e=await g.delete(`/api/tools/custom/${l}`);e.data.code===0?(u.success("åˆ é™¤æˆåŠŸ"),await we(),await J()):u.error(e.data.message)}catch{u.error("åˆ é™¤å¤±è´¥")}}const rl=[{title:"åç§°",key:"name",width:150},{title:"æè¿°",key:"description",ellipsis:{tooltip:!0}},{title:"åˆ›å»ºæ—¶é—´",key:"createdAt",width:180,render:l=>l.createdAt?new Date(l.createdAt).toLocaleString("zh-CN"):"-"},{title:"æ“ä½œ",key:"actions",width:200,render:l=>c(i,{size:"small"},{default:()=>[c(f,{size:"small",onClick:()=>tl(l)},{default:()=>"ç¼–è¾‘"}),c(f,{size:"small",type:"primary",onClick:()=>be(l)},{default:()=>"æµ‹è¯•"}),c(ze,{onPositiveClick:()=>sl(l.name)},{trigger:()=>c(f,{size:"small",type:"error"},{default:()=>"åˆ é™¤"}),default:()=>"ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ"})]})}],he=d([]),H=d(!1),W=d(!1),B=d({name:"",source:""}),I=d(!1);async function se(){try{const l=await g.get("/api/tools/js");l.data.code===0&&(he.value=l.data.data||[])}catch(l){console.error("Failed to fetch JS tools",l)}}async function ol(){I.value=!0;try{const l=await g.post("/api/tools/js/reload");l.data.code===0&&(u.success("âœ“ "+(l.data.data?.message||"çƒ­é‡è½½æˆåŠŸ"),{duration:2e3}),await se(),await J())}catch(l){u.error("é‡è½½å¤±è´¥: "+l.message)}finally{I.value=!1}}function nl(){W.value=!1,B.value={name:"",source:""},H.value=!0}async function ul(l){W.value=!0,I.value=!0;try{const e=await g.get(`/api/tools/js/${l.name}`);e.data.code===0&&(B.value={name:e.data.data.name,source:e.data.data.source},H.value=!0)}catch(e){u.error("åŠ è½½æºç å¤±è´¥: "+e.message)}finally{I.value=!1}}async function il(){if(!B.value.name){u.error("è¯·è¾“å…¥å·¥å…·åç§°");return}I.value=!0;try{if(W.value){const l=await g.put(`/api/tools/js/${B.value.name}`,{source:B.value.source});l.data.code===0?(u.success("âœ“ ä¿å­˜æˆåŠŸï¼Œå·²çƒ­é‡è½½",{duration:2e3}),H.value=!1,await se(),await J()):u.error(l.data.message)}else{const l=await g.post("/api/tools/js",{name:B.value.name,source:B.value.source||void 0});l.data.code===0?(u.success("âœ“ å·¥å…·å·²åˆ›å»º",{duration:2e3}),H.value=!1,await se(),await J()):u.error(l.data.message)}}catch(l){u.error("ä¿å­˜å¤±è´¥: "+l.message)}finally{I.value=!1}}async function dl(l){try{(await g.delete(`/api/tools/js/${l}`)).data.code===0&&(u.success("åˆ é™¤æˆåŠŸ"),await se(),await J())}catch(e){u.error("åˆ é™¤å¤±è´¥: "+e.message)}}const pl=[{title:"å·¥å…·å",key:"name",width:150},{title:"æè¿°",key:"description",ellipsis:{tooltip:!0}},{title:"æ–‡ä»¶",key:"filename",width:140},{title:"ä¿®æ”¹æ—¶é—´",key:"modifiedAt",width:160,render:l=>new Date(l.modifiedAt).toLocaleString("zh-CN")},{title:"æ“ä½œ",key:"actions",width:200,render:l=>c(i,{size:"small"},{default:()=>[c(f,{size:"small",onClick:()=>ul(l)},{default:()=>"ç¼–è¾‘"}),c(f,{size:"small",type:"primary",onClick:()=>be({name:l.name,inputSchema:{}})},{default:()=>"æµ‹è¯•"}),c(ze,{onPositiveClick:()=>dl(l.name)},{trigger:()=>c(f,{size:"small",type:"error"},{default:()=>"åˆ é™¤"}),default:()=>"ç¡®å®šåˆ é™¤å·¥å…·æ–‡ä»¶å—ï¼Ÿ"})]})}],Y=d([]),me=d(!1),fe=d({tool:null}),ml=q(()=>{const l=new Set(Y.value.map(e=>e.toolName));return Array.from(l).map(e=>({label:e,value:e}))}),fl=[{title:"æ—¶é—´",key:"timestamp",width:160,render:l=>new Date(l.timestamp).toLocaleString("zh-CN")},{title:"å·¥å…·",key:"toolName",width:150,render:l=>c(S,{type:"info",size:"small"},()=>l.toolName)},{title:"çŠ¶æ€",key:"success",width:70,render:l=>c(S,{type:l.success?"success":"error",size:"small"},()=>l.success?"æˆåŠŸ":"å¤±è´¥")},{title:"è€—æ—¶",key:"duration",width:70,render:l=>l.duration?`${l.duration}ms`:"-"},{title:"æ“ä½œ",key:"actions",width:60,render:l=>c(f,{size:"small",onClick:()=>vl(l)},()=>"è¯¦æƒ…")}],ke=d(!1),N=d(null);async function xe(){me.value=!0;try{const l={};fe.value.tool&&(l.tool=fe.value.tool);const e=await g.get("/api/tools/logs",{params:l});e.data.code===0&&(Y.value=e.data.data||[])}catch{u.error("èŽ·å–æ—¥å¿—å¤±è´¥")}finally{me.value=!1}}async function cl(){try{(await g.delete("/api/tools/logs")).data.code===0&&(u.success("æ—¥å¿—å·²æ¸…ç©º"),Y.value=[])}catch{u.error("æ¸…ç©ºå¤±è´¥")}}function vl(l){N.value=l,ke.value=!0}return Sl(()=>{J(),de(),qe(),we(),se(),xe()}),(l,e)=>{const z=Tl("n-code");return y(),$(t(i),{vertical:"",size:16},{default:s(()=>[a(t(Be),{cols:4,"x-gap":12,"y-gap":12,responsive:"screen","item-responsive":""},{default:s(()=>[a(t(re),{span:"0:2 400:1"},{default:s(()=>[a(t(O),{size:"small",hoverable:""},{default:s(()=>[a(t(ce),{label:"å†…ç½®å·¥å…·",value:Ee.value},null,8,["value"])]),_:1})]),_:1}),a(t(re),{span:"0:2 400:1"},{default:s(()=>[a(t(O),{size:"small",hoverable:""},{default:s(()=>[a(t(ce),{label:"MCPå·¥å…·",value:Ve.value},null,8,["value"])]),_:1})]),_:1}),a(t(re),{span:"0:2 400:1"},{default:s(()=>[a(t(O),{size:"small",hoverable:""},{default:s(()=>[a(t(ce),{label:"MCPæœåŠ¡å™¨",value:L.value.length},null,8,["value"])]),_:1})]),_:1}),a(t(re),{span:"0:2 400:1"},{default:s(()=>[a(t(O),{size:"small",hoverable:""},{default:s(()=>[a(t(ce),{label:"å·²è¿žæŽ¥",value:Ae.value},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(t(O),null,{default:s(()=>[a(t(zl),{value:ie.value,"onUpdate:value":e[9]||(e[9]=r=>ie.value=r),type:"line"},{default:s(()=>[a(t(X),{name:"tools",tab:"å·¥å…·åˆ—è¡¨"},{default:s(()=>[a(t(i),{vertical:"",size:12},{default:s(()=>[a(t(i),{justify:"space-between"},{default:s(()=>[a(t(i),null,{default:s(()=>[a(t(U),{value:E.value,"onUpdate:value":e[0]||(e[0]=r=>E.value=r),placeholder:"æœç´¢å·¥å…·...",style:{width:"200px"},clearable:""},null,8,["value"]),a(t(ye),{value:A.value,"onUpdate:value":e[1]||(e[1]=r=>A.value=r),options:De,placeholder:"ç±»åž‹",style:{width:"120px"},clearable:""},null,8,["value"]),a(t(ye),{value:K.value,"onUpdate:value":e[2]||(e[2]=r=>K.value=r),options:Me.value,placeholder:"æ¥æº",style:{width:"150px"},clearable:""},null,8,["value","options"])]),_:1}),a(t(i),null,{default:s(()=>[a(t(f),{onClick:Fe},{default:s(()=>[...e[34]||(e[34]=[o("å…¨éƒ¨å¯ç”¨",-1)])]),_:1}),a(t(f),{onClick:He,type:"warning"},{default:s(()=>[...e[35]||(e[35]=[o("ç¦ç”¨å±é™©å·¥å…·",-1)])]),_:1}),a(t(f),{onClick:J,loading:h.value},{default:s(()=>[...e[36]||(e[36]=[o("åˆ·æ–°",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),a(t(ue),{columns:Re,data:Le.value,loading:h.value,pagination:{pageSize:15},size:"small"},null,8,["data","loading"])]),_:1})]),_:1}),a(t(X),{name:"servers",tab:"MCPæœåŠ¡å™¨"},{default:s(()=>[a(t(i),{vertical:"",size:12},{default:s(()=>[a(t(i),{justify:"end"},{default:s(()=>[a(t(f),{type:"primary",onClick:We},{default:s(()=>[...e[37]||(e[37]=[o("æ·»åŠ æœåŠ¡å™¨",-1)])]),_:1})]),_:1}),a(t(ue),{columns:Ie,data:L.value,size:"small"},null,8,["data"])]),_:1})]),_:1}),a(t(X),{name:"builtin",tab:"å†…ç½®å·¥å…·é…ç½®"},{default:s(()=>[a(t(i),{vertical:"",size:16},{default:s(()=>[v.value.enabled?M("",!0):(y(),$(t(V),{key:0,type:"warning"},{default:s(()=>[...e[38]||(e[38]=[o(" å†…ç½®å·¥å…·å·²ç¦ç”¨ï¼ŒAIå°†æ— æ³•ä½¿ç”¨QQç›¸å…³åŠŸèƒ½ ",-1)])]),_:1})),a(t(ve),{"label-placement":"left","label-width":"140"},{default:s(()=>[a(t(x),{label:"å¯ç”¨å†…ç½®å·¥å…·"},{default:s(()=>[a(t(Se),{value:v.value.enabled,"onUpdate:value":e[3]||(e[3]=r=>v.value.enabled=r)},null,8,["value"])]),_:1}),a(t(x),{label:"å…è®¸å±é™©æ“ä½œ"},{feedback:s(()=>[...e[39]||(e[39]=[o("å±é™©æ“ä½œåŒ…æ‹¬è¸¢äººã€ç¦è¨€ã€æ’¤å›žç­‰",-1)])]),default:s(()=>[a(t(Se),{value:v.value.allowDangerous,"onUpdate:value":e[4]||(e[4]=r=>v.value.allowDangerous=r)},null,8,["value"])]),_:1}),a(t(x),{label:"å±é™©å·¥å…·åˆ—è¡¨"},{default:s(()=>[a(t(Te),{value:v.value.dangerousTools,"onUpdate:value":e[5]||(e[5]=r=>v.value.dangerousTools=r)},null,8,["value"])]),_:1}),a(t(x),{label:"å…è®¸çš„å·¥å…·"},{feedback:s(()=>[...e[40]||(e[40]=[o("ç•™ç©ºè¡¨ç¤ºå…è®¸æ‰€æœ‰å·¥å…·",-1)])]),default:s(()=>[a(t(Te),{value:v.value.allowedTools,"onUpdate:value":e[6]||(e[6]=r=>v.value.allowedTools=r)},null,8,["value"])]),_:1}),a(t(x),{label:"ç¦ç”¨çš„å·¥å…·"},{default:s(()=>[a(t(Te),{value:v.value.disabledTools,"onUpdate:value":e[7]||(e[7]=r=>v.value.disabledTools=r)},null,8,["value"])]),_:1}),a(t(x),null,{default:s(()=>[a(t(i),null,{default:s(()=>[a(t(f),{type:"primary",onClick:pe},{default:s(()=>[...e[41]||(e[41]=[o("ä¿å­˜é…ç½®",-1)])]),_:1}),a(t(f),{onClick:ll},{default:s(()=>[...e[42]||(e[42]=[o("åˆ·æ–°å†…ç½®å·¥å…·",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(t(X),{name:"custom",tab:"è‡ªå®šä¹‰å·¥å…·"},{default:s(()=>[a(t(i),{vertical:"",size:16},{default:s(()=>[a(t(V),{type:"info"},{default:s(()=>[...e[43]||(e[43]=[o(" è‡ªå®šä¹‰å·¥å…·å…è®¸ä½ ä½¿ç”¨ JavaScript ç¼–å†™è‡ªå·±çš„ MCP å·¥å…·ã€‚å·¥å…·ä»£ç åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œå¯ä»¥è®¿é—® Bot API å’Œç½‘ç»œè¯·æ±‚ã€‚ ",-1)])]),_:1}),a(t(i),{justify:"space-between"},{default:s(()=>[a(t(G),null,{default:s(()=>[o("å…± "+C(ae.value.length)+" ä¸ªè‡ªå®šä¹‰å·¥å…·",1)]),_:1}),a(t(f),{type:"primary",onClick:_e},{default:s(()=>[...e[44]||(e[44]=[o("åˆ›å»ºå·¥å…·",-1)])]),_:1})]),_:1}),a(t(ue),{columns:rl,data:ae.value,size:"small"},null,8,["data"]),a(t(Ne),null,{default:s(()=>[a(t(Ce),{title:"ðŸ“š ç¤ºä¾‹æ¨¡æ¿ (ç‚¹å‡»å±•å¼€)",name:"templates"},{default:s(()=>[a(t(Be),{cols:2,"x-gap":12,"y-gap":12},{default:s(()=>[(y(),ee(ge,null,Ue(Je,r=>a(t(re),{key:r.name},{default:s(()=>[a(t(O),{size:"small",hoverable:"",onClick:()=>{_e(),Oe(r)}},{header:s(()=>[a(t(G),{strong:""},{default:s(()=>[o(C(r.label),1)]),_:2},1024)]),default:s(()=>[a(t(G),{depth:"3"},{default:s(()=>[o(C(r.description),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)),64))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(t(X),{name:"jstools",tab:"JSå·¥å…·æ–‡ä»¶"},{default:s(()=>[a(t(i),{vertical:"",size:16},{default:s(()=>[a(t(V),{type:"info"},{default:s(()=>[...e[45]||(e[45]=[o(" JS å·¥å…·æ–‡ä»¶å­˜æ”¾åœ¨ ",-1),n("code",null,"data/tools/",-1),o(" ç›®å½•ä¸‹ï¼Œæ”¯æŒçƒ­é‡è½½ã€‚å·¥å…·ä¼šè‡ªåŠ¨æ³¨å…¥ Botã€loggerã€redisã€segmentã€common ç­‰å…¨å±€å˜é‡ã€‚ ",-1)])]),_:1}),a(t(i),{justify:"space-between"},{default:s(()=>[a(t(G),null,{default:s(()=>[o("å…± "+C(he.value.length)+" ä¸ª JS å·¥å…·æ–‡ä»¶",1)]),_:1}),a(t(i),null,{default:s(()=>[a(t(f),{onClick:ol,loading:I.value},{default:s(()=>[...e[46]||(e[46]=[o("çƒ­é‡è½½",-1)])]),_:1},8,["loading"]),a(t(f),{type:"primary",onClick:nl},{default:s(()=>[...e[47]||(e[47]=[o("åˆ›å»ºå·¥å…·",-1)])]),_:1})]),_:1})]),_:1}),a(t(ue),{columns:pl,data:he.value,size:"small"},null,8,["data"])]),_:1})]),_:1}),a(t(X),{name:"logs",tab:"è°ƒç”¨æ—¥å¿—"},{default:s(()=>[a(t(i),{vertical:"",size:12},{default:s(()=>[a(t(i),{justify:"space-between"},{default:s(()=>[a(t(i),null,{default:s(()=>[a(t(ye),{value:fe.value.tool,"onUpdate:value":[e[8]||(e[8]=r=>fe.value.tool=r),xe],options:ml.value,placeholder:"ç­›é€‰å·¥å…·",clearable:"",style:{width:"180px"}},null,8,["value","options"])]),_:1}),a(t(i),null,{default:s(()=>[a(t(f),{onClick:xe,loading:me.value},{default:s(()=>[...e[48]||(e[48]=[o("åˆ·æ–°",-1)])]),_:1},8,["loading"]),Y.value.length>0?(y(),$(t(f),{key:0,type:"error",onClick:cl},{default:s(()=>[...e[49]||(e[49]=[o("æ¸…ç©º",-1)])]),_:1})):M("",!0)]),_:1})]),_:1}),Y.value.length===0?(y(),$(t(Nl),{key:0,description:"æš‚æ— æ—¥å¿—è®°å½•"})):(y(),$(t(ue),{key:1,columns:fl,data:Y.value,loading:me.value,pagination:{pageSize:30},size:"small","max-height":"50vh"},null,8,["data","loading"]))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),a(t(Z),{show:le.value,"onUpdate:show":e[10]||(e[10]=r=>le.value=r),preset:"card",title:"å·¥å…·è¯¦æƒ…",style:{width:"650px"}},{default:s(()=>[j.value?(y(),$(t(i),{key:0,vertical:""},{default:s(()=>[n("div",null,[e[50]||(e[50]=n("strong",null,"åç§°:",-1)),o(" "+C(j.value.name),1)]),n("div",null,[e[51]||(e[51]=n("strong",null,"æè¿°:",-1)),o(" "+C(j.value.description),1)]),n("div",null,[e[52]||(e[52]=n("strong",null,"æ¥æº:",-1)),e[53]||(e[53]=o()),a(t(S),{type:"info",size:"small"},{default:s(()=>[o(C(j.value.serverName||"builtin"),1)]),_:1})]),a(t(jl)),e[54]||(e[54]=n("div",null,[n("strong",null,"è¾“å…¥å‚æ•°:")],-1)),a(oe,{code:JSON.stringify(j.value.inputSchema||{},null,2),language:"json"},null,8,["code"])]),_:1})):M("",!0)]),_:1},8,["show"]),a(t(Z),{show:te.value,"onUpdate:show":e[13]||(e[13]=r=>te.value=r),preset:"card",title:"æµ‹è¯•å·¥å…·",style:{width:"700px"}},{default:s(()=>[j.value?(y(),$(t(i),{key:0,vertical:""},{default:s(()=>[n("div",null,[e[55]||(e[55]=n("strong",null,"å·¥å…·:",-1)),o(" "+C(j.value.name),1)]),a(t(x),{label:"å‚æ•° (JSON)"},{default:s(()=>[a(t(U),{value:F.value,"onUpdate:value":e[11]||(e[11]=r=>F.value=r),type:"textarea",rows:8,placeholder:'{"key": "value"}'},null,8,["value"])]),_:1}),a(t(i),null,{default:s(()=>[a(t(f),{type:"primary",onClick:Qe,loading:k.value},{default:s(()=>[...e[56]||(e[56]=[o("æ‰§è¡Œæµ‹è¯•",-1)])]),_:1},8,["loading"]),a(t(f),{onClick:e[12]||(e[12]=r=>F.value=JSON.stringify($e(j.value),null,2))},{default:s(()=>[...e[57]||(e[57]=[o("é‡ç½®å‚æ•°",-1)])]),_:1})]),_:1}),p.value?(y(),ee("div",Ul,[e[58]||(e[58]=n("strong",null,"æµ‹è¯•ç»“æžœ:",-1)),a(oe,{code:p.value,language:"json",style:{"margin-top":"8px"}},null,8,["code"])])):M("",!0)]),_:1})):M("",!0)]),_:1},8,["show"]),a(t(Z),{show:b.value,"onUpdate:show":e[22]||(e[22]=r=>b.value=r),preset:"card",title:_.value?"ç¼–è¾‘æœåŠ¡å™¨":"æ·»åŠ æœåŠ¡å™¨",style:{width:"600px"}},{footer:s(()=>[a(t(i),{justify:"end"},{default:s(()=>[a(t(f),{onClick:e[21]||(e[21]=r=>b.value=!1)},{default:s(()=>[...e[60]||(e[60]=[o("å–æ¶ˆ",-1)])]),_:1}),a(t(f),{type:"primary",onClick:el},{default:s(()=>[...e[61]||(e[61]=[o("ä¿å­˜",-1)])]),_:1})]),_:1})]),default:s(()=>[a(t(ve),{"label-placement":"left","label-width":"100"},{default:s(()=>[a(t(x),{label:"åç§°",required:""},{default:s(()=>[a(t(U),{value:m.value.name,"onUpdate:value":e[14]||(e[14]=r=>m.value.name=r),placeholder:"æœåŠ¡å™¨åç§°",disabled:_.value},null,8,["value","disabled"])]),_:1}),a(t(x),{label:"ç±»åž‹",required:""},{default:s(()=>[a(t(ye),{value:m.value.type,"onUpdate:value":e[15]||(e[15]=r=>m.value.type=r),options:[{label:"Stdio (æœ¬åœ°è¿›ç¨‹)",value:"stdio"},{label:"JSè„šæœ¬ (æœ¬åœ°JS)",value:"js"},{label:"SSE",value:"sse"},{label:"HTTP",value:"http"}]},null,8,["value"])]),_:1}),m.value.type==="stdio"?(y(),ee(ge,{key:0},[a(t(x),{label:"å‘½ä»¤"},{default:s(()=>[a(t(U),{value:m.value.command,"onUpdate:value":e[16]||(e[16]=r=>m.value.command=r),placeholder:"ä¾‹å¦‚: node, python, npx"},null,8,["value"])]),_:1}),a(t(x),{label:"å‚æ•°"},{default:s(()=>[a(t(U),{value:m.value.args,"onUpdate:value":e[17]||(e[17]=r=>m.value.args=r),placeholder:"ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚: -m mcp_server"},null,8,["value"])]),_:1}),a(t(x),{label:"çŽ¯å¢ƒå˜é‡"},{default:s(()=>[a(t(U),{value:m.value.env,"onUpdate:value":e[18]||(e[18]=r=>m.value.env=r),type:"textarea",placeholder:'JSONæ ¼å¼: {"KEY": "VALUE"}',rows:3},null,8,["value"])]),_:1})],64)):m.value.type==="js"?(y(),ee(ge,{key:1},[a(t(x),{label:"è„šæœ¬è·¯å¾„"},{default:s(()=>[a(t(U),{value:m.value.scriptPath,"onUpdate:value":e[19]||(e[19]=r=>m.value.scriptPath=r),placeholder:"æœ¬åœ°JSæ–‡ä»¶è·¯å¾„ï¼Œå¦‚: ./mcp/my-server.js"},null,8,["value"])]),_:1}),a(t(V),{type:"info",style:{"margin-top":"8px"}},{default:s(()=>[...e[59]||(e[59]=[o(" JSè„šæœ¬éœ€è¦å¯¼å‡ºä¸€ä¸ªåŒ…å« listTools å’Œ callTool æ–¹æ³•çš„å¯¹è±¡ ",-1)])]),_:1})],64)):(y(),$(t(x),{key:2,label:"URL"},{default:s(()=>[a(t(U),{value:m.value.url,"onUpdate:value":e[20]||(e[20]=r=>m.value.url=r),placeholder:"æœåŠ¡å™¨åœ°å€"},null,8,["value"])]),_:1}))]),_:1})]),_:1},8,["show","title"]),a(t(Z),{show:Q.value,"onUpdate:show":e[28]||(e[28]=r=>Q.value=r),preset:"card",title:R.value?"ç¼–è¾‘è‡ªå®šä¹‰å·¥å…·":"åˆ›å»ºè‡ªå®šä¹‰å·¥å…·",style:{width:"900px","max-height":"90vh"}},{footer:s(()=>[a(t(i),{justify:"end"},{default:s(()=>[a(t(f),{onClick:e[27]||(e[27]=r=>Q.value=!1)},{default:s(()=>[...e[68]||(e[68]=[o("å–æ¶ˆ",-1)])]),_:1}),a(t(f),{type:"primary",onClick:al},{default:s(()=>[...e[69]||(e[69]=[o("ä¿å­˜å·¥å…·",-1)])]),_:1})]),_:1})]),default:s(()=>[a(t(Pe),{style:{"max-height":"calc(90vh - 120px)"}},{default:s(()=>[a(t(i),{vertical:"",size:16},{default:s(()=>[a(t(ve),{"label-placement":"left","label-width":"80"},{default:s(()=>[a(t(x),{label:"å·¥å…·åç§°",required:""},{default:s(()=>[a(t(U),{value:w.value.name,"onUpdate:value":e[23]||(e[23]=r=>w.value.name=r),placeholder:"ä½¿ç”¨è‹±æ–‡å’Œä¸‹åˆ’çº¿ï¼Œå¦‚: my_tool",disabled:R.value},null,8,["value","disabled"])]),_:1}),a(t(x),{label:"æè¿°",required:""},{default:s(()=>[a(t(U),{value:w.value.description,"onUpdate:value":e[24]||(e[24]=r=>w.value.description=r),type:"textarea",rows:2,placeholder:"æè¿°å·¥å…·çš„åŠŸèƒ½ï¼ŒAI ä¼šæ ¹æ®æè¿°å†³å®šä½•æ—¶ä½¿ç”¨æ­¤å·¥å…·"},null,8,["value"])]),_:1})]),_:1}),R.value?M("",!0):(y(),$(t(Ne),{key:0},{default:s(()=>[a(t(Ce),{title:"ðŸŽ¯ å¿«é€Ÿé€‰æ‹©æ¨¡æ¿",name:"tpl"},{default:s(()=>[a(t(i),null,{default:s(()=>[(y(),ee(ge,null,Ue(Je,r=>a(t(f),{key:r.name,size:"small",onClick:P=>Oe(r)},{default:s(()=>[o(C(r.label),1)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})),a(t(O),{size:"small",title:"å‚æ•°å®šä¹‰ (JSON Schema)"},{"header-extra":s(()=>[a(t(G),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[...e[62]||(e[62]=[o("å®šä¹‰å·¥å…·æŽ¥æ”¶çš„å‚æ•°",-1)])]),_:1})]),default:s(()=>[a(je,{modelValue:w.value.parameters,"onUpdate:modelValue":e[25]||(e[25]=r=>w.value.parameters=r),language:"json",rows:8,placeholder:`{
  "type": "object",
  "properties": {
    "param1": { "type": "string", "description": "å‚æ•°è¯´æ˜Ž" }
  },
  "required": ["param1"]
}`},null,8,["modelValue"])]),_:1}),a(t(O),{size:"small",title:"å·¥å…·ä»£ç  (JavaScript)"},{"header-extra":s(()=>[a(t(i),null,{default:s(()=>[a(t(G),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[...e[63]||(e[63]=[o("å¯ç”¨å˜é‡: args, ctx",-1)])]),_:1})]),_:1})]),default:s(()=>[a(je,{modelValue:w.value.handler,"onUpdate:modelValue":e[26]||(e[26]=r=>w.value.handler=r),language:"javascript",rows:15,placeholder:`// ç¼–å†™å·¥å…·é€»è¾‘
// args: ç”¨æˆ·ä¼ å…¥çš„å‚æ•°
// ctx: ä¸Šä¸‹æ–‡å¯¹è±¡
//   - ctx.getBot(): èŽ·å– Bot å®žä¾‹
//   - ctx.getEvent(): èŽ·å–å½“å‰äº‹ä»¶

return { text: 'ç»“æžœ', data: {} }`},null,8,["modelValue"])]),_:1}),a(t(Ne),null,{default:s(()=>[a(t(Ce),{title:"ðŸ“– ç¼–å†™æŒ‡å—",name:"help"},{default:s(()=>[a(t(i),{vertical:""},{default:s(()=>[a(t(V),{type:"info",title:"åŸºç¡€å˜é‡"},{default:s(()=>[...e[64]||(e[64]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,[n("code",null,"args"),o(" - ç”¨æˆ·ä¼ å…¥çš„å‚æ•°å¯¹è±¡")]),n("li",null,[n("code",null,"ctx"),o(" - ä¸Šä¸‹æ–‡å¯¹è±¡ (getBot, getEvent)")]),n("li",null,[n("code",null,"fetch"),o(" - å‘é€ HTTP è¯·æ±‚")]),n("li",null,[n("code",null,"Bot"),o(" - Bot å®žä¾‹")]),n("li",null,[n("code",null,"logger"),o(" - æ—¥å¿—è®°å½•å™¨")]),n("li",null,[n("code",null,"config"),o(" - é…ç½®ç®¡ç†å™¨")])],-1)])]),_:1}),a(t(V),{type:"info",title:"runtime å¯¹è±¡ï¼ˆå®Œæ•´ APIï¼‰"},{default:s(()=>[...e[65]||(e[65]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,[n("code",null,"runtime.Redis"),o(" - Redis å®¢æˆ·ç«¯")]),n("li",null,[n("code",null,"runtime.services.chat"),o(" - èŠå¤©æœåŠ¡")]),n("li",null,[n("code",null,"runtime.services.database"),o(" - æ•°æ®åº“æœåŠ¡")]),n("li",null,[n("code",null,"runtime.services.memory"),o(" - è®°å¿†ç®¡ç†")]),n("li",null,[n("code",null,"runtime.utils.http.get/post"),o(" - HTTP è¯·æ±‚")]),n("li",null,[n("code",null,"runtime.utils.sendGroupMsg()"),o(" - å‘é€ç¾¤æ¶ˆæ¯")]),n("li",null,[n("code",null,"runtime.utils.sendPrivateMsg()"),o(" - å‘é€ç§èŠ")]),n("li",null,[n("code",null,"runtime.utils.sleep(ms)"),o(" - å»¶è¿Ÿ")]),n("li",null,[n("code",null,"runtime.utils.exec(cmd)"),o(" - æ‰§è¡Œå‘½ä»¤")]),n("li",null,[n("code",null,"runtime.mcp.callTool()"),o(" - è°ƒç”¨å…¶ä»–å·¥å…·")]),n("li",null,[n("code",null,"runtime.mcp.listTools()"),o(" - èŽ·å–å·¥å…·åˆ—è¡¨")])],-1)])]),_:1}),a(t(V),{type:"success",title:"è¿”å›žæ ¼å¼"},{default:s(()=>[e[66]||(e[66]=n("p",{style:{margin:"0"}},[o("è¿”å›žä¸€ä¸ªå¯¹è±¡ï¼Œå»ºè®®åŒ…å« "),n("code",null,"text"),o(" å­—æ®µä½œä¸ºæ–‡æœ¬ç»“æžœï¼š")],-1)),a(z,{code:`return {
  text: 'æ“ä½œç»“æžœæè¿°',
  data: { ... }  // å…¶ä»–æ•°æ®
}`,language:"javascript"})]),_:1}),a(t(V),{type:"warning",title:"æ³¨æ„äº‹é¡¹"},{default:s(()=>[...e[67]||(e[67]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,"ä»£ç åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œè¯·æ³¨æ„å®‰å…¨æ€§"),n("li",null,"æ”¯æŒ async/await è¯­æ³•"),n("li",null,"é”™è¯¯ä¼šè¢«æ•èŽ·å¹¶è¿”å›žç»™ AI"),n("li",null,"exec å‘½ä»¤æœ‰ 10 ç§’è¶…æ—¶é™åˆ¶")],-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show","title"]),a(t(Z),{show:H.value,"onUpdate:show":e[32]||(e[32]=r=>H.value=r),preset:"card",title:W.value?"ç¼–è¾‘ JS å·¥å…·":"åˆ›å»º JS å·¥å…·",style:{width:"900px","max-height":"90vh"}},{footer:s(()=>[a(t(i),{justify:"end"},{default:s(()=>[a(t(f),{onClick:e[31]||(e[31]=r=>H.value=!1)},{default:s(()=>[...e[78]||(e[78]=[o("å–æ¶ˆ",-1)])]),_:1}),a(t(f),{type:"primary",onClick:il,loading:I.value},{default:s(()=>[o(C(W.value?"ä¿å­˜å¹¶çƒ­é‡è½½":"åˆ›å»ºå·¥å…·"),1)]),_:1},8,["loading"])]),_:1})]),default:s(()=>[a(t(Pe),{style:{"max-height":"calc(90vh - 120px)"}},{default:s(()=>[a(t(i),{vertical:"",size:16},{default:s(()=>[a(t(ve),{"label-placement":"left","label-width":"80"},{default:s(()=>[a(t(x),{label:"å·¥å…·åç§°",required:""},{default:s(()=>[a(t(U),{value:B.value.name,"onUpdate:value":e[29]||(e[29]=r=>B.value.name=r),placeholder:"å·¥å…·åç§°ï¼ˆä¸å«.jsåŽç¼€ï¼‰",disabled:W.value},null,8,["value","disabled"])]),_:1})]),_:1}),a(t(O),{size:"small",title:"å·¥å…·æºç "},{"header-extra":s(()=>[a(t(G),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[...e[70]||(e[70]=[o(" ä¿å­˜åŽè‡ªåŠ¨çƒ­é‡è½½ ",-1)])]),_:1})]),default:s(()=>[a(je,{modelValue:B.value.source,"onUpdate:modelValue":e[30]||(e[30]=r=>B.value.source=r),language:"javascript",rows:25,placeholder:`/**
 * è‡ªå®šä¹‰å·¥å…·
 * å…¨å±€å˜é‡: Bot, logger, redis, segment, common
 */
export default {
    name: 'my_tool',
    description: 'å·¥å…·æè¿°',
    inputSchema: {
        type: 'object',
        properties: {},
        required: []
    },
    
    async run(args, ctx) {
        return { text: 'ç»“æžœ' }
    }
}`},null,8,["modelValue"])]),_:1}),a(t(V),{type:"info",title:"è‡ªåŠ¨æ³¨å…¥çš„å…¨å±€å˜é‡"},{default:s(()=>[a(t(i),{size:8,style:{"flex-wrap":"wrap"}},{default:s(()=>[a(t(S),{size:"small"},{default:s(()=>[...e[71]||(e[71]=[o("Bot",-1)])]),_:1}),a(t(S),{size:"small"},{default:s(()=>[...e[72]||(e[72]=[o("logger",-1)])]),_:1}),a(t(S),{size:"small"},{default:s(()=>[...e[73]||(e[73]=[o("redis",-1)])]),_:1}),a(t(S),{size:"small"},{default:s(()=>[...e[74]||(e[74]=[o("segment",-1)])]),_:1}),a(t(S),{size:"small"},{default:s(()=>[...e[75]||(e[75]=[o("common",-1)])]),_:1}),a(t(S),{size:"small"},{default:s(()=>[...e[76]||(e[76]=[o("config",-1)])]),_:1}),a(t(S),{size:"small"},{default:s(()=>[...e[77]||(e[77]=[o("fetch",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show","title"]),a(t(Z),{show:ke.value,"onUpdate:show":e[33]||(e[33]=r=>ke.value=r),preset:"card",title:"è°ƒç”¨è¯¦æƒ…",style:{width:"700px"}},{default:s(()=>[N.value?(y(),$(t(Cl),{key:0,column:2,"label-placement":"left",bordered:""},{default:s(()=>[a(t(ne),{label:"å·¥å…·åç§°"},{default:s(()=>[a(t(S),{type:"info"},{default:s(()=>[o(C(N.value.toolName),1)]),_:1})]),_:1}),a(t(ne),{label:"çŠ¶æ€"},{default:s(()=>[a(t(S),{type:N.value.success?"success":"error"},{default:s(()=>[o(C(N.value.success?"æˆåŠŸ":"å¤±è´¥"),1)]),_:1},8,["type"])]),_:1}),a(t(ne),{label:"ç”¨æˆ·ID"},{default:s(()=>[o(C(N.value.userId||"-"),1)]),_:1}),a(t(ne),{label:"è€—æ—¶"},{default:s(()=>[o(C(N.value.duration?N.value.duration+"ms":"-"),1)]),_:1}),a(t(ne),{label:"æ—¶é—´",span:2},{default:s(()=>[o(C(new Date(N.value.timestamp).toLocaleString("zh-CN")),1)]),_:1})]),_:1})):M("",!0),N.value?.arguments?(y(),$(t(O),{key:1,title:"è¯·æ±‚å‚æ•°",size:"small",style:{"margin-top":"16px"}},{default:s(()=>[a(oe,{code:JSON.stringify(N.value.arguments,null,2),language:"json"},null,8,["code"])]),_:1})):M("",!0),N.value?.result?(y(),$(t(O),{key:2,title:"è¿”å›žç»“æžœ",size:"small",style:{"margin-top":"16px"}},{default:s(()=>[a(oe,{code:JSON.stringify(N.value.result,null,2),language:"json","max-height":"200px"},null,8,["code"])]),_:1})):M("",!0),N.value?.error?(y(),$(t(O),{key:3,title:"é”™è¯¯ä¿¡æ¯",size:"small",style:{"margin-top":"16px"}},{default:s(()=>[a(oe,{code:N.value.error,language:"text"},null,8,["code"])]),_:1})):M("",!0)]),_:1},8,["show"])]),_:1})}}};export{Wl as default};
