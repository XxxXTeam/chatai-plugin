import{d as Ge,h as f,as as Ve,x as v,A as He,K as Qe,C as _,L as Ke,M as J,O as s,P as t,Q as p,R as b,S,T as a,at as be,au as D,U as z,av as K,N as w,B as m,V as u,a1 as E,a6 as B,X as se,Y as g,$ as O,a2 as A,a3 as W,a4 as we,W as Y,Z as n,a0 as R}from"./index-CFgVY0tS.js";import{N as We,a as X}from"./Tabs-CEVlSNhv.js";import{N as re}from"./Select-TKqox95P.js";import{N as ne}from"./DataTable-1YQKaNsH.js";import{N as ue}from"./Switch-Ct42tXYQ.js";import{N as oe}from"./DynamicTags-D0ToosVv.js";import{a as L,N as Ye}from"./text-DXQxuK9-.js";import{N as ie,a as de}from"./CollapseItem-H51POXx1.js";import{N as pe}from"./Code-fVZn0EX7.js";import{N as Te}from"./Popconfirm-ByxD9mGO.js";import"./Add-BLgO25d9.js";import"./prop-NnGblK-3.js";const Xe=Object.assign(Object.assign({},He.props),{trigger:String,xScrollable:Boolean,onScroll:Function,contentClass:String,contentStyle:[Object,String],size:Number,yPlacement:{type:String,default:"right"},xPlacement:{type:String,default:"bottom"}}),Ze=Ge({name:"Scrollbar",props:Xe,setup(){const q=v(null);return Object.assign(Object.assign({},{scrollTo:(...k)=>{var y;(y=q.value)===null||y===void 0||y.scrollTo(k[0],k[1])},scrollBy:(...k)=>{var y;(y=q.value)===null||y===void 0||y.scrollBy(k[0],k[1])}}),{scrollbarInstRef:q})},render(){return f(Ve,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}}),el={key:0},fl={__name:"ToolsManager",setup(q){const i=Qe(),k=v(!1),y=v([]),I=v([]),F=v(""),G=v(null),V=v(null),me=v("tools"),Z=v(!1),T=v(null),ee=v(!1),M=v("{}"),j=v(""),le=v(!1),$=v(!1),P=v(!1),o=v({name:"",type:"stdio",command:"",args:"",url:"",env:"",scriptPath:""}),d=v({enabled:!0,allowedTools:[],disabledTools:[],dangerousTools:["kick_member","mute_member","recall_message","set_group_ban","set_group_whole_ban"],allowDangerous:!1}),te=v([]),U=v(!1),h=v(!1),c=v({name:"",description:"",parameters:"{}",handler:""}),ve=[{name:"hello_world",label:"Hello World (åŸºç¡€ç¤ºä¾‹)",description:"ä¸€ä¸ªç®€å•çš„é—®å€™å·¥å…·ï¼Œè¿”å›é—®å€™è¯­",parameters:JSON.stringify({type:"object",properties:{name:{type:"string",description:"è¦é—®å€™çš„åå­—"}},required:["name"]},null,2),handler:`// è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å·¥å…·
// args åŒ…å«ç”¨æˆ·ä¼ å…¥çš„å‚æ•°
// ctx åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆbot, event ç­‰ï¼‰

const { name } = args
return {
  text: \`ä½ å¥½ï¼Œ\${name}ï¼æ¬¢è¿ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·ã€‚\`,
  greeting: true,
  timestamp: Date.now()
}`},{name:"random_number",label:"éšæœºæ•°ç”Ÿæˆå™¨",description:"ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°",parameters:JSON.stringify({type:"object",properties:{min:{type:"number",description:"æœ€å°å€¼",default:1},max:{type:"number",description:"æœ€å¤§å€¼",default:100}}},null,2),handler:`const min = args.min || 1
const max = args.max || 100
const result = Math.floor(Math.random() * (max - min + 1)) + min

return {
  text: \`ç”Ÿæˆçš„éšæœºæ•°æ˜¯: \${result}\`,
  number: result,
  range: { min, max }
}`},{name:"fetch_api",label:"API è¯·æ±‚å·¥å…·",description:"å‘é€ HTTP è¯·æ±‚è·å–æ•°æ®",parameters:JSON.stringify({type:"object",properties:{url:{type:"string",description:"è¯·æ±‚çš„ URL"},method:{type:"string",description:"è¯·æ±‚æ–¹æ³•",enum:["GET","POST"],default:"GET"}},required:["url"]},null,2),handler:`// ä½¿ç”¨ fetch å‘é€è¯·æ±‚
const { url, method = 'GET' } = args

try {
  const response = await fetch(url, { method })
  const data = await response.json()
  return {
    text: \`è¯·æ±‚æˆåŠŸï¼ŒçŠ¶æ€ç : \${response.status}\`,
    data,
    status: response.status
  }
} catch (error) {
  return {
    error: \`è¯·æ±‚å¤±è´¥: \${error.message}\`,
    url
  }
}`},{name:"send_message_tool",label:"å‘é€æ¶ˆæ¯å·¥å…·",description:"ä½¿ç”¨ Bot å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šç¾¤",parameters:JSON.stringify({type:"object",properties:{group_id:{type:"string",description:"ç¾¤å·"},message:{type:"string",description:"æ¶ˆæ¯å†…å®¹"}},required:["group_id","message"]},null,2),handler:`// ä½¿ç”¨ ctx.getBot() è·å– Bot å®ä¾‹
const bot = ctx.getBot()
const { group_id, message } = args

try {
  const group = bot.pickGroup(parseInt(group_id))
  const result = await group.sendMsg(message)
  return {
    text: \`æ¶ˆæ¯å·²å‘é€åˆ°ç¾¤ \${group_id}\`,
    success: true,
    message_id: result.message_id
  }
} catch (error) {
  return {
    error: \`å‘é€å¤±è´¥: \${error.message}\`
  }
}`},{name:"current_time",label:"å½“å‰æ—¶é—´",description:"è·å–å½“å‰æ—¶é—´ä¿¡æ¯",parameters:JSON.stringify({type:"object",properties:{format:{type:"string",description:"æ—¶é—´æ ¼å¼",enum:["full","date","time"],default:"full"}}},null,2),handler:`const now = new Date()
const format = args.format || 'full'

let result
switch (format) {
  case 'date':
    result = now.toLocaleDateString('zh-CN')
    break
  case 'time':
    result = now.toLocaleTimeString('zh-CN')
    break
  default:
    result = now.toLocaleString('zh-CN')
}

return {
  text: \`å½“å‰æ—¶é—´: \${result}\`,
  timestamp: now.getTime(),
  formatted: result
}`},{name:"redis_cache",label:"Redis ç¼“å­˜æ“ä½œ",description:"ä½¿ç”¨ Redis å­˜å–æ•°æ®",parameters:JSON.stringify({type:"object",properties:{action:{type:"string",description:"æ“ä½œç±»å‹",enum:["get","set","del"]},key:{type:"string",description:"ç¼“å­˜é”®å"},value:{type:"string",description:"ç¼“å­˜å€¼ï¼ˆsetæ—¶éœ€è¦ï¼‰"},ttl:{type:"number",description:"è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰",default:3600}},required:["action","key"]},null,2),handler:`const { action, key, value, ttl = 3600 } = args

await runtime.Redis.init()

switch (action) {
  case 'get': {
    const data = await runtime.Redis.get(key)
    return { text: data ? \`è·å–æˆåŠŸ: \${data}\` : 'é”®ä¸å­˜åœ¨', data }
  }
  case 'set': {
    await runtime.Redis.set(key, value, ttl)
    return { text: \`å·²è®¾ç½® \${key}ï¼Œæœ‰æ•ˆæœŸ \${ttl} ç§’\` }
  }
  case 'del': {
    await runtime.Redis.del(key)
    return { text: \`å·²åˆ é™¤ \${key}\` }
  }
  default:
    return { error: 'æœªçŸ¥æ“ä½œ' }
}`},{name:"call_other_tool",label:"è°ƒç”¨å…¶ä»–å·¥å…·",description:"é“¾å¼è°ƒç”¨å…¶ä»–MCPå·¥å…·",parameters:JSON.stringify({type:"object",properties:{tool_name:{type:"string",description:"è¦è°ƒç”¨çš„å·¥å…·åç§°"},tool_args:{type:"object",description:"ä¼ é€’ç»™å·¥å…·çš„å‚æ•°"}},required:["tool_name"]},null,2),handler:`const { tool_name, tool_args = {} } = args

try {
  const result = await runtime.mcp.callTool(tool_name, tool_args)
  return {
    text: \`å·¥å…· \${tool_name} æ‰§è¡Œå®Œæˆ\`,
    result
  }
} catch (error) {
  return { error: \`è°ƒç”¨å¤±è´¥: \${error.message}\` }
}`},{name:"execute_command",label:"æ‰§è¡Œç³»ç»Ÿå‘½ä»¤",description:"æ‰§è¡Œshellå‘½ä»¤ï¼ˆæ³¨æ„å®‰å…¨ï¼‰",parameters:JSON.stringify({type:"object",properties:{command:{type:"string",description:"è¦æ‰§è¡Œçš„å‘½ä»¤"}},required:["command"]},null,2),handler:`const { command } = args

// å®‰å…¨æ£€æŸ¥ - ç¦æ­¢å±é™©å‘½ä»¤
const dangerous = ['rm -rf', 'mkfs', 'dd if=', ':(){', 'chmod -R 777']
if (dangerous.some(d => command.includes(d))) {
  return { error: 'æ£€æµ‹åˆ°å±é™©å‘½ä»¤ï¼Œå·²æ‹’ç»æ‰§è¡Œ' }
}

try {
  const { stdout, stderr } = await runtime.utils.exec(command)
  return {
    text: stdout || 'å‘½ä»¤æ‰§è¡Œå®Œæˆ',
    stdout,
    stderr
  }
} catch (error) {
  return { error: \`æ‰§è¡Œå¤±è´¥: \${error.message}\` }
}`}],xe=_(()=>{const l=new Set(["builtin"]);return y.value.forEach(e=>{e.serverName&&l.add(e.serverName)}),[{label:"å…¨éƒ¨",value:null},...Array.from(l).map(e=>({label:e,value:e}))]}),Se=[{label:"å…¨éƒ¨",value:null},{label:"å†…ç½®å·¥å…·",value:"builtin"},{label:"MCPå·¥å…·",value:"mcp"}],ke=_(()=>{let l=y.value;if(F.value){const e=F.value.toLowerCase();l=l.filter(r=>r.name.toLowerCase().includes(e)||r.description?.toLowerCase().includes(e))}return V.value&&(l=l.filter(e=>(e.serverName||"builtin")===V.value)),G.value==="builtin"?l=l.filter(e=>e.isBuiltin):G.value==="mcp"&&(l=l.filter(e=>!e.isBuiltin)),l}),Ne=_(()=>y.value.filter(l=>l.isBuiltin).length),Ce=_(()=>y.value.filter(l=>!l.isBuiltin).length),he=_(()=>I.value.filter(l=>l.status==="connected").length),ze=[{title:"åç§°",key:"name",width:180,ellipsis:{tooltip:!0}},{title:"æè¿°",key:"description",ellipsis:{tooltip:!0}},{title:"ç±»å‹",key:"type",width:80,render:l=>l.isBuiltin?f(R,{type:"success",size:"small"},{default:()=>"å†…ç½®"}):f(R,{type:"info",size:"small"},{default:()=>"MCP"})},{title:"æ¥æº",key:"serverName",width:120,render:l=>l.serverName||"builtin"},{title:"å±é™©",key:"dangerous",width:60,render:l=>d.value.dangerousTools?.includes(l.name)?f(R,{type:"error",size:"small"},{default:()=>"æ˜¯"}):""},{title:"çŠ¶æ€",key:"enabled",width:80,render:l=>{if(!l.isBuiltin)return"-";const e=d.value.disabledTools?.includes(l.name);return f(ue,{size:"small",value:!e,onUpdateValue:()=>$e(l.name)})}},{title:"æ“ä½œ",key:"actions",width:150,render:l=>f(p,{size:"small"},{default:()=>[f(m,{size:"small",onClick:()=>Ue(l)},{default:()=>"è¯¦æƒ…"}),f(m,{size:"small",type:"primary",onClick:()=>fe(l)},{default:()=>"æµ‹è¯•"})]})}],Oe=[{title:"åç§°",key:"name",width:150},{title:"ç±»å‹",key:"type",width:100,render:l=>({stdio:"æœ¬åœ°è¿›ç¨‹",sse:"SSE",http:"HTTP",js:"JSè„šæœ¬"})[l.type]||l.type},{title:"çŠ¶æ€",key:"status",width:100,render:l=>{const e=l.status==="connected"?"success":l.status==="error"?"error":"warning";return f(R,{type:e,size:"small"},{default:()=>l.status||"unknown"})}},{title:"å·¥å…·æ•°",key:"toolsCount",width:80},{title:"èµ„æºæ•°",key:"resourcesCount",width:80},{title:"æ“ä½œ",key:"actions",width:200,render:l=>{const e=l.name==="builtin";return f(p,{size:"small"},{default:()=>[f(m,{size:"small",onClick:()=>De(l),disabled:e},{default:()=>"é‡è¿"}),f(m,{size:"small",onClick:()=>_e(l),disabled:e},{default:()=>"ç¼–è¾‘"}),f(Te,{onPositiveClick:()=>Ee(l)},{trigger:()=>f(m,{size:"small",type:"error",disabled:e},{default:()=>"åˆ é™¤"}),default:()=>"ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ"})]})}}];async function N(){k.value=!0;try{const l=await b.get("/api/tools/list");l.data.code===0&&(y.value=l.data.data||[])}catch{i.error("è·å–å·¥å…·åˆ—è¡¨å¤±è´¥")}finally{k.value=!1}}async function H(){try{const l=await b.get("/api/mcp/servers");l.data.code===0&&(I.value=l.data.data||[])}catch{i.error("è·å–æœåŠ¡å™¨åˆ—è¡¨å¤±è´¥")}}async function je(){try{const l=await b.get("/api/tools/builtin/config");l.data.code===0&&(d.value={...d.value,...l.data.data})}catch(l){console.error("Failed to fetch builtin config",l)}}async function Q(){try{(await b.put("/api/tools/builtin/config",d.value)).data.code===0&&(i.success("é…ç½®å·²ä¿å­˜"),await N())}catch{i.error("ä¿å­˜å¤±è´¥")}}function Pe(){d.value.disabledTools=[],d.value.allowedTools=[],Q()}function Be(){d.value.disabledTools=[...d.value.dangerousTools],d.value.allowDangerous=!1,Q()}function $e(l){const e=d.value.disabledTools.indexOf(l);e>=0?d.value.disabledTools.splice(e,1):d.value.disabledTools.push(l),Q()}function Ue(l){T.value=l,Z.value=!0}function fe(l){T.value=l,M.value=JSON.stringify(ce(l),null,2),j.value="",ee.value=!0}function ce(l){const e=l.inputSchema||l.parameters||{},r={};return e.properties&&Object.keys(e.properties).forEach(x=>{const C=e.properties[x];C.default!==void 0?r[x]=C.default:C.type==="string"?r[x]="":C.type==="number"||C.type==="integer"?r[x]=0:C.type==="boolean"&&(r[x]=!1)}),r}async function Je(){le.value=!0,j.value="";try{const l=JSON.parse(M.value),e=await b.post("/api/tools/test",{toolName:T.value.name,arguments:l});e.data.code===0?(j.value=JSON.stringify(e.data.data,null,2),i.success("æµ‹è¯•æˆåŠŸ")):j.value=`Error: ${e.data.message}`}catch(l){j.value=`Error: ${l.message}`}finally{le.value=!1}}function Me(){P.value=!1,o.value={name:"",type:"stdio",command:"",args:"",url:"",env:"",scriptPath:""},$.value=!0}function _e(l){P.value=!0,o.value={name:l.name,type:l.type||"stdio",command:l.config?.command||"",args:l.config?.args?.join(" ")||"",url:l.config?.url||"",env:l.config?.env?JSON.stringify(l.config.env):"",scriptPath:l.config?.scriptPath||""},$.value=!0}async function De(l){try{const e=await b.post(`/api/mcp/servers/${l.name}/reconnect`);e.data.code===0?(i.success("é‡è¿æˆåŠŸ"),H(),N()):i.error(e.data.message)}catch(e){i.error("é‡è¿å¤±è´¥: "+e.message)}}async function Ee(l){try{const e=await b.delete(`/api/mcp/servers/${l.name}`);e.data.code===0?(i.success("åˆ é™¤æˆåŠŸ"),H(),N()):i.error(e.data.message)}catch{i.error("åˆ é™¤å¤±è´¥")}}async function Ae(){try{const l={type:o.value.type};o.value.type==="stdio"?(l.command=o.value.command,o.value.args&&(l.args=o.value.args.split(" ").filter(Boolean)),o.value.env&&(l.env=JSON.parse(o.value.env))):o.value.type==="js"?l.scriptPath=o.value.scriptPath:l.url=o.value.url;const e=P.value?`/api/mcp/servers/${o.value.name}`:"/api/mcp/servers",r=P.value?"put":"post",x=await b[r](e,{name:o.value.name,config:l});x.data.code===0?(i.success(P.value?"æ›´æ–°æˆåŠŸ":"æ·»åŠ æˆåŠŸ"),$.value=!1,H(),N()):i.error(x.data.message)}catch(l){i.error("æ“ä½œå¤±è´¥: "+l.message)}}async function Re(){try{const l=await b.post("/api/tools/builtin/refresh");l.data.code===0&&(i.success(`å·²åˆ·æ–° ${l.data.data?.count||0} ä¸ªå†…ç½®å·¥å…·`),await N())}catch{i.error("åˆ·æ–°å¤±è´¥")}}async function ae(){try{const l=await b.get("/api/tools/custom");l.data.code===0&&(te.value=l.data.data||[])}catch(l){console.error("Failed to fetch custom tools",l)}}function ge(){h.value=!1,c.value={name:"",description:"",parameters:JSON.stringify({type:"object",properties:{},required:[]},null,2),handler:`// åœ¨è¿™é‡Œç¼–å†™å·¥å…·é€»è¾‘
// args: ç”¨æˆ·ä¼ å…¥çš„å‚æ•°å¯¹è±¡
// ctx: ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ŒåŒ…å« getBot(), getEvent() ç­‰æ–¹æ³•

return {
  text: 'å·¥å…·æ‰§è¡ŒæˆåŠŸ',
  data: args
}`},U.value=!0}function Le(l){h.value=!0,c.value={name:l.name,description:l.description,parameters:typeof l.parameters=="string"?l.parameters:JSON.stringify(l.parameters||{},null,2),handler:l.handler||""},U.value=!0}function ye(l){c.value={name:l.name,description:l.description,parameters:l.parameters,handler:l.handler},i.success(`å·²åº”ç”¨æ¨¡æ¿: ${l.label}`)}async function qe(){if(!c.value.name||!c.value.description){i.error("åç§°å’Œæè¿°ä¸èƒ½ä¸ºç©º");return}try{let l;try{l=JSON.parse(c.value.parameters)}catch{i.error("å‚æ•°æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ JSON");return}const e={name:c.value.name,description:c.value.description,parameters:l,handler:c.value.handler},r=h.value?`/api/tools/custom/${c.value.name}`:"/api/tools/custom",x=h.value?"put":"post",C=await b[x](r,e);C.data.code===0?(i.success(h.value?"æ›´æ–°æˆåŠŸ":"åˆ›å»ºæˆåŠŸ"),U.value=!1,await ae(),await N()):i.error(C.data.message)}catch(l){i.error("ä¿å­˜å¤±è´¥: "+l.message)}}async function Ie(l){try{const e=await b.delete(`/api/tools/custom/${l}`);e.data.code===0?(i.success("åˆ é™¤æˆåŠŸ"),await ae(),await N()):i.error(e.data.message)}catch{i.error("åˆ é™¤å¤±è´¥")}}const Fe=[{title:"åç§°",key:"name",width:150},{title:"æè¿°",key:"description",ellipsis:{tooltip:!0}},{title:"åˆ›å»ºæ—¶é—´",key:"createdAt",width:180,render:l=>l.createdAt?new Date(l.createdAt).toLocaleString("zh-CN"):"-"},{title:"æ“ä½œ",key:"actions",width:200,render:l=>f(p,{size:"small"},{default:()=>[f(m,{size:"small",onClick:()=>Le(l)},{default:()=>"ç¼–è¾‘"}),f(m,{size:"small",type:"primary",onClick:()=>fe(l)},{default:()=>"æµ‹è¯•"}),f(Te,{onPositiveClick:()=>Ie(l.name)},{trigger:()=>f(m,{size:"small",type:"error"},{default:()=>"åˆ é™¤"}),default:()=>"ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ"})]})}];return Ke(()=>{N(),H(),je(),ae()}),(l,e)=>(S(),J(t(p),{vertical:"",size:16},{default:s(()=>[a(t(be),{cols:4,"x-gap":16},{default:s(()=>[a(t(D),null,{default:s(()=>[a(t(z),{size:"small"},{default:s(()=>[a(t(K),{label:"å†…ç½®å·¥å…·",value:Ne.value},null,8,["value"])]),_:1})]),_:1}),a(t(D),null,{default:s(()=>[a(t(z),{size:"small"},{default:s(()=>[a(t(K),{label:"MCPå·¥å…·",value:Ce.value},null,8,["value"])]),_:1})]),_:1}),a(t(D),null,{default:s(()=>[a(t(z),{size:"small"},{default:s(()=>[a(t(K),{label:"MCPæœåŠ¡å™¨",value:I.value.length},null,8,["value"])]),_:1})]),_:1}),a(t(D),null,{default:s(()=>[a(t(z),{size:"small"},{default:s(()=>[a(t(K),{label:"å·²è¿æ¥",value:he.value},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(t(z),null,{default:s(()=>[a(t(We),{value:me.value,"onUpdate:value":e[8]||(e[8]=r=>me.value=r),type:"line"},{default:s(()=>[a(t(X),{name:"tools",tab:"å·¥å…·åˆ—è¡¨"},{default:s(()=>[a(t(p),{vertical:"",size:12},{default:s(()=>[a(t(p),{justify:"space-between"},{default:s(()=>[a(t(p),null,{default:s(()=>[a(t(w),{value:F.value,"onUpdate:value":e[0]||(e[0]=r=>F.value=r),placeholder:"æœç´¢å·¥å…·...",style:{width:"200px"},clearable:""},null,8,["value"]),a(t(re),{value:G.value,"onUpdate:value":e[1]||(e[1]=r=>G.value=r),options:Se,placeholder:"ç±»å‹",style:{width:"120px"},clearable:""},null,8,["value"]),a(t(re),{value:V.value,"onUpdate:value":e[2]||(e[2]=r=>V.value=r),options:xe.value,placeholder:"æ¥æº",style:{width:"150px"},clearable:""},null,8,["value","options"])]),_:1}),a(t(p),null,{default:s(()=>[a(t(m),{onClick:Pe},{default:s(()=>[...e[28]||(e[28]=[u("å…¨éƒ¨å¯ç”¨",-1)])]),_:1}),a(t(m),{onClick:Be,type:"warning"},{default:s(()=>[...e[29]||(e[29]=[u("ç¦ç”¨å±é™©å·¥å…·",-1)])]),_:1}),a(t(m),{onClick:N,loading:k.value},{default:s(()=>[...e[30]||(e[30]=[u("åˆ·æ–°",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),a(t(ne),{columns:ze,data:ke.value,loading:k.value,pagination:{pageSize:15},size:"small"},null,8,["data","loading"])]),_:1})]),_:1}),a(t(X),{name:"servers",tab:"MCPæœåŠ¡å™¨"},{default:s(()=>[a(t(p),{vertical:"",size:12},{default:s(()=>[a(t(p),{justify:"end"},{default:s(()=>[a(t(m),{type:"primary",onClick:Me},{default:s(()=>[...e[31]||(e[31]=[u("æ·»åŠ æœåŠ¡å™¨",-1)])]),_:1})]),_:1}),a(t(ne),{columns:Oe,data:I.value,size:"small"},null,8,["data"])]),_:1})]),_:1}),a(t(X),{name:"builtin",tab:"å†…ç½®å·¥å…·é…ç½®"},{default:s(()=>[a(t(p),{vertical:"",size:16},{default:s(()=>[d.value.enabled?E("",!0):(S(),J(t(B),{key:0,type:"warning"},{default:s(()=>[...e[32]||(e[32]=[u(" å†…ç½®å·¥å…·å·²ç¦ç”¨ï¼ŒAIå°†æ— æ³•ä½¿ç”¨QQç›¸å…³åŠŸèƒ½ ",-1)])]),_:1})),a(t(se),{"label-placement":"left","label-width":"140"},{default:s(()=>[a(t(g),{label:"å¯ç”¨å†…ç½®å·¥å…·"},{default:s(()=>[a(t(ue),{value:d.value.enabled,"onUpdate:value":e[3]||(e[3]=r=>d.value.enabled=r)},null,8,["value"])]),_:1}),a(t(g),{label:"å…è®¸å±é™©æ“ä½œ"},{feedback:s(()=>[...e[33]||(e[33]=[u("å±é™©æ“ä½œåŒ…æ‹¬è¸¢äººã€ç¦è¨€ã€æ’¤å›ç­‰",-1)])]),default:s(()=>[a(t(ue),{value:d.value.allowDangerous,"onUpdate:value":e[4]||(e[4]=r=>d.value.allowDangerous=r)},null,8,["value"])]),_:1}),a(t(g),{label:"å±é™©å·¥å…·åˆ—è¡¨"},{default:s(()=>[a(t(oe),{value:d.value.dangerousTools,"onUpdate:value":e[5]||(e[5]=r=>d.value.dangerousTools=r)},null,8,["value"])]),_:1}),a(t(g),{label:"å…è®¸çš„å·¥å…·"},{feedback:s(()=>[...e[34]||(e[34]=[u("ç•™ç©ºè¡¨ç¤ºå…è®¸æ‰€æœ‰å·¥å…·",-1)])]),default:s(()=>[a(t(oe),{value:d.value.allowedTools,"onUpdate:value":e[6]||(e[6]=r=>d.value.allowedTools=r)},null,8,["value"])]),_:1}),a(t(g),{label:"ç¦ç”¨çš„å·¥å…·"},{default:s(()=>[a(t(oe),{value:d.value.disabledTools,"onUpdate:value":e[7]||(e[7]=r=>d.value.disabledTools=r)},null,8,["value"])]),_:1}),a(t(g),null,{default:s(()=>[a(t(p),null,{default:s(()=>[a(t(m),{type:"primary",onClick:Q},{default:s(()=>[...e[35]||(e[35]=[u("ä¿å­˜é…ç½®",-1)])]),_:1}),a(t(m),{onClick:Re},{default:s(()=>[...e[36]||(e[36]=[u("åˆ·æ–°å†…ç½®å·¥å…·",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(t(X),{name:"custom",tab:"è‡ªå®šä¹‰å·¥å…·"},{default:s(()=>[a(t(p),{vertical:"",size:16},{default:s(()=>[a(t(B),{type:"info"},{default:s(()=>[...e[37]||(e[37]=[u(" è‡ªå®šä¹‰å·¥å…·å…è®¸ä½ ä½¿ç”¨ JavaScript ç¼–å†™è‡ªå·±çš„ MCP å·¥å…·ã€‚å·¥å…·ä»£ç åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œå¯ä»¥è®¿é—® Bot API å’Œç½‘ç»œè¯·æ±‚ã€‚ ",-1)])]),_:1}),a(t(p),{justify:"space-between"},{default:s(()=>[a(t(L),null,{default:s(()=>[u("å…± "+O(te.value.length)+" ä¸ªè‡ªå®šä¹‰å·¥å…·",1)]),_:1}),a(t(m),{type:"primary",onClick:ge},{default:s(()=>[...e[38]||(e[38]=[u("åˆ›å»ºå·¥å…·",-1)])]),_:1})]),_:1}),a(t(ne),{columns:Fe,data:te.value,size:"small"},null,8,["data"]),a(t(ie),null,{default:s(()=>[a(t(de),{title:"ğŸ“š ç¤ºä¾‹æ¨¡æ¿ (ç‚¹å‡»å±•å¼€)",name:"templates"},{default:s(()=>[a(t(be),{cols:2,"x-gap":12,"y-gap":12},{default:s(()=>[(S(),A(W,null,we(ve,r=>a(t(D),{key:r.name},{default:s(()=>[a(t(z),{size:"small",hoverable:"",onClick:()=>{ge(),ye(r)}},{header:s(()=>[a(t(L),{strong:""},{default:s(()=>[u(O(r.label),1)]),_:2},1024)]),default:s(()=>[a(t(L),{depth:"3"},{default:s(()=>[u(O(r.description),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)),64))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),a(t(Y),{show:Z.value,"onUpdate:show":e[9]||(e[9]=r=>Z.value=r),preset:"card",title:"å·¥å…·è¯¦æƒ…",style:{width:"650px"}},{default:s(()=>[T.value?(S(),J(t(p),{key:0,vertical:""},{default:s(()=>[n("div",null,[e[39]||(e[39]=n("strong",null,"åç§°:",-1)),u(" "+O(T.value.name),1)]),n("div",null,[e[40]||(e[40]=n("strong",null,"æè¿°:",-1)),u(" "+O(T.value.description),1)]),n("div",null,[e[41]||(e[41]=n("strong",null,"æ¥æº:",-1)),e[42]||(e[42]=u()),a(t(R),{type:"info",size:"small"},{default:s(()=>[u(O(T.value.serverName||"builtin"),1)]),_:1})]),a(t(Ye)),e[43]||(e[43]=n("div",null,[n("strong",null,"è¾“å…¥å‚æ•°:")],-1)),a(t(pe),{code:JSON.stringify(T.value.inputSchema||{},null,2),language:"json"},null,8,["code"])]),_:1})):E("",!0)]),_:1},8,["show"]),a(t(Y),{show:ee.value,"onUpdate:show":e[12]||(e[12]=r=>ee.value=r),preset:"card",title:"æµ‹è¯•å·¥å…·",style:{width:"700px"}},{default:s(()=>[T.value?(S(),J(t(p),{key:0,vertical:""},{default:s(()=>[n("div",null,[e[44]||(e[44]=n("strong",null,"å·¥å…·:",-1)),u(" "+O(T.value.name),1)]),a(t(g),{label:"å‚æ•° (JSON)"},{default:s(()=>[a(t(w),{value:M.value,"onUpdate:value":e[10]||(e[10]=r=>M.value=r),type:"textarea",rows:8,placeholder:'{"key": "value"}'},null,8,["value"])]),_:1}),a(t(p),null,{default:s(()=>[a(t(m),{type:"primary",onClick:Je,loading:le.value},{default:s(()=>[...e[45]||(e[45]=[u("æ‰§è¡Œæµ‹è¯•",-1)])]),_:1},8,["loading"]),a(t(m),{onClick:e[11]||(e[11]=r=>M.value=JSON.stringify(ce(T.value),null,2))},{default:s(()=>[...e[46]||(e[46]=[u("é‡ç½®å‚æ•°",-1)])]),_:1})]),_:1}),j.value?(S(),A("div",el,[e[47]||(e[47]=n("strong",null,"æµ‹è¯•ç»“æœ:",-1)),a(t(pe),{code:j.value,language:"json",style:{"margin-top":"8px"}},null,8,["code"])])):E("",!0)]),_:1})):E("",!0)]),_:1},8,["show"]),a(t(Y),{show:$.value,"onUpdate:show":e[21]||(e[21]=r=>$.value=r),preset:"card",title:P.value?"ç¼–è¾‘æœåŠ¡å™¨":"æ·»åŠ æœåŠ¡å™¨",style:{width:"600px"}},{footer:s(()=>[a(t(p),{justify:"end"},{default:s(()=>[a(t(m),{onClick:e[20]||(e[20]=r=>$.value=!1)},{default:s(()=>[...e[49]||(e[49]=[u("å–æ¶ˆ",-1)])]),_:1}),a(t(m),{type:"primary",onClick:Ae},{default:s(()=>[...e[50]||(e[50]=[u("ä¿å­˜",-1)])]),_:1})]),_:1})]),default:s(()=>[a(t(se),{"label-placement":"left","label-width":"100"},{default:s(()=>[a(t(g),{label:"åç§°",required:""},{default:s(()=>[a(t(w),{value:o.value.name,"onUpdate:value":e[13]||(e[13]=r=>o.value.name=r),placeholder:"æœåŠ¡å™¨åç§°",disabled:P.value},null,8,["value","disabled"])]),_:1}),a(t(g),{label:"ç±»å‹",required:""},{default:s(()=>[a(t(re),{value:o.value.type,"onUpdate:value":e[14]||(e[14]=r=>o.value.type=r),options:[{label:"Stdio (æœ¬åœ°è¿›ç¨‹)",value:"stdio"},{label:"JSè„šæœ¬ (æœ¬åœ°JS)",value:"js"},{label:"SSE",value:"sse"},{label:"HTTP",value:"http"}]},null,8,["value"])]),_:1}),o.value.type==="stdio"?(S(),A(W,{key:0},[a(t(g),{label:"å‘½ä»¤"},{default:s(()=>[a(t(w),{value:o.value.command,"onUpdate:value":e[15]||(e[15]=r=>o.value.command=r),placeholder:"ä¾‹å¦‚: node, python, npx"},null,8,["value"])]),_:1}),a(t(g),{label:"å‚æ•°"},{default:s(()=>[a(t(w),{value:o.value.args,"onUpdate:value":e[16]||(e[16]=r=>o.value.args=r),placeholder:"ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚: -m mcp_server"},null,8,["value"])]),_:1}),a(t(g),{label:"ç¯å¢ƒå˜é‡"},{default:s(()=>[a(t(w),{value:o.value.env,"onUpdate:value":e[17]||(e[17]=r=>o.value.env=r),type:"textarea",placeholder:'JSONæ ¼å¼: {"KEY": "VALUE"}',rows:3},null,8,["value"])]),_:1})],64)):o.value.type==="js"?(S(),A(W,{key:1},[a(t(g),{label:"è„šæœ¬è·¯å¾„"},{default:s(()=>[a(t(w),{value:o.value.scriptPath,"onUpdate:value":e[18]||(e[18]=r=>o.value.scriptPath=r),placeholder:"æœ¬åœ°JSæ–‡ä»¶è·¯å¾„ï¼Œå¦‚: ./mcp/my-server.js"},null,8,["value"])]),_:1}),a(t(B),{type:"info",style:{"margin-top":"8px"}},{default:s(()=>[...e[48]||(e[48]=[u(" JSè„šæœ¬éœ€è¦å¯¼å‡ºä¸€ä¸ªåŒ…å« listTools å’Œ callTool æ–¹æ³•çš„å¯¹è±¡ ",-1)])]),_:1})],64)):(S(),J(t(g),{key:2,label:"URL"},{default:s(()=>[a(t(w),{value:o.value.url,"onUpdate:value":e[19]||(e[19]=r=>o.value.url=r),placeholder:"æœåŠ¡å™¨åœ°å€"},null,8,["value"])]),_:1}))]),_:1})]),_:1},8,["show","title"]),a(t(Y),{show:U.value,"onUpdate:show":e[27]||(e[27]=r=>U.value=r),preset:"card",title:h.value?"ç¼–è¾‘è‡ªå®šä¹‰å·¥å…·":"åˆ›å»ºè‡ªå®šä¹‰å·¥å…·",style:{width:"900px","max-height":"90vh"}},{footer:s(()=>[a(t(p),{justify:"end"},{default:s(()=>[a(t(m),{onClick:e[26]||(e[26]=r=>U.value=!1)},{default:s(()=>[...e[57]||(e[57]=[u("å–æ¶ˆ",-1)])]),_:1}),a(t(m),{type:"primary",onClick:qe},{default:s(()=>[...e[58]||(e[58]=[u("ä¿å­˜å·¥å…·",-1)])]),_:1})]),_:1})]),default:s(()=>[a(t(Ze),{style:{"max-height":"calc(90vh - 120px)"}},{default:s(()=>[a(t(p),{vertical:"",size:16},{default:s(()=>[a(t(se),{"label-placement":"left","label-width":"80"},{default:s(()=>[a(t(g),{label:"å·¥å…·åç§°",required:""},{default:s(()=>[a(t(w),{value:c.value.name,"onUpdate:value":e[22]||(e[22]=r=>c.value.name=r),placeholder:"ä½¿ç”¨è‹±æ–‡å’Œä¸‹åˆ’çº¿ï¼Œå¦‚: my_tool",disabled:h.value},null,8,["value","disabled"])]),_:1}),a(t(g),{label:"æè¿°",required:""},{default:s(()=>[a(t(w),{value:c.value.description,"onUpdate:value":e[23]||(e[23]=r=>c.value.description=r),type:"textarea",rows:2,placeholder:"æè¿°å·¥å…·çš„åŠŸèƒ½ï¼ŒAI ä¼šæ ¹æ®æè¿°å†³å®šä½•æ—¶ä½¿ç”¨æ­¤å·¥å…·"},null,8,["value"])]),_:1})]),_:1}),h.value?E("",!0):(S(),J(t(ie),{key:0},{default:s(()=>[a(t(de),{title:"ğŸ¯ å¿«é€Ÿé€‰æ‹©æ¨¡æ¿",name:"tpl"},{default:s(()=>[a(t(p),null,{default:s(()=>[(S(),A(W,null,we(ve,r=>a(t(m),{key:r.name,size:"small",onClick:x=>ye(r)},{default:s(()=>[u(O(r.label),1)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})),a(t(z),{size:"small",title:"å‚æ•°å®šä¹‰ (JSON Schema)"},{"header-extra":s(()=>[a(t(L),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[...e[51]||(e[51]=[u("å®šä¹‰å·¥å…·æ¥æ”¶çš„å‚æ•°",-1)])]),_:1})]),default:s(()=>[a(t(w),{value:c.value.parameters,"onUpdate:value":e[24]||(e[24]=r=>c.value.parameters=r),type:"textarea",rows:8,placeholder:`{
  "type": "object",
  "properties": {
    "param1": { "type": "string", "description": "å‚æ•°è¯´æ˜" }
  },
  "required": ["param1"]
}`,style:{"font-family":"monospace"}},null,8,["value"])]),_:1}),a(t(z),{size:"small",title:"å·¥å…·ä»£ç  (JavaScript)"},{"header-extra":s(()=>[a(t(p),null,{default:s(()=>[a(t(L),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[...e[52]||(e[52]=[u("å¯ç”¨å˜é‡: args, ctx",-1)])]),_:1})]),_:1})]),default:s(()=>[a(t(w),{value:c.value.handler,"onUpdate:value":e[25]||(e[25]=r=>c.value.handler=r),type:"textarea",rows:15,placeholder:`// ç¼–å†™å·¥å…·é€»è¾‘
// args: ç”¨æˆ·ä¼ å…¥çš„å‚æ•°
// ctx: ä¸Šä¸‹æ–‡å¯¹è±¡
//   - ctx.getBot(): è·å– Bot å®ä¾‹
//   - ctx.getEvent(): è·å–å½“å‰äº‹ä»¶

return { text: 'ç»“æœ', data: {} }`,style:{"font-family":"monospace"}},null,8,["value"])]),_:1}),a(t(ie),null,{default:s(()=>[a(t(de),{title:"ğŸ“– ç¼–å†™æŒ‡å—",name:"help"},{default:s(()=>[a(t(p),{vertical:""},{default:s(()=>[a(t(B),{type:"info",title:"åŸºç¡€å˜é‡"},{default:s(()=>[...e[53]||(e[53]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,[n("code",null,"args"),u(" - ç”¨æˆ·ä¼ å…¥çš„å‚æ•°å¯¹è±¡")]),n("li",null,[n("code",null,"ctx"),u(" - ä¸Šä¸‹æ–‡å¯¹è±¡ (getBot, getEvent)")]),n("li",null,[n("code",null,"fetch"),u(" - å‘é€ HTTP è¯·æ±‚")]),n("li",null,[n("code",null,"Bot"),u(" - Bot å®ä¾‹")]),n("li",null,[n("code",null,"logger"),u(" - æ—¥å¿—è®°å½•å™¨")]),n("li",null,[n("code",null,"config"),u(" - é…ç½®ç®¡ç†å™¨")])],-1)])]),_:1}),a(t(B),{type:"info",title:"runtime å¯¹è±¡ï¼ˆå®Œæ•´ APIï¼‰"},{default:s(()=>[...e[54]||(e[54]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,[n("code",null,"runtime.Redis"),u(" - Redis å®¢æˆ·ç«¯")]),n("li",null,[n("code",null,"runtime.services.chat"),u(" - èŠå¤©æœåŠ¡")]),n("li",null,[n("code",null,"runtime.services.database"),u(" - æ•°æ®åº“æœåŠ¡")]),n("li",null,[n("code",null,"runtime.services.memory"),u(" - è®°å¿†ç®¡ç†")]),n("li",null,[n("code",null,"runtime.utils.http.get/post"),u(" - HTTP è¯·æ±‚")]),n("li",null,[n("code",null,"runtime.utils.sendGroupMsg()"),u(" - å‘é€ç¾¤æ¶ˆæ¯")]),n("li",null,[n("code",null,"runtime.utils.sendPrivateMsg()"),u(" - å‘é€ç§èŠ")]),n("li",null,[n("code",null,"runtime.utils.sleep(ms)"),u(" - å»¶è¿Ÿ")]),n("li",null,[n("code",null,"runtime.utils.exec(cmd)"),u(" - æ‰§è¡Œå‘½ä»¤")]),n("li",null,[n("code",null,"runtime.mcp.callTool()"),u(" - è°ƒç”¨å…¶ä»–å·¥å…·")]),n("li",null,[n("code",null,"runtime.mcp.listTools()"),u(" - è·å–å·¥å…·åˆ—è¡¨")])],-1)])]),_:1}),a(t(B),{type:"success",title:"è¿”å›æ ¼å¼"},{default:s(()=>[e[55]||(e[55]=n("p",{style:{margin:"0"}},[u("è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå»ºè®®åŒ…å« "),n("code",null,"text"),u(" å­—æ®µä½œä¸ºæ–‡æœ¬ç»“æœï¼š")],-1)),a(t(pe),{code:`return {
  text: 'æ“ä½œç»“æœæè¿°',
  data: { ... }  // å…¶ä»–æ•°æ®
}`,language:"javascript"})]),_:1}),a(t(B),{type:"warning",title:"æ³¨æ„äº‹é¡¹"},{default:s(()=>[...e[56]||(e[56]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,"ä»£ç åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œè¯·æ³¨æ„å®‰å…¨æ€§"),n("li",null,"æ”¯æŒ async/await è¯­æ³•"),n("li",null,"é”™è¯¯ä¼šè¢«æ•è·å¹¶è¿”å›ç»™ AI"),n("li",null,"exec å‘½ä»¤æœ‰ 10 ç§’è¶…æ—¶é™åˆ¶")],-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show","title"])]),_:1}))}};export{fl as default};
