import{K as E,w as p,a5 as K,L as W,M as D,O as o,P as e,Q as y,R as x,S as L,T as a,a6 as T,V as u,U as M,X as C,Y as d,a7 as O,N as m,B as r,a8 as f,W as Q}from"./index-BaS8Rpkv.js";import{N as j,M as X}from"./ModelSelector-C0kvro_X.js";import{N as Y}from"./Select-BdIElXFX.js";import{N as k}from"./Switch-DwxBOS_C.js";import{N as I}from"./text-2FSPxKfw.js";import{N as w}from"./InputNumber-DFJkb3JD.js";import"./SearchOutlined-Dqw_wIfn.js";const ll={__name:"Settings",setup(q){const v=E(),U=p(!1),g=p(!1),s=K({basic:{toggleMode:"at",togglePrefix:"#chat",commandPrefix:"#ai",debug:!1},llm:{defaultModel:"",embeddingModel:"text-embedding-3-small",models:{chat:"",roleplay:"",toolCall:"",search:"",reasoning:""},chatModel:"",codeModel:"",translationModel:""},bym:{enable:!1,probability:.02,temperature:.9,maxTokens:100,recall:!1,model:"",systemPrompt:""}}),N=p([]),b=p(!1),$=p("defaultModel");async function z(){U.value=!0;try{const n=await x.get("/api/config");if(n.data.code===0){const l=n.data.data;l.basic&&Object.assign(s.basic,l.basic),l.llm&&(Object.assign(s.llm,l.llm),l.llm.models&&Object.assign(s.llm.models,l.llm.models)),l.bym&&Object.assign(s.bym,l.bym);const t=await x.get("/api/channels/list");if(t.data.code===0){const F=t.data.data,P=new Set;F.forEach(S=>{S.models&&S.models.forEach(V=>P.add(V))}),N.value=Array.from(P).sort()}}}catch(n){v.error("加载配置失败: "+n.message)}finally{U.value=!1}}async function A(){g.value=!0;try{const n={basic:{...s.basic},llm:{...s.llm},bym:{...s.bym}},l=await x.post("/api/config",n);l.data.code===0?(v.success("配置已保存"),z()):v.error("保存失败: "+l.data.message)}catch(n){v.error("保存失败: "+n.message)}finally{g.value=!1}}function i(n){$.value=n,b.value=!0}function B(n){if(n.length>0){const l=$.value;if(l==="bymModel")s.bym.model=n[0];else if(l.startsWith("models.")){const t=l.replace("models.","");s.llm.models[t]=n[0]}else s.llm[l]=n[0]}b.value=!1}const R=[{label:"仅@触发",value:"at"},{label:"仅前缀触发",value:"prefix"},{label:"@和前缀都触发",value:"both"}];return W(()=>{z()}),(n,l)=>(L(),D(e(y),{vertical:"",size:"large"},{default:o(()=>[a(e(T),{type:"info",title:"提示",style:{"margin-bottom":"16px"}},{default:o(()=>[...l[35]||(l[35]=[u(" API Key 和渠道配置请前往「渠道管理」页面进行设置 ",-1)])]),_:1}),a(e(M),{title:"触发模式"},{default:o(()=>[a(e(C),{"label-placement":"left","label-width":"140"},{default:o(()=>[a(e(d),{label:"触发方式"},{default:o(()=>[a(e(Y),{value:s.basic.toggleMode,"onUpdate:value":l[0]||(l[0]=t=>s.basic.toggleMode=t),options:R,placeholder:"选择触发方式"},null,8,["value"])]),_:1}),a(e(d),{label:"触发前缀"},{default:o(()=>[a(e(O),{trigger:"hover"},{trigger:o(()=>[a(e(m),{value:s.basic.togglePrefix,"onUpdate:value":l[1]||(l[1]=t=>s.basic.togglePrefix=t),placeholder:"#chat",disabled:s.basic.toggleMode==="at"},null,8,["value","disabled"])]),default:o(()=>[l[36]||(l[36]=u(" 当触发方式包含前缀时，用户发送此前缀开头的消息会触发AI对话 ",-1))]),_:1})]),_:1}),a(e(d),{label:"命令前缀"},{default:o(()=>[a(e(O),{trigger:"hover"},{trigger:o(()=>[a(e(m),{value:s.basic.commandPrefix,"onUpdate:value":l[2]||(l[2]=t=>s.basic.commandPrefix=t),placeholder:"#ai"},null,8,["value"])]),default:o(()=>[l[37]||(l[37]=u(" 管理命令的前缀，如 #ai帮助、#ai状态 等 ",-1))]),_:1})]),_:1}),a(e(d),{label:"调试模式"},{default:o(()=>[a(e(k),{value:s.basic.debug,"onUpdate:value":l[3]||(l[3]=t=>s.basic.debug=t)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(M),{title:"模型配置"},{default:o(()=>[a(e(C),{"label-placement":"left","label-width":"140"},{default:o(()=>[a(e(d),{label:"默认模型"},{default:o(()=>[a(e(m),{value:s.llm.defaultModel,"onUpdate:value":l[5]||(l[5]=t=>s.llm.defaultModel=t),placeholder:"选择模型",readonly:"",onClick:l[6]||(l[6]=t=>i("defaultModel"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[4]||(l[4]=f(t=>i("defaultModel"),["stop"]))},{default:o(()=>[...l[38]||(l[38]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(I),{"title-placement":"left"},{default:o(()=>[...l[39]||(l[39]=[u("模型分类 (可选，留空使用默认模型)",-1)])]),_:1}),a(e(d),{label:"对话模型"},{default:o(()=>[a(e(m),{value:s.llm.models.chat,"onUpdate:value":l[8]||(l[8]=t=>s.llm.models.chat=t),placeholder:"普通聊天使用的模型",readonly:"",onClick:l[9]||(l[9]=t=>i("models.chat"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[7]||(l[7]=f(t=>i("models.chat"),["stop"]))},{default:o(()=>[...l[40]||(l[40]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"伪人模型"},{default:o(()=>[a(e(m),{value:s.llm.models.roleplay,"onUpdate:value":l[11]||(l[11]=t=>s.llm.models.roleplay=t),placeholder:"模拟真人回复的模型",readonly:"",onClick:l[12]||(l[12]=t=>i("models.roleplay"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[10]||(l[10]=f(t=>i("models.roleplay"),["stop"]))},{default:o(()=>[...l[41]||(l[41]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"工具调用模型"},{default:o(()=>[a(e(m),{value:s.llm.models.toolCall,"onUpdate:value":l[14]||(l[14]=t=>s.llm.models.toolCall=t),placeholder:"Function Calling 模型",readonly:"",onClick:l[15]||(l[15]=t=>i("models.toolCall"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[13]||(l[13]=f(t=>i("models.toolCall"),["stop"]))},{default:o(()=>[...l[42]||(l[42]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"搜索模型"},{default:o(()=>[a(e(m),{value:s.llm.models.search,"onUpdate:value":l[17]||(l[17]=t=>s.llm.models.search=t),placeholder:"联网搜索使用的模型",readonly:"",onClick:l[18]||(l[18]=t=>i("models.search"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[16]||(l[16]=f(t=>i("models.search"),["stop"]))},{default:o(()=>[...l[43]||(l[43]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"思考模型"},{default:o(()=>[a(e(m),{value:s.llm.models.reasoning,"onUpdate:value":l[20]||(l[20]=t=>s.llm.models.reasoning=t),placeholder:"深度推理使用的模型",readonly:"",onClick:l[21]||(l[21]=t=>i("models.reasoning"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[19]||(l[19]=f(t=>i("models.reasoning"),["stop"]))},{default:o(()=>[...l[44]||(l[44]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(I),{"title-placement":"left"},{default:o(()=>[...l[45]||(l[45]=[u("其他配置",-1)])]),_:1}),a(e(d),{label:"嵌入模型"},{default:o(()=>[a(e(m),{value:s.llm.embeddingModel,"onUpdate:value":l[22]||(l[22]=t=>s.llm.embeddingModel=t),placeholder:"text-embedding-3-small"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(M),{title:"伪人模式"},{default:o(()=>[a(e(C),{"label-placement":"left","label-width":"140"},{default:o(()=>[a(e(d),{label:"启用"},{default:o(()=>[a(e(k),{value:s.bym.enable,"onUpdate:value":l[23]||(l[23]=t=>s.bym.enable=t)},null,8,["value"])]),_:1}),a(e(d),{label:"触发概率"},{default:o(()=>[a(e(y),{vertical:"",style:{width:"100%"}},{default:o(()=>[a(e(j),{value:s.bym.probability,"onUpdate:value":l[24]||(l[24]=t=>s.bym.probability=t),min:0,max:1,step:.01,marks:{0:"0%",.5:"50%",1:"100%"}},null,8,["value"]),a(e(w),{value:s.bym.probability,"onUpdate:value":l[25]||(l[25]=t=>s.bym.probability=t),min:0,max:1,step:.01,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),a(e(d),{label:"回复温度"},{default:o(()=>[a(e(y),{vertical:"",style:{width:"100%"}},{default:o(()=>[a(e(j),{value:s.bym.temperature,"onUpdate:value":l[26]||(l[26]=t=>s.bym.temperature=t),min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}},null,8,["value"]),a(e(w),{value:s.bym.temperature,"onUpdate:value":l[27]||(l[27]=t=>s.bym.temperature=t),min:0,max:2,step:.1,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),a(e(d),{label:"最大 Token"},{default:o(()=>[a(e(w),{value:s.bym.maxTokens,"onUpdate:value":l[28]||(l[28]=t=>s.bym.maxTokens=t),min:10,max:1e3,step:10,style:{width:"100%"}},null,8,["value"])]),_:1}),a(e(d),{label:"启用记忆"},{default:o(()=>[a(e(k),{value:s.bym.recall,"onUpdate:value":l[29]||(l[29]=t=>s.bym.recall=t)},null,8,["value"])]),_:1}),a(e(d),{label:"使用模型"},{default:o(()=>[a(e(m),{value:s.bym.model,"onUpdate:value":l[31]||(l[31]=t=>s.bym.model=t),placeholder:"留空使用默认模型",readonly:"",onClick:l[32]||(l[32]=t=>i("bymModel"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[30]||(l[30]=f(t=>i("bymModel"),["stop"]))},{default:o(()=>[...l[46]||(l[46]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"系统提示词"},{default:o(()=>[a(e(m),{value:s.bym.systemPrompt,"onUpdate:value":l[33]||(l[33]=t=>s.bym.systemPrompt=t),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"伪人模式的系统提示词"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(T),{type:"warning",title:"提示",style:{"margin-top":"8px"}},{default:o(()=>[...l[47]||(l[47]=[u(" 流式传输、推理模式等高级设置请在「渠道管理」中配置每个渠道的独立参数 ",-1)])]),_:1}),a(e(y),{justify:"end",style:{"margin-top":"16px"}},{default:o(()=>[a(e(r),{type:"primary",size:"large",onClick:A,loading:g.value},{default:o(()=>[...l[48]||(l[48]=[u(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1}),a(e(Q),{show:b.value,"onUpdate:show":l[34]||(l[34]=t=>b.value=t),preset:"card",title:"选择模型",style:{width:"800px","max-height":"85vh"}},{default:o(()=>[a(X,{"all-models":N.value,value:[],multiple:!1,"onUpdate:value":B},null,8,["all-models"])]),_:1},8,["show"])]),_:1}))}};export{ll as default};
