import{K as D,w as y,a5 as X,L as Z,M as S,O as a,P as e,Q as N,R as O,S as R,T as t,a6 as F,V as s,U as g,X as b,a1 as A,Y as r,a7 as d,N as f,B as v,a8 as p,Z as M,W as G}from"./index-B2LdyV3q.js";import{N as E,M as H}from"./ModelSelector-DtArTN7o.js";import{N as J}from"./Select-_h7lzeeB.js";import{N as n}from"./Switch-DCPZ4aqg.js";import{N as x}from"./text-D32VQaCj.js";import{N as w}from"./InputNumber-BxORcG1a.js";import"./SearchOutlined-g7Tu8wVe.js";import"./Add-CF-vumPd.js";const sl={__name:"Settings",setup(h){const k=D(),Q=y(!1),P=y(!1),o=X({basic:{toggleMode:"at",togglePrefix:"#chat",commandPrefix:"#ai",debug:!1,showThinkingMessage:!0,debugToConsoleOnly:!0,quoteReply:!0,autoRecall:{enabled:!1,delay:60,recallError:!0}},admin:{masterQQ:[],loginNotifyPrivate:!0,sensitiveCommandMasterOnly:!0},llm:{defaultModel:"",embeddingModel:"text-embedding-3-small",models:{chat:"",roleplay:"",toolCall:"",search:"",reasoning:""},chatModel:"",codeModel:"",translationModel:""},bym:{enable:!1,probability:.02,temperature:.9,maxTokens:100,recall:!1,model:"",systemPrompt:"",exclusiveFeatures:["groupSummary","userPortrait"]},tools:{showCallLogs:!0,useForwardMsg:!0},thinking:{showThinkingContent:!0,useForwardMsg:!0},features:{groupSummary:{enabled:!0,maxMessages:100},userPortrait:{enabled:!0,minMessages:10}},memory:{enabled:!1,autoExtract:!0}}),T=y([]),U=y(!1),$=y("defaultModel"),C=y("");function B(){const i=C.value.trim();i?o.admin.masterQQ=i.split(/[,，\s]+/).filter(Boolean):o.admin.masterQQ=[]}function V(){C.value=(o.admin.masterQQ||[]).join(", ")}async function j(){Q.value=!0;try{const i=await O.get("/api/config");if(i.data.code===0){const l=i.data.data;l.basic&&(Object.assign(o.basic,l.basic),l.basic.autoRecall&&Object.assign(o.basic.autoRecall,l.basic.autoRecall)),l.llm&&(Object.assign(o.llm,l.llm),l.llm.models&&Object.assign(o.llm.models,l.llm.models)),l.admin&&Object.assign(o.admin,l.admin),l.bym&&Object.assign(o.bym,l.bym),l.tools&&Object.assign(o.tools,l.tools),l.thinking&&Object.assign(o.thinking,l.thinking),l.features&&(l.features.groupSummary&&Object.assign(o.features.groupSummary,l.features.groupSummary),l.features.userPortrait&&Object.assign(o.features.userPortrait,l.features.userPortrait)),l.memory&&Object.assign(o.memory,l.memory);const u=await O.get("/api/channels/list");if(u.data.code===0){const W=u.data.data,z=new Set;W.forEach(I=>{I.models&&I.models.forEach(Y=>z.add(Y))}),T.value=Array.from(z).sort()}V()}}catch(i){k.error("加载配置失败: "+i.message)}finally{Q.value=!1}}async function L(){P.value=!0;try{const i={basic:{...o.basic},admin:{...o.admin},llm:{...o.llm},bym:{...o.bym},tools:{...o.tools},thinking:{...o.thinking},features:{...o.features},memory:{...o.memory}},l=await O.post("/api/config",i);l.data.code===0?(k.success("配置已保存"),j()):k.error("保存失败: "+l.data.message)}catch(i){k.error("保存失败: "+i.message)}finally{P.value=!1}}function m(i){$.value=i,U.value=!0}function q(i){if(i.length>0){const l=$.value;if(l==="bymModel")o.bym.model=i[0];else if(l.startsWith("models.")){const u=l.replace("models.","");o.llm.models[u]=i[0]}else o.llm[l]=i[0]}U.value=!1}const K=[{label:"仅@触发",value:"at"},{label:"仅前缀触发",value:"prefix"},{label:"@和前缀都触发",value:"both"}];return Z(()=>{j()}),(i,l)=>(R(),S(e(N),{vertical:"",size:"large"},{default:a(()=>[t(e(F),{type:"info",title:"提示",style:{"margin-bottom":"16px"}},{default:a(()=>[...l[54]||(l[54]=[s(" API Key 和渠道配置请前往「渠道管理」页面进行设置 ",-1)])]),_:1}),t(e(g),{title:"触发模式"},{default:a(()=>[t(e(b),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"触发方式"},{default:a(()=>[t(e(J),{value:o.basic.toggleMode,"onUpdate:value":l[0]||(l[0]=u=>o.basic.toggleMode=u),options:K,placeholder:"选择触发方式"},null,8,["value"])]),_:1}),t(e(r),{label:"触发前缀"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(f),{value:o.basic.togglePrefix,"onUpdate:value":l[1]||(l[1]=u=>o.basic.togglePrefix=u),placeholder:"#chat",disabled:o.basic.toggleMode==="at"},null,8,["value","disabled"])]),default:a(()=>[l[55]||(l[55]=s(" 当触发方式包含前缀时，用户发送此前缀开头的消息会触发AI对话 ",-1))]),_:1})]),_:1}),t(e(r),{label:"命令前缀"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(f),{value:o.basic.commandPrefix,"onUpdate:value":l[2]||(l[2]=u=>o.basic.commandPrefix=u),placeholder:"#ai"},null,8,["value"])]),default:a(()=>[l[56]||(l[56]=s(" 管理命令的前缀，如 #ai帮助、#ai状态 等 ",-1))]),_:1})]),_:1}),t(e(r),{label:"调试模式"},{default:a(()=>[t(e(n),{value:o.basic.debug,"onUpdate:value":l[3]||(l[3]=u=>o.basic.debug=u)},null,8,["value"])]),_:1}),t(e(r),{label:"思考提示"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.showThinkingMessage,"onUpdate:value":l[4]||(l[4]=u=>o.basic.showThinkingMessage=u)},null,8,["value"])]),default:a(()=>[l[57]||(l[57]=s(' 开启后，AI处理时会先发送"思考中..."提示 ',-1))]),_:1})]),_:1}),t(e(r),{label:"调试仅控制台"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.debugToConsoleOnly,"onUpdate:value":l[5]||(l[5]=u=>o.basic.debugToConsoleOnly=u)},null,8,["value"])]),default:a(()=>[l[58]||(l[58]=s(" 开启后，调试信息仅输出到控制台，不发送到聊天 ",-1))]),_:1})]),_:1}),t(e(r),{label:"引用回复"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.quoteReply,"onUpdate:value":l[6]||(l[6]=u=>o.basic.quoteReply=u)},null,8,["value"])]),default:a(()=>[l[59]||(l[59]=s(" 开启后，AI回复会引用触发消息 ",-1))]),_:1})]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[60]||(l[60]=[s("自动撤回",-1)])]),_:1}),t(e(r),{label:"启用自动撤回"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.autoRecall.enabled,"onUpdate:value":l[7]||(l[7]=u=>o.basic.autoRecall.enabled=u)},null,8,["value"])]),default:a(()=>[l[61]||(l[61]=s(" 开启后，AI回复会在指定时间后自动撤回 ",-1))]),_:1})]),_:1}),o.basic.autoRecall.enabled?(R(),S(e(r),{key:0,label:"撤回延迟(秒)"},{default:a(()=>[t(e(w),{value:o.basic.autoRecall.delay,"onUpdate:value":l[8]||(l[8]=u=>o.basic.autoRecall.delay=u),min:5,max:300},null,8,["value"])]),_:1})):A("",!0),o.basic.autoRecall.enabled?(R(),S(e(r),{key:1,label:"撤回错误消息"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.basic.autoRecall.recallError,"onUpdate:value":l[9]||(l[9]=u=>o.basic.autoRecall.recallError=u)},null,8,["value"])]),default:a(()=>[l[62]||(l[62]=s(" 开启后，错误提示也会自动撤回 ",-1))]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1}),t(e(g),{title:"管理配置"},{default:a(()=>[t(e(b),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"主人QQ"},{default:a(()=>[t(e(f),{value:C.value,"onUpdate:value":l[10]||(l[10]=u=>C.value=u),placeholder:"多个用逗号分隔，留空使用Yunzai配置",onBlur:B},null,8,["value"])]),_:1}),t(e(r),{label:"登录链接私聊推送"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.admin.loginNotifyPrivate,"onUpdate:value":l[11]||(l[11]=u=>o.admin.loginNotifyPrivate=u)},null,8,["value"])]),default:a(()=>[l[63]||(l[63]=s(" 开启后，群聊中触发管理面板命令时会私聊推送登录链接 ",-1))]),_:1})]),_:1}),t(e(r),{label:"敏感命令仅主人"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.admin.sensitiveCommandMasterOnly,"onUpdate:value":l[12]||(l[12]=u=>o.admin.sensitiveCommandMasterOnly=u)},null,8,["value"])]),default:a(()=>[l[64]||(l[64]=s(" 开启后，敏感命令（如管理面板）仅限主人使用 ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(g),{title:"模型配置"},{default:a(()=>[t(e(b),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"默认模型"},{default:a(()=>[t(e(f),{value:o.llm.defaultModel,"onUpdate:value":l[14]||(l[14]=u=>o.llm.defaultModel=u),placeholder:"选择模型",readonly:"",onClick:l[15]||(l[15]=u=>m("defaultModel"))},{suffix:a(()=>[t(e(v),{size:"small",onClick:l[13]||(l[13]=p(u=>m("defaultModel"),["stop"]))},{default:a(()=>[...l[65]||(l[65]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[66]||(l[66]=[s("模型分类 (可选，留空使用默认模型)",-1)])]),_:1}),t(e(r),{label:"对话模型"},{default:a(()=>[t(e(f),{value:o.llm.models.chat,"onUpdate:value":l[17]||(l[17]=u=>o.llm.models.chat=u),placeholder:"普通聊天使用的模型",readonly:"",onClick:l[18]||(l[18]=u=>m("models.chat"))},{suffix:a(()=>[t(e(v),{size:"small",onClick:l[16]||(l[16]=p(u=>m("models.chat"),["stop"]))},{default:a(()=>[...l[67]||(l[67]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"伪人模型"},{default:a(()=>[t(e(f),{value:o.llm.models.roleplay,"onUpdate:value":l[20]||(l[20]=u=>o.llm.models.roleplay=u),placeholder:"模拟真人回复的模型",readonly:"",onClick:l[21]||(l[21]=u=>m("models.roleplay"))},{suffix:a(()=>[t(e(v),{size:"small",onClick:l[19]||(l[19]=p(u=>m("models.roleplay"),["stop"]))},{default:a(()=>[...l[68]||(l[68]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"工具调用模型"},{default:a(()=>[t(e(f),{value:o.llm.models.toolCall,"onUpdate:value":l[23]||(l[23]=u=>o.llm.models.toolCall=u),placeholder:"Function Calling 模型",readonly:"",onClick:l[24]||(l[24]=u=>m("models.toolCall"))},{suffix:a(()=>[t(e(v),{size:"small",onClick:l[22]||(l[22]=p(u=>m("models.toolCall"),["stop"]))},{default:a(()=>[...l[69]||(l[69]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"搜索模型"},{default:a(()=>[t(e(f),{value:o.llm.models.search,"onUpdate:value":l[26]||(l[26]=u=>o.llm.models.search=u),placeholder:"联网搜索使用的模型",readonly:"",onClick:l[27]||(l[27]=u=>m("models.search"))},{suffix:a(()=>[t(e(v),{size:"small",onClick:l[25]||(l[25]=p(u=>m("models.search"),["stop"]))},{default:a(()=>[...l[70]||(l[70]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"思考模型"},{default:a(()=>[t(e(f),{value:o.llm.models.reasoning,"onUpdate:value":l[29]||(l[29]=u=>o.llm.models.reasoning=u),placeholder:"深度推理使用的模型",readonly:"",onClick:l[30]||(l[30]=u=>m("models.reasoning"))},{suffix:a(()=>[t(e(v),{size:"small",onClick:l[28]||(l[28]=p(u=>m("models.reasoning"),["stop"]))},{default:a(()=>[...l[71]||(l[71]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[72]||(l[72]=[s("其他配置",-1)])]),_:1}),t(e(r),{label:"嵌入模型"},{default:a(()=>[t(e(f),{value:o.llm.embeddingModel,"onUpdate:value":l[31]||(l[31]=u=>o.llm.embeddingModel=u),placeholder:"text-embedding-3-small"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(g),{title:"伪人模式"},{default:a(()=>[t(e(b),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"启用"},{default:a(()=>[t(e(n),{value:o.bym.enable,"onUpdate:value":l[32]||(l[32]=u=>o.bym.enable=u)},null,8,["value"])]),_:1}),t(e(r),{label:"触发概率"},{default:a(()=>[t(e(N),{vertical:"",style:{width:"100%"}},{default:a(()=>[t(e(E),{value:o.bym.probability,"onUpdate:value":l[33]||(l[33]=u=>o.bym.probability=u),min:0,max:1,step:.01,marks:{0:"0%",.5:"50%",1:"100%"}},null,8,["value"]),t(e(w),{value:o.bym.probability,"onUpdate:value":l[34]||(l[34]=u=>o.bym.probability=u),min:0,max:1,step:.01,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),t(e(r),{label:"回复温度"},{default:a(()=>[t(e(N),{vertical:"",style:{width:"100%"}},{default:a(()=>[t(e(E),{value:o.bym.temperature,"onUpdate:value":l[35]||(l[35]=u=>o.bym.temperature=u),min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}},null,8,["value"]),t(e(w),{value:o.bym.temperature,"onUpdate:value":l[36]||(l[36]=u=>o.bym.temperature=u),min:0,max:2,step:.1,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),t(e(r),{label:"最大 Token"},{default:a(()=>[t(e(w),{value:o.bym.maxTokens,"onUpdate:value":l[37]||(l[37]=u=>o.bym.maxTokens=u),min:10,max:1e3,step:10,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(r),{label:"启用记忆"},{default:a(()=>[t(e(n),{value:o.bym.recall,"onUpdate:value":l[38]||(l[38]=u=>o.bym.recall=u)},null,8,["value"])]),_:1}),t(e(r),{label:"使用模型"},{default:a(()=>[t(e(f),{value:o.bym.model,"onUpdate:value":l[40]||(l[40]=u=>o.bym.model=u),placeholder:"留空使用默认模型",readonly:"",onClick:l[41]||(l[41]=u=>m("bymModel"))},{suffix:a(()=>[t(e(v),{size:"small",onClick:l[39]||(l[39]=p(u=>m("bymModel"),["stop"]))},{default:a(()=>[...l[73]||(l[73]=[s("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(e(r),{label:"系统提示词"},{default:a(()=>[t(e(f),{value:o.bym.systemPrompt,"onUpdate:value":l[42]||(l[42]=u=>o.bym.systemPrompt=u),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"伪人模式的系统提示词"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(g),{title:"工具调用"},{default:a(()=>[t(e(b),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"显示调用日志"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.tools.showCallLogs,"onUpdate:value":l[43]||(l[43]=u=>o.tools.showCallLogs=u)},null,8,["value"])]),default:a(()=>[l[74]||(l[74]=s(" 开启后，显示工具调用的详细日志 ",-1))]),_:1})]),_:1}),t(e(r),{label:"日志合并转发"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.tools.useForwardMsg,"onUpdate:value":l[44]||(l[44]=u=>o.tools.useForwardMsg=u)},null,8,["value"])]),default:a(()=>[l[75]||(l[75]=s(" 开启后，工具调用日志使用合并转发发送 ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(g),{title:"深度思考"},{default:a(()=>[t(e(b),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(r),{label:"显示思考内容"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.thinking.showThinkingContent,"onUpdate:value":l[45]||(l[45]=u=>o.thinking.showThinkingContent=u)},null,8,["value"])]),default:a(()=>[l[76]||(l[76]=s(" 开启后，显示AI的思考过程 ",-1))]),_:1})]),_:1}),t(e(r),{label:"思考合并转发"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.thinking.useForwardMsg,"onUpdate:value":l[46]||(l[46]=u=>o.thinking.useForwardMsg=u)},null,8,["value"])]),default:a(()=>[l[77]||(l[77]=s(" 开启后，思考内容使用合并转发发送 ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(g),{title:"高级功能"},{default:a(()=>[t(e(b),{"label-placement":"left","label-width":"140"},{default:a(()=>[t(e(x),{"title-placement":"left"},{default:a(()=>[...l[78]||(l[78]=[s("群聊总结",-1)])]),_:1}),t(e(r),{label:"启用"},{default:a(()=>[t(e(n),{value:o.features.groupSummary.enabled,"onUpdate:value":l[47]||(l[47]=u=>o.features.groupSummary.enabled=u)},null,8,["value"])]),_:1}),t(e(r),{label:"最大消息数"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(w),{value:o.features.groupSummary.maxMessages,"onUpdate:value":l[48]||(l[48]=u=>o.features.groupSummary.maxMessages=u),min:10,max:500,step:10,style:{width:"150px"}},null,8,["value"])]),default:a(()=>[l[79]||(l[79]=s(" 总结时分析的最大消息数量 ",-1))]),_:1})]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[80]||(l[80]=[s("个人画像",-1)])]),_:1}),t(e(r),{label:"启用"},{default:a(()=>[t(e(n),{value:o.features.userPortrait.enabled,"onUpdate:value":l[49]||(l[49]=u=>o.features.userPortrait.enabled=u)},null,8,["value"])]),_:1}),t(e(r),{label:"最少消息数"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(w),{value:o.features.userPortrait.minMessages,"onUpdate:value":l[50]||(l[50]=u=>o.features.userPortrait.minMessages=u),min:5,max:100,step:5,style:{width:"150px"}},null,8,["value"])]),default:a(()=>[l[81]||(l[81]=s(" 生成画像需要的最少消息数量 ",-1))]),_:1})]),_:1}),t(e(x),{"title-placement":"left"},{default:a(()=>[...l[82]||(l[82]=[s("长期记忆",-1)])]),_:1}),t(e(r),{label:"启用记忆"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.memory.enabled,"onUpdate:value":l[51]||(l[51]=u=>o.memory.enabled=u)},null,8,["value"])]),default:a(()=>[l[83]||(l[83]=s(" 启用后，AI会记住用户透露的个人信息和偏好 ",-1))]),_:1})]),_:1}),t(e(r),{label:"自动提取"},{default:a(()=>[t(e(d),{trigger:"hover"},{trigger:a(()=>[t(e(n),{value:o.memory.autoExtract,"onUpdate:value":l[52]||(l[52]=u=>o.memory.autoExtract=u),disabled:!o.memory.enabled},null,8,["value","disabled"])]),default:a(()=>[l[84]||(l[84]=s(" 自动从对话中提取值得记忆的信息 ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(F),{type:"info",title:"命令提示",style:{"margin-top":"8px"}},{default:a(()=>[...l[85]||(l[85]=[M("div",null,[s("• "),M("strong",null,"#群聊总结"),s(" - 总结群聊消息")],-1),M("div",null,[s("• "),M("strong",null,"#个人画像"),s(" - 分析自己的用户画像")],-1),M("div",null,[s("• "),M("strong",null,"#分析 @用户"),s(" - 分析指定用户的画像")],-1)])]),_:1}),t(e(N),{justify:"end",style:{"margin-top":"16px"}},{default:a(()=>[t(e(v),{type:"primary",size:"large",onClick:L,loading:P.value},{default:a(()=>[...l[86]||(l[86]=[s(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1}),t(e(G),{show:U.value,"onUpdate:show":l[53]||(l[53]=u=>U.value=u),preset:"card",title:"选择模型",style:{width:"800px","max-height":"85vh"}},{default:a(()=>[t(H,{"all-models":T.value,value:[],multiple:!1,"onUpdate:value":q},null,8,["all-models"])]),_:1},8,["show"])]),_:1}))}};export{sl as default};
