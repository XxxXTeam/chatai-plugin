import{K as L,x as N,C as T,L as O,a2 as G,T as a,O as u,P as l,Q as g,R as F,S as n,U as C,a6 as I,V as o,X as $,M as v,a1 as d,Y as s,a3 as V,Z as E,$ as m,N as z,a8 as H,a9 as y,a0 as f,B as j}from"./index-BDK2Knud.js";import{N as b}from"./Divider-Du8DunKT.js";import{N as p}from"./Switch-CPc_tZoJ.js";import{N as K}from"./Select-CWE4u-Bm.js";import{N as P}from"./Slider-nz3BnoH5.js";import{N as k}from"./DynamicTags-BUlSrW1A.js";import"./Add-BPG2yJa0.js";import"./prop-NnGblK-3.js";const h={__name:"ListenerConfig",setup(Q){const w=L(),x=N(!1),U=N(!1),t=N({private:{enabled:!0,mode:"always"},group:{enabled:!0,at:!0,prefix:!0,keyword:!1,random:!1,randomRate:.05},prefixes:["#chat"],keywords:[],collectGroupMsg:!0,blacklistUsers:[],whitelistUsers:[],blacklistGroups:[],whitelistGroups:[]}),A=[{label:"总是响应",value:"always"},{label:"需要前缀",value:"prefix"},{label:"关闭",value:"off"}],B=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`}),M=T({get:()=>(t.value.prefixes||[]).join(", "),set:i=>{t.value.prefixes=i.split(/[,，]\s*/).filter(Boolean)}}),R=T({get:()=>(t.value.keywords||[]).join(", "),set:i=>{t.value.keywords=i.split(/[,，]\s*/).filter(Boolean)}});async function S(){x.value=!0;try{const i=await F.get("/api/trigger/config",{headers:B()});if(i.data?.data){const e=i.data.data;t.value={...t.value,...e,private:e.private||{enabled:!0,mode:"always"},group:e.group||{enabled:!0,at:!0,prefix:!0,keyword:!1,random:!1,randomRate:.05},prefixes:e.prefixes||["#chat"],keywords:e.keywords||[],collectGroupMsg:e.collectGroupMsg??!0,whitelistGroups:e.whitelistGroups||[],blacklistGroups:e.blacklistGroups||[],whitelistUsers:e.whitelistUsers||[],blacklistUsers:e.blacklistUsers||[]}}}catch(i){w.error("加载配置失败: "+i.message)}finally{x.value=!1}}async function D(){U.value=!0;try{await F.put("/api/trigger/config",t.value,{headers:B()}),w.success("配置已保存")}catch(i){w.error("保存失败: "+i.message)}finally{U.value=!1}}return O(()=>{S()}),(i,e)=>(n(),G("div",null,[a(l(g),{vertical:"",size:"large"},{default:u(()=>[a(l(C),{title:"AI触发配置"},{default:u(()=>[a(l(I),{type:"info",style:{"margin-bottom":"16px"}},{default:u(()=>[...e[15]||(e[15]=[o(" 配置机器人何时响应消息。私聊和群聊可独立配置触发方式。 ",-1)])]),_:1}),a(l($),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(l(b),{"title-placement":"left"},{default:u(()=>[...e[16]||(e[16]=[o("私聊触发",-1)])]),_:1}),a(l(s),{label:"响应私聊"},{default:u(()=>[a(l(p),{value:t.value.private.enabled,"onUpdate:value":e[0]||(e[0]=r=>t.value.private.enabled=r)},null,8,["value"])]),_:1}),t.value.private.enabled?(n(),v(l(s),{key:0,label:"私聊模式"},{default:u(()=>[a(l(K),{value:t.value.private.mode,"onUpdate:value":e[1]||(e[1]=r=>t.value.private.mode=r),options:A,style:{width:"180px"}},null,8,["value"])]),_:1})):d("",!0),a(l(b),{"title-placement":"left"},{default:u(()=>[...e[17]||(e[17]=[o("群聊触发",-1)])]),_:1}),a(l(s),{label:"响应群聊"},{default:u(()=>[a(l(p),{value:t.value.group.enabled,"onUpdate:value":e[2]||(e[2]=r=>t.value.group.enabled=r)},null,8,["value"])]),_:1}),t.value.group.enabled?(n(),G(V,{key:1},[a(l(s),{label:"@机器人触发"},{default:u(()=>[a(l(p),{value:t.value.group.at,"onUpdate:value":e[3]||(e[3]=r=>t.value.group.at=r)},null,8,["value"])]),_:1}),a(l(s),{label:"前缀触发"},{default:u(()=>[a(l(p),{value:t.value.group.prefix,"onUpdate:value":e[4]||(e[4]=r=>t.value.group.prefix=r)},null,8,["value"])]),_:1}),a(l(s),{label:"关键词触发"},{default:u(()=>[a(l(p),{value:t.value.group.keyword,"onUpdate:value":e[5]||(e[5]=r=>t.value.group.keyword=r)},null,8,["value"])]),_:1}),a(l(s),{label:"随机触发"},{default:u(()=>[a(l(g),{align:"center"},{default:u(()=>[a(l(p),{value:t.value.group.random,"onUpdate:value":e[6]||(e[6]=r=>t.value.group.random=r)},null,8,["value"]),t.value.group.random?(n(),G(V,{key:0},[a(l(P),{value:t.value.group.randomRate,"onUpdate:value":e[7]||(e[7]=r=>t.value.group.randomRate=r),min:0,max:.5,step:.01,style:{width:"120px"}},null,8,["value"]),E("span",null,m((t.value.group.randomRate*100).toFixed(0))+"%",1)],64)):d("",!0)]),_:1})]),_:1})],64)):d("",!0),a(l(b),{"title-placement":"left"},{default:u(()=>[...e[18]||(e[18]=[o("触发词",-1)])]),_:1}),a(l(s),{label:"触发前缀"},{default:u(()=>[a(l(z),{value:M.value,"onUpdate:value":e[8]||(e[8]=r=>M.value=r),placeholder:"多个用逗号分隔，如: #chat, 小助手",style:{width:"300px"}},null,8,["value"])]),_:1}),t.value.group.keyword?(n(),v(l(s),{key:2,label:"触发关键词"},{default:u(()=>[a(l(z),{value:R.value,"onUpdate:value":e[9]||(e[9]=r=>R.value=r),placeholder:"消息包含这些词时触发",style:{width:"300px"}},null,8,["value"])]),_:1})):d("",!0),a(l(b),{"title-placement":"left"},{default:u(()=>[...e[19]||(e[19]=[o("其他",-1)])]),_:1}),a(l(s),{label:"采集群消息"},{default:u(()=>[a(l(p),{value:t.value.collectGroupMsg,"onUpdate:value":e[10]||(e[10]=r=>t.value.collectGroupMsg=r)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(l(C),{title:"访问控制"},{default:u(()=>[a(l(I),{type:"warning",style:{"margin-bottom":"16px"}},{default:u(()=>[...e[20]||(e[20]=[o(" 白名单优先于黑名单。设置白名单后，只有名单内的才会触发。 ",-1)])]),_:1}),a(l(H),{cols:2,"x-gap":24,responsive:"screen"},{default:u(()=>[a(l(y),null,{default:u(()=>[a(l(s),{label:"群白名单"},{default:u(()=>[a(l(k),{value:t.value.whitelistGroups,"onUpdate:value":e[11]||(e[11]=r=>t.value.whitelistGroups=r)},null,8,["value"])]),_:1})]),_:1}),a(l(y),null,{default:u(()=>[a(l(s),{label:"群黑名单"},{default:u(()=>[a(l(k),{value:t.value.blacklistGroups,"onUpdate:value":e[12]||(e[12]=r=>t.value.blacklistGroups=r)},null,8,["value"])]),_:1})]),_:1}),a(l(y),null,{default:u(()=>[a(l(s),{label:"用户白名单"},{default:u(()=>[a(l(k),{value:t.value.whitelistUsers,"onUpdate:value":e[13]||(e[13]=r=>t.value.whitelistUsers=r)},null,8,["value"])]),_:1})]),_:1}),a(l(y),null,{default:u(()=>[a(l(s),{label:"用户黑名单"},{default:u(()=>[a(l(k),{value:t.value.blacklistUsers,"onUpdate:value":e[14]||(e[14]=r=>t.value.blacklistUsers=r)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),a(l(C),{title:"当前状态"},{default:u(()=>[a(l(g),null,{default:u(()=>[a(l(f),{type:t.value.private.enabled?"success":"default"},{default:u(()=>[o(" 私聊: "+m(t.value.private.enabled?t.value.private.mode:"关闭"),1)]),_:1},8,["type"]),a(l(f),{type:t.value.group.enabled?"success":"default"},{default:u(()=>[o(" 群聊: "+m(t.value.group.enabled?"开启":"关闭"),1)]),_:1},8,["type"]),t.value.group.at?(n(),v(l(f),{key:0,type:"info"},{default:u(()=>[...e[21]||(e[21]=[o("@触发",-1)])]),_:1})):d("",!0),t.value.group.prefix?(n(),v(l(f),{key:1,type:"info"},{default:u(()=>[...e[22]||(e[22]=[o("前缀触发",-1)])]),_:1})):d("",!0),t.value.group.keyword?(n(),v(l(f),{key:2,type:"info"},{default:u(()=>[...e[23]||(e[23]=[o("关键词触发",-1)])]),_:1})):d("",!0),t.value.group.random?(n(),v(l(f),{key:3,type:"warning"},{default:u(()=>[o("随机"+m((t.value.group.randomRate*100).toFixed(0))+"%",1)]),_:1})):d("",!0)]),_:1})]),_:1}),a(l(g),{justify:"center"},{default:u(()=>[a(l(j),{type:"primary",size:"large",onClick:D,loading:U.value},{default:u(()=>[...e[24]||(e[24]=[o(" 保存配置 ",-1)])]),_:1},8,["loading"]),a(l(j),{size:"large",onClick:S,loading:x.value},{default:u(()=>[...e[25]||(e[25]=[o(" 重新加载 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]))}};export{h as default};
