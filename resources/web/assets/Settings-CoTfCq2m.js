import{G as P,j as g,D as I,E as F,J as e,K as s,a0 as B,L as a,F as S,aI as j,H as b,s as C,U as h,at as w,M as N,aJ as U,aK as n,Y as _,X as G}from"./index-o4Nj2Cvq.js";import{a as M}from"./Upload-C3bQ0UEq.js";import{N as k}from"./Switch-DEzSjWiZ.js";import{N as x}from"./InputNumber-xgBbxMG9.js";import{N as z}from"./Select-D4Iz-QNo.js";import"./Add-CYnKA-89.js";const J={class:"image-upload"},D=["src"],E={__name:"ImageUpload",props:{onUpload:{type:Function,default:()=>{}}},setup(c){const r=c,t=P(),f=g(!1),v=g(""),u=g([]);async function l({file:d,onFinish:i,onError:m}){const y=new FormData;y.append("image",d.file);try{const p=await b.post("/api/upload/image",y,{headers:{"Content-Type":"multipart/form-data"}});p.data.code===0?(t.success("上传成功"),d.url=`/api/images/${p.data.data.id}`,d.name=p.data.data.id,i(),r.onUpload(p.data.data)):(t.error(p.data.message||"上传失败"),m())}catch{t.error("上传出错"),m()}}function o(d){const{url:i}=d;v.value=i,f.value=!0}return(d,i)=>(F(),I("div",J,[e(a(M),{"list-type":"image-card","custom-request":l,"on-preview":o,"file-list":u.value,"onUpdate:fileList":i[0]||(i[0]=m=>u.value=m),accept:"image/*"},{default:s(()=>[...i[2]||(i[2]=[B(" 点击上传 ",-1)])]),_:1},8,["file-list"]),e(a(j),{show:f.value,"onUpdate:show":i[1]||(i[1]=m=>f.value=m),preset:"card",style:{width:"600px"},title:"图片预览"},{default:s(()=>[S("img",{src:v.value,style:{width:"100%"}},null,8,D)]),_:1},8,["show"])]))}},q={__name:"Settings",setup(c){const r=P(),t=g({bym:{enable:!1,probability:.02,systemPrompt:""},images:{storagePath:"./data/images",maxSize:10485760,allowedFormats:["jpg","jpeg","png","gif","webp"]}});async function f(){try{const u=await b.get("/api/config");u.data.code===0&&(t.value=u.data.data)}catch{r.error("获取配置失败")}}async function v(){try{const u=await b.post("/api/config",{bym:t.value.bym,images:t.value.images});u.data.code===0?r.success("保存成功"):r.error(u.data.message)}catch{r.error("保存失败")}}return C(()=>{f()}),(u,l)=>(F(),h(a(w),{vertical:""},{default:s(()=>[e(a(N),{title:"伪人模式 (BYM) 设置"},{default:s(()=>[e(a(U),{"label-placement":"left","label-width":"120"},{default:s(()=>[e(a(n),{label:"启用"},{default:s(()=>[e(a(k),{value:t.value.bym.enable,"onUpdate:value":l[0]||(l[0]=o=>t.value.bym.enable=o)},null,8,["value"])]),_:1}),e(a(n),{label:"触发概率"},{default:s(()=>[e(a(x),{value:t.value.bym.probability,"onUpdate:value":l[1]||(l[1]=o=>t.value.bym.probability=o),min:0,max:1,step:.01},null,8,["value"])]),_:1}),e(a(n),{label:"系统提示词"},{default:s(()=>[e(a(_),{value:t.value.bym.systemPrompt,"onUpdate:value":l[2]||(l[2]=o=>t.value.bym.systemPrompt=o),type:"textarea",rows:5},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(a(N),{title:"图片处理设置"},{default:s(()=>[e(a(U),{"label-placement":"left","label-width":"120"},{default:s(()=>[e(a(n),{label:"存储路径"},{default:s(()=>[e(a(_),{value:t.value.images.storagePath,"onUpdate:value":l[3]||(l[3]=o=>t.value.images.storagePath=o),placeholder:"./data/images"},null,8,["value"])]),_:1}),e(a(n),{label:"最大大小 (Bytes)"},{default:s(()=>[e(a(x),{value:t.value.images.maxSize,"onUpdate:value":l[4]||(l[4]=o=>t.value.images.maxSize=o),min:0},null,8,["value"])]),_:1}),e(a(n),{label:"允许格式"},{default:s(()=>[e(a(z),{value:t.value.images.allowedFormats,"onUpdate:value":l[5]||(l[5]=o=>t.value.images.allowedFormats=o),multiple:"",options:[{label:"JPG",value:"jpg"},{label:"JPEG",value:"jpeg"},{label:"PNG",value:"png"},{label:"GIF",value:"gif"},{label:"WEBP",value:"webp"}]},null,8,["value"])]),_:1}),e(a(n),{label:"上传测试"},{default:s(()=>[e(E,{"on-upload":o=>a(r).success("上传成功: "+o.id)},null,8,["on-upload"])]),_:1})]),_:1})]),_:1}),e(a(w),{justify:"end"},{default:s(()=>[e(a(G),{type:"primary",size:"large",onClick:v},{default:s(()=>[...l[6]||(l[6]=[B("保存所有配置",-1)])]),_:1})]),_:1})]),_:1}))}};export{q as default};
