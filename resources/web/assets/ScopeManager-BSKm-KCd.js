import{K as le,x as m,L as ae,a2 as se,T as l,O as s,P as t,U as re,W as G,R as P,S as x,Q as f,M as S,a1 as z,B as u,V as v,ar as A,a0 as ue,X as B,Y as b,N as w,h as y}from"./index-C-g6fVkQ.js";import{N as oe,a as T}from"./Tabs-CFI4FSdY.js";import{N as F}from"./DataTable-BVyP0DW2.js";import{N as Q}from"./Select-DCQcYpn3.js";import{N as R}from"./Popconfirm-C4QT5NXI.js";import"./Add-CPzzEKz0.js";import"./prop-NnGblK-3.js";const ge={__name:"ScopeManager",setup(de){const d=le(),D=m([]),M=m([]),$=m([]),k=m(!1),c=m(!1),U=m(!1),C=m(!1),p=m(!1),n=m({userId:"",systemPrompt:"",presetId:""}),i=m({groupId:"",systemPrompt:"",presetId:""}),o=m({groupId:"",userId:"",systemPrompt:"",presetId:""}),N=m([]),g=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`});async function I(){k.value=!0;try{const[a,e,r,te]=await Promise.all([P.get("/api/scope/users",{headers:g()}),P.get("/api/scope/groups",{headers:g()}),P.get("/api/scope/group-users",{headers:g()}),P.get("/api/preset/list",{headers:g()})]);D.value=a.data?.data||[],M.value=e.data?.data||[],$.value=r.data?.data||[],N.value=(te.data?.data||[]).map(h=>({label:h.name||h.id,value:h.id}))}catch(a){d.error("加载数据失败: "+a.message)}finally{k.value=!1}}const q=[{title:"用户ID",key:"userId",width:150},{title:"自定义Prompt",key:"systemPrompt",ellipsis:{tooltip:!0},render:a=>a.systemPrompt?a.systemPrompt.substring(0,50)+(a.systemPrompt.length>50?"...":""):"-"},{title:"预设",key:"presetId",width:120},{title:"更新时间",key:"updatedAt",width:180,render:a=>a.updatedAt?new Date(a.updatedAt).toLocaleString():"-"},{title:"操作",key:"actions",width:150,render:a=>y(f,null,{default:()=>[y(u,{size:"small",onClick:()=>E(a)},{default:()=>"编辑"}),y(R,{onPositiveClick:()=>H(a.userId)},{trigger:()=>y(u,{size:"small",type:"error"},{default:()=>"删除"}),default:()=>"确认删除此用户的人格设定？"})]})}],V=[{title:"群组ID",key:"groupId",width:150},{title:"自定义Prompt",key:"systemPrompt",ellipsis:{tooltip:!0},render:a=>a.systemPrompt?a.systemPrompt.substring(0,50)+(a.systemPrompt.length>50?"...":""):"-"},{title:"预设",key:"presetId",width:120},{title:"更新时间",key:"updatedAt",width:180,render:a=>a.updatedAt?new Date(a.updatedAt).toLocaleString():"-"},{title:"操作",key:"actions",width:150,render:a=>y(f,null,{default:()=>[y(u,{size:"small",onClick:()=>W(a)},{default:()=>"编辑"}),y(R,{onPositiveClick:()=>Y(a.groupId)},{trigger:()=>y(u,{size:"small",type:"error"},{default:()=>"删除"}),default:()=>"确认删除此群组的人格设定？"})]})}],j=[{title:"群组ID",key:"groupId",width:150},{title:"用户ID",key:"userId",width:150},{title:"自定义Prompt",key:"systemPrompt",ellipsis:{tooltip:!0},render:a=>a.systemPrompt?a.systemPrompt.substring(0,50)+(a.systemPrompt.length>50?"...":""):"-"},{title:"预设",key:"presetId",width:120},{title:"操作",key:"actions",width:150,render:a=>y(f,null,{default:()=>[y(u,{size:"small",onClick:()=>Z(a)},{default:()=>"编辑"}),y(R,{onPositiveClick:()=>ee(a.groupId,a.userId)},{trigger:()=>y(u,{size:"small",type:"error"},{default:()=>"删除"}),default:()=>"确认删除此群内用户的人格设定？"})]})}];function L(){p.value=!1,n.value={userId:"",systemPrompt:"",presetId:""},c.value=!0}function E(a){p.value=!0,n.value={...a},c.value=!0}async function O(){if(!n.value.userId){d.warning("请输入用户ID");return}try{await P.put(`/api/scope/user/${n.value.userId}`,{systemPrompt:n.value.systemPrompt,presetId:n.value.presetId},{headers:g()}),d.success("保存成功"),c.value=!1,I()}catch(a){d.error("保存失败: "+a.message)}}async function H(a){try{await P.delete(`/api/scope/user/${a}`,{headers:g()}),d.success("删除成功"),I()}catch(e){d.error("删除失败: "+e.message)}}function K(){p.value=!1,i.value={groupId:"",systemPrompt:"",presetId:""},U.value=!0}function W(a){p.value=!0,i.value={...a},U.value=!0}async function X(){if(!i.value.groupId){d.warning("请输入群组ID");return}try{await P.put(`/api/scope/group/${i.value.groupId}`,{systemPrompt:i.value.systemPrompt,presetId:i.value.presetId},{headers:g()}),d.success("保存成功"),U.value=!1,I()}catch(a){d.error("保存失败: "+a.message)}}async function Y(a){try{await P.delete(`/api/scope/group/${a}`,{headers:g()}),d.success("删除成功"),I()}catch(e){d.error("删除失败: "+e.message)}}function J(){p.value=!1,o.value={groupId:"",userId:"",systemPrompt:"",presetId:""},C.value=!0}function Z(a){p.value=!0,o.value={...a},C.value=!0}async function _(){if(!o.value.groupId||!o.value.userId){d.warning("请输入群组ID和用户ID");return}try{await P.put(`/api/scope/group/${o.value.groupId}/user/${o.value.userId}`,{systemPrompt:o.value.systemPrompt,presetId:o.value.presetId},{headers:g()}),d.success("保存成功"),C.value=!1,I()}catch(a){d.error("保存失败: "+a.message)}}async function ee(a,e){try{await P.delete(`/api/scope/group/${a}/user/${e}`,{headers:g()}),d.success("删除成功"),I()}catch(r){d.error("删除失败: "+r.message)}}return ae(()=>{I()}),(a,e)=>(x(),se("div",null,[l(t(re),{title:"独立人格管理"},{"header-extra":s(()=>[l(t(ue),{type:"info"},{default:s(()=>[...e[16]||(e[16]=[v("优先级: 群内用户 > 群组 > 用户全局 > 默认预设",-1)])]),_:1})]),default:s(()=>[l(t(oe),{type:"line",animated:""},{default:s(()=>[l(t(T),{name:"user",tab:"用户人格"},{default:s(()=>[l(t(f),{vertical:""},{default:s(()=>[l(t(f),null,{default:s(()=>[l(t(u),{type:"primary",onClick:L},{default:s(()=>[...e[17]||(e[17]=[v("添加用户人格",-1)])]),_:1}),l(t(u),{onClick:I},{default:s(()=>[...e[18]||(e[18]=[v("刷新",-1)])]),_:1})]),_:1}),l(t(F),{columns:q,data:D.value,loading:k.value,bordered:!1},null,8,["data","loading"]),D.value.length===0&&!k.value?(x(),S(t(A),{key:0,description:"暂无用户人格设定"})):z("",!0)]),_:1})]),_:1}),l(t(T),{name:"group",tab:"群组人格"},{default:s(()=>[l(t(f),{vertical:""},{default:s(()=>[l(t(f),null,{default:s(()=>[l(t(u),{type:"primary",onClick:K},{default:s(()=>[...e[19]||(e[19]=[v("添加群组人格",-1)])]),_:1}),l(t(u),{onClick:I},{default:s(()=>[...e[20]||(e[20]=[v("刷新",-1)])]),_:1})]),_:1}),l(t(F),{columns:V,data:M.value,loading:k.value,bordered:!1},null,8,["data","loading"]),M.value.length===0&&!k.value?(x(),S(t(A),{key:0,description:"暂无群组人格设定"})):z("",!0)]),_:1})]),_:1}),l(t(T),{name:"groupUser",tab:"群内用户人格"},{default:s(()=>[l(t(f),{vertical:""},{default:s(()=>[l(t(f),null,{default:s(()=>[l(t(u),{type:"primary",onClick:J},{default:s(()=>[...e[21]||(e[21]=[v("添加群内用户人格",-1)])]),_:1}),l(t(u),{onClick:I},{default:s(()=>[...e[22]||(e[22]=[v("刷新",-1)])]),_:1})]),_:1}),l(t(F),{columns:j,data:$.value,loading:k.value,bordered:!1},null,8,["data","loading"]),$.value.length===0&&!k.value?(x(),S(t(A),{key:0,description:"暂无群内用户人格设定"})):z("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(t(G),{show:c.value,"onUpdate:show":e[4]||(e[4]=r=>c.value=r),preset:"card",title:p.value?"编辑用户人格":"添加用户人格",style:{width:"600px"}},{footer:s(()=>[l(t(f),{justify:"end"},{default:s(()=>[l(t(u),{onClick:e[3]||(e[3]=r=>c.value=!1)},{default:s(()=>[...e[23]||(e[23]=[v("取消",-1)])]),_:1}),l(t(u),{type:"primary",onClick:O},{default:s(()=>[...e[24]||(e[24]=[v("保存",-1)])]),_:1})]),_:1})]),default:s(()=>[l(t(B),{model:n.value,"label-placement":"left","label-width":"100px"},{default:s(()=>[l(t(b),{label:"用户ID",required:""},{default:s(()=>[l(t(w),{value:n.value.userId,"onUpdate:value":e[0]||(e[0]=r=>n.value.userId=r),placeholder:"QQ号",disabled:p.value},null,8,["value","disabled"])]),_:1}),l(t(b),{label:"自定义Prompt"},{default:s(()=>[l(t(w),{value:n.value.systemPrompt,"onUpdate:value":e[1]||(e[1]=r=>n.value.systemPrompt=r),type:"textarea",rows:6,placeholder:"为该用户设置专属的系统提示词..."},null,8,["value"])]),_:1}),l(t(b),{label:"使用预设"},{default:s(()=>[l(t(Q),{value:n.value.presetId,"onUpdate:value":e[2]||(e[2]=r=>n.value.presetId=r),options:N.value,placeholder:"选择预设（可选）",clearable:""},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),l(t(G),{show:U.value,"onUpdate:show":e[9]||(e[9]=r=>U.value=r),preset:"card",title:p.value?"编辑群组人格":"添加群组人格",style:{width:"600px"}},{footer:s(()=>[l(t(f),{justify:"end"},{default:s(()=>[l(t(u),{onClick:e[8]||(e[8]=r=>U.value=!1)},{default:s(()=>[...e[25]||(e[25]=[v("取消",-1)])]),_:1}),l(t(u),{type:"primary",onClick:X},{default:s(()=>[...e[26]||(e[26]=[v("保存",-1)])]),_:1})]),_:1})]),default:s(()=>[l(t(B),{model:i.value,"label-placement":"left","label-width":"100px"},{default:s(()=>[l(t(b),{label:"群组ID",required:""},{default:s(()=>[l(t(w),{value:i.value.groupId,"onUpdate:value":e[5]||(e[5]=r=>i.value.groupId=r),placeholder:"群号",disabled:p.value},null,8,["value","disabled"])]),_:1}),l(t(b),{label:"自定义Prompt"},{default:s(()=>[l(t(w),{value:i.value.systemPrompt,"onUpdate:value":e[6]||(e[6]=r=>i.value.systemPrompt=r),type:"textarea",rows:6,placeholder:"为该群组设置专属的系统提示词..."},null,8,["value"])]),_:1}),l(t(b),{label:"使用预设"},{default:s(()=>[l(t(Q),{value:i.value.presetId,"onUpdate:value":e[7]||(e[7]=r=>i.value.presetId=r),options:N.value,placeholder:"选择预设（可选）",clearable:""},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),l(t(G),{show:C.value,"onUpdate:show":e[15]||(e[15]=r=>C.value=r),preset:"card",title:p.value?"编辑群内用户人格":"添加群内用户人格",style:{width:"600px"}},{footer:s(()=>[l(t(f),{justify:"end"},{default:s(()=>[l(t(u),{onClick:e[14]||(e[14]=r=>C.value=!1)},{default:s(()=>[...e[27]||(e[27]=[v("取消",-1)])]),_:1}),l(t(u),{type:"primary",onClick:_},{default:s(()=>[...e[28]||(e[28]=[v("保存",-1)])]),_:1})]),_:1})]),default:s(()=>[l(t(B),{model:o.value,"label-placement":"left","label-width":"100px"},{default:s(()=>[l(t(b),{label:"群组ID",required:""},{default:s(()=>[l(t(w),{value:o.value.groupId,"onUpdate:value":e[10]||(e[10]=r=>o.value.groupId=r),placeholder:"群号",disabled:p.value},null,8,["value","disabled"])]),_:1}),l(t(b),{label:"用户ID",required:""},{default:s(()=>[l(t(w),{value:o.value.userId,"onUpdate:value":e[11]||(e[11]=r=>o.value.userId=r),placeholder:"QQ号",disabled:p.value},null,8,["value","disabled"])]),_:1}),l(t(b),{label:"自定义Prompt"},{default:s(()=>[l(t(w),{value:o.value.systemPrompt,"onUpdate:value":e[12]||(e[12]=r=>o.value.systemPrompt=r),type:"textarea",rows:6,placeholder:"为该群内的特定用户设置专属的系统提示词..."},null,8,["value"])]),_:1}),l(t(b),{label:"使用预设"},{default:s(()=>[l(t(Q),{value:o.value.presetId,"onUpdate:value":e[13]||(e[13]=r=>o.value.presetId=r),options:N.value,placeholder:"选择预设（可选）",clearable:""},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]))}};export{ge as default};
