import{d as $,a2 as b,S as d,Z as v,_ as W,K as Y,x as I,C as ee,M as m,O as e,R as P,ah as u,T as l,a1 as C,V as n,$ as r,a3 as T,a4 as H,P as B,aA as le}from"./index-BDK2Knud.js";import{C as U}from"./CodeBlock-BQNeydBS.js";import{S as te}from"./SearchOutlined-CUBeh0aw.js";const ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ae=$({name:"ContentCopyOutlined",render:function(_,f){return d(),b("svg",ne,f[0]||(f[0]=[v("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z",fill:"currentColor"},null,-1)]))}}),ue={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},oe=$({name:"InfoOutlined",render:function(_,f){return d(),b("svg",ue,f[0]||(f[0]=[v("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8z",fill:"currentColor"},null,-1)]))}}),se={key:0},re={key:0,style:{"margin-top":"12px"}},de={__name:"MessageDebug",setup(V){const _=Y(),f=I(!1),i=I({type:"seq",value:"",groupId:"",userId:""}),a=I(null),g=I(""),c=I({platform:"unknown",version:"",features:[]});async function h(){try{const o=await P.get("/api/platform/info");o.data.code===0&&(c.value=o.data.data)}catch(o){console.error("获取平台信息失败:",o)}}async function M(){if(!i.value.value){_.warning("请输入消息ID或Seq");return}f.value=!0,g.value="",a.value=null;try{const o=await P.post("/api/message/query",{type:i.value.type,value:i.value.value,group_id:i.value.groupId||void 0,user_id:i.value.userId||void 0});o.data.code===0?(a.value=o.data.data,_.success("查询成功")):(g.value=o.data.message||"查询失败",_.error(g.value))}catch(o){g.value=o.response?.data?.message||o.message,_.error("查询失败: "+g.value)}finally{f.value=!1}}async function j(o){try{await navigator.clipboard.writeText(typeof o=="string"?o:JSON.stringify(o,null,2)),_.success("已复制到剪贴板")}catch{_.error("复制失败")}}function K(o){return o?new Date(o*1e3).toLocaleString("zh-CN"):"N/A"}const E=ee(()=>a.value?JSON.stringify(a.value,null,2):"");return h(),(o,t)=>{const z=u("n-icon"),q=u("n-space"),w=u("n-tag"),p=u("n-descriptions-item"),S=u("n-descriptions"),y=u("n-card"),A=u("n-radio-button"),L=u("n-radio-group"),x=u("n-form-item"),N=u("n-input"),J=u("n-button"),F=u("n-form"),R=u("n-alert"),D=u("n-text"),O=u("n-code"),X=u("n-collapse-item"),Z=u("n-collapse"),k=u("n-li"),G=u("n-ul"),Q=u("n-divider");return d(),m(q,{vertical:"",size:"large"},{default:e(()=>[l(y,{size:"small"},{header:e(()=>[l(q,{align:"center"},{default:e(()=>[l(z,null,{default:e(()=>[l(B(oe))]),_:1}),t[5]||(t[5]=v("span",null,"平台信息",-1))]),_:1})]),default:e(()=>[l(S,{column:4,"label-placement":"left"},{default:e(()=>[l(p,{label:"平台"},{default:e(()=>[l(w,{type:c.value.platform==="icqq"?"success":"info"},{default:e(()=>[n(r(c.value.platform),1)]),_:1},8,["type"])]),_:1}),l(p,{label:"版本"},{default:e(()=>[n(r(c.value.version||"N/A"),1)]),_:1}),l(p,{label:"特性"},{default:e(()=>[l(q,{size:"small"},{default:e(()=>[(d(!0),b(T,null,H(c.value.features,s=>(d(),m(w,{key:s,size:"small"},{default:e(()=>[n(r(s),1)]),_:2},1024))),128)),c.value.features?.length?C("",!0):(d(),b("span",se,"-"))]),_:1})]),_:1})]),_:1})]),_:1}),l(y,{title:"消息查询"},{"header-extra":e(()=>[l(w,{type:"warning"},{default:e(()=>[...t[6]||(t[6]=[n("仅主人可用",-1)])]),_:1})]),default:e(()=>[l(F,{inline:"","label-placement":"left"},{default:e(()=>[l(x,{label:"查询类型"},{default:e(()=>[l(L,{value:i.value.type,"onUpdate:value":t[0]||(t[0]=s=>i.value.type=s)},{default:e(()=>[l(A,{value:"seq"},{default:e(()=>[...t[7]||(t[7]=[n("Seq",-1)])]),_:1}),l(A,{value:"message_id"},{default:e(()=>[...t[8]||(t[8]=[n("消息ID",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(x,{label:"消息标识"},{default:e(()=>[l(N,{value:i.value.value,"onUpdate:value":t[1]||(t[1]=s=>i.value.value=s),placeholder:"输入消息Seq或ID",style:{width:"200px"},onKeyup:le(M,["enter"])},null,8,["value"])]),_:1}),l(x,{label:"群号"},{default:e(()=>[l(N,{value:i.value.groupId,"onUpdate:value":t[2]||(t[2]=s=>i.value.groupId=s),placeholder:"可选",style:{width:"150px"}},null,8,["value"])]),_:1}),l(x,{label:"用户ID"},{default:e(()=>[l(N,{value:i.value.userId,"onUpdate:value":t[3]||(t[3]=s=>i.value.userId=s),placeholder:"可选（私聊）",style:{width:"150px"}},null,8,["value"])]),_:1}),l(x,null,{default:e(()=>[l(J,{type:"primary",onClick:M,loading:f.value},{icon:e(()=>[l(z,null,{default:e(()=>[l(B(te))]),_:1})]),default:e(()=>[t[9]||(t[9]=n(" 查询 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),g.value?(d(),m(R,{key:0,type:"error",style:{"margin-top":"16px"}},{default:e(()=>[n(r(g.value),1)]),_:1})):C("",!0)]),_:1}),a.value?(d(),m(y,{key:0,title:"查询结果"},{"header-extra":e(()=>[l(J,{size:"small",onClick:t[4]||(t[4]=s=>j(a.value))},{icon:e(()=>[l(z,null,{default:e(()=>[l(B(ae))]),_:1})]),default:e(()=>[t[10]||(t[10]=n(" 复制JSON ",-1))]),_:1})]),default:e(()=>[l(S,{column:3,"label-placement":"left",bordered:""},{default:e(()=>[l(p,{label:"平台"},{default:e(()=>[l(w,null,{default:e(()=>[n(r(a.value.platform),1)]),_:1})]),_:1}),l(p,{label:"Seq"},{default:e(()=>[n(r(a.value.parsed?.seq||"N/A"),1)]),_:1}),l(p,{label:"消息ID"},{default:e(()=>[n(r(a.value.parsed?.message_id||"N/A"),1)]),_:1}),l(p,{label:"时间"},{default:e(()=>[n(r(K(a.value.parsed?.time)),1)]),_:1}),l(p,{label:"发送者"},{default:e(()=>[n(r(a.value.parsed?.sender?.nickname||a.value.parsed?.sender?.user_id||"N/A"),1)]),_:1}),l(p,{label:"查询方法"},{default:e(()=>[(d(!0),b(T,null,H(a.value.methods_tried?.filter(s=>!s.includes("failed")),s=>(d(),m(w,{key:s,size:"small"},{default:e(()=>[n(r(s),1)]),_:2},1024))),128))]),_:1})]),_:1}),a.value.pb?.has_raw?(d(),m(y,{key:0,size:"small",title:"PB数据",style:{"margin-top":"16px"}},{default:e(()=>[l(S,{column:2,"label-placement":"left"},{default:e(()=>[l(p,{label:"数据类型"},{default:e(()=>[n(r(a.value.pb.raw_type),1)]),_:1}),l(p,{label:"数据大小"},{default:e(()=>[n(r(a.value.pb.raw_length)+" bytes ",1)]),_:1})]),_:1}),a.value.pb.hex_preview?(d(),b("div",re,[l(D,{depth:"3"},{default:e(()=>[...t[11]||(t[11]=[n("HEX预览:",-1)])]),_:1}),l(O,{style:{"word-break":"break-all","margin-top":"8px"}},{default:e(()=>[n(r(a.value.pb.hex_preview),1)]),_:1})])):C("",!0)]),_:1})):C("",!0),l(y,{size:"small",title:"消息内容",style:{"margin-top":"16px"}},{default:e(()=>[a.value.parsed?.raw_message?(d(),m(D,{key:0},{default:e(()=>[n(r(a.value.parsed.raw_message),1)]),_:1})):(d(),m(U,{key:1,code:JSON.stringify(a.value.parsed?.message||[],null,2),language:"json","max-height":"300px"},null,8,["code"]))]),_:1}),l(Z,{style:{"margin-top":"16px"}},{default:e(()=>[l(X,{title:"完整JSON数据",name:"json"},{default:e(()=>[l(U,{code:E.value,language:"json","max-height":"400px"},null,8,["code"])]),_:1})]),_:1})]),_:1})):C("",!0),l(y,{title:"使用说明",size:"small"},{default:e(()=>[l(G,null,{default:e(()=>[l(k,null,{default:e(()=>[...t[12]||(t[12]=[v("strong",null,"Seq查询",-1),n(": 使用消息序列号查询，通常为数字 ",-1)])]),_:1}),l(k,null,{default:e(()=>[...t[13]||(t[13]=[v("strong",null,"消息ID查询",-1),n(": 使用消息唯一标识符查询 ",-1)])]),_:1}),l(k,null,{default:e(()=>[...t[14]||(t[14]=[v("strong",null,"群号",-1),n(": 群聊消息需要提供群号 ",-1)])]),_:1}),l(k,null,{default:e(()=>[...t[15]||(t[15]=[v("strong",null,"用户ID",-1),n(": 私聊消息需要提供用户ID ",-1)])]),_:1}),l(k,null,{default:e(()=>[...t[16]||(t[16]=[v("strong",null,"PB数据",-1),n(": 仅 icqq 平台支持获取原始 Protobuf 数据 ",-1)])]),_:1})]),_:1}),l(Q),l(D,{depth:"3"},{default:e(()=>[t[19]||(t[19]=n(" 也可以在聊天中使用 ",-1)),l(O,null,{default:e(()=>[...t[17]||(t[17]=[n("#取 [seq]",-1)])]),_:1}),t[20]||(t[20]=n(" 或引用消息后发送 ",-1)),l(O,null,{default:e(()=>[...t[18]||(t[18]=[n("#取",-1)])]),_:1}),t[21]||(t[21]=n(" 来查询 ",-1))]),_:1})]),_:1})]),_:1})}}},_e=W(de,[["__scopeId","data-v-c2d4d6bb"]]);export{_e as default};
