import{_ as M,W as A,r as i,l as T,X as $,Y as c,Z as s,$ as a,a0 as f,a1 as m,a2 as l,a3 as r,a4 as O,P,ay as k,Q as w,a5 as b,bd as V,a6 as E,a9 as _,az as H,be as Q,ax as U,aA as j,aB as q,bf as F,bg as J,aa as N,ab as R,h as p}from"./index-rQPlXJ7c.js";import{S as W}from"./SearchOutlined-DgwjuhM_.js";import{N as X}from"./DataTable-MgpoJv9i.js";import{N as Y}from"./Popconfirm-CIhsMMSi.js";import"./Select-Uf32c2s9.js";const Z={style:{"max-height":"60vh","overflow-y":"auto"}},G={style:{color:"#999","font-size":"12px"}},K={style:{"white-space":"pre-wrap","word-break":"break-word","max-height":"200px","overflow-y":"auto"}},ee={__name:"ChatHistory",setup(te){const n=A(),d=i(!1),v=i([]),u=i(""),x=i(null),y=i(!1),h=i([]),z=[{title:"会话ID",key:"id",width:200,ellipsis:{tooltip:!0},render:e=>e.id?.substring(0,16)+"..."},{title:"用户",key:"userId",width:150,ellipsis:{tooltip:!0}},{title:"消息数",key:"messageCount",width:80,align:"center"},{title:"最后活动",key:"lastActivity",width:160,render:e=>C(e.lastActivity)},{title:"操作",key:"actions",width:150,render:e=>p(f,{size:"small"},()=>[p(w,{size:"small",onClick:()=>L(e)},()=>"查看"),p(Y,{onPositiveClick:()=>S(e.id)},{trigger:()=>p(w,{size:"small",type:"error"},()=>"删除"),default:()=>"确定删除此会话？"})])}],I=T(()=>{if(!u.value)return v.value;const e=u.value.toLowerCase();return v.value.filter(t=>t.id?.toLowerCase().includes(e)||t.userId?.toLowerCase().includes(e))});async function g(){d.value=!0;try{const e=await m.get("/api/conversations/list");e.data.code===0&&(v.value=e.data.data||[])}catch(e){n.error("获取会话列表失败: "+e.message)}finally{d.value=!1}}async function L(e){x.value=e;try{const t=await m.get(`/api/conversations/${e.id}/messages`);t.data.code===0&&(h.value=t.data.data||[],y.value=!0)}catch(t){n.error("获取会话详情失败: "+t.message)}}async function S(e){try{const t=await m.delete(`/api/conversations/${e}`);t.data.code===0?(n.success("删除成功"),g()):n.error("删除失败: "+t.data.message)}catch(t){n.error("删除失败: "+t.message)}}function C(e){return e?new Date(e).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function B(e){return typeof e.content=="string"?e.content:Array.isArray(e.content)?e.content.filter(t=>t.type==="text").map(t=>t.text).join(`
`):JSON.stringify(e.content)}return $(()=>{g()}),(e,t)=>(l(),c(a(f),{vertical:"",size:"large"},{default:s(()=>[r(a(O),{title:"对话历史"},{"header-extra":s(()=>[r(a(f),null,{default:s(()=>[r(a(P),{value:u.value,"onUpdate:value":t[0]||(t[0]=o=>u.value=o),placeholder:"搜索会话ID或用户",clearable:"",style:{width:"200px"}},{prefix:s(()=>[r(a(k),null,{default:s(()=>[r(a(W))]),_:1})]),_:1},8,["value"]),r(a(w),{onClick:g,loading:d.value},{icon:s(()=>[r(a(k),null,{default:s(()=>[r(a(V))]),_:1})]),default:s(()=>[t[2]||(t[2]=b(" 刷新 ",-1))]),_:1},8,["loading"])]),_:1})]),default:s(()=>[r(a(X),{columns:z,data:I.value,loading:d.value,pagination:{pageSize:20},bordered:!1,striped:""},null,8,["data","loading"])]),_:1}),r(a(E),{show:y.value,"onUpdate:show":t[1]||(t[1]=o=>y.value=o),preset:"card",title:`会话详情 - ${x.value?.userId||""}`,style:{width:"700px","max-height":"80vh"}},{default:s(()=>[_("div",Z,[h.value.length===0?(l(),c(a(H),{key:0,description:"暂无消息"})):(l(),c(a(Q),{key:1},{default:s(()=>[(l(!0),U(j,null,q(h.value,(o,D)=>(l(),c(a(F),{key:D},{default:s(()=>[r(a(J),null,{header:s(()=>[r(a(f),{align:"center",size:8},{default:s(()=>[r(a(R),{type:o.role==="user"?"info":o.role==="assistant"?"success":"warning",size:"small"},{default:s(()=>[b(N(o.role),1)]),_:2},1032,["type"]),_("span",G,N(C(o.timestamp)),1)]),_:2},1024)]),description:s(()=>[_("div",K,N(B(o)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))])]),_:1},8,["show","title"])]),_:1}))}},ne=M(ee,[["__scopeId","data-v-c402ac43"]]);export{ne as default};
