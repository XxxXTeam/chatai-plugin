import{W as V,r as i,X as A,Y as r,Z as t,$ as e,a0 as L,a1 as O,a2 as u,a3 as l,a4 as w,aB as J,h as b,ac as p,P as K,b7 as Q,aA as D,Q as S,a5 as d,b3 as $,a6 as j,ab as _,aa as f}from"./index-BO19D5Ve.js";import{S as E}from"./SearchOutlined-Bjt6MPOS.js";import{D as P}from"./DeleteOutlined-DpJXUCMT.js";import{N as R,a as m}from"./DescriptionsItem-Dpv07U8w.js";import{N as W}from"./DataTable-CsiH7edV.js";import{N as X}from"./Select-C4v57nJL.js";import{N as z}from"./Code-PohXdZL_.js";const te={__name:"ToolLogs",setup(Y){const k=V(),v=i(!1),c=i([]),g=i(""),y=i(null),x=i(!1),s=i(null),B=[{title:"时间",key:"timestamp",width:160,render:a=>I(a.timestamp)},{title:"工具",key:"toolName",width:180,render:a=>b(_,{type:"info",size:"small"},()=>a.toolName)},{title:"用户",key:"userId",width:120,ellipsis:{tooltip:!0}},{title:"状态",key:"success",width:80,render:a=>b(_,{type:a.success?"success":"error",size:"small"},()=>a.success?"成功":"失败")},{title:"耗时",key:"duration",width:80,render:a=>a.duration?`${a.duration}ms`:"-"},{title:"操作",key:"actions",width:80,render:a=>b(S,{size:"small",onClick:()=>M(a)},()=>"详情")}],C=i([]);async function h(){v.value=!0;try{const a={};y.value&&(a.tool=y.value),g.value&&(a.search=g.value);const o=await O.get("/api/tools/logs",{params:a});if(o.data.code===0){c.value=o.data.data||[];const n=new Set(c.value.map(N=>N.toolName));C.value=Array.from(n).map(N=>({label:N,value:N}))}}catch(a){k.error("获取日志失败: "+a.message)}finally{v.value=!1}}function M(a){s.value=a,x.value=!0}async function U(){try{(await O.delete("/api/tools/logs")).data.code===0&&(k.success("日志已清空"),c.value=[])}catch(a){k.error("清空失败: "+a.message)}}function I(a){return a?new Date(a).toLocaleString("zh-CN"):"-"}function T(a){try{return JSON.stringify(a,null,2)}catch{return String(a)}}return A(()=>{h()}),(a,o)=>(u(),r(e(L),{vertical:"",size:"large"},{default:t(()=>[l(e(w),{title:"工具调用日志"},{"header-extra":t(()=>[l(e(L),null,{default:t(()=>[l(e(X),{value:y.value,"onUpdate:value":[o[0]||(o[0]=n=>y.value=n),h],options:C.value,placeholder:"筛选工具",clearable:"",style:{width:"180px"}},null,8,["value","options"]),l(e(K),{value:g.value,"onUpdate:value":o[1]||(o[1]=n=>g.value=n),placeholder:"搜索...",clearable:"",style:{width:"150px"},onKeyup:Q(h,["enter"])},{prefix:t(()=>[l(e(D),null,{default:t(()=>[l(e(E))]),_:1})]),_:1},8,["value"]),l(e(S),{onClick:h,loading:v.value},{icon:t(()=>[l(e(D),null,{default:t(()=>[l(e($))]),_:1})]),default:t(()=>[o[3]||(o[3]=d(" 刷新 ",-1))]),_:1},8,["loading"]),c.value.length>0?(u(),r(e(S),{key:0,type:"error",onClick:U},{icon:t(()=>[l(e(D),null,{default:t(()=>[l(e(P))]),_:1})]),default:t(()=>[o[4]||(o[4]=d(" 清空 ",-1))]),_:1})):p("",!0)]),_:1})]),default:t(()=>[c.value.length===0?(u(),r(e(J),{key:0,description:"暂无日志记录"})):(u(),r(e(W),{key:1,columns:B,data:c.value,loading:v.value,pagination:{pageSize:50},bordered:!1,striped:"","max-height":"60vh"},null,8,["data","loading"]))]),_:1}),l(e(j),{show:x.value,"onUpdate:show":o[2]||(o[2]=n=>x.value=n),preset:"card",title:"调用详情",style:{width:"700px"}},{default:t(()=>[s.value?(u(),r(e(R),{key:0,column:2,"label-placement":"left",bordered:""},{default:t(()=>[l(e(m),{label:"工具名称"},{default:t(()=>[l(e(_),{type:"info"},{default:t(()=>[d(f(s.value.toolName),1)]),_:1})]),_:1}),l(e(m),{label:"状态"},{default:t(()=>[l(e(_),{type:s.value.success?"success":"error"},{default:t(()=>[d(f(s.value.success?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),l(e(m),{label:"用户ID"},{default:t(()=>[d(f(s.value.userId||"-"),1)]),_:1}),l(e(m),{label:"耗时"},{default:t(()=>[d(f(s.value.duration?s.value.duration+"ms":"-"),1)]),_:1}),l(e(m),{label:"时间",span:2},{default:t(()=>[d(f(I(s.value.timestamp)),1)]),_:1})]),_:1})):p("",!0),s.value?.arguments?(u(),r(e(w),{key:1,title:"请求参数",size:"small",style:{"margin-top":"16px"}},{default:t(()=>[l(e(z),{code:T(s.value.arguments),language:"json"},null,8,["code"])]),_:1})):p("",!0),s.value?.result?(u(),r(e(w),{key:2,title:"返回结果",size:"small",style:{"margin-top":"16px"}},{default:t(()=>[l(e(z),{code:T(s.value.result),language:"json",style:{"max-height":"300px",overflow:"auto"}},null,8,["code"])]),_:1})):p("",!0),s.value?.error?(u(),r(e(w),{key:3,title:"错误信息",size:"small",style:{"margin-top":"16px"}},{default:t(()=>[l(e(z),{code:s.value.error,language:"text"},null,8,["code"])]),_:1})):p("",!0)]),_:1},8,["show"])]),_:1}))}};export{te as default};
