import{K as V,w as b,a5 as E,L as K,M as L,O as s,P as e,Q as y,R as w,S as W,T as a,a6 as D,V as u,U as x,X as k,Y as n,a7 as T,N as m,B as r,a8 as f,W as Q}from"./index-YVyRGUFH.js";import{N as O,M as X}from"./ModelSelector-DV4Unun7.js";import{N as Y}from"./Select-BDC-ckzl.js";import{N as v}from"./Switch-BMUiMb7Q.js";import{N as j}from"./text-DiCHNzVc.js";import{N as C}from"./InputNumber-wwM5vtV-.js";import"./SearchOutlined-BQ5fCQof.js";const ll={__name:"Settings",setup(q){const p=V(),U=b(!1),M=b(!1),o=E({basic:{toggleMode:"at",togglePrefix:"#chat",commandPrefix:"#ai",debug:!1},llm:{defaultModel:"",embeddingModel:"text-embedding-3-small",models:{chat:"",roleplay:"",toolCall:"",search:"",reasoning:""},chatModel:"",codeModel:"",translationModel:""},bym:{enable:!1,probability:.02,temperature:.9,maxTokens:100,recall:!1,model:"",systemPrompt:""},thinking:{enableReasoning:!1,defaultLevel:"low"},streaming:{enabled:!0}}),N=b([]),g=b(!1),$=b("defaultModel");async function z(){U.value=!0;try{const d=await w.get("/api/config");if(d.data.code===0){const l=d.data.data;l.basic&&Object.assign(o.basic,l.basic),l.llm&&(Object.assign(o.llm,l.llm),l.llm.models&&Object.assign(o.llm.models,l.llm.models)),l.bym&&Object.assign(o.bym,l.bym),l.thinking&&Object.assign(o.thinking,l.thinking),l.streaming&&Object.assign(o.streaming,l.streaming);const t=await w.get("/api/channels/list");if(t.data.code===0){const B=t.data.data,S=new Set;B.forEach(P=>{P.models&&P.models.forEach(F=>S.add(F))}),N.value=Array.from(S).sort()}}}catch(d){p.error("加载配置失败: "+d.message)}finally{U.value=!1}}async function R(){M.value=!0;try{const d={basic:{...o.basic},llm:{...o.llm},bym:{...o.bym},thinking:{...o.thinking},streaming:{...o.streaming}},l=await w.post("/api/config",d);l.data.code===0?(p.success("配置已保存"),z()):p.error("保存失败: "+l.data.message)}catch(d){p.error("保存失败: "+d.message)}finally{M.value=!1}}function i(d){$.value=d,g.value=!0}function I(d){if(d.length>0){const l=$.value;if(l==="bymModel")o.bym.model=d[0];else if(l.startsWith("models.")){const t=l.replace("models.","");o.llm.models[t]=d[0]}else o.llm[l]=d[0]}g.value=!1}const A=[{label:"仅@触发",value:"at"},{label:"仅前缀触发",value:"prefix"},{label:"@和前缀都触发",value:"both"}];return K(()=>{z()}),(d,l)=>(W(),L(e(y),{vertical:"",size:"large"},{default:s(()=>[a(e(D),{type:"info",title:"提示",style:{"margin-bottom":"16px"}},{default:s(()=>[...l[37]||(l[37]=[u(" API Key 和渠道配置请前往「渠道管理」页面进行设置 ",-1)])]),_:1}),a(e(x),{title:"触发模式"},{default:s(()=>[a(e(k),{"label-placement":"left","label-width":"140"},{default:s(()=>[a(e(n),{label:"触发方式"},{default:s(()=>[a(e(Y),{value:o.basic.toggleMode,"onUpdate:value":l[0]||(l[0]=t=>o.basic.toggleMode=t),options:A,placeholder:"选择触发方式"},null,8,["value"])]),_:1}),a(e(n),{label:"触发前缀"},{default:s(()=>[a(e(T),{trigger:"hover"},{trigger:s(()=>[a(e(m),{value:o.basic.togglePrefix,"onUpdate:value":l[1]||(l[1]=t=>o.basic.togglePrefix=t),placeholder:"#chat",disabled:o.basic.toggleMode==="at"},null,8,["value","disabled"])]),default:s(()=>[l[38]||(l[38]=u(" 当触发方式包含前缀时，用户发送此前缀开头的消息会触发AI对话 ",-1))]),_:1})]),_:1}),a(e(n),{label:"命令前缀"},{default:s(()=>[a(e(T),{trigger:"hover"},{trigger:s(()=>[a(e(m),{value:o.basic.commandPrefix,"onUpdate:value":l[2]||(l[2]=t=>o.basic.commandPrefix=t),placeholder:"#ai"},null,8,["value"])]),default:s(()=>[l[39]||(l[39]=u(" 管理命令的前缀，如 #ai帮助、#ai状态 等 ",-1))]),_:1})]),_:1}),a(e(n),{label:"调试模式"},{default:s(()=>[a(e(v),{value:o.basic.debug,"onUpdate:value":l[3]||(l[3]=t=>o.basic.debug=t)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(x),{title:"模型配置"},{default:s(()=>[a(e(k),{"label-placement":"left","label-width":"140"},{default:s(()=>[a(e(n),{label:"默认模型"},{default:s(()=>[a(e(m),{value:o.llm.defaultModel,"onUpdate:value":l[5]||(l[5]=t=>o.llm.defaultModel=t),placeholder:"选择模型",readonly:"",onClick:l[6]||(l[6]=t=>i("defaultModel"))},{suffix:s(()=>[a(e(r),{size:"small",onClick:l[4]||(l[4]=f(t=>i("defaultModel"),["stop"]))},{default:s(()=>[...l[40]||(l[40]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(j),{"title-placement":"left"},{default:s(()=>[...l[41]||(l[41]=[u("模型分类 (可选，留空使用默认模型)",-1)])]),_:1}),a(e(n),{label:"对话模型"},{default:s(()=>[a(e(m),{value:o.llm.models.chat,"onUpdate:value":l[8]||(l[8]=t=>o.llm.models.chat=t),placeholder:"普通聊天使用的模型",readonly:"",onClick:l[9]||(l[9]=t=>i("models.chat"))},{suffix:s(()=>[a(e(r),{size:"small",onClick:l[7]||(l[7]=f(t=>i("models.chat"),["stop"]))},{default:s(()=>[...l[42]||(l[42]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(n),{label:"伪人模型"},{default:s(()=>[a(e(m),{value:o.llm.models.roleplay,"onUpdate:value":l[11]||(l[11]=t=>o.llm.models.roleplay=t),placeholder:"模拟真人回复的模型",readonly:"",onClick:l[12]||(l[12]=t=>i("models.roleplay"))},{suffix:s(()=>[a(e(r),{size:"small",onClick:l[10]||(l[10]=f(t=>i("models.roleplay"),["stop"]))},{default:s(()=>[...l[43]||(l[43]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(n),{label:"工具调用模型"},{default:s(()=>[a(e(m),{value:o.llm.models.toolCall,"onUpdate:value":l[14]||(l[14]=t=>o.llm.models.toolCall=t),placeholder:"Function Calling 模型",readonly:"",onClick:l[15]||(l[15]=t=>i("models.toolCall"))},{suffix:s(()=>[a(e(r),{size:"small",onClick:l[13]||(l[13]=f(t=>i("models.toolCall"),["stop"]))},{default:s(()=>[...l[44]||(l[44]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(n),{label:"搜索模型"},{default:s(()=>[a(e(m),{value:o.llm.models.search,"onUpdate:value":l[17]||(l[17]=t=>o.llm.models.search=t),placeholder:"联网搜索使用的模型",readonly:"",onClick:l[18]||(l[18]=t=>i("models.search"))},{suffix:s(()=>[a(e(r),{size:"small",onClick:l[16]||(l[16]=f(t=>i("models.search"),["stop"]))},{default:s(()=>[...l[45]||(l[45]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(n),{label:"思考模型"},{default:s(()=>[a(e(m),{value:o.llm.models.reasoning,"onUpdate:value":l[20]||(l[20]=t=>o.llm.models.reasoning=t),placeholder:"深度推理使用的模型",readonly:"",onClick:l[21]||(l[21]=t=>i("models.reasoning"))},{suffix:s(()=>[a(e(r),{size:"small",onClick:l[19]||(l[19]=f(t=>i("models.reasoning"),["stop"]))},{default:s(()=>[...l[46]||(l[46]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(j),{"title-placement":"left"},{default:s(()=>[...l[47]||(l[47]=[u("其他配置",-1)])]),_:1}),a(e(n),{label:"嵌入模型"},{default:s(()=>[a(e(m),{value:o.llm.embeddingModel,"onUpdate:value":l[22]||(l[22]=t=>o.llm.embeddingModel=t),placeholder:"text-embedding-3-small"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(x),{title:"伪人模式"},{default:s(()=>[a(e(k),{"label-placement":"left","label-width":"140"},{default:s(()=>[a(e(n),{label:"启用"},{default:s(()=>[a(e(v),{value:o.bym.enable,"onUpdate:value":l[23]||(l[23]=t=>o.bym.enable=t)},null,8,["value"])]),_:1}),a(e(n),{label:"触发概率"},{default:s(()=>[a(e(y),{vertical:"",style:{width:"100%"}},{default:s(()=>[a(e(O),{value:o.bym.probability,"onUpdate:value":l[24]||(l[24]=t=>o.bym.probability=t),min:0,max:1,step:.01,marks:{0:"0%",.5:"50%",1:"100%"}},null,8,["value"]),a(e(C),{value:o.bym.probability,"onUpdate:value":l[25]||(l[25]=t=>o.bym.probability=t),min:0,max:1,step:.01,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),a(e(n),{label:"回复温度"},{default:s(()=>[a(e(y),{vertical:"",style:{width:"100%"}},{default:s(()=>[a(e(O),{value:o.bym.temperature,"onUpdate:value":l[26]||(l[26]=t=>o.bym.temperature=t),min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}},null,8,["value"]),a(e(C),{value:o.bym.temperature,"onUpdate:value":l[27]||(l[27]=t=>o.bym.temperature=t),min:0,max:2,step:.1,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),a(e(n),{label:"最大 Token"},{default:s(()=>[a(e(C),{value:o.bym.maxTokens,"onUpdate:value":l[28]||(l[28]=t=>o.bym.maxTokens=t),min:10,max:1e3,step:10,style:{width:"100%"}},null,8,["value"])]),_:1}),a(e(n),{label:"启用记忆"},{default:s(()=>[a(e(v),{value:o.bym.recall,"onUpdate:value":l[29]||(l[29]=t=>o.bym.recall=t)},null,8,["value"])]),_:1}),a(e(n),{label:"使用模型"},{default:s(()=>[a(e(m),{value:o.bym.model,"onUpdate:value":l[31]||(l[31]=t=>o.bym.model=t),placeholder:"留空使用默认模型",readonly:"",onClick:l[32]||(l[32]=t=>i("bymModel"))},{suffix:s(()=>[a(e(r),{size:"small",onClick:l[30]||(l[30]=f(t=>i("bymModel"),["stop"]))},{default:s(()=>[...l[48]||(l[48]=[u("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(n),{label:"系统提示词"},{default:s(()=>[a(e(m),{value:o.bym.systemPrompt,"onUpdate:value":l[33]||(l[33]=t=>o.bym.systemPrompt=t),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"伪人模式的系统提示词"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(x),{title:"全局设置"},{default:s(()=>[a(e(k),{"label-placement":"left","label-width":"140"},{default:s(()=>[a(e(n),{label:"启用推理 (Thinking)"},{default:s(()=>[a(e(v),{value:o.thinking.enableReasoning,"onUpdate:value":l[34]||(l[34]=t=>o.thinking.enableReasoning=t)},null,8,["value"])]),_:1}),a(e(n),{label:"流式传输 (Streaming)"},{default:s(()=>[a(e(v),{value:o.streaming.enabled,"onUpdate:value":l[35]||(l[35]=t=>o.streaming.enabled=t)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(y),{justify:"end"},{default:s(()=>[a(e(r),{type:"primary",size:"large",onClick:R,loading:M.value},{default:s(()=>[...l[49]||(l[49]=[u(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1}),a(e(Q),{show:g.value,"onUpdate:show":l[36]||(l[36]=t=>g.value=t),preset:"card",title:"选择模型",style:{width:"800px","max-height":"85vh"}},{default:s(()=>[a(X,{"all-models":N.value,value:[],multiple:!1,"onUpdate:value":I},null,8,["all-models"])]),_:1},8,["show"])]),_:1}))}};export{ll as default};
