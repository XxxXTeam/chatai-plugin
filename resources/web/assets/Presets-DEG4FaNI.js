import{K as de,w as i,A as pe,L as ve,M as z,O as o,P as t,Q as N,R as d,S as C,T as s,U as M,Y as r,B as p,V as f,W as O,X as me,N as b,$ as v,a1 as F,Z as S,a2 as fe,a3 as ye,a4 as ce,a0 as R,h as c}from"./index-DxCzDBsQ.js";import{N as ge,a as B}from"./Tabs-R1y6W25B.js";import{N as be}from"./Code-OylKrr3G.js";import{N as Q}from"./Select-DBes2zJg.js";import{N as V}from"./Switch-DRTATV-n.js";import{N as ke}from"./DataTable-DjUg8Hw_.js";import{N as $}from"./InputNumber-BVBmw9IH.js";import{N as T}from"./DynamicTags-Cx4ftFi1.js";import{N as we}from"./Popconfirm-CrObcHRt.js";const xe={style:{display:"grid","grid-template-columns":"repeat(2, 1fr)",gap:"16px"}},Pe={style:{"font-weight":"600","font-size":"15px"}},Ue={style:{"min-height":"60px"}},Ne={style:{color:"#666","font-size":"13px",margin:"0 0 8px 0"}},Ce={style:{color:"#999","font-size":"12px",margin:"0","line-height":"1.4",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden"}},Oe={__name:"Presets",setup(Se){const u=de(),k=i([]),j=i([]),A=i([]),g=i(!1),w=i(!1),I=i(""),D=i(null),E=i(""),L=i(!1),x=i(!1),y=i({defaultId:"default",allowUserSwitch:!0,perUserPreset:!1,perGroupPreset:!1}),W=[{id:"assistant",name:"通用助手",description:"友好专业的AI助手",systemPrompt:"你是一个有帮助的AI助手，请用简洁清晰的语言回答用户的问题。",persona:{name:"AI助手",personality:"友好、专业、乐于助人",speakingStyle:"礼貌、简洁"}},{id:"catgirl",name:"猫娘",description:"可爱的猫娘角色",systemPrompt:'你是一只可爱的猫娘，说话时会加上"喵~"，性格活泼可爱。',persona:{name:"小喵",personality:"活泼、可爱、傲娇",speakingStyle:"卖萌、撒娇",traits:["猫耳","傲娇","贪吃"]}},{id:"coder",name:"编程助手",description:"专业的编程开发助手",systemPrompt:"你是一个专业的编程助手，擅长多种编程语言和框架。请提供清晰的代码示例和解释。",persona:{name:"代码助手",personality:"严谨、专业、耐心",speakingStyle:"技术性、条理清晰"}},{id:"translator",name:"翻译助手",description:"多语言翻译专家",systemPrompt:"你是一个专业的翻译助手，精通中英日韩等多种语言。请提供准确流畅的翻译。",persona:{name:"翻译官",personality:"专业、细致",speakingStyle:"准确、地道"}},{id:"writer",name:"写作助手",description:"创意写作和文案助手",systemPrompt:"你是一个创意写作助手，擅长各类文体写作，包括小说、诗歌、文案等。",persona:{name:"文思",personality:"富有创意、文采斐然",speakingStyle:"优美、富有感染力"}},{id:"roleplay",name:"角色扮演",description:"沉浸式角色扮演",systemPrompt:"你将扮演用户指定的角色，保持角色一致性，进行沉浸式对话。不要打破角色设定。",persona:{name:"",personality:"根据角色设定",speakingStyle:"符合角色特点"}},{id:"tutor",name:"学习导师",description:"耐心的学习辅导老师",systemPrompt:"你是一个耐心的学习导师，擅长用通俗易懂的方式解释复杂概念，引导学生思考。",persona:{name:"导师",personality:"耐心、博学、善于引导",speakingStyle:"循循善诱、深入浅出"}},{id:"emotional",name:"情感陪伴",description:"温暖的情感支持伙伴",systemPrompt:"你是一个温暖的倾听者和陪伴者，善于理解和安慰他人，提供情感支持。",persona:{name:"暖心",personality:"温柔、善解人意、有同理心",speakingStyle:"温暖、治愈"}}];function X(l){n.value={...P(),name:l.name,description:l.description,systemPrompt:l.systemPrompt,persona:{...P().persona,...l.persona}},x.value=!1,w.value=!1,I.value="",g.value=!0}const P=()=>({name:"",description:"",systemPrompt:"",model:"",temperature:.7,persona:{name:"",personality:"",background:"",speakingStyle:"",traits:[],likes:[],dislikes:[],customFields:{}},context:{maxMessages:20,maxTokens:8e3,includeGroupContext:!1,groupContextLength:10},tools:{enableBuiltinTools:!0,allowedTools:[],disabledTools:[]}}),n=i(P()),Y={name:{required:!0,message:"请输入名称",trigger:"blur"}},Z=pe(()=>k.value.map(l=>({label:l.name,value:l.id}))),H=[{title:"名称",key:"name",width:120},{title:"描述",key:"description",ellipsis:{tooltip:!0}},{title:"人设",key:"persona",width:100,render(l){return l.persona?.name?c(R,{type:"info",size:"small"},{default:()=>l.persona.name}):"-"}},{title:"模型",key:"model",width:150,ellipsis:{tooltip:!0}},{title:"默认",key:"isDefault",width:60,render(l){return y.value.defaultId===l.id?c(R,{type:"success",size:"small"},{default:()=>"是"}):""}},{title:"操作",key:"actions",width:220,render(l){return c(N,null,{default:()=>[c(p,{size:"small",onClick:()=>ae(l)},{default:()=>"编辑"}),c(p,{size:"small",type:"info",onClick:()=>te(l.id)},{default:()=>"预览"}),l.id!==y.value.defaultId?c(p,{size:"small",onClick:()=>le(l.id)},{default:()=>"设为默认"}):null,c(we,{onPositiveClick:()=>oe(l.id)},{trigger:()=>c(p,{size:"small",type:"error",disabled:l.id==="default"},{default:()=>"删除"}),default:()=>"确定删除该预设吗？"})].filter(Boolean)})}}];async function h(){try{const l=await d.get("/api/preset/list");l.data.code===0&&(k.value=l.data.data)}catch{u.error("获取预设列表失败")}}async function _(){try{const l=await d.get("/api/channels/list");if(l.data.code===0){j.value=l.data.data;const e=new Set;j.value.forEach(a=>{a.models&&Array.isArray(a.models)&&a.models.forEach(m=>e.add(m))}),A.value=Array.from(e).map(a=>({label:a,value:a})),A.value.unshift({label:"使用默认模型",value:""})}}catch(l){console.error("Failed to fetch channels",l)}}function ee(){w.value=!1,I.value="",n.value=P(),g.value=!0}function ae(l){w.value=!0,I.value=l.id;const e=P();n.value={...e,...l,persona:{...e.persona,...l.persona},context:{...e.context,...l.context},tools:{...e.tools,...l.tools}},g.value=!0}async function te(l){try{const e=await d.get(`/api/preset/${l}/prompt`);e.data.code===0&&(E.value=e.data.data.prompt,L.value=!0)}catch{u.error("获取预览失败")}}async function le(l){try{(await d.put("/api/presets/config",{defaultId:l})).data.code===0&&(y.value.defaultId=l,u.success("已设为默认预设"))}catch{u.error("设置失败")}}async function se(){try{const l=await d.get("/api/presets/config");l.data.code===0&&(y.value=l.data.data)}catch(l){console.error("Failed to fetch presets config",l)}}async function G(){try{(await d.put("/api/presets/config",y.value)).data.code===0&&u.success("配置已保存")}catch{u.error("保存失败")}}async function oe(l){try{const e=await d.delete(`/api/preset/${l}`);e.data.code===0?(u.success("删除成功"),h()):u.error(e.data.message)}catch{u.error("删除失败")}}function ne(){const l=JSON.stringify(k.value,null,2),e=new Blob([l],{type:"application/json"}),a=URL.createObjectURL(e),m=document.createElement("a");m.href=a,m.download=`presets_${new Date().toISOString().slice(0,10)}.json`,m.click(),URL.revokeObjectURL(a),u.success("导出成功")}function re(){const l=document.createElement("input");l.type="file",l.accept=".json",l.onchange=async e=>{const a=e.target.files[0];if(a)try{const m=await a.text(),J=JSON.parse(m);if(!Array.isArray(J)){u.error("无效的预设文件格式");return}let q=0;for(const U of J)try{k.value.find(ie=>ie.id===U.id)?await d.put(`/api/preset/${U.id}`,U):await d.post("/api/preset/",U),q++}catch(K){console.error("导入预设失败:",U.name,K)}u.success(`成功导入 ${q} 个预设`),h()}catch(m){u.error("导入失败: "+m.message)}},l.click()}async function ue(){D.value?.validate(async l=>{if(!l)try{let e;w.value?e=await d.put(`/api/preset/${I.value}`,n.value):e=await d.post("/api/preset/",n.value),e.data.code===0?(u.success("保存成功"),g.value=!1,h()):u.error(e.data.message)}catch{u.error("保存失败")}})}return ve(()=>{h(),_(),se()}),(l,e)=>(C(),z(t(N),{vertical:""},{default:o(()=>[s(t(M),{title:"预设配置",size:"small"},{default:o(()=>[s(t(N),null,{default:o(()=>[s(t(r),{label:"默认预设","label-placement":"left"},{default:o(()=>[s(t(Q),{value:y.value.defaultId,"onUpdate:value":[e[0]||(e[0]=a=>y.value.defaultId=a),G],options:Z.value,style:{width:"200px"}},null,8,["value","options"])]),_:1}),s(t(r),{label:"允许用户切换","label-placement":"left"},{default:o(()=>[s(t(V),{value:y.value.allowUserSwitch,"onUpdate:value":[e[1]||(e[1]=a=>y.value.allowUserSwitch=a),G]},null,8,["value"])]),_:1})]),_:1})]),_:1}),s(t(M),{title:"预设管理"},{"header-extra":o(()=>[s(t(N),null,{default:o(()=>[s(t(p),{onClick:e[2]||(e[2]=a=>x.value=!0)},{default:o(()=>[...e[27]||(e[27]=[f("模板库",-1)])]),_:1}),s(t(p),{onClick:re},{default:o(()=>[...e[28]||(e[28]=[f("导入",-1)])]),_:1}),s(t(p),{onClick:ne},{default:o(()=>[...e[29]||(e[29]=[f("导出",-1)])]),_:1}),s(t(p),{type:"primary",onClick:ee},{default:o(()=>[...e[30]||(e[30]=[f("添加预设",-1)])]),_:1})]),_:1})]),default:o(()=>[s(t(ke),{columns:H,data:k.value,pagination:{pageSize:10}},null,8,["data"])]),_:1}),s(t(O),{show:g.value,"onUpdate:show":e[23]||(e[23]=a=>g.value=a),preset:"card",title:w.value?"编辑预设":"添加预设",style:{width:"800px","max-height":"90vh"},"mask-closable":!1},{footer:o(()=>[s(t(N),{justify:"end"},{default:o(()=>[s(t(p),{onClick:e[22]||(e[22]=a=>g.value=!1)},{default:o(()=>[...e[32]||(e[32]=[f("取消",-1)])]),_:1}),s(t(p),{type:"primary",onClick:ue},{default:o(()=>[...e[33]||(e[33]=[f("保存",-1)])]),_:1})]),_:1})]),default:o(()=>[s(t(me),{ref_key:"formRef",ref:D,model:n.value,rules:Y,"label-placement":"left","label-width":"100"},{default:o(()=>[s(t(ge),{type:"line"},{default:o(()=>[s(t(B),{name:"basic",tab:"基础设置"},{default:o(()=>[s(t(r),{label:"名称",path:"name"},{default:o(()=>[s(t(b),{value:n.value.name,"onUpdate:value":e[3]||(e[3]=a=>n.value.name=a),placeholder:"请输入名称"},null,8,["value"])]),_:1}),s(t(r),{label:"描述",path:"description"},{default:o(()=>[s(t(b),{value:n.value.description,"onUpdate:value":e[4]||(e[4]=a=>n.value.description=a),placeholder:"请输入描述"},null,8,["value"])]),_:1}),s(t(r),{label:"系统提示词"},{feedback:o(()=>[f(" 支持变量: "+v(l.user_name)+", "+v(l.user_id)+", "+v(l.group_name)+", "+v(l.group_id)+", "+v(l.bot_name)+", "+v(l.date)+", "+v(l.time)+", "+v(l.weekday),1)]),default:o(()=>[s(t(b),{value:n.value.systemPrompt,"onUpdate:value":e[5]||(e[5]=a=>n.value.systemPrompt=a),type:"textarea",placeholder:"基础系统提示词，人设信息会自动附加",rows:4},null,8,["value"])]),_:1}),s(t(r),{label:"模型"},{default:o(()=>[s(t(Q),{value:n.value.model,"onUpdate:value":e[6]||(e[6]=a=>n.value.model=a),options:A.value,placeholder:"留空使用默认模型",filterable:"",tag:"",clearable:""},null,8,["value","options"])]),_:1}),s(t(r),{label:"温度"},{default:o(()=>[s(t($),{value:n.value.temperature,"onUpdate:value":e[7]||(e[7]=a=>n.value.temperature=a),min:0,max:2,step:.1,style:{width:"150px"}},null,8,["value"])]),_:1})]),_:1}),s(t(B),{name:"persona",tab:"人设配置"},{default:o(()=>[s(t(r),{label:"角色名称"},{default:o(()=>[s(t(b),{value:n.value.persona.name,"onUpdate:value":e[8]||(e[8]=a=>n.value.persona.name=a),placeholder:"AI的名字"},null,8,["value"])]),_:1}),s(t(r),{label:"性格特点"},{default:o(()=>[s(t(b),{value:n.value.persona.personality,"onUpdate:value":e[9]||(e[9]=a=>n.value.persona.personality=a),placeholder:"如：友好、幽默、专业"},null,8,["value"])]),_:1}),s(t(r),{label:"说话风格"},{default:o(()=>[s(t(b),{value:n.value.persona.speakingStyle,"onUpdate:value":e[10]||(e[10]=a=>n.value.persona.speakingStyle=a),placeholder:"如：礼貌、简洁、活泼"},null,8,["value"])]),_:1}),s(t(r),{label:"背景故事"},{default:o(()=>[s(t(b),{value:n.value.persona.background,"onUpdate:value":e[11]||(e[11]=a=>n.value.persona.background=a),type:"textarea",placeholder:"角色的背景故事",rows:3},null,8,["value"])]),_:1}),s(t(r),{label:"性格标签"},{default:o(()=>[s(t(T),{value:n.value.persona.traits,"onUpdate:value":e[12]||(e[12]=a=>n.value.persona.traits=a)},null,8,["value"])]),_:1}),s(t(r),{label:"喜好"},{default:o(()=>[s(t(T),{value:n.value.persona.likes,"onUpdate:value":e[13]||(e[13]=a=>n.value.persona.likes=a)},null,8,["value"])]),_:1}),s(t(r),{label:"厌恶"},{default:o(()=>[s(t(T),{value:n.value.persona.dislikes,"onUpdate:value":e[14]||(e[14]=a=>n.value.persona.dislikes=a)},null,8,["value"])]),_:1})]),_:1}),s(t(B),{name:"context",tab:"上下文配置"},{default:o(()=>[s(t(r),{label:"最大消息数"},{default:o(()=>[s(t($),{value:n.value.context.maxMessages,"onUpdate:value":e[15]||(e[15]=a=>n.value.context.maxMessages=a),min:1,max:100,style:{width:"150px"}},null,8,["value"])]),_:1}),s(t(r),{label:"最大Token数"},{default:o(()=>[s(t($),{value:n.value.context.maxTokens,"onUpdate:value":e[16]||(e[16]=a=>n.value.context.maxTokens=a),min:100,max:128e3,step:100,style:{width:"150px"}},null,8,["value"])]),_:1}),s(t(r),{label:"包含群聊上下文"},{default:o(()=>[s(t(V),{value:n.value.context.includeGroupContext,"onUpdate:value":e[17]||(e[17]=a=>n.value.context.includeGroupContext=a)},null,8,["value"])]),_:1}),n.value.context.includeGroupContext?(C(),z(t(r),{key:0,label:"群聊上下文长度"},{default:o(()=>[s(t($),{value:n.value.context.groupContextLength,"onUpdate:value":e[18]||(e[18]=a=>n.value.context.groupContextLength=a),min:1,max:50,style:{width:"150px"}},null,8,["value"])]),_:1})):F("",!0)]),_:1}),s(t(B),{name:"tools",tab:"工具配置"},{default:o(()=>[s(t(r),{label:"启用内置工具"},{default:o(()=>[s(t(V),{value:n.value.tools.enableBuiltinTools,"onUpdate:value":e[19]||(e[19]=a=>n.value.tools.enableBuiltinTools=a)},null,8,["value"])]),_:1}),n.value.tools.enableBuiltinTools?(C(),z(t(r),{key:0,label:"允许的工具"},{feedback:o(()=>[...e[31]||(e[31]=[f("留空表示允许所有工具",-1)])]),default:o(()=>[s(t(T),{value:n.value.tools.allowedTools,"onUpdate:value":e[20]||(e[20]=a=>n.value.tools.allowedTools=a)},null,8,["value"])]),_:1})):F("",!0),n.value.tools.enableBuiltinTools?(C(),z(t(r),{key:1,label:"禁用的工具"},{default:o(()=>[s(t(T),{value:n.value.tools.disabledTools,"onUpdate:value":e[21]||(e[21]=a=>n.value.tools.disabledTools=a)},null,8,["value"])]),_:1})):F("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),s(t(O),{show:L.value,"onUpdate:show":e[24]||(e[24]=a=>L.value=a),preset:"card",title:"系统提示词预览",style:{width:"700px"}},{default:o(()=>[s(t(be),{code:E.value,language:"markdown","word-wrap":""},null,8,["code"])]),_:1},8,["show"]),s(t(O),{show:x.value,"onUpdate:show":e[26]||(e[26]=a=>x.value=a),preset:"card",title:"预设模板库",style:{width:"750px"}},{footer:o(()=>[s(t(p),{onClick:e[25]||(e[25]=a=>x.value=!1)},{default:o(()=>[...e[35]||(e[35]=[f("关闭",-1)])]),_:1})]),default:o(()=>[S("div",xe,[(C(),fe(ye,null,ce(W,a=>s(t(M),{key:a.id,size:"small",hoverable:"",style:{cursor:"pointer"},onClick:m=>X(a)},{header:o(()=>[S("div",Pe,v(a.name),1)]),"header-extra":o(()=>[s(t(R),{size:"small",type:"info"},{default:o(()=>[...e[34]||(e[34]=[f("点击使用",-1)])]),_:1})]),default:o(()=>[S("div",Ue,[S("p",Ne,v(a.description),1),S("p",Ce,v(a.systemPrompt),1)])]),_:2},1032,["onClick"])),64))])]),_:1},8,["show"])]),_:1}))}};export{Oe as default};
