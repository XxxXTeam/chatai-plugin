import{d as Fe,h as v,as as Ge,x as c,A as Ke,_ as Qe,C as D,a2 as I,S as C,Z as n,at as We,au as Ye,K as Ze,L as Xe,M as L,O as s,P as t,Q as m,R as N,av as el,T as a,aw as ye,ax as G,U,ay as ee,N as $,B as f,V as o,a1 as K,a6 as R,X as re,Y as h,$ as M,a3 as le,a4 as be,W as te,a0 as Q}from"./index-BqjRKREt.js";import{C as we}from"./CodeBlock-DJkyKkbM.js";import{N as ll,a as ae}from"./Tabs-Al5CcygC.js";import{N as ne}from"./Select-DX174aVp.js";import{N as oe}from"./DataTable-BU0dPw-Q.js";import{N as ue}from"./Switch-BlYxbmOn.js";import{N as ie}from"./DynamicTags-DBRO1yAj.js";import{N as W}from"./text-DzBZpY64.js";import{N as de,a as pe}from"./CollapseItem-BgTSFr9b.js";import{N as tl}from"./Divider-6yR6HZeb.js";import{N as he}from"./Popconfirm-D1303jSz.js";import"./Add-BmXcPTYd.js";import"./prop-NnGblK-3.js";const al=Object.assign(Object.assign({},Ke.props),{trigger:String,xScrollable:Boolean,onScroll:Function,contentClass:String,contentStyle:[Object,String],size:Number,yPlacement:{type:String,default:"right"},xPlacement:{type:String,default:"bottom"}}),sl=Fe({name:"Scrollbar",props:al,setup(){const j=c(null);return Object.assign(Object.assign({},{scrollTo:(...b)=>{var S;(S=j.value)===null||S===void 0||S.scrollTo(b[0],b[1])},scrollBy:(...b)=>{var S;(S=j.value)===null||S===void 0||S.scrollBy(b[0],b[1])}}),{scrollbarInstRef:j})},render(){return v(Ge,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}}),rl={class:"code-editor"},nl=["innerHTML"],ol=["placeholder","rows","readonly"],ul={__name:"CodeEditor",props:{modelValue:{type:String,default:""},language:{type:String,default:"javascript"},placeholder:{type:String,default:""},rows:{type:Number,default:10},readonly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(j,{emit:d}){const b=j,S=d,_=c(null),O=c(null),P=D({get:()=>b.modelValue,set:u=>S("update:modelValue",u)}),V=D(()=>{if(!b.modelValue)return"";let u=Y(b.modelValue);return b.language==="javascript"||b.language==="js"?u=q(u):b.language==="json"&&(u=x(u)),u+`
`});function Y(u){return u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function q(u){const w=/\b(const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|try|catch|finally|throw|new|typeof|instanceof|class|extends|async|await|import|export|default|from|of|in)\b/g,g=/\b(console|Math|JSON|Date|Array|Object|String|Number|Boolean|Promise|Error|runtime|args|ctx|fetch|Bot|logger|config|Redis)\b/g,k=/(["'`])(?:(?!\1)[^\\]|\\.)*?\1/g,i=/(\/\/.*$|\/\*[\s\S]*?\*\/)/gm,p=/\b(\d+\.?\d*)\b/g,F=/\b(true|false|null|undefined)\b/g;return u.replace(i,'<span class="hl-comment">$1</span>').replace(k,'<span class="hl-string">$&</span>').replace(w,'<span class="hl-keyword">$1</span>').replace(g,'<span class="hl-builtin">$1</span>').replace(F,'<span class="hl-bool">$1</span>').replace(p,'<span class="hl-number">$1</span>')}function x(u){return u.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,w=>{let g="hl-number";return/^"/.test(w)?/:$/.test(w)?g="hl-key":g="hl-string":/true|false/.test(w)?g="hl-bool":/null/.test(w)&&(g="hl-null"),`<span class="${g}">${w}</span>`})}function H(){O.value&&_.value&&(O.value.scrollTop=_.value.scrollTop,O.value.scrollLeft=_.value.scrollLeft)}function E(u){if(u.key==="Tab"){u.preventDefault();const w=u.target.selectionStart,g=u.target.selectionEnd,k=u.target.value;u.target.value=k.substring(0,w)+"  "+k.substring(g),u.target.selectionStart=u.target.selectionEnd=w+2,P.value=u.target.value}}return(u,w)=>(C(),I("div",rl,[n("pre",{ref_key:"highlightRef",ref:O,class:"highlight-layer",innerHTML:V.value,"aria-hidden":"true"},null,8,nl),We(n("textarea",{ref_key:"textareaRef",ref:_,"onUpdate:modelValue":w[0]||(w[0]=g=>P.value=g),class:"input-layer",placeholder:j.placeholder,rows:j.rows,readonly:j.readonly,spellcheck:"false",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onScroll:H,onKeydown:E},null,40,ol),[[Ye,P.value]])]))}},Se=Qe(ul,[["__scopeId","data-v-c9dc239f"]]),il={key:0},kl={__name:"ToolsManager",setup(j){const d=Ze(),b=c(!1),S=c([]),_=c([]),O=c(""),P=c(null),V=c(null),Y=c("tools"),q=c(!1),x=c(null),H=c(!1),E=c("{}"),u=c(""),w=c(!1),g=c(!1),k=c(!1),i=c({name:"",type:"stdio",command:"",args:"",url:"",env:"",scriptPath:""}),p=c({enabled:!0,allowedTools:[],disabledTools:[],dangerousTools:["kick_member","mute_member","recall_message","set_group_ban","set_group_whole_ban"],allowDangerous:!1}),F=c([]),A=c(!1),J=c(!1),y=c({name:"",description:"",parameters:"{}",handler:""}),ce=[{name:"hello_world",label:"Hello World (åŸºç¡€ç¤ºä¾‹)",description:"ä¸€ä¸ªç®€å•çš„é—®å€™å·¥å…·ï¼Œè¿”å›é—®å€™è¯­",parameters:JSON.stringify({type:"object",properties:{name:{type:"string",description:"è¦é—®å€™çš„åå­—"}},required:["name"]},null,2),handler:`// è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å·¥å…·
// args åŒ…å«ç”¨æˆ·ä¼ å…¥çš„å‚æ•°
// ctx åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆbot, event ç­‰ï¼‰

const { name } = args
return {
  text: \`ä½ å¥½ï¼Œ\${name}ï¼æ¬¢è¿ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·ã€‚\`,
  greeting: true,
  timestamp: Date.now()
}`},{name:"random_number",label:"éšæœºæ•°ç”Ÿæˆå™¨",description:"ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°",parameters:JSON.stringify({type:"object",properties:{min:{type:"number",description:"æœ€å°å€¼",default:1},max:{type:"number",description:"æœ€å¤§å€¼",default:100}}},null,2),handler:`const min = args.min || 1
const max = args.max || 100
const result = Math.floor(Math.random() * (max - min + 1)) + min

return {
  text: \`ç”Ÿæˆçš„éšæœºæ•°æ˜¯: \${result}\`,
  number: result,
  range: { min, max }
}`},{name:"fetch_api",label:"API è¯·æ±‚å·¥å…·",description:"å‘é€ HTTP è¯·æ±‚è·å–æ•°æ®",parameters:JSON.stringify({type:"object",properties:{url:{type:"string",description:"è¯·æ±‚çš„ URL"},method:{type:"string",description:"è¯·æ±‚æ–¹æ³•",enum:["GET","POST"],default:"GET"}},required:["url"]},null,2),handler:`// ä½¿ç”¨ fetch å‘é€è¯·æ±‚
const { url, method = 'GET' } = args

try {
  const response = await fetch(url, { method })
  const data = await response.json()
  return {
    text: \`è¯·æ±‚æˆåŠŸï¼ŒçŠ¶æ€ç : \${response.status}\`,
    data,
    status: response.status
  }
} catch (error) {
  return {
    error: \`è¯·æ±‚å¤±è´¥: \${error.message}\`,
    url
  }
}`},{name:"send_message_tool",label:"å‘é€æ¶ˆæ¯å·¥å…·",description:"ä½¿ç”¨ Bot å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šç¾¤",parameters:JSON.stringify({type:"object",properties:{group_id:{type:"string",description:"ç¾¤å·"},message:{type:"string",description:"æ¶ˆæ¯å†…å®¹"}},required:["group_id","message"]},null,2),handler:`// ä½¿ç”¨ ctx.getBot() è·å– Bot å®ä¾‹
const bot = ctx.getBot()
const { group_id, message } = args

try {
  const group = bot.pickGroup(parseInt(group_id))
  const result = await group.sendMsg(message)
  return {
    text: \`æ¶ˆæ¯å·²å‘é€åˆ°ç¾¤ \${group_id}\`,
    success: true,
    message_id: result.message_id
  }
} catch (error) {
  return {
    error: \`å‘é€å¤±è´¥: \${error.message}\`
  }
}`},{name:"current_time",label:"å½“å‰æ—¶é—´",description:"è·å–å½“å‰æ—¶é—´ä¿¡æ¯",parameters:JSON.stringify({type:"object",properties:{format:{type:"string",description:"æ—¶é—´æ ¼å¼",enum:["full","date","time"],default:"full"}}},null,2),handler:`const now = new Date()
const format = args.format || 'full'

let result
switch (format) {
  case 'date':
    result = now.toLocaleDateString('zh-CN')
    break
  case 'time':
    result = now.toLocaleTimeString('zh-CN')
    break
  default:
    result = now.toLocaleString('zh-CN')
}

return {
  text: \`å½“å‰æ—¶é—´: \${result}\`,
  timestamp: now.getTime(),
  formatted: result
}`},{name:"redis_cache",label:"Redis ç¼“å­˜æ“ä½œ",description:"ä½¿ç”¨ Redis å­˜å–æ•°æ®",parameters:JSON.stringify({type:"object",properties:{action:{type:"string",description:"æ“ä½œç±»å‹",enum:["get","set","del"]},key:{type:"string",description:"ç¼“å­˜é”®å"},value:{type:"string",description:"ç¼“å­˜å€¼ï¼ˆsetæ—¶éœ€è¦ï¼‰"},ttl:{type:"number",description:"è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰",default:3600}},required:["action","key"]},null,2),handler:`const { action, key, value, ttl = 3600 } = args

await runtime.Redis.init()

switch (action) {
  case 'get': {
    const data = await runtime.Redis.get(key)
    return { text: data ? \`è·å–æˆåŠŸ: \${data}\` : 'é”®ä¸å­˜åœ¨', data }
  }
  case 'set': {
    await runtime.Redis.set(key, value, ttl)
    return { text: \`å·²è®¾ç½® \${key}ï¼Œæœ‰æ•ˆæœŸ \${ttl} ç§’\` }
  }
  case 'del': {
    await runtime.Redis.del(key)
    return { text: \`å·²åˆ é™¤ \${key}\` }
  }
  default:
    return { error: 'æœªçŸ¥æ“ä½œ' }
}`},{name:"call_other_tool",label:"è°ƒç”¨å…¶ä»–å·¥å…·",description:"é“¾å¼è°ƒç”¨å…¶ä»–MCPå·¥å…·",parameters:JSON.stringify({type:"object",properties:{tool_name:{type:"string",description:"è¦è°ƒç”¨çš„å·¥å…·åç§°"},tool_args:{type:"object",description:"ä¼ é€’ç»™å·¥å…·çš„å‚æ•°"}},required:["tool_name"]},null,2),handler:`const { tool_name, tool_args = {} } = args

try {
  const result = await runtime.mcp.callTool(tool_name, tool_args)
  return {
    text: \`å·¥å…· \${tool_name} æ‰§è¡Œå®Œæˆ\`,
    result
  }
} catch (error) {
  return { error: \`è°ƒç”¨å¤±è´¥: \${error.message}\` }
}`},{name:"execute_command",label:"æ‰§è¡Œç³»ç»Ÿå‘½ä»¤",description:"æ‰§è¡Œshellå‘½ä»¤ï¼ˆæ³¨æ„å®‰å…¨ï¼‰",parameters:JSON.stringify({type:"object",properties:{command:{type:"string",description:"è¦æ‰§è¡Œçš„å‘½ä»¤"}},required:["command"]},null,2),handler:`const { command } = args

// å®‰å…¨æ£€æŸ¥ - ç¦æ­¢å±é™©å‘½ä»¤
const dangerous = ['rm -rf', 'mkfs', 'dd if=', ':(){', 'chmod -R 777']
if (dangerous.some(d => command.includes(d))) {
  return { error: 'æ£€æµ‹åˆ°å±é™©å‘½ä»¤ï¼Œå·²æ‹’ç»æ‰§è¡Œ' }
}

try {
  const { stdout, stderr } = await runtime.utils.exec(command)
  return {
    text: stdout || 'å‘½ä»¤æ‰§è¡Œå®Œæˆ',
    stdout,
    stderr
  }
} catch (error) {
  return { error: \`æ‰§è¡Œå¤±è´¥: \${error.message}\` }
}`}],Te=D(()=>{const l=new Set(["builtin"]);return S.value.forEach(e=>{e.serverName&&l.add(e.serverName)}),[{label:"å…¨éƒ¨",value:null},...Array.from(l).map(e=>({label:e,value:e}))]}),xe=[{label:"å…¨éƒ¨",value:null},{label:"å†…ç½®å·¥å…·",value:"builtin"},{label:"MCPå·¥å…·",value:"mcp"}],ke=D(()=>{let l=S.value;if(O.value){const e=O.value.toLowerCase();l=l.filter(T=>T.name.toLowerCase().includes(e)||T.description?.toLowerCase().includes(e))}return V.value&&(l=l.filter(e=>(e.serverName||"builtin")===V.value)),P.value==="builtin"?l=l.filter(e=>e.isBuiltin):P.value==="mcp"&&(l=l.filter(e=>!e.isBuiltin)),l}),Ne=D(()=>S.value.filter(l=>l.isBuiltin).length),Ce=D(()=>S.value.filter(l=>!l.isBuiltin).length),ze=D(()=>_.value.filter(l=>l.status==="connected").length),$e=[{title:"åç§°",key:"name",width:180,ellipsis:{tooltip:!0}},{title:"æè¿°",key:"description",ellipsis:{tooltip:!0}},{title:"ç±»å‹",key:"type",width:80,render:l=>l.isBuiltin?v(Q,{type:"success",size:"small"},{default:()=>"å†…ç½®"}):v(Q,{type:"info",size:"small"},{default:()=>"MCP"})},{title:"æ¥æº",key:"serverName",width:120,render:l=>l.serverName||"builtin"},{title:"å±é™©",key:"dangerous",width:60,render:l=>p.value.dangerousTools?.includes(l.name)?v(Q,{type:"error",size:"small"},{default:()=>"æ˜¯"}):""},{title:"çŠ¶æ€",key:"enabled",width:80,render:l=>{if(!l.isBuiltin)return"-";const e=p.value.disabledTools?.includes(l.name);return v(ue,{size:"small",value:!e,onUpdateValue:()=>Pe(l.name)})}},{title:"æ“ä½œ",key:"actions",width:150,render:l=>v(m,{size:"small"},{default:()=>[v(f,{size:"small",onClick:()=>Je(l)},{default:()=>"è¯¦æƒ…"}),v(f,{size:"small",type:"primary",onClick:()=>me(l)},{default:()=>"æµ‹è¯•"})]})}],je=[{title:"åç§°",key:"name",width:150},{title:"ç±»å‹",key:"type",width:100,render:l=>({stdio:"æœ¬åœ°è¿›ç¨‹",sse:"SSE",http:"HTTP",js:"JSè„šæœ¬"})[l.type]||l.type},{title:"çŠ¶æ€",key:"status",width:100,render:l=>{const e=l.status==="connected"?"success":l.status==="error"?"error":"warning";return v(Q,{type:e,size:"small"},{default:()=>l.status||"unknown"})}},{title:"å·¥å…·æ•°",key:"toolsCount",width:80},{title:"èµ„æºæ•°",key:"resourcesCount",width:80},{title:"æ“ä½œ",key:"actions",width:200,render:l=>{const e=l.name==="builtin";return v(m,{size:"small"},{default:()=>[v(f,{size:"small",onClick:()=>Re(l),disabled:e},{default:()=>"é‡è¿"}),v(f,{size:"small",onClick:()=>Ee(l),disabled:e},{default:()=>"ç¼–è¾‘"}),v(he,{onPositiveClick:()=>De(l)},{trigger:()=>v(f,{size:"small",type:"error",disabled:e},{default:()=>"åˆ é™¤"}),default:()=>"ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ"})]})}}];async function B(){b.value=!0;try{const l=await N.get("/api/tools/list");l.data.code===0&&(S.value=l.data.data||[])}catch{d.error("è·å–å·¥å…·åˆ—è¡¨å¤±è´¥")}finally{b.value=!1}}async function Z(){try{const l=await N.get("/api/mcp/servers");l.data.code===0&&(_.value=l.data.data||[])}catch{d.error("è·å–æœåŠ¡å™¨åˆ—è¡¨å¤±è´¥")}}async function _e(){try{const l=await N.get("/api/tools/builtin/config");l.data.code===0&&(p.value={...p.value,...l.data.data})}catch(l){console.error("Failed to fetch builtin config",l)}}async function X(){try{(await N.put("/api/tools/builtin/config",p.value)).data.code===0&&(d.success("é…ç½®å·²ä¿å­˜"),await B())}catch{d.error("ä¿å­˜å¤±è´¥")}}function Oe(){p.value.disabledTools=[],p.value.allowedTools=[],X()}function Be(){p.value.disabledTools=[...p.value.dangerousTools],p.value.allowDangerous=!1,X()}function Pe(l){const e=p.value.disabledTools.indexOf(l);e>=0?p.value.disabledTools.splice(e,1):p.value.disabledTools.push(l),X()}function Je(l){x.value=l,q.value=!0}function me(l){x.value=l,E.value=JSON.stringify(fe(l),null,2),u.value="",H.value=!0}function fe(l){const e=l.inputSchema||l.parameters||{},T={};return e.properties&&Object.keys(e.properties).forEach(r=>{const z=e.properties[r];z.default!==void 0?T[r]=z.default:z.type==="string"?T[r]="":z.type==="number"||z.type==="integer"?T[r]=0:z.type==="boolean"&&(T[r]=!1)}),T}async function Ue(){w.value=!0,u.value="";try{const l=JSON.parse(E.value),e=await N.post("/api/tools/test",{toolName:x.value.name,arguments:l});e.data.code===0?(u.value=JSON.stringify(e.data.data,null,2),d.success("æµ‹è¯•æˆåŠŸ")):u.value=`Error: ${e.data.message}`}catch(l){u.value=`Error: ${l.message}`}finally{w.value=!1}}function Me(){k.value=!1,i.value={name:"",type:"stdio",command:"",args:"",url:"",env:"",scriptPath:""},g.value=!0}function Ee(l){k.value=!0,i.value={name:l.name,type:l.type||"stdio",command:l.config?.command||"",args:l.config?.args?.join(" ")||"",url:l.config?.url||"",env:l.config?.env?JSON.stringify(l.config.env):"",scriptPath:l.config?.scriptPath||""},g.value=!0}async function Re(l){try{const e=await N.post(`/api/mcp/servers/${l.name}/reconnect`);e.data.code===0?(d.success("é‡è¿æˆåŠŸ"),Z(),B()):d.error(e.data.message)}catch(e){d.error("é‡è¿å¤±è´¥: "+e.message)}}async function De(l){try{const e=await N.delete(`/api/mcp/servers/${l.name}`);e.data.code===0?(d.success("åˆ é™¤æˆåŠŸ"),Z(),B()):d.error(e.data.message)}catch{d.error("åˆ é™¤å¤±è´¥")}}async function Ve(){try{const l={type:i.value.type};i.value.type==="stdio"?(l.command=i.value.command,i.value.args&&(l.args=i.value.args.split(" ").filter(Boolean)),i.value.env&&(l.env=JSON.parse(i.value.env))):i.value.type==="js"?l.scriptPath=i.value.scriptPath:l.url=i.value.url;const e=k.value?`/api/mcp/servers/${i.value.name}`:"/api/mcp/servers",T=k.value?"put":"post",r=await N[T](e,{name:i.value.name,config:l});r.data.code===0?(d.success(k.value?"æ›´æ–°æˆåŠŸ":"æ·»åŠ æˆåŠŸ"),g.value=!1,Z(),B()):d.error(r.data.message)}catch(l){d.error("æ“ä½œå¤±è´¥: "+l.message)}}async function Ae(){try{const l=await N.post("/api/tools/builtin/refresh");l.data.code===0&&(d.success(`å·²åˆ·æ–° ${l.data.data?.count||0} ä¸ªå†…ç½®å·¥å…·`),await B())}catch{d.error("åˆ·æ–°å¤±è´¥")}}async function se(){try{const l=await N.get("/api/tools/custom");l.data.code===0&&(F.value=l.data.data||[])}catch(l){console.error("Failed to fetch custom tools",l)}}function ve(){J.value=!1,y.value={name:"",description:"",parameters:JSON.stringify({type:"object",properties:{},required:[]},null,2),handler:`// åœ¨è¿™é‡Œç¼–å†™å·¥å…·é€»è¾‘
// args: ç”¨æˆ·ä¼ å…¥çš„å‚æ•°å¯¹è±¡
// ctx: ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ŒåŒ…å« getBot(), getEvent() ç­‰æ–¹æ³•

return {
  text: 'å·¥å…·æ‰§è¡ŒæˆåŠŸ',
  data: args
}`},A.value=!0}function Le(l){J.value=!0,y.value={name:l.name,description:l.description,parameters:typeof l.parameters=="string"?l.parameters:JSON.stringify(l.parameters||{},null,2),handler:l.handler||""},A.value=!0}function ge(l){y.value={name:l.name,description:l.description,parameters:l.parameters,handler:l.handler},d.success(`å·²åº”ç”¨æ¨¡æ¿: ${l.label}`)}async function Ie(){if(!y.value.name||!y.value.description){d.error("åç§°å’Œæè¿°ä¸èƒ½ä¸ºç©º");return}try{let l;try{l=JSON.parse(y.value.parameters)}catch{d.error("å‚æ•°æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ JSON");return}const e={name:y.value.name,description:y.value.description,parameters:l,handler:y.value.handler},T=J.value?`/api/tools/custom/${y.value.name}`:"/api/tools/custom",r=J.value?"put":"post",z=await N[r](T,e);z.data.code===0?(d.success(J.value?"æ›´æ–°æˆåŠŸ":"åˆ›å»ºæˆåŠŸ"),A.value=!1,await se(),await B()):d.error(z.data.message)}catch(l){d.error("ä¿å­˜å¤±è´¥: "+l.message)}}async function qe(l){try{const e=await N.delete(`/api/tools/custom/${l}`);e.data.code===0?(d.success("åˆ é™¤æˆåŠŸ"),await se(),await B()):d.error(e.data.message)}catch{d.error("åˆ é™¤å¤±è´¥")}}const He=[{title:"åç§°",key:"name",width:150},{title:"æè¿°",key:"description",ellipsis:{tooltip:!0}},{title:"åˆ›å»ºæ—¶é—´",key:"createdAt",width:180,render:l=>l.createdAt?new Date(l.createdAt).toLocaleString("zh-CN"):"-"},{title:"æ“ä½œ",key:"actions",width:200,render:l=>v(m,{size:"small"},{default:()=>[v(f,{size:"small",onClick:()=>Le(l)},{default:()=>"ç¼–è¾‘"}),v(f,{size:"small",type:"primary",onClick:()=>me(l)},{default:()=>"æµ‹è¯•"}),v(he,{onPositiveClick:()=>qe(l.name)},{trigger:()=>v(f,{size:"small",type:"error"},{default:()=>"åˆ é™¤"}),default:()=>"ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ"})]})}];return Xe(()=>{B(),Z(),_e(),se()}),(l,e)=>{const T=el("n-code");return C(),L(t(m),{vertical:"",size:16},{default:s(()=>[a(t(ye),{cols:4,"x-gap":16},{default:s(()=>[a(t(G),null,{default:s(()=>[a(t(U),{size:"small"},{default:s(()=>[a(t(ee),{label:"å†…ç½®å·¥å…·",value:Ne.value},null,8,["value"])]),_:1})]),_:1}),a(t(G),null,{default:s(()=>[a(t(U),{size:"small"},{default:s(()=>[a(t(ee),{label:"MCPå·¥å…·",value:Ce.value},null,8,["value"])]),_:1})]),_:1}),a(t(G),null,{default:s(()=>[a(t(U),{size:"small"},{default:s(()=>[a(t(ee),{label:"MCPæœåŠ¡å™¨",value:_.value.length},null,8,["value"])]),_:1})]),_:1}),a(t(G),null,{default:s(()=>[a(t(U),{size:"small"},{default:s(()=>[a(t(ee),{label:"å·²è¿æ¥",value:ze.value},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(t(U),null,{default:s(()=>[a(t(ll),{value:Y.value,"onUpdate:value":e[8]||(e[8]=r=>Y.value=r),type:"line"},{default:s(()=>[a(t(ae),{name:"tools",tab:"å·¥å…·åˆ—è¡¨"},{default:s(()=>[a(t(m),{vertical:"",size:12},{default:s(()=>[a(t(m),{justify:"space-between"},{default:s(()=>[a(t(m),null,{default:s(()=>[a(t($),{value:O.value,"onUpdate:value":e[0]||(e[0]=r=>O.value=r),placeholder:"æœç´¢å·¥å…·...",style:{width:"200px"},clearable:""},null,8,["value"]),a(t(ne),{value:P.value,"onUpdate:value":e[1]||(e[1]=r=>P.value=r),options:xe,placeholder:"ç±»å‹",style:{width:"120px"},clearable:""},null,8,["value"]),a(t(ne),{value:V.value,"onUpdate:value":e[2]||(e[2]=r=>V.value=r),options:Te.value,placeholder:"æ¥æº",style:{width:"150px"},clearable:""},null,8,["value","options"])]),_:1}),a(t(m),null,{default:s(()=>[a(t(f),{onClick:Oe},{default:s(()=>[...e[28]||(e[28]=[o("å…¨éƒ¨å¯ç”¨",-1)])]),_:1}),a(t(f),{onClick:Be,type:"warning"},{default:s(()=>[...e[29]||(e[29]=[o("ç¦ç”¨å±é™©å·¥å…·",-1)])]),_:1}),a(t(f),{onClick:B,loading:b.value},{default:s(()=>[...e[30]||(e[30]=[o("åˆ·æ–°",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),a(t(oe),{columns:$e,data:ke.value,loading:b.value,pagination:{pageSize:15},size:"small"},null,8,["data","loading"])]),_:1})]),_:1}),a(t(ae),{name:"servers",tab:"MCPæœåŠ¡å™¨"},{default:s(()=>[a(t(m),{vertical:"",size:12},{default:s(()=>[a(t(m),{justify:"end"},{default:s(()=>[a(t(f),{type:"primary",onClick:Me},{default:s(()=>[...e[31]||(e[31]=[o("æ·»åŠ æœåŠ¡å™¨",-1)])]),_:1})]),_:1}),a(t(oe),{columns:je,data:_.value,size:"small"},null,8,["data"])]),_:1})]),_:1}),a(t(ae),{name:"builtin",tab:"å†…ç½®å·¥å…·é…ç½®"},{default:s(()=>[a(t(m),{vertical:"",size:16},{default:s(()=>[p.value.enabled?K("",!0):(C(),L(t(R),{key:0,type:"warning"},{default:s(()=>[...e[32]||(e[32]=[o(" å†…ç½®å·¥å…·å·²ç¦ç”¨ï¼ŒAIå°†æ— æ³•ä½¿ç”¨QQç›¸å…³åŠŸèƒ½ ",-1)])]),_:1})),a(t(re),{"label-placement":"left","label-width":"140"},{default:s(()=>[a(t(h),{label:"å¯ç”¨å†…ç½®å·¥å…·"},{default:s(()=>[a(t(ue),{value:p.value.enabled,"onUpdate:value":e[3]||(e[3]=r=>p.value.enabled=r)},null,8,["value"])]),_:1}),a(t(h),{label:"å…è®¸å±é™©æ“ä½œ"},{feedback:s(()=>[...e[33]||(e[33]=[o("å±é™©æ“ä½œåŒ…æ‹¬è¸¢äººã€ç¦è¨€ã€æ’¤å›ç­‰",-1)])]),default:s(()=>[a(t(ue),{value:p.value.allowDangerous,"onUpdate:value":e[4]||(e[4]=r=>p.value.allowDangerous=r)},null,8,["value"])]),_:1}),a(t(h),{label:"å±é™©å·¥å…·åˆ—è¡¨"},{default:s(()=>[a(t(ie),{value:p.value.dangerousTools,"onUpdate:value":e[5]||(e[5]=r=>p.value.dangerousTools=r)},null,8,["value"])]),_:1}),a(t(h),{label:"å…è®¸çš„å·¥å…·"},{feedback:s(()=>[...e[34]||(e[34]=[o("ç•™ç©ºè¡¨ç¤ºå…è®¸æ‰€æœ‰å·¥å…·",-1)])]),default:s(()=>[a(t(ie),{value:p.value.allowedTools,"onUpdate:value":e[6]||(e[6]=r=>p.value.allowedTools=r)},null,8,["value"])]),_:1}),a(t(h),{label:"ç¦ç”¨çš„å·¥å…·"},{default:s(()=>[a(t(ie),{value:p.value.disabledTools,"onUpdate:value":e[7]||(e[7]=r=>p.value.disabledTools=r)},null,8,["value"])]),_:1}),a(t(h),null,{default:s(()=>[a(t(m),null,{default:s(()=>[a(t(f),{type:"primary",onClick:X},{default:s(()=>[...e[35]||(e[35]=[o("ä¿å­˜é…ç½®",-1)])]),_:1}),a(t(f),{onClick:Ae},{default:s(()=>[...e[36]||(e[36]=[o("åˆ·æ–°å†…ç½®å·¥å…·",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(t(ae),{name:"custom",tab:"è‡ªå®šä¹‰å·¥å…·"},{default:s(()=>[a(t(m),{vertical:"",size:16},{default:s(()=>[a(t(R),{type:"info"},{default:s(()=>[...e[37]||(e[37]=[o(" è‡ªå®šä¹‰å·¥å…·å…è®¸ä½ ä½¿ç”¨ JavaScript ç¼–å†™è‡ªå·±çš„ MCP å·¥å…·ã€‚å·¥å…·ä»£ç åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œå¯ä»¥è®¿é—® Bot API å’Œç½‘ç»œè¯·æ±‚ã€‚ ",-1)])]),_:1}),a(t(m),{justify:"space-between"},{default:s(()=>[a(t(W),null,{default:s(()=>[o("å…± "+M(F.value.length)+" ä¸ªè‡ªå®šä¹‰å·¥å…·",1)]),_:1}),a(t(f),{type:"primary",onClick:ve},{default:s(()=>[...e[38]||(e[38]=[o("åˆ›å»ºå·¥å…·",-1)])]),_:1})]),_:1}),a(t(oe),{columns:He,data:F.value,size:"small"},null,8,["data"]),a(t(de),null,{default:s(()=>[a(t(pe),{title:"ğŸ“š ç¤ºä¾‹æ¨¡æ¿ (ç‚¹å‡»å±•å¼€)",name:"templates"},{default:s(()=>[a(t(ye),{cols:2,"x-gap":12,"y-gap":12},{default:s(()=>[(C(),I(le,null,be(ce,r=>a(t(G),{key:r.name},{default:s(()=>[a(t(U),{size:"small",hoverable:"",onClick:()=>{ve(),ge(r)}},{header:s(()=>[a(t(W),{strong:""},{default:s(()=>[o(M(r.label),1)]),_:2},1024)]),default:s(()=>[a(t(W),{depth:"3"},{default:s(()=>[o(M(r.description),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)),64))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),a(t(te),{show:q.value,"onUpdate:show":e[9]||(e[9]=r=>q.value=r),preset:"card",title:"å·¥å…·è¯¦æƒ…",style:{width:"650px"}},{default:s(()=>[x.value?(C(),L(t(m),{key:0,vertical:""},{default:s(()=>[n("div",null,[e[39]||(e[39]=n("strong",null,"åç§°:",-1)),o(" "+M(x.value.name),1)]),n("div",null,[e[40]||(e[40]=n("strong",null,"æè¿°:",-1)),o(" "+M(x.value.description),1)]),n("div",null,[e[41]||(e[41]=n("strong",null,"æ¥æº:",-1)),e[42]||(e[42]=o()),a(t(Q),{type:"info",size:"small"},{default:s(()=>[o(M(x.value.serverName||"builtin"),1)]),_:1})]),a(t(tl)),e[43]||(e[43]=n("div",null,[n("strong",null,"è¾“å…¥å‚æ•°:")],-1)),a(we,{code:JSON.stringify(x.value.inputSchema||{},null,2),language:"json"},null,8,["code"])]),_:1})):K("",!0)]),_:1},8,["show"]),a(t(te),{show:H.value,"onUpdate:show":e[12]||(e[12]=r=>H.value=r),preset:"card",title:"æµ‹è¯•å·¥å…·",style:{width:"700px"}},{default:s(()=>[x.value?(C(),L(t(m),{key:0,vertical:""},{default:s(()=>[n("div",null,[e[44]||(e[44]=n("strong",null,"å·¥å…·:",-1)),o(" "+M(x.value.name),1)]),a(t(h),{label:"å‚æ•° (JSON)"},{default:s(()=>[a(t($),{value:E.value,"onUpdate:value":e[10]||(e[10]=r=>E.value=r),type:"textarea",rows:8,placeholder:'{"key": "value"}'},null,8,["value"])]),_:1}),a(t(m),null,{default:s(()=>[a(t(f),{type:"primary",onClick:Ue,loading:w.value},{default:s(()=>[...e[45]||(e[45]=[o("æ‰§è¡Œæµ‹è¯•",-1)])]),_:1},8,["loading"]),a(t(f),{onClick:e[11]||(e[11]=r=>E.value=JSON.stringify(fe(x.value),null,2))},{default:s(()=>[...e[46]||(e[46]=[o("é‡ç½®å‚æ•°",-1)])]),_:1})]),_:1}),u.value?(C(),I("div",il,[e[47]||(e[47]=n("strong",null,"æµ‹è¯•ç»“æœ:",-1)),a(we,{code:u.value,language:"json",style:{"margin-top":"8px"}},null,8,["code"])])):K("",!0)]),_:1})):K("",!0)]),_:1},8,["show"]),a(t(te),{show:g.value,"onUpdate:show":e[21]||(e[21]=r=>g.value=r),preset:"card",title:k.value?"ç¼–è¾‘æœåŠ¡å™¨":"æ·»åŠ æœåŠ¡å™¨",style:{width:"600px"}},{footer:s(()=>[a(t(m),{justify:"end"},{default:s(()=>[a(t(f),{onClick:e[20]||(e[20]=r=>g.value=!1)},{default:s(()=>[...e[49]||(e[49]=[o("å–æ¶ˆ",-1)])]),_:1}),a(t(f),{type:"primary",onClick:Ve},{default:s(()=>[...e[50]||(e[50]=[o("ä¿å­˜",-1)])]),_:1})]),_:1})]),default:s(()=>[a(t(re),{"label-placement":"left","label-width":"100"},{default:s(()=>[a(t(h),{label:"åç§°",required:""},{default:s(()=>[a(t($),{value:i.value.name,"onUpdate:value":e[13]||(e[13]=r=>i.value.name=r),placeholder:"æœåŠ¡å™¨åç§°",disabled:k.value},null,8,["value","disabled"])]),_:1}),a(t(h),{label:"ç±»å‹",required:""},{default:s(()=>[a(t(ne),{value:i.value.type,"onUpdate:value":e[14]||(e[14]=r=>i.value.type=r),options:[{label:"Stdio (æœ¬åœ°è¿›ç¨‹)",value:"stdio"},{label:"JSè„šæœ¬ (æœ¬åœ°JS)",value:"js"},{label:"SSE",value:"sse"},{label:"HTTP",value:"http"}]},null,8,["value"])]),_:1}),i.value.type==="stdio"?(C(),I(le,{key:0},[a(t(h),{label:"å‘½ä»¤"},{default:s(()=>[a(t($),{value:i.value.command,"onUpdate:value":e[15]||(e[15]=r=>i.value.command=r),placeholder:"ä¾‹å¦‚: node, python, npx"},null,8,["value"])]),_:1}),a(t(h),{label:"å‚æ•°"},{default:s(()=>[a(t($),{value:i.value.args,"onUpdate:value":e[16]||(e[16]=r=>i.value.args=r),placeholder:"ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚: -m mcp_server"},null,8,["value"])]),_:1}),a(t(h),{label:"ç¯å¢ƒå˜é‡"},{default:s(()=>[a(t($),{value:i.value.env,"onUpdate:value":e[17]||(e[17]=r=>i.value.env=r),type:"textarea",placeholder:'JSONæ ¼å¼: {"KEY": "VALUE"}',rows:3},null,8,["value"])]),_:1})],64)):i.value.type==="js"?(C(),I(le,{key:1},[a(t(h),{label:"è„šæœ¬è·¯å¾„"},{default:s(()=>[a(t($),{value:i.value.scriptPath,"onUpdate:value":e[18]||(e[18]=r=>i.value.scriptPath=r),placeholder:"æœ¬åœ°JSæ–‡ä»¶è·¯å¾„ï¼Œå¦‚: ./mcp/my-server.js"},null,8,["value"])]),_:1}),a(t(R),{type:"info",style:{"margin-top":"8px"}},{default:s(()=>[...e[48]||(e[48]=[o(" JSè„šæœ¬éœ€è¦å¯¼å‡ºä¸€ä¸ªåŒ…å« listTools å’Œ callTool æ–¹æ³•çš„å¯¹è±¡ ",-1)])]),_:1})],64)):(C(),L(t(h),{key:2,label:"URL"},{default:s(()=>[a(t($),{value:i.value.url,"onUpdate:value":e[19]||(e[19]=r=>i.value.url=r),placeholder:"æœåŠ¡å™¨åœ°å€"},null,8,["value"])]),_:1}))]),_:1})]),_:1},8,["show","title"]),a(t(te),{show:A.value,"onUpdate:show":e[27]||(e[27]=r=>A.value=r),preset:"card",title:J.value?"ç¼–è¾‘è‡ªå®šä¹‰å·¥å…·":"åˆ›å»ºè‡ªå®šä¹‰å·¥å…·",style:{width:"900px","max-height":"90vh"}},{footer:s(()=>[a(t(m),{justify:"end"},{default:s(()=>[a(t(f),{onClick:e[26]||(e[26]=r=>A.value=!1)},{default:s(()=>[...e[57]||(e[57]=[o("å–æ¶ˆ",-1)])]),_:1}),a(t(f),{type:"primary",onClick:Ie},{default:s(()=>[...e[58]||(e[58]=[o("ä¿å­˜å·¥å…·",-1)])]),_:1})]),_:1})]),default:s(()=>[a(t(sl),{style:{"max-height":"calc(90vh - 120px)"}},{default:s(()=>[a(t(m),{vertical:"",size:16},{default:s(()=>[a(t(re),{"label-placement":"left","label-width":"80"},{default:s(()=>[a(t(h),{label:"å·¥å…·åç§°",required:""},{default:s(()=>[a(t($),{value:y.value.name,"onUpdate:value":e[22]||(e[22]=r=>y.value.name=r),placeholder:"ä½¿ç”¨è‹±æ–‡å’Œä¸‹åˆ’çº¿ï¼Œå¦‚: my_tool",disabled:J.value},null,8,["value","disabled"])]),_:1}),a(t(h),{label:"æè¿°",required:""},{default:s(()=>[a(t($),{value:y.value.description,"onUpdate:value":e[23]||(e[23]=r=>y.value.description=r),type:"textarea",rows:2,placeholder:"æè¿°å·¥å…·çš„åŠŸèƒ½ï¼ŒAI ä¼šæ ¹æ®æè¿°å†³å®šä½•æ—¶ä½¿ç”¨æ­¤å·¥å…·"},null,8,["value"])]),_:1})]),_:1}),J.value?K("",!0):(C(),L(t(de),{key:0},{default:s(()=>[a(t(pe),{title:"ğŸ¯ å¿«é€Ÿé€‰æ‹©æ¨¡æ¿",name:"tpl"},{default:s(()=>[a(t(m),null,{default:s(()=>[(C(),I(le,null,be(ce,r=>a(t(f),{key:r.name,size:"small",onClick:z=>ge(r)},{default:s(()=>[o(M(r.label),1)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})),a(t(U),{size:"small",title:"å‚æ•°å®šä¹‰ (JSON Schema)"},{"header-extra":s(()=>[a(t(W),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[...e[51]||(e[51]=[o("å®šä¹‰å·¥å…·æ¥æ”¶çš„å‚æ•°",-1)])]),_:1})]),default:s(()=>[a(Se,{modelValue:y.value.parameters,"onUpdate:modelValue":e[24]||(e[24]=r=>y.value.parameters=r),language:"json",rows:8,placeholder:`{
  "type": "object",
  "properties": {
    "param1": { "type": "string", "description": "å‚æ•°è¯´æ˜" }
  },
  "required": ["param1"]
}`},null,8,["modelValue"])]),_:1}),a(t(U),{size:"small",title:"å·¥å…·ä»£ç  (JavaScript)"},{"header-extra":s(()=>[a(t(m),null,{default:s(()=>[a(t(W),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[...e[52]||(e[52]=[o("å¯ç”¨å˜é‡: args, ctx",-1)])]),_:1})]),_:1})]),default:s(()=>[a(Se,{modelValue:y.value.handler,"onUpdate:modelValue":e[25]||(e[25]=r=>y.value.handler=r),language:"javascript",rows:15,placeholder:`// ç¼–å†™å·¥å…·é€»è¾‘
// args: ç”¨æˆ·ä¼ å…¥çš„å‚æ•°
// ctx: ä¸Šä¸‹æ–‡å¯¹è±¡
//   - ctx.getBot(): è·å– Bot å®ä¾‹
//   - ctx.getEvent(): è·å–å½“å‰äº‹ä»¶

return { text: 'ç»“æœ', data: {} }`},null,8,["modelValue"])]),_:1}),a(t(de),null,{default:s(()=>[a(t(pe),{title:"ğŸ“– ç¼–å†™æŒ‡å—",name:"help"},{default:s(()=>[a(t(m),{vertical:""},{default:s(()=>[a(t(R),{type:"info",title:"åŸºç¡€å˜é‡"},{default:s(()=>[...e[53]||(e[53]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,[n("code",null,"args"),o(" - ç”¨æˆ·ä¼ å…¥çš„å‚æ•°å¯¹è±¡")]),n("li",null,[n("code",null,"ctx"),o(" - ä¸Šä¸‹æ–‡å¯¹è±¡ (getBot, getEvent)")]),n("li",null,[n("code",null,"fetch"),o(" - å‘é€ HTTP è¯·æ±‚")]),n("li",null,[n("code",null,"Bot"),o(" - Bot å®ä¾‹")]),n("li",null,[n("code",null,"logger"),o(" - æ—¥å¿—è®°å½•å™¨")]),n("li",null,[n("code",null,"config"),o(" - é…ç½®ç®¡ç†å™¨")])],-1)])]),_:1}),a(t(R),{type:"info",title:"runtime å¯¹è±¡ï¼ˆå®Œæ•´ APIï¼‰"},{default:s(()=>[...e[54]||(e[54]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,[n("code",null,"runtime.Redis"),o(" - Redis å®¢æˆ·ç«¯")]),n("li",null,[n("code",null,"runtime.services.chat"),o(" - èŠå¤©æœåŠ¡")]),n("li",null,[n("code",null,"runtime.services.database"),o(" - æ•°æ®åº“æœåŠ¡")]),n("li",null,[n("code",null,"runtime.services.memory"),o(" - è®°å¿†ç®¡ç†")]),n("li",null,[n("code",null,"runtime.utils.http.get/post"),o(" - HTTP è¯·æ±‚")]),n("li",null,[n("code",null,"runtime.utils.sendGroupMsg()"),o(" - å‘é€ç¾¤æ¶ˆæ¯")]),n("li",null,[n("code",null,"runtime.utils.sendPrivateMsg()"),o(" - å‘é€ç§èŠ")]),n("li",null,[n("code",null,"runtime.utils.sleep(ms)"),o(" - å»¶è¿Ÿ")]),n("li",null,[n("code",null,"runtime.utils.exec(cmd)"),o(" - æ‰§è¡Œå‘½ä»¤")]),n("li",null,[n("code",null,"runtime.mcp.callTool()"),o(" - è°ƒç”¨å…¶ä»–å·¥å…·")]),n("li",null,[n("code",null,"runtime.mcp.listTools()"),o(" - è·å–å·¥å…·åˆ—è¡¨")])],-1)])]),_:1}),a(t(R),{type:"success",title:"è¿”å›æ ¼å¼"},{default:s(()=>[e[55]||(e[55]=n("p",{style:{margin:"0"}},[o("è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå»ºè®®åŒ…å« "),n("code",null,"text"),o(" å­—æ®µä½œä¸ºæ–‡æœ¬ç»“æœï¼š")],-1)),a(T,{code:`return {
  text: 'æ“ä½œç»“æœæè¿°',
  data: { ... }  // å…¶ä»–æ•°æ®
}`,language:"javascript"})]),_:1}),a(t(R),{type:"warning",title:"æ³¨æ„äº‹é¡¹"},{default:s(()=>[...e[56]||(e[56]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,"ä»£ç åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œè¯·æ³¨æ„å®‰å…¨æ€§"),n("li",null,"æ”¯æŒ async/await è¯­æ³•"),n("li",null,"é”™è¯¯ä¼šè¢«æ•è·å¹¶è¿”å›ç»™ AI"),n("li",null,"exec å‘½ä»¤æœ‰ 10 ç§’è¶…æ—¶é™åˆ¶")],-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show","title"])]),_:1})}}};export{kl as default};
