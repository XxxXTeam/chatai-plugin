import{K as V,w as f,A as $,L as O,M as b,O as t,P as e,Q as N,R as h,S as x,T as l,U as q,aq as F,N as Q,ap as _,B as c,V as u,b4 as R,W as I,a1 as j,$ as i,a0 as M,X as E,Y as U,h as v}from"./index-DxCzDBsQ.js";import{S as K}from"./SearchOutlined-Bg2n-gU3.js";import{N as W}from"./DataTable-DjUg8Hw_.js";import{N as X,a as d}from"./DescriptionsItem-D4feF2m-.js";import{N as P}from"./InputNumber-BVBmw9IH.js";import{N as Y}from"./Switch-DRTATV-n.js";import{N as G}from"./Popconfirm-CrObcHRt.js";import"./Select-DBes2zJg.js";const oe={__name:"Users",setup(H){const m=V(),y=f(!1),g=f([]),k=f(""),D=f(!1),r=f(null),p=f(!1),n=f({maxTokensPerDay:1e5,maxMessagesPerDay:100,allowedModels:[],blocked:!1}),S=[{title:"用户ID",key:"userId",width:150,ellipsis:{tooltip:!0}},{title:"昵称",key:"nickname",width:120,ellipsis:{tooltip:!0}},{title:"对话数",key:"conversationCount",width:80,align:"center"},{title:"消息数",key:"messageCount",width:80,align:"center"},{title:"最后活动",key:"lastActivity",width:140,render:a=>C(a.lastActivity)},{title:"状态",key:"status",width:80,render:a=>a.blocked?v(M,{type:"error",size:"small"},()=>"已封禁"):v(M,{type:"success",size:"small"},()=>"正常")},{title:"操作",key:"actions",width:180,render:a=>v(N,{size:"small"},()=>[v(c,{size:"small",onClick:()=>z(a)},()=>"详情"),v(c,{size:"small",type:"info",onClick:()=>A(a)},()=>"设置"),v(G,{onPositiveClick:()=>B(a.userId)},{trigger:()=>v(c,{size:"small",type:"warning"},()=>"清除"),default:()=>"确定清除该用户的所有数据？"})])}],T=$(()=>{if(!k.value)return g.value;const a=k.value.toLowerCase();return g.value.filter(s=>s.userId?.toLowerCase().includes(a)||s.nickname?.toLowerCase().includes(a))});async function w(){y.value=!0;try{const a=await h.get("/api/users/list");a.data.code===0&&(g.value=a.data.data||[])}catch(a){m.error("获取用户列表失败: "+a.message)}finally{y.value=!1}}function z(a){r.value=a,D.value=!0}function A(a){r.value=a,n.value={maxTokensPerDay:a.settings?.maxTokensPerDay||1e5,maxMessagesPerDay:a.settings?.maxMessagesPerDay||100,allowedModels:a.settings?.allowedModels||[],blocked:a.blocked||!1},p.value=!0}async function L(){try{(await h.put(`/api/users/${r.value.userId}/settings`,n.value)).data.code===0&&(m.success("设置已保存"),p.value=!1,w())}catch(a){m.error("保存失败: "+a.message)}}async function B(a){try{(await h.delete(`/api/users/${a}/data`)).data.code===0&&(m.success("用户数据已清除"),w())}catch(s){m.error("清除失败: "+s.message)}}function C(a){return a?new Date(a).toLocaleString("zh-CN"):"-"}return O(()=>{w()}),(a,s)=>(x(),b(e(N),{vertical:"",size:"large"},{default:t(()=>[l(e(q),{title:"用户管理"},{"header-extra":t(()=>[l(e(N),null,{default:t(()=>[l(e(Q),{value:k.value,"onUpdate:value":s[0]||(s[0]=o=>k.value=o),placeholder:"搜索用户ID或昵称",clearable:"",style:{width:"200px"}},{prefix:t(()=>[l(e(_),null,{default:t(()=>[l(e(K))]),_:1})]),_:1},8,["value"]),l(e(c),{onClick:w,loading:y.value},{icon:t(()=>[l(e(_),null,{default:t(()=>[l(e(R))]),_:1})]),default:t(()=>[s[7]||(s[7]=u(" 刷新 ",-1))]),_:1},8,["loading"])]),_:1})]),default:t(()=>[g.value.length===0?(x(),b(e(F),{key:0,description:"暂无用户数据"})):(x(),b(e(W),{key:1,columns:S,data:T.value,loading:y.value,pagination:{pageSize:20},bordered:!1,striped:""},null,8,["data","loading"]))]),_:1}),l(e(I),{show:D.value,"onUpdate:show":s[1]||(s[1]=o=>D.value=o),preset:"card",title:"用户详情",style:{width:"500px"}},{default:t(()=>[r.value?(x(),b(e(X),{key:0,column:1,"label-placement":"left",bordered:""},{default:t(()=>[l(e(d),{label:"用户ID"},{default:t(()=>[u(i(r.value.userId),1)]),_:1}),l(e(d),{label:"昵称"},{default:t(()=>[u(i(r.value.nickname||"-"),1)]),_:1}),l(e(d),{label:"对话数"},{default:t(()=>[u(i(r.value.conversationCount||0),1)]),_:1}),l(e(d),{label:"消息数"},{default:t(()=>[u(i(r.value.messageCount||0),1)]),_:1}),l(e(d),{label:"Token使用"},{default:t(()=>[u(i(r.value.tokenUsage||0),1)]),_:1}),l(e(d),{label:"首次活动"},{default:t(()=>[u(i(C(r.value.firstActivity)),1)]),_:1}),l(e(d),{label:"最后活动"},{default:t(()=>[u(i(C(r.value.lastActivity)),1)]),_:1}),l(e(d),{label:"状态"},{default:t(()=>[l(e(M),{type:r.value.blocked?"error":"success",size:"small"},{default:t(()=>[u(i(r.value.blocked?"已封禁":"正常"),1)]),_:1},8,["type"])]),_:1})]),_:1})):j("",!0)]),_:1},8,["show"]),l(e(I),{show:p.value,"onUpdate:show":s[6]||(s[6]=o=>p.value=o),preset:"card",title:"用户设置",style:{width:"450px"}},{footer:t(()=>[l(e(N),{justify:"end"},{default:t(()=>[l(e(c),{onClick:s[5]||(s[5]=o=>p.value=!1)},{default:t(()=>[...s[8]||(s[8]=[u("取消",-1)])]),_:1}),l(e(c),{type:"primary",onClick:L},{default:t(()=>[...s[9]||(s[9]=[u("保存",-1)])]),_:1})]),_:1})]),default:t(()=>[l(e(E),{"label-placement":"left","label-width":"120"},{default:t(()=>[l(e(U),{label:"每日Token限制"},{default:t(()=>[l(e(P),{value:n.value.maxTokensPerDay,"onUpdate:value":s[2]||(s[2]=o=>n.value.maxTokensPerDay=o),min:0,max:1e7,style:{width:"100%"}},null,8,["value"])]),_:1}),l(e(U),{label:"每日消息限制"},{default:t(()=>[l(e(P),{value:n.value.maxMessagesPerDay,"onUpdate:value":s[3]||(s[3]=o=>n.value.maxMessagesPerDay=o),min:0,max:1e4,style:{width:"100%"}},null,8,["value"])]),_:1}),l(e(U),{label:"封禁用户"},{default:t(()=>[l(e(Y),{value:n.value.blocked,"onUpdate:value":s[4]||(s[4]=o=>n.value.blocked=o)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1}))}};export{oe as default};
