import{K as E,w as p,a5 as K,L as W,M as D,O as o,P as e,Q as g,R as M,S as L,T as a,a6 as I,V as i,U as k,X as w,Y as d,a7 as C,N as m,B as r,a8 as f,W as Q}from"./index-CxA8u68m.js";import{N as O,M as X}from"./ModelSelector-DJA5QwtJ.js";import{N as Y}from"./Select-BFvf1tQg.js";import{N as y}from"./Switch-BifJ7wER.js";import{N as j}from"./text-GFsYe9hx.js";import{N as U}from"./InputNumber-CwU5u3nb.js";import"./SearchOutlined-BOPQJuYO.js";const ll={__name:"Settings",setup(q){const v=E(),N=p(!1),x=p(!1),s=K({basic:{toggleMode:"at",togglePrefix:"#chat",commandPrefix:"#ai",debug:!1,showThinkingMessage:!0},llm:{defaultModel:"",embeddingModel:"text-embedding-3-small",models:{chat:"",roleplay:"",toolCall:"",search:"",reasoning:""},chatModel:"",codeModel:"",translationModel:""},bym:{enable:!1,probability:.02,temperature:.9,maxTokens:100,recall:!1,model:"",systemPrompt:""}}),$=p([]),b=p(!1),z=p("defaultModel");async function P(){N.value=!0;try{const n=await M.get("/api/config");if(n.data.code===0){const l=n.data.data;l.basic&&Object.assign(s.basic,l.basic),l.llm&&(Object.assign(s.llm,l.llm),l.llm.models&&Object.assign(s.llm.models,l.llm.models)),l.bym&&Object.assign(s.bym,l.bym);const t=await M.get("/api/channels/list");if(t.data.code===0){const F=t.data.data,S=new Set;F.forEach(T=>{T.models&&T.models.forEach(V=>S.add(V))}),$.value=Array.from(S).sort()}}}catch(n){v.error("加载配置失败: "+n.message)}finally{N.value=!1}}async function A(){x.value=!0;try{const n={basic:{...s.basic},llm:{...s.llm},bym:{...s.bym}},l=await M.post("/api/config",n);l.data.code===0?(v.success("配置已保存"),P()):v.error("保存失败: "+l.data.message)}catch(n){v.error("保存失败: "+n.message)}finally{x.value=!1}}function u(n){z.value=n,b.value=!0}function B(n){if(n.length>0){const l=z.value;if(l==="bymModel")s.bym.model=n[0];else if(l.startsWith("models.")){const t=l.replace("models.","");s.llm.models[t]=n[0]}else s.llm[l]=n[0]}b.value=!1}const R=[{label:"仅@触发",value:"at"},{label:"仅前缀触发",value:"prefix"},{label:"@和前缀都触发",value:"both"}];return W(()=>{P()}),(n,l)=>(L(),D(e(g),{vertical:"",size:"large"},{default:o(()=>[a(e(I),{type:"info",title:"提示",style:{"margin-bottom":"16px"}},{default:o(()=>[...l[36]||(l[36]=[i(" API Key 和渠道配置请前往「渠道管理」页面进行设置 ",-1)])]),_:1}),a(e(k),{title:"触发模式"},{default:o(()=>[a(e(w),{"label-placement":"left","label-width":"140"},{default:o(()=>[a(e(d),{label:"触发方式"},{default:o(()=>[a(e(Y),{value:s.basic.toggleMode,"onUpdate:value":l[0]||(l[0]=t=>s.basic.toggleMode=t),options:R,placeholder:"选择触发方式"},null,8,["value"])]),_:1}),a(e(d),{label:"触发前缀"},{default:o(()=>[a(e(C),{trigger:"hover"},{trigger:o(()=>[a(e(m),{value:s.basic.togglePrefix,"onUpdate:value":l[1]||(l[1]=t=>s.basic.togglePrefix=t),placeholder:"#chat",disabled:s.basic.toggleMode==="at"},null,8,["value","disabled"])]),default:o(()=>[l[37]||(l[37]=i(" 当触发方式包含前缀时，用户发送此前缀开头的消息会触发AI对话 ",-1))]),_:1})]),_:1}),a(e(d),{label:"命令前缀"},{default:o(()=>[a(e(C),{trigger:"hover"},{trigger:o(()=>[a(e(m),{value:s.basic.commandPrefix,"onUpdate:value":l[2]||(l[2]=t=>s.basic.commandPrefix=t),placeholder:"#ai"},null,8,["value"])]),default:o(()=>[l[38]||(l[38]=i(" 管理命令的前缀，如 #ai帮助、#ai状态 等 ",-1))]),_:1})]),_:1}),a(e(d),{label:"调试模式"},{default:o(()=>[a(e(y),{value:s.basic.debug,"onUpdate:value":l[3]||(l[3]=t=>s.basic.debug=t)},null,8,["value"])]),_:1}),a(e(d),{label:"思考提示"},{default:o(()=>[a(e(C),{trigger:"hover"},{trigger:o(()=>[a(e(y),{value:s.basic.showThinkingMessage,"onUpdate:value":l[4]||(l[4]=t=>s.basic.showThinkingMessage=t)},null,8,["value"])]),default:o(()=>[l[39]||(l[39]=i(' 开启后，AI处理时会先发送"思考中..."提示 ',-1))]),_:1})]),_:1})]),_:1})]),_:1}),a(e(k),{title:"模型配置"},{default:o(()=>[a(e(w),{"label-placement":"left","label-width":"140"},{default:o(()=>[a(e(d),{label:"默认模型"},{default:o(()=>[a(e(m),{value:s.llm.defaultModel,"onUpdate:value":l[6]||(l[6]=t=>s.llm.defaultModel=t),placeholder:"选择模型",readonly:"",onClick:l[7]||(l[7]=t=>u("defaultModel"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[5]||(l[5]=f(t=>u("defaultModel"),["stop"]))},{default:o(()=>[...l[40]||(l[40]=[i("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(j),{"title-placement":"left"},{default:o(()=>[...l[41]||(l[41]=[i("模型分类 (可选，留空使用默认模型)",-1)])]),_:1}),a(e(d),{label:"对话模型"},{default:o(()=>[a(e(m),{value:s.llm.models.chat,"onUpdate:value":l[9]||(l[9]=t=>s.llm.models.chat=t),placeholder:"普通聊天使用的模型",readonly:"",onClick:l[10]||(l[10]=t=>u("models.chat"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[8]||(l[8]=f(t=>u("models.chat"),["stop"]))},{default:o(()=>[...l[42]||(l[42]=[i("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"伪人模型"},{default:o(()=>[a(e(m),{value:s.llm.models.roleplay,"onUpdate:value":l[12]||(l[12]=t=>s.llm.models.roleplay=t),placeholder:"模拟真人回复的模型",readonly:"",onClick:l[13]||(l[13]=t=>u("models.roleplay"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[11]||(l[11]=f(t=>u("models.roleplay"),["stop"]))},{default:o(()=>[...l[43]||(l[43]=[i("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"工具调用模型"},{default:o(()=>[a(e(m),{value:s.llm.models.toolCall,"onUpdate:value":l[15]||(l[15]=t=>s.llm.models.toolCall=t),placeholder:"Function Calling 模型",readonly:"",onClick:l[16]||(l[16]=t=>u("models.toolCall"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[14]||(l[14]=f(t=>u("models.toolCall"),["stop"]))},{default:o(()=>[...l[44]||(l[44]=[i("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"搜索模型"},{default:o(()=>[a(e(m),{value:s.llm.models.search,"onUpdate:value":l[18]||(l[18]=t=>s.llm.models.search=t),placeholder:"联网搜索使用的模型",readonly:"",onClick:l[19]||(l[19]=t=>u("models.search"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[17]||(l[17]=f(t=>u("models.search"),["stop"]))},{default:o(()=>[...l[45]||(l[45]=[i("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"思考模型"},{default:o(()=>[a(e(m),{value:s.llm.models.reasoning,"onUpdate:value":l[21]||(l[21]=t=>s.llm.models.reasoning=t),placeholder:"深度推理使用的模型",readonly:"",onClick:l[22]||(l[22]=t=>u("models.reasoning"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[20]||(l[20]=f(t=>u("models.reasoning"),["stop"]))},{default:o(()=>[...l[46]||(l[46]=[i("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(j),{"title-placement":"left"},{default:o(()=>[...l[47]||(l[47]=[i("其他配置",-1)])]),_:1}),a(e(d),{label:"嵌入模型"},{default:o(()=>[a(e(m),{value:s.llm.embeddingModel,"onUpdate:value":l[23]||(l[23]=t=>s.llm.embeddingModel=t),placeholder:"text-embedding-3-small"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(k),{title:"伪人模式"},{default:o(()=>[a(e(w),{"label-placement":"left","label-width":"140"},{default:o(()=>[a(e(d),{label:"启用"},{default:o(()=>[a(e(y),{value:s.bym.enable,"onUpdate:value":l[24]||(l[24]=t=>s.bym.enable=t)},null,8,["value"])]),_:1}),a(e(d),{label:"触发概率"},{default:o(()=>[a(e(g),{vertical:"",style:{width:"100%"}},{default:o(()=>[a(e(O),{value:s.bym.probability,"onUpdate:value":l[25]||(l[25]=t=>s.bym.probability=t),min:0,max:1,step:.01,marks:{0:"0%",.5:"50%",1:"100%"}},null,8,["value"]),a(e(U),{value:s.bym.probability,"onUpdate:value":l[26]||(l[26]=t=>s.bym.probability=t),min:0,max:1,step:.01,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),a(e(d),{label:"回复温度"},{default:o(()=>[a(e(g),{vertical:"",style:{width:"100%"}},{default:o(()=>[a(e(O),{value:s.bym.temperature,"onUpdate:value":l[27]||(l[27]=t=>s.bym.temperature=t),min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}},null,8,["value"]),a(e(U),{value:s.bym.temperature,"onUpdate:value":l[28]||(l[28]=t=>s.bym.temperature=t),min:0,max:2,step:.1,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),a(e(d),{label:"最大 Token"},{default:o(()=>[a(e(U),{value:s.bym.maxTokens,"onUpdate:value":l[29]||(l[29]=t=>s.bym.maxTokens=t),min:10,max:1e3,step:10,style:{width:"100%"}},null,8,["value"])]),_:1}),a(e(d),{label:"启用记忆"},{default:o(()=>[a(e(y),{value:s.bym.recall,"onUpdate:value":l[30]||(l[30]=t=>s.bym.recall=t)},null,8,["value"])]),_:1}),a(e(d),{label:"使用模型"},{default:o(()=>[a(e(m),{value:s.bym.model,"onUpdate:value":l[32]||(l[32]=t=>s.bym.model=t),placeholder:"留空使用默认模型",readonly:"",onClick:l[33]||(l[33]=t=>u("bymModel"))},{suffix:o(()=>[a(e(r),{size:"small",onClick:l[31]||(l[31]=f(t=>u("bymModel"),["stop"]))},{default:o(()=>[...l[48]||(l[48]=[i("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(e(d),{label:"系统提示词"},{default:o(()=>[a(e(m),{value:s.bym.systemPrompt,"onUpdate:value":l[34]||(l[34]=t=>s.bym.systemPrompt=t),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"伪人模式的系统提示词"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(I),{type:"warning",title:"提示",style:{"margin-top":"8px"}},{default:o(()=>[...l[49]||(l[49]=[i(" 流式传输、推理模式等高级设置请在「渠道管理」中配置每个渠道的独立参数 ",-1)])]),_:1}),a(e(g),{justify:"end",style:{"margin-top":"16px"}},{default:o(()=>[a(e(r),{type:"primary",size:"large",onClick:A,loading:x.value},{default:o(()=>[...l[50]||(l[50]=[i(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1}),a(e(Q),{show:b.value,"onUpdate:show":l[35]||(l[35]=t=>b.value=t),preset:"card",title:"选择模型",style:{width:"800px","max-height":"85vh"}},{default:o(()=>[a(X,{"all-models":$.value,value:[],multiple:!1,"onUpdate:value":B},null,8,["all-models"])]),_:1},8,["show"])]),_:1}))}};export{ll as default};
