import{K as V,x as G,C as T,L as F,a2 as o,T as s,O as a,P as l,Q as I,R as _,S as i,U as b,a6 as C,V as u,X as M,M as g,a1 as f,Y as d,N as L,Z as v,a0 as m,$ as p,a3 as y,a4 as k,B as S}from"./index-CNHZuXR0.js";import{N as D}from"./Switch-WgLNg2WF.js";import{N as O}from"./Select-DMfqE7AC.js";import{N as x}from"./DynamicTags-Cbw_N7Gx.js";import"./Add-CFEAcTeM.js";import"./prop-NnGblK-3.js";const $={key:0},j={key:0},E={key:1},H={key:2},K={key:3},h={__name:"ListenerConfig",setup(R){const w=V(),U=G(!1),N=G(!1),t=G({enabled:!0,priority:-1/0,triggerMode:"at",triggerPrefix:"",whitelistGroups:[],blacklistGroups:[],whitelistUsers:[],blacklistUsers:[]}),z=[{label:"仅@机器人触发",value:"at"},{label:"仅前缀触发",value:"prefix"},{label:"@或前缀触发",value:"at_or_prefix"},{label:"始终触发（所有消息）",value:"always"}],A=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`});async function B(){U.value=!0;try{const n=await _.get("/api/listener/config",{headers:A()});n.data?.data&&(t.value={...t.value,...n.data.data,whitelistGroups:n.data.data.whitelistGroups||[],blacklistGroups:n.data.data.blacklistGroups||[],whitelistUsers:n.data.data.whitelistUsers||[],blacklistUsers:n.data.data.blacklistUsers||[]})}catch(n){w.error("加载配置失败: "+n.message)}finally{U.value=!1}}async function Q(){N.value=!0;try{await _.put("/api/listener/config",t.value,{headers:A()}),w.success("配置已保存")}catch(n){w.error("保存失败: "+n.message)}finally{N.value=!1}}const P=T(()=>["prefix","at_or_prefix"].includes(t.value.triggerMode));return F(()=>{B()}),(n,e)=>(i(),o("div",null,[s(l(I),{vertical:"",size:"large"},{default:a(()=>[s(l(b),{title:"监听器基础配置"},{default:a(()=>[s(l(C),{type:"info",style:{"margin-bottom":"16px"}},{default:a(()=>[...e[7]||(e[7]=[u(" 监听器用于接收群聊/私聊消息并触发AI回复。优先级设置为最低（-Infinity）可确保在其他插件之后处理。 ",-1)])]),_:1}),s(l(M),{"label-placement":"left","label-width":"150px"},{default:a(()=>[s(l(d),{label:"启用监听"},{default:a(()=>[s(l(D),{value:t.value.enabled,"onUpdate:value":e[0]||(e[0]=r=>t.value.enabled=r)},null,8,["value"])]),_:1}),s(l(d),{label:"触发模式"},{default:a(()=>[s(l(O),{value:t.value.triggerMode,"onUpdate:value":e[1]||(e[1]=r=>t.value.triggerMode=r),options:z,style:{width:"250px"}},null,8,["value"])]),_:1}),P.value?(i(),g(l(d),{key:0,label:"触发前缀"},{default:a(()=>[s(l(L),{value:t.value.triggerPrefix,"onUpdate:value":e[2]||(e[2]=r=>t.value.triggerPrefix=r),placeholder:"如: #ai 或 /chat",style:{width:"200px"}},null,8,["value"])]),_:1})):f("",!0)]),_:1})]),_:1}),s(l(b),{title:"群组过滤"},{default:a(()=>[s(l(C),{type:"warning",style:{"margin-bottom":"16px"}},{default:a(()=>[...e[8]||(e[8]=[u(" 如果设置了白名单，则只有白名单内的群组才会触发AI；如果只设置黑名单，则黑名单内的群组不会触发AI。 ",-1)])]),_:1}),s(l(M),{"label-placement":"top"},{default:a(()=>[s(l(d),{label:"群组白名单（留空表示不限制）"},{feedback:a(()=>[...e[9]||(e[9]=[u(" 输入群号后按回车添加 ",-1)])]),default:a(()=>[s(l(x),{value:t.value.whitelistGroups,"onUpdate:value":e[3]||(e[3]=r=>t.value.whitelistGroups=r)},null,8,["value"])]),_:1}),s(l(d),{label:"群组黑名单"},{feedback:a(()=>[...e[10]||(e[10]=[u(" 输入群号后按回车添加 ",-1)])]),default:a(()=>[s(l(x),{value:t.value.blacklistGroups,"onUpdate:value":e[4]||(e[4]=r=>t.value.blacklistGroups=r)},null,8,["value"])]),_:1})]),_:1})]),_:1}),s(l(b),{title:"用户过滤"},{default:a(()=>[s(l(C),{type:"warning",style:{"margin-bottom":"16px"}},{default:a(()=>[...e[11]||(e[11]=[u(" 如果设置了白名单，则只有白名单内的用户才会触发AI；如果只设置黑名单，则黑名单内的用户不会触发AI。 ",-1)])]),_:1}),s(l(M),{"label-placement":"top"},{default:a(()=>[s(l(d),{label:"用户白名单（留空表示不限制）"},{feedback:a(()=>[...e[12]||(e[12]=[u(" 输入QQ号后按回车添加 ",-1)])]),default:a(()=>[s(l(x),{value:t.value.whitelistUsers,"onUpdate:value":e[5]||(e[5]=r=>t.value.whitelistUsers=r)},null,8,["value"])]),_:1}),s(l(d),{label:"用户黑名单"},{feedback:a(()=>[...e[13]||(e[13]=[u(" 输入QQ号后按回车添加 ",-1)])]),default:a(()=>[s(l(x),{value:t.value.blacklistUsers,"onUpdate:value":e[6]||(e[6]=r=>t.value.blacklistUsers=r)},null,8,["value"])]),_:1})]),_:1})]),_:1}),s(l(b),{title:"配置预览"},{default:a(()=>[s(l(I),{vertical:""},{default:a(()=>[v("div",null,[s(l(m),{type:t.value.enabled?"success":"error"},{default:a(()=>[u(p(t.value.enabled?"监听已启用":"监听已禁用"),1)]),_:1},8,["type"])]),v("div",null,[e[14]||(e[14]=v("strong",null,"触发模式：",-1)),u(" "+p(z.find(r=>r.value===t.value.triggerMode)?.label||"未知")+" ",1),P.value&&t.value.triggerPrefix?(i(),o("span",$," （前缀："+p(t.value.triggerPrefix)+"） ",1)):f("",!0)]),t.value.whitelistGroups.length?(i(),o("div",j,[e[15]||(e[15]=v("strong",null,"群组白名单：",-1)),(i(!0),o(y,null,k(t.value.whitelistGroups,r=>(i(),g(l(m),{key:r,size:"small",style:{"margin-right":"4px"}},{default:a(()=>[u(p(r),1)]),_:2},1024))),128))])):f("",!0),t.value.blacklistGroups.length?(i(),o("div",E,[e[16]||(e[16]=v("strong",null,"群组黑名单：",-1)),(i(!0),o(y,null,k(t.value.blacklistGroups,r=>(i(),g(l(m),{key:r,size:"small",type:"error",style:{"margin-right":"4px"}},{default:a(()=>[u(p(r),1)]),_:2},1024))),128))])):f("",!0),t.value.whitelistUsers.length?(i(),o("div",H,[e[17]||(e[17]=v("strong",null,"用户白名单：",-1)),(i(!0),o(y,null,k(t.value.whitelistUsers,r=>(i(),g(l(m),{key:r,size:"small",style:{"margin-right":"4px"}},{default:a(()=>[u(p(r),1)]),_:2},1024))),128))])):f("",!0),t.value.blacklistUsers.length?(i(),o("div",K,[e[18]||(e[18]=v("strong",null,"用户黑名单：",-1)),(i(!0),o(y,null,k(t.value.blacklistUsers,r=>(i(),g(l(m),{key:r,size:"small",type:"error",style:{"margin-right":"4px"}},{default:a(()=>[u(p(r),1)]),_:2},1024))),128))])):f("",!0)]),_:1})]),_:1}),s(l(I),{justify:"center"},{default:a(()=>[s(l(S),{type:"primary",size:"large",onClick:Q,loading:N.value},{default:a(()=>[...e[19]||(e[19]=[u(" 保存配置 ",-1)])]),_:1},8,["loading"]),s(l(S),{size:"large",onClick:B,loading:U.value},{default:a(()=>[...e[20]||(e[20]=[u(" 重新加载 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]))}};export{h as default};
