import{K as O,x as B,C as T,L as $,a2 as m,T as a,O as u,P as l,Q as d,R as F,S as p,U as C,a6 as I,V as o,X as E,M as v,a1 as i,Y as s,a3 as V,Z as y,$ as b,N as j,a8 as H,a9 as k,a0 as f,B as A}from"./index-Bsw7oJ13.js";import{N as w}from"./Divider--26pnQkq.js";import{N as g}from"./Switch-CVq7N8W4.js";import{N as K}from"./Select-tPLuyu9V.js";import{N as P}from"./Slider-BgaOWhmq.js";import{N as x}from"./DynamicTags-D16R2-DS.js";import"./Add-Dox3aWAK.js";import"./prop-NnGblK-3.js";const Q={key:1,style:{color:"#999","font-size":"12px"}},ee={__name:"ListenerConfig",setup(X){const U=O(),N=B(!1),G=B(!1),t=B({private:{enabled:!0,mode:"always"},group:{enabled:!0,at:!0,reply:!1,replyBot:!1,prefix:!0,keyword:!1,random:!1,randomRate:.05},prefixes:["#chat"],keywords:[],collectGroupMsg:!0,blacklistUsers:[],whitelistUsers:[],blacklistGroups:[],whitelistGroups:[]}),D=[{label:"总是响应",value:"always"},{label:"需要前缀",value:"prefix"},{label:"关闭",value:"off"}],z=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`}),M=T({get:()=>(t.value.prefixes||[]).join(", "),set:n=>{t.value.prefixes=n.split(/[,，]\s*/).filter(Boolean)}}),R=T({get:()=>(t.value.keywords||[]).join(", "),set:n=>{t.value.keywords=n.split(/[,，]\s*/).filter(Boolean)}});async function S(){N.value=!0;try{const n=await F.get("/api/trigger/config",{headers:z()});if(n.data?.data){const e=n.data.data;t.value={...t.value,...e,private:e.private||{enabled:!0,mode:"always"},group:{enabled:e.group?.enabled??!0,at:e.group?.at??!0,reply:e.group?.reply??!1,replyBot:e.group?.replyBot??!1,prefix:e.group?.prefix??!0,keyword:e.group?.keyword??!1,random:e.group?.random??!1,randomRate:e.group?.randomRate??.05},prefixes:e.prefixes||["#chat"],keywords:e.keywords||[],collectGroupMsg:e.collectGroupMsg??!0,whitelistGroups:e.whitelistGroups||[],blacklistGroups:e.blacklistGroups||[],whitelistUsers:e.whitelistUsers||[],blacklistUsers:e.blacklistUsers||[]}}}catch(n){U.error("加载配置失败: "+n.message)}finally{N.value=!1}}async function L(){G.value=!0;try{await F.put("/api/trigger/config",t.value,{headers:z()}),U.success("配置已保存")}catch(n){U.error("保存失败: "+n.message)}finally{G.value=!1}}return $(()=>{S()}),(n,e)=>(p(),m("div",null,[a(l(d),{vertical:"",size:"large"},{default:u(()=>[a(l(C),{title:"AI触发配置"},{default:u(()=>[a(l(I),{type:"info",style:{"margin-bottom":"16px"}},{default:u(()=>[...e[16]||(e[16]=[o(" 配置机器人何时响应消息。私聊和群聊可独立配置触发方式。 ",-1)])]),_:1}),a(l(E),{"label-placement":"left","label-width":"150px"},{default:u(()=>[a(l(w),{"title-placement":"left"},{default:u(()=>[...e[17]||(e[17]=[o("私聊触发",-1)])]),_:1}),a(l(s),{label:"响应私聊"},{default:u(()=>[a(l(g),{value:t.value.private.enabled,"onUpdate:value":e[0]||(e[0]=r=>t.value.private.enabled=r)},null,8,["value"])]),_:1}),t.value.private.enabled?(p(),v(l(s),{key:0,label:"私聊模式"},{default:u(()=>[a(l(K),{value:t.value.private.mode,"onUpdate:value":e[1]||(e[1]=r=>t.value.private.mode=r),options:D,style:{width:"180px"}},null,8,["value"])]),_:1})):i("",!0),a(l(w),{"title-placement":"left"},{default:u(()=>[...e[18]||(e[18]=[o("群聊触发",-1)])]),_:1}),a(l(s),{label:"响应群聊"},{default:u(()=>[a(l(g),{value:t.value.group.enabled,"onUpdate:value":e[2]||(e[2]=r=>t.value.group.enabled=r)},null,8,["value"])]),_:1}),t.value.group.enabled?(p(),m(V,{key:1},[a(l(s),{label:"@机器人触发"},{default:u(()=>[a(l(d),{align:"center"},{default:u(()=>[a(l(g),{value:t.value.group.at,"onUpdate:value":e[3]||(e[3]=r=>t.value.group.at=r)},null,8,["value"]),e[19]||(e[19]=y("span",{style:{color:"#999","font-size":"12px"}},"被@时响应",-1))]),_:1})]),_:1}),a(l(s),{label:"引用机器人触发"},{default:u(()=>[a(l(d),{align:"center"},{default:u(()=>[a(l(g),{value:t.value.group.replyBot,"onUpdate:value":e[4]||(e[4]=r=>t.value.group.replyBot=r)},null,8,["value"]),e[20]||(e[20]=y("span",{style:{color:"#999","font-size":"12px"}},"引用机器人消息时触发（关闭可防止重复响应）",-1))]),_:1})]),_:1}),a(l(s),{label:"前缀触发"},{default:u(()=>[a(l(d),{align:"center"},{default:u(()=>[a(l(g),{value:t.value.group.prefix,"onUpdate:value":e[5]||(e[5]=r=>t.value.group.prefix=r)},null,8,["value"]),e[21]||(e[21]=y("span",{style:{color:"#999","font-size":"12px"}},"消息以指定前缀开头时响应",-1))]),_:1})]),_:1}),a(l(s),{label:"关键词触发"},{default:u(()=>[a(l(d),{align:"center"},{default:u(()=>[a(l(g),{value:t.value.group.keyword,"onUpdate:value":e[6]||(e[6]=r=>t.value.group.keyword=r)},null,8,["value"]),e[22]||(e[22]=y("span",{style:{color:"#999","font-size":"12px"}},"消息包含关键词时响应",-1))]),_:1})]),_:1}),a(l(s),{label:"随机触发"},{default:u(()=>[a(l(d),{align:"center"},{default:u(()=>[a(l(g),{value:t.value.group.random,"onUpdate:value":e[7]||(e[7]=r=>t.value.group.random=r)},null,8,["value"]),t.value.group.random?(p(),m(V,{key:0},[a(l(P),{value:t.value.group.randomRate,"onUpdate:value":e[8]||(e[8]=r=>t.value.group.randomRate=r),min:0,max:.5,step:.01,style:{width:"120px"}},null,8,["value"]),y("span",null,b((t.value.group.randomRate*100).toFixed(0))+"%",1)],64)):(p(),m("span",Q,"按概率随机响应（伪人模式）"))]),_:1})]),_:1})],64)):i("",!0),a(l(w),{"title-placement":"left"},{default:u(()=>[...e[23]||(e[23]=[o("触发词",-1)])]),_:1}),a(l(s),{label:"触发前缀"},{default:u(()=>[a(l(j),{value:M.value,"onUpdate:value":e[9]||(e[9]=r=>M.value=r),placeholder:"多个用逗号分隔，如: #chat, 小助手",style:{width:"300px"}},null,8,["value"])]),_:1}),t.value.group.keyword?(p(),v(l(s),{key:2,label:"触发关键词"},{default:u(()=>[a(l(j),{value:R.value,"onUpdate:value":e[10]||(e[10]=r=>R.value=r),placeholder:"消息包含这些词时触发",style:{width:"300px"}},null,8,["value"])]),_:1})):i("",!0),a(l(w),{"title-placement":"left"},{default:u(()=>[...e[24]||(e[24]=[o("其他",-1)])]),_:1}),a(l(s),{label:"采集群消息"},{default:u(()=>[a(l(g),{value:t.value.collectGroupMsg,"onUpdate:value":e[11]||(e[11]=r=>t.value.collectGroupMsg=r)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(l(C),{title:"访问控制"},{default:u(()=>[a(l(I),{type:"warning",style:{"margin-bottom":"16px"}},{default:u(()=>[...e[25]||(e[25]=[o(" 白名单优先于黑名单。设置白名单后，只有名单内的才会触发。 ",-1)])]),_:1}),a(l(H),{cols:2,"x-gap":24,responsive:"screen"},{default:u(()=>[a(l(k),null,{default:u(()=>[a(l(s),{label:"群白名单"},{default:u(()=>[a(l(x),{value:t.value.whitelistGroups,"onUpdate:value":e[12]||(e[12]=r=>t.value.whitelistGroups=r)},null,8,["value"])]),_:1})]),_:1}),a(l(k),null,{default:u(()=>[a(l(s),{label:"群黑名单"},{default:u(()=>[a(l(x),{value:t.value.blacklistGroups,"onUpdate:value":e[13]||(e[13]=r=>t.value.blacklistGroups=r)},null,8,["value"])]),_:1})]),_:1}),a(l(k),null,{default:u(()=>[a(l(s),{label:"用户白名单"},{default:u(()=>[a(l(x),{value:t.value.whitelistUsers,"onUpdate:value":e[14]||(e[14]=r=>t.value.whitelistUsers=r)},null,8,["value"])]),_:1})]),_:1}),a(l(k),null,{default:u(()=>[a(l(s),{label:"用户黑名单"},{default:u(()=>[a(l(x),{value:t.value.blacklistUsers,"onUpdate:value":e[15]||(e[15]=r=>t.value.blacklistUsers=r)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),a(l(C),{title:"当前状态"},{default:u(()=>[a(l(d),null,{default:u(()=>[a(l(f),{type:t.value.private.enabled?"success":"default"},{default:u(()=>[o(" 私聊: "+b(t.value.private.enabled?t.value.private.mode:"关闭"),1)]),_:1},8,["type"]),a(l(f),{type:t.value.group.enabled?"success":"default"},{default:u(()=>[o(" 群聊: "+b(t.value.group.enabled?"开启":"关闭"),1)]),_:1},8,["type"]),t.value.group.at?(p(),v(l(f),{key:0,type:"info"},{default:u(()=>[...e[26]||(e[26]=[o("@触发",-1)])]),_:1})):i("",!0),t.value.group.replyBot?(p(),v(l(f),{key:1,type:"info"},{default:u(()=>[...e[27]||(e[27]=[o("引用触发",-1)])]),_:1})):i("",!0),t.value.group.prefix?(p(),v(l(f),{key:2,type:"info"},{default:u(()=>[...e[28]||(e[28]=[o("前缀触发",-1)])]),_:1})):i("",!0),t.value.group.keyword?(p(),v(l(f),{key:3,type:"info"},{default:u(()=>[...e[29]||(e[29]=[o("关键词触发",-1)])]),_:1})):i("",!0),t.value.group.random?(p(),v(l(f),{key:4,type:"warning"},{default:u(()=>[o("随机"+b((t.value.group.randomRate*100).toFixed(0))+"%",1)]),_:1})):i("",!0),t.value.group.replyBot?i("",!0):(p(),v(l(f),{key:5,type:"default"},{default:u(()=>[...e[30]||(e[30]=[o("引用机器人不触发",-1)])]),_:1}))]),_:1})]),_:1}),a(l(d),{justify:"center"},{default:u(()=>[a(l(A),{type:"primary",size:"large",onClick:L,loading:G.value},{default:u(()=>[...e[31]||(e[31]=[o(" 保存配置 ",-1)])]),_:1},8,["loading"]),a(l(A),{size:"large",onClick:S,loading:N.value},{default:u(()=>[...e[32]||(e[32]=[o(" 重新加载 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]))}};export{ee as default};
