import{W as B,r as p,ad as F,X as E,Y as V,Z as s,$ as a,a0 as y,a1 as x,a2 as W,a3 as t,ae as D,a5 as m,a4 as M,a7 as C,a8 as d,P as u,Q as r,af as f,a6 as K}from"./index-BkHJ8ozj.js";import{N as j,M as L}from"./ModelSelector-C3l2Htyz.js";import{N as R}from"./Divider-CL_5VIHO.js";import{N as g}from"./Switch-FaSdSlpy.js";import{N as w}from"./InputNumber-DDw8T1Ao.js";import"./SearchOutlined-BsPnln7g.js";import"./text-BBupRWYn.js";const h={__name:"Settings",setup(Q){const v=B(),U=p(!1),k=p(!1),o=F({llm:{defaultModel:"",embeddingModel:"text-embedding-3-small",models:{chat:"",roleplay:"",toolCall:"",search:"",reasoning:""},chatModel:"",codeModel:"",translationModel:""},bym:{enable:!1,probability:.02,temperature:.9,maxTokens:100,recall:!1,model:"",systemPrompt:""},thinking:{enableReasoning:!1,defaultLevel:"low"},streaming:{enabled:!0}}),N=p([]),b=p(!1),$=p("defaultModel");async function z(){U.value=!0;try{const n=await x.get("/api/config");if(n.data.code===0){const l=n.data.data;l.llm&&(Object.assign(o.llm,l.llm),l.llm.models&&Object.assign(o.llm.models,l.llm.models)),l.bym&&Object.assign(o.bym,l.bym),l.thinking&&Object.assign(o.thinking,l.thinking),l.streaming&&Object.assign(o.streaming,l.streaming);const e=await x.get("/api/channels/list");if(e.data.code===0){const I=e.data.data,S=new Set;I.forEach(T=>{T.models&&T.models.forEach(A=>S.add(A))}),N.value=Array.from(S).sort()}}}catch(n){v.error("加载配置失败: "+n.message)}finally{U.value=!1}}async function O(){k.value=!0;try{const n={llm:{...o.llm},bym:{...o.bym},thinking:{...o.thinking},streaming:{...o.streaming}},l=await x.post("/api/config",n);l.data.code===0?(v.success("配置已保存"),z()):v.error("保存失败: "+l.data.message)}catch(n){v.error("保存失败: "+n.message)}finally{k.value=!1}}function i(n){$.value=n,b.value=!0}function P(n){if(n.length>0){const l=$.value;if(l==="bymModel")o.bym.model=n[0];else if(l.startsWith("models.")){const e=l.replace("models.","");o.llm.models[e]=n[0]}else o.llm[l]=n[0]}b.value=!1}return E(()=>{z()}),(n,l)=>(W(),V(a(y),{vertical:"",size:"large"},{default:s(()=>[t(a(D),{type:"info",title:"提示",style:{"margin-bottom":"16px"}},{default:s(()=>[...l[33]||(l[33]=[m(" API Key 和渠道配置请前往「渠道管理」页面进行设置 ",-1)])]),_:1}),t(a(M),{title:"模型配置"},{default:s(()=>[t(a(C),{"label-placement":"left","label-width":"140"},{default:s(()=>[t(a(d),{label:"默认模型"},{default:s(()=>[t(a(u),{value:o.llm.defaultModel,"onUpdate:value":l[1]||(l[1]=e=>o.llm.defaultModel=e),placeholder:"选择模型",readonly:"",onClick:l[2]||(l[2]=e=>i("defaultModel"))},{suffix:s(()=>[t(a(r),{size:"small",onClick:l[0]||(l[0]=f(e=>i("defaultModel"),["stop"]))},{default:s(()=>[...l[34]||(l[34]=[m("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(a(R),{"title-placement":"left"},{default:s(()=>[...l[35]||(l[35]=[m("模型分类 (可选，留空使用默认模型)",-1)])]),_:1}),t(a(d),{label:"对话模型"},{default:s(()=>[t(a(u),{value:o.llm.models.chat,"onUpdate:value":l[4]||(l[4]=e=>o.llm.models.chat=e),placeholder:"普通聊天使用的模型",readonly:"",onClick:l[5]||(l[5]=e=>i("models.chat"))},{suffix:s(()=>[t(a(r),{size:"small",onClick:l[3]||(l[3]=f(e=>i("models.chat"),["stop"]))},{default:s(()=>[...l[36]||(l[36]=[m("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(a(d),{label:"伪人模型"},{default:s(()=>[t(a(u),{value:o.llm.models.roleplay,"onUpdate:value":l[7]||(l[7]=e=>o.llm.models.roleplay=e),placeholder:"模拟真人回复的模型",readonly:"",onClick:l[8]||(l[8]=e=>i("models.roleplay"))},{suffix:s(()=>[t(a(r),{size:"small",onClick:l[6]||(l[6]=f(e=>i("models.roleplay"),["stop"]))},{default:s(()=>[...l[37]||(l[37]=[m("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(a(d),{label:"工具调用模型"},{default:s(()=>[t(a(u),{value:o.llm.models.toolCall,"onUpdate:value":l[10]||(l[10]=e=>o.llm.models.toolCall=e),placeholder:"Function Calling 模型",readonly:"",onClick:l[11]||(l[11]=e=>i("models.toolCall"))},{suffix:s(()=>[t(a(r),{size:"small",onClick:l[9]||(l[9]=f(e=>i("models.toolCall"),["stop"]))},{default:s(()=>[...l[38]||(l[38]=[m("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(a(d),{label:"搜索模型"},{default:s(()=>[t(a(u),{value:o.llm.models.search,"onUpdate:value":l[13]||(l[13]=e=>o.llm.models.search=e),placeholder:"联网搜索使用的模型",readonly:"",onClick:l[14]||(l[14]=e=>i("models.search"))},{suffix:s(()=>[t(a(r),{size:"small",onClick:l[12]||(l[12]=f(e=>i("models.search"),["stop"]))},{default:s(()=>[...l[39]||(l[39]=[m("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(a(d),{label:"思考模型"},{default:s(()=>[t(a(u),{value:o.llm.models.reasoning,"onUpdate:value":l[16]||(l[16]=e=>o.llm.models.reasoning=e),placeholder:"深度推理使用的模型",readonly:"",onClick:l[17]||(l[17]=e=>i("models.reasoning"))},{suffix:s(()=>[t(a(r),{size:"small",onClick:l[15]||(l[15]=f(e=>i("models.reasoning"),["stop"]))},{default:s(()=>[...l[40]||(l[40]=[m("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(a(R),{"title-placement":"left"},{default:s(()=>[...l[41]||(l[41]=[m("其他配置",-1)])]),_:1}),t(a(d),{label:"嵌入模型"},{default:s(()=>[t(a(u),{value:o.llm.embeddingModel,"onUpdate:value":l[18]||(l[18]=e=>o.llm.embeddingModel=e),placeholder:"text-embedding-3-small"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(a(M),{title:"伪人模式"},{default:s(()=>[t(a(C),{"label-placement":"left","label-width":"140"},{default:s(()=>[t(a(d),{label:"启用"},{default:s(()=>[t(a(g),{value:o.bym.enable,"onUpdate:value":l[19]||(l[19]=e=>o.bym.enable=e)},null,8,["value"])]),_:1}),t(a(d),{label:"触发概率"},{default:s(()=>[t(a(y),{vertical:"",style:{width:"100%"}},{default:s(()=>[t(a(j),{value:o.bym.probability,"onUpdate:value":l[20]||(l[20]=e=>o.bym.probability=e),min:0,max:1,step:.01,marks:{0:"0%",.5:"50%",1:"100%"}},null,8,["value"]),t(a(w),{value:o.bym.probability,"onUpdate:value":l[21]||(l[21]=e=>o.bym.probability=e),min:0,max:1,step:.01,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),t(a(d),{label:"回复温度"},{default:s(()=>[t(a(y),{vertical:"",style:{width:"100%"}},{default:s(()=>[t(a(j),{value:o.bym.temperature,"onUpdate:value":l[22]||(l[22]=e=>o.bym.temperature=e),min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}},null,8,["value"]),t(a(w),{value:o.bym.temperature,"onUpdate:value":l[23]||(l[23]=e=>o.bym.temperature=e),min:0,max:2,step:.1,size:"small",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),t(a(d),{label:"最大 Token"},{default:s(()=>[t(a(w),{value:o.bym.maxTokens,"onUpdate:value":l[24]||(l[24]=e=>o.bym.maxTokens=e),min:10,max:1e3,step:10,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(d),{label:"启用记忆"},{default:s(()=>[t(a(g),{value:o.bym.recall,"onUpdate:value":l[25]||(l[25]=e=>o.bym.recall=e)},null,8,["value"])]),_:1}),t(a(d),{label:"使用模型"},{default:s(()=>[t(a(u),{value:o.bym.model,"onUpdate:value":l[27]||(l[27]=e=>o.bym.model=e),placeholder:"留空使用默认模型",readonly:"",onClick:l[28]||(l[28]=e=>i("bymModel"))},{suffix:s(()=>[t(a(r),{size:"small",onClick:l[26]||(l[26]=f(e=>i("bymModel"),["stop"]))},{default:s(()=>[...l[42]||(l[42]=[m("选择",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(a(d),{label:"系统提示词"},{default:s(()=>[t(a(u),{value:o.bym.systemPrompt,"onUpdate:value":l[29]||(l[29]=e=>o.bym.systemPrompt=e),type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"伪人模式的系统提示词"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(a(M),{title:"全局设置"},{default:s(()=>[t(a(C),{"label-placement":"left","label-width":"140"},{default:s(()=>[t(a(d),{label:"启用推理 (Thinking)"},{default:s(()=>[t(a(g),{value:o.thinking.enableReasoning,"onUpdate:value":l[30]||(l[30]=e=>o.thinking.enableReasoning=e)},null,8,["value"])]),_:1}),t(a(d),{label:"流式传输 (Streaming)"},{default:s(()=>[t(a(g),{value:o.streaming.enabled,"onUpdate:value":l[31]||(l[31]=e=>o.streaming.enabled=e)},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(a(y),{justify:"end"},{default:s(()=>[t(a(r),{type:"primary",size:"large",onClick:O,loading:k.value},{default:s(()=>[...l[43]||(l[43]=[m(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1}),t(a(K),{show:b.value,"onUpdate:show":l[32]||(l[32]=e=>b.value=e),preset:"card",title:"选择模型",style:{width:"800px","max-height":"85vh"}},{default:s(()=>[t(L,{"all-models":N.value,value:[],multiple:!1,"onUpdate:value":P},null,8,["all-models"])]),_:1},8,["show"])]),_:1}))}};export{h as default};
