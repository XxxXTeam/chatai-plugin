{"version":3,"sources":["turbopack:///[project]/plugins/chatgpt-plugin/frontend/components/ui/card.tsx","turbopack:///[project]/node_modules/.pnpm/next@16.0.10_@babel+core@7._c57d9b56c0bd86dac4690a5de51b3a27/node_modules/next/navigation.js","turbopack:///[project]/node_modules/.pnpm/lucide-react@0.556.0_react@19.2.1/node_modules/lucide-react/src/icons/circle-check-big.ts","turbopack:///[project]/node_modules/.pnpm/lucide-react@0.556.0_react@19.2.1/node_modules/lucide-react/src/icons/circle-x.ts","turbopack:///[project]/plugins/chatgpt-plugin/frontend/app/login/token/page.tsx"],"sourcesContent":["import * as React from 'react'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction Card({ className, ...props }: React.ComponentProps<'div'>) {\r\n    return (\r\n        <div\r\n            data-slot=\"card\"\r\n            className={cn(\r\n                'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm transition-all duration-200',\r\n                'hover:shadow-md dark:border-border/50 dark:shadow-none dark:hover:border-border',\r\n                className\r\n            )}\r\n            {...props}\r\n        />\r\n    )\r\n}\r\n\r\nfunction CardHeader({ className, ...props }: React.ComponentProps<'div'>) {\r\n    return (\r\n        <div\r\n            data-slot=\"card-header\"\r\n            className={cn(\r\n                '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',\r\n                className\r\n            )}\r\n            {...props}\r\n        />\r\n    )\r\n}\r\n\r\nfunction CardTitle({ className, ...props }: React.ComponentProps<'div'>) {\r\n    return <div data-slot=\"card-title\" className={cn('leading-none font-semibold', className)} {...props} />\r\n}\r\n\r\nfunction CardDescription({ className, ...props }: React.ComponentProps<'div'>) {\r\n    return <div data-slot=\"card-description\" className={cn('text-muted-foreground text-sm', className)} {...props} />\r\n}\r\n\r\nfunction CardAction({ className, ...props }: React.ComponentProps<'div'>) {\r\n    return (\r\n        <div\r\n            data-slot=\"card-action\"\r\n            className={cn('col-start-2 row-span-2 row-start-1 self-start justify-self-end', className)}\r\n            {...props}\r\n        />\r\n    )\r\n}\r\n\r\nfunction CardContent({ className, ...props }: React.ComponentProps<'div'>) {\r\n    return <div data-slot=\"card-content\" className={cn('px-6', className)} {...props} />\r\n}\r\n\r\nfunction CardFooter({ className, ...props }: React.ComponentProps<'div'>) {\r\n    return (\r\n        <div data-slot=\"card-footer\" className={cn('flex items-center px-6 [.border-t]:pt-6', className)} {...props} />\r\n    )\r\n}\r\n\r\nexport { Card, CardHeader, CardFooter, CardTitle, CardAction, CardDescription, CardContent }\r\n","module.exports = require('./dist/client/components/navigation')\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M21.801 10A10 10 0 1 1 17 3.335', key: 'yps3ct' }],\n  ['path', { d: 'm9 11 3 3L22 4', key: '1pflzl' }],\n];\n\n/**\n * @component @name CircleCheckBig\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjEuODAxIDEwQTEwIDEwIDAgMSAxIDE3IDMuMzM1IiAvPgogIDxwYXRoIGQ9Im05IDExIDMgM0wyMiA0IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/circle-check-big\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CircleCheckBig = createLucideIcon('circle-check-big', __iconNode);\n\nexport default CircleCheckBig;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n  ['path', { d: 'm15 9-6 6', key: '1uzhvr' }],\n  ['path', { d: 'm9 9 6 6', key: 'z0biqf' }],\n];\n\n/**\n * @component @name CircleX\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICA8cGF0aCBkPSJtMTUgOS02IDYiIC8+CiAgPHBhdGggZD0ibTkgOSA2IDYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/circle-x\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CircleX = createLucideIcon('circle-x', __iconNode);\n\nexport default CircleX;\n","'use client'\r\n\r\nimport { useEffect, useState, Suspense } from 'react'\r\nimport { useRouter, useSearchParams } from 'next/navigation'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Loader2, CheckCircle, XCircle } from 'lucide-react'\r\nimport { authApi } from '@/lib/api'\r\nimport { toast } from 'sonner'\r\n\r\nfunction TokenLoginContent() {\r\n    const router = useRouter()\r\n    const searchParams = useSearchParams()\r\n    const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading')\r\n    const [message, setMessage] = useState('正在验证登录凭证...')\r\n\r\n    useEffect(() => {\r\n        const token = searchParams.get('token')\r\n\r\n        // 1. 先检查是否已有有效的JWT token\r\n        const existingToken = localStorage.getItem('chatai_token')\r\n        if (existingToken) {\r\n            // 尝试验证现有token是否有效（简单检查JWT格式和过期）\r\n            try {\r\n                const parts = existingToken.split('.')\r\n                if (parts.length === 3) {\r\n                    const payload = JSON.parse(atob(parts[1]))\r\n                    const exp = payload.exp * 1000 // JWT exp是秒，转毫秒\r\n                    if (exp > Date.now()) {\r\n                        // Token有效，直接跳转\r\n                        setStatus('success')\r\n                        setMessage('已登录，正在跳转...')\r\n                        router.push('/')\r\n                        return\r\n                    }\r\n                }\r\n            } catch {\r\n                // Token解析失败，继续正常登录流程\r\n                localStorage.removeItem('chatai_token')\r\n            }\r\n        }\r\n\r\n        if (!token) {\r\n            setStatus('error')\r\n            setMessage('无效的登录链接')\r\n            return\r\n        }\r\n\r\n        // 2. 验证 URL token\r\n        const verifyToken = async () => {\r\n            try {\r\n                const res = (await authApi.verifyToken(token)) as {\r\n                    success?: boolean\r\n                    data?: { token?: string }\r\n                    message?: string\r\n                }\r\n                if (res?.success || res?.data?.token) {\r\n                    // 保存 JWT token\r\n                    const authToken = res?.data?.token\r\n                    localStorage.setItem('chatai_token', authToken)\r\n                    setStatus('success')\r\n                    setMessage('登录成功，正在跳转...')\r\n                    toast.success('登录成功')\r\n\r\n                    // 延迟跳转\r\n                    setTimeout(() => {\r\n                        router.push('/')\r\n                    }, 10)\r\n                } else {\r\n                    throw new Error(res?.message || '验证失败')\r\n                }\r\n            } catch (error) {\r\n                const err = error as { response?: { data?: { message?: string } }; message?: string }\r\n                console.error('Token验证失败:', error)\r\n                setStatus('error')\r\n                setMessage(err?.response?.data?.message || err?.message || '登录凭证无效或已过期')\r\n                toast.error('登录失败')\r\n            }\r\n        }\r\n\r\n        verifyToken()\r\n    }, [searchParams, router])\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-muted p-4\">\r\n            <Card className=\"w-full max-w-md\">\r\n                <CardHeader className=\"text-center\">\r\n                    <div className=\"flex justify-center mb-4\">\r\n                        {status === 'loading' && <Loader2 className=\"h-12 w-12 text-primary animate-spin\" />}\r\n                        {status === 'success' && <CheckCircle className=\"h-12 w-12 text-green-500\" />}\r\n                        {status === 'error' && <XCircle className=\"h-12 w-12 text-destructive\" />}\r\n                    </div>\r\n                    <CardTitle className=\"text-xl\">{message}</CardTitle>\r\n                </CardHeader>\r\n                {status === 'error' && (\r\n                    <CardContent className=\"text-center\">\r\n                        <button onClick={() => router.push('/login')} className=\"text-primary hover:underline\">\r\n                            返回登录页面\r\n                        </button>\r\n                    </CardContent>\r\n                )}\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default function TokenLoginPage() {\r\n    return (\r\n        <Suspense\r\n            fallback={\r\n                <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-muted p-4\">\r\n                    <Card className=\"w-full max-w-md\">\r\n                        <CardHeader className=\"text-center\">\r\n                            <div className=\"flex justify-center mb-4\">\r\n                                <Loader2 className=\"h-12 w-12 text-primary animate-spin\" />\r\n                            </div>\r\n                            <CardTitle className=\"text-xl\">正在加载...</CardTitle>\r\n                        </CardHeader>\r\n                    </Card>\r\n                </div>\r\n            }\r\n        >\r\n            <TokenLoginContent />\r\n        </Suspense>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[1,2,3]}