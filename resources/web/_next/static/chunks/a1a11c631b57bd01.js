(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,81610,e=>{"use strict";var s=e.i(42548),a=e.i(5614),l=e.i(41049),r=e.i(17609),t=e.i(61375),i=e.i(48694),n=e.i(58899),d=e.i(70404),c=e.i(71205),x=e.i(56949),h=e.i(31887),o=e.i(2490),m=e.i(94237),j=e.i(45030);let g=(0,m.cva)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function u({className:e,variant:a,...l}){return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,j.cn)(g({variant:a}),e),...l})}function p({className:e,...a}){return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,j.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...a})}var f=e.i(35860),b=e.i(9641),C=e.i(74940),v=e.i(60713);function y({value:e=[],onChange:l,placeholder:i="输入后按回车添加",className:n,disabled:d=!1,variant:c="secondary"}){let[x,h]=(0,a.useState)(""),o=()=>{let s=x.trim();s&&!e.includes(s)&&(l([...e,s]),h(""))};return(0,s.jsxs)("div",{className:(0,j.cn)("space-y-2",n),children:[(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(a=>(0,s.jsxs)(b.Badge,{variant:c,className:"gap-1 pr-1",children:[a,!d&&(0,s.jsx)("button",{type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),l(e.filter(e=>e!==a))},className:"ml-1 rounded-full hover:bg-destructive/20 p-0.5",children:(0,s.jsx)(C.X,{className:"h-3 w-3 cursor-pointer hover:text-destructive"})})]},a))}),!d&&(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(r.Input,{value:x,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),o())},placeholder:i,className:"flex-1"}),(0,s.jsx)(t.Button,{type:"button",variant:"outline",size:"icon",onClick:o,disabled:!x.trim(),children:(0,s.jsx)(v.Plus,{className:"h-4 w-4"})})]})]})}var N=e.i(40251),k=e.i(41012),w=e.i(34852),S=e.i(79342),L=e.i(5850),T=e.i(89908),I=e.i(48569),I=I,A=e.i(97058),P=e.i(43939),M=e.i(84141);let G={basic:{commandPrefix:"#ai",debug:!1,showThinkingMessage:!0,debugToConsoleOnly:!0,quoteReply:!0,autoRecall:{enabled:!1,delay:60,recallError:!0}},admin:{masterQQ:[],loginNotifyPrivate:!0,sensitiveCommandMasterOnly:!0},llm:{defaultModel:"",models:{chat:[],roleplay:[],toolCall:[],search:[],reasoning:[]},fallback:{enabled:!1,models:[],maxRetries:3,retryDelay:500,notifyOnFallback:!1}},context:{maxMessages:20,autoEnd:{enabled:!1,maxRounds:50}},bym:{enable:!1,probability:.02,temperature:.9,maxTokens:100,recall:!1,model:"",systemPrompt:"",inheritPersonality:!0},tools:{showCallLogs:!0,useForwardMsg:!0,parallelExecution:!0,sendIntermediateReply:!0},personality:{isolateContext:{enabled:!1,clearOnSwitch:!1}},thinking:{enabled:!0,showThinkingContent:!0,useForwardMsg:!0},features:{groupSummary:{enabled:!0,maxMessages:100},userPortrait:{enabled:!0,minMessages:10},poke:{enabled:!1,pokeBack:!1,message:"别戳了~"},reaction:{enabled:!1},imageGen:{enabled:!0,apis:[],model:"gemini-3-pro-image",videoModel:"veo-2.0-generate-001"},autoCleanOnError:{enabled:!1,notifyUser:!0}},memory:{enabled:!1,autoExtract:!0},trigger:{private:{enabled:!0,mode:"always"},group:{enabled:!0,at:!0,prefix:!0,keyword:!1,random:!1,randomRate:.05},prefixes:["#chat"],prefixPersonas:[],keywords:[],collectGroupMsg:!0,blacklistUsers:[],whitelistUsers:[],blacklistGroups:[],whitelistGroups:[]}},R={default:"默认模型",chat:"对话模型",roleplay:"伪人模型",toolCall:"工具调用模型",search:"搜索模型",reasoning:"思考模型",fallback:"备选模型"};function O(){let[e,m]=(0,a.useState)(null),[j,g]=(0,a.useState)(!0),[O,B]=(0,a.useState)(!1),[D,E]=(0,a.useState)([]),[H,F]=(0,a.useState)([]),[U,z]=(0,a.useState)(!1),[Q,V]=(0,a.useState)(!1),[K,J]=(0,a.useState)("chat"),[q,X]=(0,a.useState)([]),[$,_]=(0,a.useState)("idle"),Y=(0,a.useRef)(!0),W=(0,a.useRef)(null),Z=(0,a.useCallback)(async e=>{W.current&&clearTimeout(W.current),W.current=setTimeout(async()=>{_("saving");try{await w.configApi.update(e),_("saved"),setTimeout(()=>_("idle"),2e3)}catch(e){S.toast.error("自动保存失败"),console.error(e),_("idle")}},800)},[]);(0,a.useEffect)(()=>{!Y.current&&e&&Z(e)},[e,Z]),(0,a.useEffect)(()=>{(async()=>{try{let[e,s]=await Promise.all([w.configApi.get(),w.channelsApi.list().catch(()=>({data:[]}))]),a=e.data||{},l=JSON.parse(JSON.stringify(G)),r=(e,s)=>{Object.keys(s).forEach(a=>{s[a]&&"object"==typeof s[a]&&!Array.isArray(s[a])?(e[a]||(e[a]={}),r(e[a],s[a])):void 0!==s[a]&&(e[a]=s[a])})};r(l,a),l.llm||(l.llm={defaultModel:"",models:{},fallback:{enabled:!1,models:[],maxRetries:3,retryDelay:500,notifyOnFallback:!1}}),l.llm.models||(l.llm.models={}),l.llm.fallback||(l.llm.fallback={enabled:!1,models:[],maxRetries:3,retryDelay:500,notifyOnFallback:!1}),["chat","roleplay","toolCall","search","reasoning"].forEach(e=>{let s=l.llm.models[e];"string"==typeof s?l.llm.models[e]=s?[s]:[]:Array.isArray(s)||(l.llm.models[e]=[])}),Array.isArray(l.trigger?.prefixPersonas)||(l.trigger.prefixPersonas=[]),l.llm?.fallback&&!Array.isArray(l.llm.fallback.models)&&(l.llm.fallback.models=[]),m(l),setTimeout(()=>{Y.current=!1},100);let t=s?.data||[],i=new Set;t.forEach(e=>{Array.isArray(e.models)&&e.models.forEach(e=>i.add(e))});let n=Array.from(i).sort();E(n),F(n)}catch(e){S.toast.error("加载配置失败"),console.error(e)}finally{g(!1)}})()},[]);let ee=async()=>{z(!0);try{let e=await w.channelsApi.list(),s=e?.data||[],a=new Set;s.forEach(e=>{Array.isArray(e.models)&&e.models.forEach(e=>a.add(e))});let l=Array.from(a).sort();F(l),E(l),S.toast.success(`获取到 ${l.length} 个模型`)}catch(e){S.toast.error("获取模型列表失败"),console.error(e)}finally{z(!1)}},es=s=>{if(!e)return;J(s);let a=[];X(Array.isArray(a="default"===s?e.llm?.defaultModel?[e.llm.defaultModel]:[]:"fallback"===s?e.llm?.fallback?.models||[]:e.llm?.models?.[s]||[])?a:[]),V(!0)},ea=s=>e?"default"===s?+!!e.llm?.defaultModel:"fallback"===s?e.llm?.fallback?.models?.length||0:e.llm?.models?.[s]?.length||0:0,el=async()=>{if(e){B(!0);try{await w.configApi.update(e),_("saved"),S.toast.success("配置已保存"),setTimeout(()=>_("idle"),2e3)}catch(e){S.toast.error("保存失败"),console.error(e)}finally{B(!1)}}},er=(s,a)=>{if(!e)return;let l=s.split("."),r=JSON.parse(JSON.stringify(e)),t=r;for(let e=0;e<l.length-1;e++)t=t[l[e]];t[l[l.length-1]]=a,m(r)};return j?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(c.Skeleton,{className:"h-10 w-48"}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(c.Skeleton,{className:"h-6 w-32"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsx)(c.Skeleton,{className:"h-10 w-full"}),(0,s.jsx)(c.Skeleton,{className:"h-10 w-full"})]})]})]}):e?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"系统设置"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["saving"===$&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Loader2,{className:"inline h-4 w-4 animate-spin mr-1"}),"保存中"]}),"saved"===$&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.Check,{className:"inline h-4 w-4 text-green-500 mr-1"}),"已保存"]}),"idle"===$&&"自动保存"]}),(0,s.jsxs)(t.Button,{onClick:el,disabled:O,size:"sm",children:[O?(0,s.jsx)(T.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(L.Save,{className:"mr-2 h-4 w-4"}),"保存"]})]})]}),(0,s.jsxs)(d.Tabs,{defaultValue:"trigger",className:"w-full",children:[(0,s.jsxs)(d.TabsList,{className:"flex flex-wrap h-auto gap-1",children:[(0,s.jsx)(d.TabsTrigger,{value:"trigger",children:"触发配置"}),(0,s.jsx)(d.TabsTrigger,{value:"basic",children:"基础设置"}),(0,s.jsx)(d.TabsTrigger,{value:"admin",children:"管理配置"}),(0,s.jsx)(d.TabsTrigger,{value:"llm",children:"模型配置"}),(0,s.jsx)(d.TabsTrigger,{value:"bym",children:"伪人模式"}),(0,s.jsx)(d.TabsTrigger,{value:"tools",children:"工具调用"}),(0,s.jsx)(d.TabsTrigger,{value:"thinking",children:"深度思考"}),(0,s.jsx)(d.TabsTrigger,{value:"features",children:"高级功能"})]}),(0,s.jsxs)(d.TabsContent,{value:"trigger",className:"space-y-4",children:[(0,s.jsxs)(u,{children:[(0,s.jsx)(I.default,{className:"h-4 w-4"}),(0,s.jsx)(p,{children:"配置机器人何时响应消息。私聊和群聊可独立配置触发方式。"})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"私聊触发"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"响应私聊"}),(0,s.jsx)(n.Switch,{checked:e.trigger?.private?.enabled??!0,onCheckedChange:e=>er("trigger.private.enabled",e)})]}),e.trigger?.private?.enabled&&(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"私聊模式"}),(0,s.jsxs)(f.Select,{value:e.trigger?.private?.mode||"always",onValueChange:e=>er("trigger.private.mode",e),children:[(0,s.jsx)(f.SelectTrigger,{children:(0,s.jsx)(f.SelectValue,{})}),(0,s.jsxs)(f.SelectContent,{children:[(0,s.jsx)(f.SelectItem,{value:"always",children:"总是响应"}),(0,s.jsx)(f.SelectItem,{value:"prefix",children:"需要前缀"}),(0,s.jsx)(f.SelectItem,{value:"off",children:"关闭"})]})]})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"群聊触发"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"响应群聊"}),(0,s.jsx)(n.Switch,{checked:e.trigger?.group?.enabled??!0,onCheckedChange:e=>er("trigger.group.enabled",e)})]}),e.trigger?.group?.enabled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"@机器人触发"}),(0,s.jsx)(n.Switch,{checked:e.trigger?.group?.at??!0,onCheckedChange:e=>er("trigger.group.at",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"前缀触发"}),(0,s.jsx)(n.Switch,{checked:e.trigger?.group?.prefix??!0,onCheckedChange:e=>er("trigger.group.prefix",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"关键词触发"}),(0,s.jsx)(n.Switch,{checked:e.trigger?.group?.keyword??!1,onCheckedChange:e=>er("trigger.group.keyword",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"随机触发"}),e.trigger?.group?.random&&(0,s.jsxs)("span",{className:"ml-2 text-sm text-muted-foreground",children:[(100*(e.trigger?.group?.randomRate||.05)).toFixed(0),"%"]})]}),(0,s.jsx)(n.Switch,{checked:e.trigger?.group?.random??!1,onCheckedChange:e=>er("trigger.group.random",e)})]}),e.trigger?.group?.random&&(0,s.jsx)(h.Slider,{value:[e.trigger?.group?.randomRate||.05],min:0,max:.5,step:.01,onValueChange:e=>er("trigger.group.randomRate",e[0])})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"触发词"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.Label,{children:"触发前缀"}),(0,s.jsx)(y,{value:e.trigger?.prefixes||[],onChange:e=>er("trigger.prefixes",e),placeholder:"输入前缀后按回车，如: #chat"})]}),e.trigger?.group?.keyword&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.Label,{children:"触发关键词"}),(0,s.jsx)(y,{value:e.trigger?.keywords||[],onChange:e=>er("trigger.keywords",e),placeholder:"消息包含这些词时触发"})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"前缀人格"}),(0,s.jsx)(l.CardDescription,{children:"为不同的触发前缀绑定不同的预设人格"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(e.trigger?.prefixPersonas||[]).map((a,l)=>(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(r.Input,{value:a.prefix,onChange:s=>{let a=[...e.trigger?.prefixPersonas||[]];a[l]={...a[l],prefix:s.target.value},er("trigger.prefixPersonas",a)},placeholder:"前缀，如: #猫娘",className:"flex-1"}),(0,s.jsx)(r.Input,{value:a.preset,onChange:s=>{let a=[...e.trigger?.prefixPersonas||[]];a[l]={...a[l],preset:s.target.value},er("trigger.prefixPersonas",a)},placeholder:"预设名称",className:"flex-1"}),(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>{er("trigger.prefixPersonas",(e.trigger?.prefixPersonas||[]).filter((e,s)=>s!==l))},children:(0,s.jsx)(C.X,{className:"h-4 w-4"})})]},l)),(0,s.jsx)(t.Button,{variant:"outline",size:"sm",onClick:()=>{er("trigger.prefixPersonas",[...e.trigger?.prefixPersonas||[],{prefix:"",preset:""}])},children:"添加前缀人格"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"使用特定前缀触发时，会自动切换到对应的预设人格"})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"访问控制"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.Label,{children:"群白名单"}),(0,s.jsx)(y,{value:e.trigger?.whitelistGroups||[],onChange:e=>er("trigger.whitelistGroups",e),placeholder:"群号"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.Label,{children:"群黑名单"}),(0,s.jsx)(y,{value:e.trigger?.blacklistGroups||[],onChange:e=>er("trigger.blacklistGroups",e),placeholder:"群号",variant:"destructive"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.Label,{children:"用户白名单"}),(0,s.jsx)(y,{value:e.trigger?.whitelistUsers||[],onChange:e=>er("trigger.whitelistUsers",e),placeholder:"QQ号"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.Label,{children:"用户黑名单"}),(0,s.jsx)(y,{value:e.trigger?.blacklistUsers||[],onChange:e=>er("trigger.blacklistUsers",e),placeholder:"QQ号",variant:"destructive"})]})]}),(0,s.jsx)(x.Separator,{}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"采集群消息"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"用于记忆和上下文分析"})]}),(0,s.jsx)(n.Switch,{checked:e.trigger?.collectGroupMsg??!0,onCheckedChange:e=>er("trigger.collectGroupMsg",e)})]})]})]})]}),(0,s.jsx)(d.TabsContent,{value:"basic",className:"space-y-4",children:(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"基础配置"}),(0,s.jsx)(l.CardDescription,{children:"插件基础功能设置"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"命令前缀"}),(0,s.jsx)(r.Input,{value:e.basic?.commandPrefix||"#ai",onChange:e=>er("basic.commandPrefix",e.target.value),placeholder:"#ai"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"管理命令的前缀，如 #ai帮助、#ai状态 等"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"思考提示"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:'AI处理时发送"思考中..."提示'})]}),(0,s.jsx)(n.Switch,{checked:e.basic?.showThinkingMessage??!0,onCheckedChange:e=>er("basic.showThinkingMessage",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"引用回复"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"AI回复会引用触发消息"})]}),(0,s.jsx)(n.Switch,{checked:e.basic?.quoteReply??!0,onCheckedChange:e=>er("basic.quoteReply",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"调试模式"}),(0,s.jsx)(n.Switch,{checked:e.basic?.debug??!1,onCheckedChange:e=>er("basic.debug",e)})]}),e.basic?.debug&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"调试仅控制台"}),(0,s.jsx)(n.Switch,{checked:e.basic?.debugToConsoleOnly??!0,onCheckedChange:e=>er("basic.debugToConsoleOnly",e)})]}),(0,s.jsx)(x.Separator,{}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"自动撤回"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"自动撤回AI回复消息"})]}),(0,s.jsx)(n.Switch,{checked:e.basic?.autoRecall?.enabled??!1,onCheckedChange:e=>er("basic.autoRecall.enabled",e)})]}),e.basic?.autoRecall?.enabled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"撤回延迟（秒）"}),(0,s.jsx)(r.Input,{type:"number",value:e.basic?.autoRecall?.delay||60,onChange:e=>er("basic.autoRecall.delay",parseInt(e.target.value))})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"撤回错误消息"}),(0,s.jsx)(n.Switch,{checked:e.basic?.autoRecall?.recallError??!0,onCheckedChange:e=>er("basic.autoRecall.recallError",e)})]})]})]})]})}),(0,s.jsx)(d.TabsContent,{value:"admin",className:"space-y-4",children:(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"管理配置"}),(0,s.jsx)(l.CardDescription,{children:"管理员和权限设置"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.Label,{children:"主人QQ"}),(0,s.jsx)(y,{value:e.admin?.masterQQ||[],onChange:e=>er("admin.masterQQ",e),placeholder:"多个用回车分隔，留空使用Yunzai配置"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"登录链接私聊推送"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"群聊中触发管理面板命令时私聊推送登录链接"})]}),(0,s.jsx)(n.Switch,{checked:e.admin?.loginNotifyPrivate??!0,onCheckedChange:e=>er("admin.loginNotifyPrivate",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"敏感命令仅主人"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"敏感命令（如管理面板）仅限主人使用"})]}),(0,s.jsx)(n.Switch,{checked:e.admin?.sensitiveCommandMasterOnly??!0,onCheckedChange:e=>er("admin.sensitiveCommandMasterOnly",e)})]})]})]})}),(0,s.jsxs)(d.TabsContent,{value:"llm",className:"space-y-4",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"模型配置"}),(0,s.jsx)(l.CardDescription,{children:"模型选择和映射设置"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(i.Label,{children:"可用模型"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"从已配置的渠道获取模型列表"})]}),(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",onClick:ee,disabled:U,children:[U?(0,s.jsx)(T.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(A.RefreshCw,{className:"mr-2 h-4 w-4"}),"获取模型 (",H.length,")"]})]}),(0,s.jsx)(x.Separator,{}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(i.Label,{children:"默认模型"}),(0,s.jsx)("div",{className:"flex items-center gap-2 mt-1",children:e.llm?.defaultModel?(0,s.jsx)(b.Badge,{variant:"secondary",children:e.llm.defaultModel}):(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"未配置"})}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"未配置分类模型时使用的默认模型"})]}),(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",onClick:()=>es("default"),disabled:0===H.length,children:[(0,s.jsx)(P.Settings2,{className:"mr-2 h-4 w-4"}),"配置"]})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{className:"text-base",children:"模型分类"}),(0,s.jsx)(l.CardDescription,{children:"为不同场景配置专用模型"})]}),(0,s.jsx)(l.CardContent,{className:"space-y-3",children:["chat","roleplay","toolCall","search","reasoning"].map(a=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:R[a]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[(e.llm?.models?.[a]||[]).slice(0,3).map(e=>(0,s.jsx)(b.Badge,{variant:"secondary",className:"text-xs",children:e},e)),(e.llm?.models?.[a]?.length||0)>3&&(0,s.jsxs)(b.Badge,{variant:"outline",className:"text-xs",children:["+",(e.llm?.models?.[a]?.length||0)-3]}),!e.llm?.models?.[a]?.length&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"未配置，使用默认模型"})]})]}),(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",onClick:()=>es(a),disabled:0===H.length,children:[(0,s.jsx)(P.Settings2,{className:"mr-2 h-4 w-4"}),"配置 (",ea(a),")"]})]},a))})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{className:"text-base",children:"备选模型轮询"}),(0,s.jsx)(l.CardDescription,{children:"当主模型失败时自动切换到备选模型"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"启用备选模型"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"主模型调用失败时自动尝试备选模型"})]}),(0,s.jsx)(n.Switch,{checked:e.llm?.fallback?.enabled??!1,onCheckedChange:e=>er("llm.fallback.enabled",e)})]}),e.llm?.fallback?.enabled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"备选模型列表"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[(e.llm?.fallback?.models||[]).slice(0,3).map(e=>(0,s.jsx)(b.Badge,{variant:"secondary",className:"text-xs",children:e},e)),(e.llm?.fallback?.models?.length||0)>3&&(0,s.jsxs)(b.Badge,{variant:"outline",className:"text-xs",children:["+",(e.llm?.fallback?.models?.length||0)-3]}),!e.llm?.fallback?.models?.length&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"未配置备选模型"})]})]}),(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",onClick:()=>es("fallback"),disabled:0===H.length,children:[(0,s.jsx)(P.Settings2,{className:"mr-2 h-4 w-4"}),"配置 (",ea("fallback"),")"]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"最大重试次数"}),(0,s.jsx)(r.Input,{type:"number",value:e.llm?.fallback?.maxRetries||3,onChange:e=>er("llm.fallback.maxRetries",parseInt(e.target.value)),min:1,max:10})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"重试延迟 (ms)"}),(0,s.jsx)(r.Input,{type:"number",value:e.llm?.fallback?.retryDelay||500,onChange:e=>er("llm.fallback.retryDelay",parseInt(e.target.value)),min:0,step:100})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"切换通知"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"切换到备选模型时通知用户"})]}),(0,s.jsx)(n.Switch,{checked:e.llm?.fallback?.notifyOnFallback??!1,onCheckedChange:e=>er("llm.fallback.notifyOnFallback",e)})]})]})]})]})]}),(0,s.jsx)(d.TabsContent,{value:"bym",className:"space-y-4",children:(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"伪人模式"}),(0,s.jsx)(l.CardDescription,{children:"随机模拟真人回复，使机器人更像真人"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"启用伪人模式"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"AI回复更像真人"})]}),(0,s.jsx)(n.Switch,{checked:e.bym?.enable??!1,onCheckedChange:e=>er("bym.enable",e)})]}),e.bym?.enable&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(i.Label,{children:"触发概率"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:[((e.bym?.probability??.02)*100).toFixed(0),"%"]})]}),(0,s.jsx)(h.Slider,{value:[e.bym?.probability??.02],min:.01,max:1,step:.01,onValueChange:e=>er("bym.probability",e[0])}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"最小1%，如需完全禁用请关闭伪人模式开关"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(i.Label,{children:"回复温度"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:e.bym?.temperature||.9})]}),(0,s.jsx)(h.Slider,{value:[e.bym?.temperature||.9],min:0,max:2,step:.1,onValueChange:e=>er("bym.temperature",e[0])})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"最大Token"}),(0,s.jsx)(r.Input,{type:"number",value:e.bym?.maxTokens||100,onChange:e=>er("bym.maxTokens",parseInt(e.target.value))})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"启用记忆"}),(0,s.jsx)(n.Switch,{checked:e.bym?.recall??!1,onCheckedChange:e=>er("bym.recall",e)})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"使用模型"}),(0,s.jsx)(r.Input,{value:e.bym?.model||"",onChange:e=>er("bym.model",e.target.value),placeholder:"留空使用默认模型"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"系统提示词"}),(0,s.jsx)(o.Textarea,{value:e.bym?.systemPrompt||"",onChange:e=>er("bym.systemPrompt",e.target.value),placeholder:"伪人模式的系统提示词",rows:3})]})]})]})]})}),(0,s.jsxs)(d.TabsContent,{value:"tools",className:"space-y-4",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"工具调用配置"}),(0,s.jsx)(l.CardDescription,{children:"配置AI工具调用的行为"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"显示调用日志"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"显示工具调用的详细日志"})]}),(0,s.jsx)(n.Switch,{checked:e.tools?.showCallLogs??!0,onCheckedChange:e=>er("tools.showCallLogs",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"日志合并转发"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"工具调用日志使用合并转发发送"})]}),(0,s.jsx)(n.Switch,{checked:e.tools?.useForwardMsg??!0,onCheckedChange:e=>er("tools.useForwardMsg",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"并行执行"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"多个无依赖的工具调用会并行执行"})]}),(0,s.jsx)(n.Switch,{checked:e.tools?.parallelExecution??!0,onCheckedChange:e=>er("tools.parallelExecution",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"发送中间回复"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"工具调用前先发送模型的文本回复"})]}),(0,s.jsx)(n.Switch,{checked:e.tools?.sendIntermediateReply??!0,onCheckedChange:e=>er("tools.sendIntermediateReply",e)})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"人格上下文"}),(0,s.jsx)(l.CardDescription,{children:"配置独立人格的上下文隔离行为"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"独立上下文"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"不同人格的对话历史相互独立"})]}),(0,s.jsx)(n.Switch,{checked:e.personality?.isolateContext?.enabled??!1,onCheckedChange:e=>er("personality.isolateContext.enabled",e)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"切换时清除"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"切换人格时清除原人格的上下文"})]}),(0,s.jsx)(n.Switch,{checked:e.personality?.isolateContext?.clearOnSwitch??!1,onCheckedChange:e=>er("personality.isolateContext.clearOnSwitch",e),disabled:!e.personality?.isolateContext?.enabled})]})]})]})]}),(0,s.jsx)(d.TabsContent,{value:"thinking",className:"space-y-4",children:(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"深度思考"}),(0,s.jsx)(l.CardDescription,{children:"配置AI思考过程的显示和适配"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"启用思考适配"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"开启后会解析和处理模型的思考内容 (如 Claude 的 thinking 标签)"})]}),(0,s.jsx)(n.Switch,{checked:e.thinking?.enabled??!0,onCheckedChange:e=>er("thinking.enabled",e)})]}),(0,s.jsx)(x.Separator,{}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"显示思考内容"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"显示AI的思考过程"})]}),(0,s.jsx)(n.Switch,{checked:e.thinking?.showThinkingContent??!0,onCheckedChange:e=>er("thinking.showThinkingContent",e),disabled:!e.thinking?.enabled})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"思考合并转发"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"思考内容使用合并转发发送"})]}),(0,s.jsx)(n.Switch,{checked:e.thinking?.useForwardMsg??!0,onCheckedChange:e=>er("thinking.useForwardMsg",e),disabled:!e.thinking?.enabled})]})]})]})}),(0,s.jsxs)(d.TabsContent,{value:"features",className:"space-y-4",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"群聊总结"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"启用"}),(0,s.jsx)(n.Switch,{checked:e.features?.groupSummary?.enabled??!0,onCheckedChange:e=>er("features.groupSummary.enabled",e)})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"最大消息数"}),(0,s.jsx)(r.Input,{type:"number",value:e.features?.groupSummary?.maxMessages||100,onChange:e=>er("features.groupSummary.maxMessages",parseInt(e.target.value))}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"总结时分析的最大消息数量"})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"个人画像"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"启用"}),(0,s.jsx)(n.Switch,{checked:e.features?.userPortrait?.enabled??!0,onCheckedChange:e=>er("features.userPortrait.enabled",e)})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"最少消息数"}),(0,s.jsx)(r.Input,{type:"number",value:e.features?.userPortrait?.minMessages||10,onChange:e=>er("features.userPortrait.minMessages",parseInt(e.target.value))}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"生成画像需要的最少消息数量"})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"戳一戳响应"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"启用"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"被戳时使用AI人设回复"})]}),(0,s.jsx)(n.Switch,{checked:e.features?.poke?.enabled??!1,onCheckedChange:e=>er("features.poke.enabled",e)})]}),e.features?.poke?.enabled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"自动回戳"}),(0,s.jsx)(n.Switch,{checked:e.features?.poke?.pokeBack??!1,onCheckedChange:e=>er("features.poke.pokeBack",e)})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"备用回复"}),(0,s.jsx)(r.Input,{value:e.features?.poke?.message||"",onChange:e=>er("features.poke.message",e.target.value),placeholder:"AI回复失败时的备用回复"})]})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"表情回应"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"启用"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"收到表情回应时使用AI人设处理"})]}),(0,s.jsx)(n.Switch,{checked:e.features?.reaction?.enabled??!1,onCheckedChange:e=>er("features.reaction.enabled",e)})]})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"AI图片/视频生成"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"启用"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"可使用 #文生图、#图生图、#文生视频、#图生视频、#谷歌状态 等命令"})]}),(0,s.jsx)(n.Switch,{checked:e.features?.imageGen?.enabled??!0,onCheckedChange:e=>er("features.imageGen.enabled",e)})]}),e.features?.imageGen?.enabled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Separator,{}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"API配置"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"支持多个API，会按顺序轮询和故障转移"})]}),(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",onClick:()=>{er("features.imageGen.apis",[...e.features?.imageGen?.apis||[],{baseUrl:"",apiKey:"",models:[]}])},children:[(0,s.jsx)(v.Plus,{className:"h-4 w-4 mr-1"})," 添加API"]})]}),(e.features?.imageGen?.apis||[]).map((a,l)=>(0,s.jsxs)("div",{className:"p-3 border rounded-lg space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-sm font-medium",children:["API ",l+1]}),(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{let s=[...e.features?.imageGen?.apis||[]];s.splice(l,1),er("features.imageGen.apis",s)},children:(0,s.jsx)(C.X,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{className:"text-xs",children:"API地址"}),(0,s.jsx)(r.Input,{value:a.baseUrl||"",onChange:s=>{let a=[...e.features?.imageGen?.apis||[]];a[l]={...a[l],baseUrl:s.target.value},er("features.imageGen.apis",a)},placeholder:"https://business.928100.xyz"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{className:"text-xs",children:"API密钥"}),(0,s.jsx)(r.Input,{type:"password",value:a.apiKey||"",onChange:s=>{let a=[...e.features?.imageGen?.apis||[]];a[l]={...a[l],apiKey:s.target.value},er("features.imageGen.apis",a)},placeholder:"sk-..."})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(i.Label,{className:"text-xs",children:["可用模型 (",a.models?.length||0,")"]}),(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",className:"h-7 text-xs",disabled:!a.baseUrl,onClick:async()=>{if(a.baseUrl)try{let s=await w.channelsApi.fetchModels({adapterType:"openai",baseUrl:a.baseUrl,apiKey:a.apiKey}),r=s?.data?.models||[],t=[...e.features?.imageGen?.apis||[]];t[l]={...t[l],models:r},er("features.imageGen.apis",t),S.toast.success(`获取到 ${r.length} 个模型`)}catch(e){S.toast.error("获取模型失败")}},children:[(0,s.jsx)(A.RefreshCw,{className:"h-3 w-3 mr-1"})," 获取模型"]})]}),a.models?.length>0&&(0,s.jsxs)("div",{className:"flex flex-wrap gap-1 max-h-20 overflow-y-auto",children:[a.models.slice(0,20).map(e=>(0,s.jsx)(b.Badge,{variant:"secondary",className:"text-xs",children:e},e)),a.models.length>20&&(0,s.jsxs)(b.Badge,{variant:"outline",className:"text-xs",children:["+",a.models.length-20]})]})]})]},l)),0===(e.features?.imageGen?.apis||[]).length&&(0,s.jsx)("div",{className:"text-center py-4 text-sm text-muted-foreground border border-dashed rounded-lg",children:"暂无API配置，点击上方按钮添加"})]}),(0,s.jsx)(x.Separator,{}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"图片模型"}),(0,s.jsxs)(f.Select,{value:e.features?.imageGen?.model||"",onValueChange:e=>er("features.imageGen.model",e),children:[(0,s.jsx)(f.SelectTrigger,{children:(0,s.jsx)(f.SelectValue,{placeholder:"选择或输入模型"})}),(0,s.jsxs)(f.SelectContent,{children:[Array.from(new Set((e.features?.imageGen?.apis||[]).flatMap(e=>e.models||[]))).map(e=>(0,s.jsx)(f.SelectItem,{value:e,children:e},e)),0===(e.features?.imageGen?.apis||[]).flatMap(e=>e.models||[]).length&&(0,s.jsx)(f.SelectItem,{value:"gemini-3-pro-image",children:"gemini-3-pro-image"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(i.Label,{children:"视频模型"}),(0,s.jsxs)(f.Select,{value:e.features?.imageGen?.videoModel||"",onValueChange:e=>er("features.imageGen.videoModel",e),children:[(0,s.jsx)(f.SelectTrigger,{children:(0,s.jsx)(f.SelectValue,{placeholder:"选择或输入模型"})}),(0,s.jsxs)(f.SelectContent,{children:[Array.from(new Set((e.features?.imageGen?.apis||[]).flatMap(e=>e.models||[]))).map(e=>(0,s.jsx)(f.SelectItem,{value:e,children:e},e)),0===(e.features?.imageGen?.apis||[]).flatMap(e=>e.models||[]).length&&(0,s.jsx)(f.SelectItem,{value:"veo-2.0-generate-001",children:"veo-2.0-generate-001"})]})]})]})]})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"错误处理"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"错误时自动结清"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"API返回错误时自动删除对话历史"})]}),(0,s.jsx)(n.Switch,{checked:e.features?.autoCleanOnError?.enabled??!1,onCheckedChange:e=>er("features.autoCleanOnError.enabled",e)})]}),e.features?.autoCleanOnError?.enabled&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(i.Label,{children:"提示用户"}),(0,s.jsx)(n.Switch,{checked:e.features?.autoCleanOnError?.notifyUser??!0,onCheckedChange:e=>er("features.autoCleanOnError.notifyUser",e)})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"长期记忆"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"启用记忆"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"AI会记住用户透露的个人信息和偏好"})]}),(0,s.jsx)(n.Switch,{checked:e.memory?.enabled??!1,onCheckedChange:e=>er("memory.enabled",e)})]}),e.memory?.enabled&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{children:"自动提取"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"自动从对话中提取值得记忆的信息"})]}),(0,s.jsx)(n.Switch,{checked:e.memory?.autoExtract??!0,onCheckedChange:e=>er("memory.autoExtract",e)})]})]})]})]})]}),(0,s.jsx)(k.Dialog,{open:Q,onOpenChange:V,children:(0,s.jsxs)(k.DialogContent,{className:"max-w-2xl max-h-[80vh]",children:[(0,s.jsxs)(k.DialogHeader,{children:[(0,s.jsxs)(k.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(P.Settings2,{className:"h-5 w-5"}),"配置",R[K]]}),(0,s.jsx)(k.DialogDescription,{children:"从列表中选择需要使用的模型，支持搜索和分组选择"})]}),(0,s.jsx)(N.ModelSelector,{value:q,allModels:H,onChange:X}),(0,s.jsxs)(k.DialogFooter,{children:[(0,s.jsx)(t.Button,{variant:"outline",onClick:()=>V(!1),children:"取消"}),(0,s.jsxs)(t.Button,{onClick:()=>{e&&("default"===K?er("llm.defaultModel",q[0]||""):"fallback"===K?er("llm.fallback.models",q):er(`llm.models.${K}`,q),V(!1))},children:["确认选择 (",q.length,")"]})]})]})})]}):(0,s.jsx)("div",{children:"加载失败"})}e.s(["default",()=>O],81610)}]);