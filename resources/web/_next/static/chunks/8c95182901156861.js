(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87126,e=>{"use strict";var s=e.i(33169),t=e.i(17171);function a({className:e,...a}){return(0,s.jsx)("div",{"data-slot":"skeleton",className:(0,t.cn)("bg-accent animate-pulse rounded-md",e),...a})}e.s(["Skeleton",()=>a])},97058,e=>{"use strict";let s=(0,e.i(50974).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>s],97058)},35771,e=>{"use strict";let s=(0,e.i(50974).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>s],35771)},60422,e=>{"use strict";var s=e.i(70707);e.s(["ChevronUp",()=>s.default])},62754,e=>{"use strict";let s=(0,e.i(50974).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>s],62754)},73151,e=>{"use strict";let s=(0,e.i(50974).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>s],73151)},30848,e=>{"use strict";var s=e.i(33169),t=e.i(60844),a=e.i(51200),l=e.i(72029),r=e.i(13107),d=e.i(87126),i=e.i(47686),c=e.i(94518),n=e.i(75979),x=e.i(79342),o=e.i(97058),h=e.i(10273),m=e.i(70620),u=e.i(83949),j=e.i(79923),p=e.i(73151),g=e.i(35771),N=e.i(89908);let f=(0,e.i(50974).default)("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);var v=e.i(82018),C=e.i(32647),b=e.i(62754),y=e.i(3190),k=e.i(60422);function w(e){return e?e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":String(e):"0"}let M=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1","#14b8a6","#a855f7","#eab308","#22c55e","#0ea5e9"];function T({data:e,size:t=200}){let a=e.reduce((e,s)=>e+s.value,0);if(0===a)return(0,s.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"暂无数据"});let l=e.reduce((s,t,l)=>{let r=0===l?0:s[l-1]+e[l-1].value/a*360;return s.push(r),s},[]),r=e.map((e,s)=>{let r=e.value/a,d=360*r,i=l[s],c=(i-90)*Math.PI/180,n=(i+d-90)*Math.PI/180,x=t/2-10,o=t/2,h=t/2,m=o+x*Math.cos(c),u=h+x*Math.sin(c),j=o+x*Math.cos(n),p=h+x*Math.sin(n),g=`M ${o} ${h} L ${m} ${u} A ${x} ${x} 0 ${+(d>180)} 1 ${j} ${p} Z`;return{...e,path:g,percentage:r,color:e.color||M[s%M.length]}});return(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsxs)("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[r.map((e,t)=>(0,s.jsx)("path",{d:e.path,fill:e.color,stroke:"white",strokeWidth:"2",className:"transition-opacity hover:opacity-80",children:(0,s.jsxs)("title",{children:[e.label,": ",e.value," (",(100*e.percentage).toFixed(1),"%)"]})},t)),(0,s.jsx)("circle",{cx:t/2,cy:t/2,r:t/5,fill:"white",className:"dark:fill-gray-900"}),(0,s.jsx)("text",{x:t/2,y:t/2,textAnchor:"middle",dominantBaseline:"middle",className:"text-lg font-bold fill-current",children:a})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 justify-center max-w-full",children:[r.slice(0,8).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:e.color}}),(0,s.jsx)("span",{className:"truncate max-w-20",children:e.label}),(0,s.jsxs)("span",{className:"text-muted-foreground",children:["(",(100*e.percentage).toFixed(0),"%)"]})]},t)),r.length>8&&(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["+",r.length-8," 更多"]})]})]})}function D(){let[e,M]=(0,t.useState)(null),[D,S]=(0,t.useState)(!0),[$,B]=(0,t.useState)(!1),[q,A]=(0,t.useState)(!1),[H,U]=(0,t.useState)([]),[z,I]=(0,t.useState)(null),L=async()=>{try{S(!0);let[e,s]=await Promise.all([n.statsApi.getOverview(),n.usageStatsApi.getRecent(50)]);M(e?.data||null),U(s?.data||[])}catch(e){x.toast.error("加载统计数据失败"),console.error(e)}finally{S(!1)}};(0,t.useEffect)(()=>{L()},[]);let O=async()=>{A(!0);try{await n.statsApi.reset(),x.toast.success("统计数据已重置"),B(!1),L()}catch(e){x.toast.error("重置失败")}finally{A(!1)}};return D?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(d.Skeleton,{className:"h-8 w-32"}),(0,s.jsx)(d.Skeleton,{className:"h-10 w-24"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"p-6",children:(0,s.jsx)(d.Skeleton,{className:"h-20 w-full"})})},t))})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"使用统计"}),(0,s.jsxs)("p",{className:"text-muted-foreground text-sm",children:["运行 ",e?.uptime.days||0," 天 ",e?.uptime.hours||0," 小时"]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(l.Button,{variant:"outline",onClick:L,children:[(0,s.jsx)(o.RefreshCw,{className:"mr-2 h-4 w-4"}),"刷新"]}),(0,s.jsxs)(l.Button,{variant:"destructive",onClick:()=>B(!0),children:[(0,s.jsx)(g.Trash2,{className:"mr-2 h-4 w-4"}),"重置"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:(0,s.jsx)(h.MessageSquare,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"消息总数"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:w(e?.messages.total||0)}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e?.messages.conversations||0," 个对话"]})]})]})})}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:(0,s.jsx)(m.Bot,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"模型调用"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:w(e?.models.totalCalls||0)}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e?.models.byModel?.length||0," 个模型"]})]})]})})}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-lg",children:(0,s.jsx)(p.TrendingUp,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Tokens 消耗"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:w(e?.tokens.totalSum||0)}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["入 ",w(e?.tokens.total?.input||0)," / 出"," ",w(e?.tokens.total?.output||0)]})]})]})})}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"p-3 bg-orange-100 dark:bg-orange-900 rounded-lg",children:(0,s.jsx)(u.Wrench,{className:"h-6 w-6 text-orange-600 dark:text-orange-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"工具调用"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:w(e?.tools.totalCalls||0)}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e?.tools.byTool?.length||0," 个工具"]})]})]})})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Bot,{className:"h-5 w-5"}),"模型使用统计"]}),(0,s.jsx)(a.CardDescription,{children:"按调用次数排序"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(i.ScrollArea,{className:"h-[300px]",children:e?.models.byModel&&e.models.byModel.length>0?(0,s.jsx)("div",{className:"space-y-3",children:e.models.byModel.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium truncate",children:e.name.split("/").pop()}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["成功 ",e.success," / 失败 ",e.failed]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"font-bold",children:[e.calls," 次"]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[w(e.inputTokens+e.outputTokens)," tokens"]})]})]},t))}):(0,s.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"暂无数据"})})})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(u.Wrench,{className:"h-5 w-5"}),"工具使用统计"]}),(0,s.jsx)(a.CardDescription,{children:"按调用次数排序"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(i.ScrollArea,{className:"h-[300px]",children:e?.tools.byTool&&e.tools.byTool.length>0?(0,s.jsx)("div",{className:"space-y-3",children:e.tools.byTool.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium truncate",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["成功率"," ",e.calls>0?Math.round(e.success/e.calls*100):0,"%"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"font-bold",children:[e.calls," 次"]}),(0,s.jsx)(r.Badge,{variant:e.failed>0?"destructive":"secondary",className:"text-xs",children:e.failed>0?`${e.failed} 失败`:"全部成功"})]})]},t))}):(0,s.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"暂无数据"})})})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(f,{className:"h-5 w-5"}),"消息类型分布"]}),(0,s.jsx)(a.CardDescription,{children:"按类型统计的消息数量"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(T,{data:Object.entries(e?.messages.types||{}).sort((e,s)=>s[1]-e[1]).map(([e,s])=>({label:e,value:s})),size:220})})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(f,{className:"h-5 w-5"}),"群组消息分布"]}),(0,s.jsx)(a.CardDescription,{children:"各群组的消息占比"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(T,{data:(e?.messages.topGroups||[]).slice(0,10).map(e=>({label:e.id,value:e.count})),size:220})})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(f,{className:"h-5 w-5"}),"用户消息分布"]}),(0,s.jsx)(a.CardDescription,{children:"各用户的消息占比"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(T,{data:(e?.messages.topUsers||[]).slice(0,10).map(e=>({label:e.id,value:e.count})),size:220})})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(f,{className:"h-5 w-5"}),"Tokens 模型分布"]}),(0,s.jsx)(a.CardDescription,{children:"各模型的 Tokens 消耗占比"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(T,{data:(e?.tokens.byModel||[]).slice(0,10).map(e=>({label:e.name.split("/").pop()||e.name,value:e.total})),size:220})})]}),(0,s.jsxs)(a.Card,{className:"lg:col-span-2",children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(j.Clock,{className:"h-5 w-5"}),"消息时段分布"]}),(0,s.jsx)(a.CardDescription,{children:"24 小时消息分布热力图"})]}),(0,s.jsx)(a.CardContent,{children:e?.messages.hourlyDistribution&&Object.keys(e.messages.hourlyDistribution).length>0?(0,s.jsx)("div",{className:"grid grid-cols-12 gap-1",children:Array.from({length:24},(t,a)=>{let l=e.messages.hourlyDistribution[a]||0,r=l/Math.max(...Object.values(e.messages.hourlyDistribution),1);return(0,s.jsx)("div",{className:"aspect-square rounded flex items-center justify-center text-xs font-medium",style:{backgroundColor:`rgba(59, 130, 246, ${Math.max(.1,r)})`,color:r>.5?"white":"inherit"},title:`${a}:00 - ${l} 条消息`,children:a},a)})}):(0,s.jsx)("p",{className:"text-center text-muted-foreground py-4",children:"暂无数据"})})]}),(0,s.jsxs)(a.Card,{className:"lg:col-span-2",children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(v.Activity,{className:"h-5 w-5"}),"模型请求日志"]}),(0,s.jsx)(a.CardDescription,{children:"最近的模型调用记录（成功仅记录请求，失败记录请求和响应）"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(i.ScrollArea,{className:"h-[400px]",children:H.length>0?(0,s.jsx)("div",{className:"space-y-2",children:H.map(e=>(0,s.jsxs)("div",{className:`p-3 rounded-lg border ${e.success?"bg-muted/30":"bg-red-50 dark:bg-red-950/30 border-red-200 dark:border-red-900"}`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>I(z===e.id?null:e.id),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.success?(0,s.jsx)(C.CheckCircle2,{className:"h-4 w-4 text-green-500"}):(0,s.jsx)(b.XCircle,{className:"h-4 w-4 text-red-500"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:e.model?.split("/").pop()||e.model}),(0,s.jsx)(r.Badge,{variant:"outline",className:"text-xs",children:e.channelName}),(0,s.jsx)(r.Badge,{variant:"secondary",className:"text-xs",children:e.source})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,s.jsxs)("span",{children:[e.duration,"ms"]}),(0,s.jsxs)("span",{children:[w(e.inputTokens+e.outputTokens)," tokens"]}),(0,s.jsx)("span",{children:new Date(e.timestamp).toLocaleTimeString()}),z===e.id?(0,s.jsx)(k.ChevronUp,{className:"h-4 w-4"}):(0,s.jsx)(y.ChevronDown,{className:"h-4 w-4"})]})]}),z===e.id&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t space-y-2 text-sm",children:[e.request&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-xs text-muted-foreground mb-1",children:"请求摘要"}),(0,s.jsxs)("div",{className:"bg-muted/50 p-2 rounded text-xs space-y-1",children:[e.request.messageCount&&(0,s.jsxs)("p",{children:["消息数: ",e.request.messageCount]}),e.request.systemPromptLength&&(0,s.jsxs)("p",{children:["系统提示长度:"," ",e.request.systemPromptLength]}),e.request.lastUserMessage&&(0,s.jsxs)("p",{className:"truncate",children:["最后用户消息: ",e.request.lastUserMessage]}),e.request.hasImages&&(0,s.jsx)(r.Badge,{variant:"outline",className:"text-xs",children:"包含图片"}),e.request.hasTools&&(0,s.jsxs)(r.Badge,{variant:"outline",className:"text-xs",children:["使用工具 (",e.request.toolCount,")"]})]})]}),!e.success&&e.error&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-xs text-red-500 mb-1",children:"错误信息"}),(0,s.jsx)("div",{className:"bg-red-100 dark:bg-red-950/50 p-2 rounded text-xs text-red-700 dark:text-red-300",children:e.error})]}),!e.success&&e.response&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-xs text-red-500 mb-1",children:"响应详情"}),(0,s.jsx)("div",{className:"bg-red-100 dark:bg-red-950/50 p-2 rounded text-xs text-red-700 dark:text-red-300",children:(0,s.jsx)("pre",{className:"whitespace-pre-wrap overflow-auto max-h-32",children:JSON.stringify(e.response,null,2)})})]}),(0,s.jsxs)("div",{className:"flex gap-4 text-xs text-muted-foreground pt-1",children:[e.userId&&(0,s.jsxs)("span",{children:["用户: ",e.userId]}),e.groupId&&(0,s.jsxs)("span",{children:["群组: ",e.groupId]}),(0,s.jsxs)("span",{children:["渠道: ",e.channelId]})]})]})]},e.id))}):(0,s.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"暂无请求记录"})})})]})]}),(0,s.jsx)(c.Dialog,{open:$,onOpenChange:B,children:(0,s.jsxs)(c.DialogContent,{children:[(0,s.jsxs)(c.DialogHeader,{children:[(0,s.jsx)(c.DialogTitle,{children:"确认重置统计"}),(0,s.jsx)(c.DialogDescription,{children:"此操作将清空所有统计数据，包括消息、模型调用、工具调用等记录。此操作不可撤销。"})]}),(0,s.jsxs)(c.DialogFooter,{children:[(0,s.jsx)(l.Button,{variant:"outline",onClick:()=>B(!1),children:"取消"}),(0,s.jsxs)(l.Button,{variant:"destructive",onClick:O,disabled:q,children:[q&&(0,s.jsx)(N.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"确认重置"]})]})]})})]})}e.s(["default",()=>D],30848)}]);