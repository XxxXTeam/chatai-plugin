(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8422,(e,a,s)=>{a.exports=e.r(13765)},79923,e=>{"use strict";let a=(0,e.i(50974).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>a],79923)},87126,e=>{"use strict";var a=e.i(33169),s=e.i(17171);function t({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,s.cn)("bg-accent animate-pulse rounded-md",e),...t})}e.s(["Skeleton",()=>t])},5850,e=>{"use strict";let a=(0,e.i(50974).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>a],5850)},32647,e=>{"use strict";var a=e.i(84548);e.s(["CheckCircle2",()=>a.default])},29720,e=>{"use strict";let a=(0,e.i(50974).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>a],29720)},60381,e=>{"use strict";let a=(0,e.i(50974).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>a],60381)},15204,e=>{"use strict";let a=(0,e.i(50974).default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);e.s(["Sparkles",()=>a],15204)},82251,e=>{"use strict";let a=(0,e.i(50974).default)("gamepad-2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]);e.s(["Gamepad2",()=>a],82251)},9831,e=>{"use strict";let a=(0,e.i(50974).default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>a],9831)},27691,e=>{"use strict";let a=(0,e.i(50974).default)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]);e.s(["Heart",()=>a],27691)},35908,e=>{"use strict";let a=(0,e.i(50974).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>a],35908)},82333,e=>{"use strict";var a=e.i(33169),s=e.i(8422),t=e.i(60844),r=e.i(51200),l=e.i(72029),i=e.i(30243),c=e.i(99573),n=e.i(20650),d=e.i(13107),o=e.i(87126),m=e.i(47686),x=e.i(79342),h=e.i(82251),u=e.i(79923),p=e.i(9831),j=e.i(5850),g=e.i(60381),f=e.i(32647),y=e.i(29720),k=e.i(35908),N=e.i(27691),v=e.i(15204),b=e.i(89908);let w={name:"角色名",world:"世界观",identity:"身份",personality:"性格",likes:"喜好",dislikes:"厌恶",background:"背景故事",secret:"秘密",scene:"当前场景",meetingReason:"相遇原因",greeting:"开场白",summary:"前情提要",relationship:"关系"},C={name:(0,a.jsx)(y.User,{className:"h-4 w-4"}),world:(0,a.jsx)(k.MapPin,{className:"h-4 w-4"}),personality:(0,a.jsx)(v.Sparkles,{className:"h-4 w-4"}),relationship:(0,a.jsx)(N.Heart,{className:"h-4 w-4"})};function S(){let e,y,k=(0,s.useSearchParams)().get("code"),[N,v]=(0,t.useState)(!0),[S,M]=(0,t.useState)(!1),[T,I]=(0,t.useState)(""),[A,H]=(0,t.useState)(!1),[_,z]=(0,t.useState)(null),[B,L]=(0,t.useState)(null),[P,U]=(0,t.useState)({}),[$,F]=(0,t.useState)(!1),[q,D]=(0,t.useState)(!1),[E,O]=(0,t.useState)(0),G=(0,t.useCallback)(async e=>{try{let a=await fetch("/chatai/api/game-edit/session",{headers:{Authorization:`Bearer ${e}`}});if(!a.ok){if(401===a.status){localStorage.removeItem("game_edit_token"),M(!0),v(!1);return}throw Error("加载失败")}let s=await a.json();if(0===s.code)L(s.data),U(s.data.gameData||{}),O(s.data.remainingTime),M(!1);else throw Error(s.message)}catch(e){z(e.message||"加载失败")}finally{v(!1)}},[]),K=(0,t.useCallback)(async e=>{v(!0);try{let a=await fetch("/chatai/api/game-edit/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e.trim()})}),s=await a.json();0===s.code?(localStorage.setItem("game_edit_token",s.data.token),x.toast.success("登录成功"),G(s.data.token)):(x.toast.error(s.message||"编辑码无效或已过期"),M(!0),v(!1))}catch{x.toast.error("登录失败，请检查网络"),M(!0),v(!1)}},[G]);(0,t.useEffect)(()=>{if(k){window.history.replaceState({},"","/chatai/game-edit"),K(k);return}let e=localStorage.getItem("game_edit_token");if(!e){M(!0),v(!1);return}G(e)},[k,K,G]),(0,t.useEffect)(()=>{if(E<=0)return;let e=setInterval(()=>{O(a=>a<=1e3?(clearInterval(e),z("编辑会话已过期"),0):a-1e3)},1e3);return()=>clearInterval(e)},[E]);let R=(e,a)=>{U(s=>({...s,environment:{...s.environment,[e]:a}}))},V=async()=>{T.trim()?(H(!0),await K(T),H(!1)):x.toast.error("请输入编辑码")},J=async()=>{if(B){F(!0);try{let e=await fetch("/chatai/api/game-edit/session",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("game_edit_token")||""}`},body:JSON.stringify({updates:P})}),a=await e.json();if(0!==a.code)return void x.toast.error(a.message||"提交失败");D(!0),localStorage.removeItem("game_edit_token"),x.toast.success("编辑已提交！请返回游戏查看更新")}catch{x.toast.error("网络错误")}finally{F(!1)}}};return N?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-900 dark:to-purple-900 p-4",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto space-y-4",children:[(0,a.jsx)(o.Skeleton,{className:"h-12 w-48"}),(0,a.jsx)(o.Skeleton,{className:"h-64 w-full"})]})}):_?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-900 dark:to-purple-900 flex items-center justify-center p-4",children:(0,a.jsx)(r.Card,{className:"max-w-md w-full",children:(0,a.jsxs)(r.CardContent,{className:"pt-6 text-center",children:[(0,a.jsx)(g.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"无法加载"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:_})]})})}):S?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-900 dark:to-purple-900",children:(0,a.jsxs)("div",{className:"w-full max-w-md space-y-4",children:[(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto p-3 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 w-fit mb-2",children:(0,a.jsx)(h.Gamepad2,{className:"h-6 w-6 text-white"})}),(0,a.jsx)(r.CardTitle,{children:"游戏信息编辑"}),(0,a.jsx)(r.CardDescription,{children:"输入编辑码以访问编辑页面"})]}),(0,a.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,a.jsx)(i.Input,{value:T,onChange:e=>I(e.target.value),onKeyDown:e=>"Enter"===e.key&&V(),placeholder:"输入编辑码（UUID格式）",className:"text-center font-mono",autoFocus:!0}),(0,a.jsxs)(l.Button,{className:"w-full bg-purple-600 hover:bg-purple-700",onClick:V,disabled:A,children:[A&&(0,a.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"进入编辑"]})]})]}),(0,a.jsx)(r.Card,{className:"bg-muted/50",children:(0,a.jsxs)(r.CardContent,{className:"pt-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[(0,a.jsx)(g.AlertCircle,{className:"h-4 w-4 text-muted-foreground"}),"如何获取编辑码？"]}),(0,a.jsxs)("ol",{className:"text-xs text-muted-foreground space-y-1 list-decimal list-inside",children:[(0,a.jsxs)("li",{children:["在游戏群中发送 ",(0,a.jsx)("code",{className:"bg-background px-1 py-0.5 rounded border",children:"#游戏在线编辑"})]}),(0,a.jsx)("li",{children:"Bot 将私聊发送编辑链接或编辑码"}),(0,a.jsxs)("li",{children:["编辑码有效期为 ",(0,a.jsx)("strong",{children:"30分钟"})]})]})]})})]})}):q?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 dark:from-gray-900 dark:to-emerald-900 flex items-center justify-center p-4",children:(0,a.jsx)(r.Card,{className:"max-w-md w-full",children:(0,a.jsxs)(r.CardContent,{className:"pt-6 text-center",children:[(0,a.jsx)(f.CheckCircle2,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"编辑已提交"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"请返回游戏查看更新后的信息"})]})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-900 dark:to-purple-900 p-4",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto space-y-4",children:[(0,a.jsx)(r.Card,{children:(0,a.jsx)(r.CardHeader,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500",children:(0,a.jsx)(h.Gamepad2,{className:"h-5 w-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(r.CardTitle,{children:"游戏信息编辑"}),(0,a.jsx)(r.CardDescription,{children:"编辑你的游戏角色和环境设定"})]})]}),(0,a.jsxs)(d.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(u.Clock,{className:"h-3 w-3"}),(e=Math.floor(E/6e4),y=Math.floor(E%6e4/1e3),`${e}:${y.toString().padStart(2,"0")}`)]})]})})}),(0,a.jsxs)(r.Card,{children:[(0,a.jsx)(r.CardHeader,{children:(0,a.jsx)(r.CardTitle,{className:"text-base",children:"角色设定"})}),(0,a.jsx)(r.CardContent,{children:(0,a.jsx)(m.ScrollArea,{className:"max-h-[50vh]",children:(0,a.jsx)("div",{className:"space-y-4 pr-4",children:B?.editableFields.environment.map(e=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(c.Label,{className:"flex items-center gap-2",children:[C[e],w[e]||e]}),["background","summary","greeting","scene"].includes(e)?(0,a.jsx)(n.Textarea,{value:P.environment?.[e]||"",onChange:a=>R(e,a.target.value),placeholder:`输入${w[e]||e}...`,rows:3}):(0,a.jsx)(i.Input,{value:P.environment?.[e]||"",onChange:a=>R(e,a.target.value),placeholder:`输入${w[e]||e}...`})]},e))})})})]}),(0,a.jsxs)(r.Card,{className:"border-dashed",children:[(0,a.jsx)(r.CardHeader,{className:"pb-2",children:(0,a.jsxs)(r.CardTitle,{className:"text-sm flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)(p.Lock,{className:"h-4 w-4"}),"受保护的信息（只读）"]})}),(0,a.jsx)(r.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"好感度:"}),(0,a.jsx)("span",{children:P.session?.affection??"???"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"信任度:"}),(0,a.jsx)("span",{children:P.session?.trust??"???"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"金币:"}),(0,a.jsx)("span",{children:P.session?.gold??"???"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"秘密:"}),(0,a.jsx)("span",{className:"text-muted-foreground italic",children:"隐藏"})]})]})})]}),B?.editableFields.session.length>0&&(0,a.jsxs)(r.Card,{children:[(0,a.jsx)(r.CardHeader,{children:(0,a.jsx)(r.CardTitle,{className:"text-base",children:"会话设定"})}),(0,a.jsx)(r.CardContent,{className:"space-y-4",children:B.editableFields.session.map(e=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(c.Label,{className:"flex items-center gap-2",children:[C[e],w[e]||e]}),(0,a.jsx)(i.Input,{value:P.session?.[e]||"",onChange:a=>{var s;return s=a.target.value,void U(a=>({...a,session:{...a.session,[e]:s}}))},placeholder:`输入${w[e]||e}...`})]},e))})]}),(0,a.jsx)(l.Button,{className:"w-full",size:"lg",onClick:J,disabled:$||E<=0,children:$?(0,a.jsx)(a.Fragment,{children:"保存中..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Save,{className:"mr-2 h-4 w-4"}),"提交编辑"]})})]})})}function M(){return(0,a.jsx)(t.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-900 dark:to-purple-900 p-4",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto space-y-4",children:[(0,a.jsx)(o.Skeleton,{className:"h-12 w-48"}),(0,a.jsx)(o.Skeleton,{className:"h-64 w-full"})]})}),children:(0,a.jsx)(S,{})})}e.s(["default",()=>M])}]);