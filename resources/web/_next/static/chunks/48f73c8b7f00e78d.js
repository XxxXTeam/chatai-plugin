(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,43698,e=>{"use strict";var a=e.i(52542),s=e.i(40418),i=e.i(51200),t=e.i(72029),l=e.i(30243),n=e.i(99573),r=e.i(13107),d=e.i(20308),o=e.i(20650),c=e.i(84519),m=e.i(10201),h=e.i(94518),x=e.i(79342),b=e.i(60381),u=e.i(89908),p=e.i(40204),g=e.i(96173),j=e.i(15204),y=e.i(63959),v=e.i(97058),f=e.i(98858),N=e.i(74940),C=e.i(17286),w=e.i(10273),S=e.i(44697),k=e.i(14775),E=e.i(70620),P=e.i(32308),T=e.i(79923),I=e.i(77759),M=e.i(10148),L=e.i(57345),_=e.i(64775),B=e.i(36393),G=e.i(72024),U=e.i(35771),R=e.i(60713),z=e.i(17171),K=e.i(91132),V=e.i(13795);function A({value:e,onChange:s,className:i}){return(0,a.jsxs)(m.Select,{value:e,onValueChange:s,children:[(0,a.jsx)(m.SelectTrigger,{className:(0,z.cn)("w-24",i),children:(0,a.jsx)(m.SelectValue,{})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"inherit",children:"继承"}),(0,a.jsx)(m.SelectItem,{value:"on",children:"开启"}),(0,a.jsx)(m.SelectItem,{value:"off",children:"关闭"})]})]})}function D({icon:e,title:s,desc:i,value:t,onChange:l,children:n}){return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"p-2 rounded-md bg-muted shrink-0",children:e}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium truncate",children:s}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:i})]})]}),(0,a.jsx)(A,{value:t,onChange:l})]}),n&&"off"!==t&&(0,a.jsx)("div",{className:"ml-4 pl-4 border-l-2 border-muted space-y-3",children:n})]})}function Q({label:e,value:s,models:i,onChange:t}){return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:e}),(0,a.jsxs)(m.Select,{value:s||"__default__",onValueChange:e=>t("__default__"===e?"":e),children:[(0,a.jsx)(m.SelectTrigger,{children:(0,a.jsx)(m.SelectValue,{placeholder:"继承全局"})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"__default__",children:"继承全局"}),i.map(e=>(0,a.jsx)(m.SelectItem,{value:e,children:e},e))]})]})]})}function q({value:e,onChange:s,label:i="响应概率"}){let t="inherit"===e?1:e;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:i}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[Math.round(100*t),"%"]})]}),(0,a.jsx)(c.Slider,{value:[t],onValueChange:([e])=>s(e),min:0,max:1,step:.05})]})}function O(){let e=(0,K.useIsMobile)(),[c,O]=(0,s.useState)(!0),[F,H]=(0,s.useState)(!1),[$,J]=(0,s.useState)(""),[X,Z]=(0,s.useState)(""),[W,Y]=(0,s.useState)("basic"),[ee,ea]=(0,s.useState)(!1),[es,ei]=(0,s.useState)(""),[et,el]=(0,s.useState)(!1),[en,er]=(0,s.useState)([]),[ed,eo]=(0,s.useState)([]),[ec,em]=(0,s.useState)([]),[eh,ex]=(0,s.useState)({total:0,images:[]}),[eb,eu]=(0,s.useState)({groupId:"",groupName:"",presetId:"__default__",systemPrompt:"",enabled:!0,triggerMode:"default",customPrefix:"",toolsEnabled:"inherit",imageGenEnabled:"inherit",imageGenModel:"",imageGenSize:"1024x1024",imageGenQuality:"standard",imageGenDailyLimit:0,summaryEnabled:"inherit",summaryModel:"",eventEnabled:"inherit",emojiThiefEnabled:"inherit",emojiThiefSeparateFolder:!0,emojiThiefMaxCount:500,emojiThiefStealRate:1,emojiThiefTriggerRate:.05,emojiThiefTriggerMode:"off",bymEnabled:"inherit",bymPresetId:"__default__",bymPrompt:"",bymProbability:"inherit",bymModel:"",bymTemperature:"inherit",bymMaxTokens:"inherit",bymReplyLength:"medium",bymUseEmoji:!0,proactiveChatEnabled:"inherit",proactiveChatProbability:"inherit",proactiveChatCooldown:"inherit",proactiveChatMaxDaily:"inherit",proactiveChatMinMessages:5,proactiveChatTimeStart:8,proactiveChatTimeEnd:23,chatEnabled:!0,chatContextLength:20,chatStreamReply:!0,chatQuoteReply:!1,chatShowThinking:!0,chatModel:"",listMode:"none",blacklist:[],whitelist:[],summaryPushEnabled:!1,summaryPushIntervalType:"day",summaryPushIntervalValue:1,summaryPushHour:20,summaryPushMessageCount:100,welcomeEnabled:"inherit",welcomeMessage:"",welcomePrompt:"",welcomeProbability:"inherit",goodbyeEnabled:"inherit",goodbyePrompt:"",goodbyeProbability:"inherit",pokeEnabled:"inherit",pokeBack:!1,pokeProbability:"inherit",recallEnabled:"inherit",recallProbability:"inherit",banEnabled:"inherit",banProbability:"inherit",luckyKingEnabled:"inherit",luckyKingProbability:"inherit",honorEnabled:"inherit",honorProbability:"inherit",essenceEnabled:"inherit",essenceProbability:"inherit",adminEnabled:"inherit",adminProbability:"inherit",knowledgeIds:[],independentChannelEnabled:!1,independentBaseUrl:"",independentApiKey:"",independentAdapterType:"openai",independentChannels:[],dailyGroupLimit:0,dailyUserLimit:0,usageLimitMessage:""}),[ep,eg]=(0,s.useState)(!1),[ej,ey]=(0,s.useState)(null),[ev,ef]=(0,s.useState)({name:"",baseUrl:"",apiKey:"",adapterType:"openai",models:"",enabled:!0,priority:0,modelsPath:"",chatPath:"",imageTransferMode:"auto",imageCompress:!0,imageQuality:85,imageMaxSize:4096}),[eN,eC]=(0,s.useState)(null),ew=()=>localStorage.getItem("group_admin_token")||"",eS=(0,s.useCallback)(async e=>{O(!0);try{let a=await fetch("/api/group-admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e.toUpperCase()})}),s=await a.json();0===s.code?(localStorage.setItem("group_admin_token",s.data.token),x.toast.success("登录成功"),ek(s.data.token)):(x.toast.error(s.message||"登录码无效或已过期"),ea(!0),O(!1))}catch{x.toast.error("登录失败，请检查网络"),ea(!0),O(!1)}},[]),ek=(0,s.useCallback)(async e=>{try{let a=await fetch("/api/group-admin/config",{headers:{Authorization:`Bearer ${e||ew()}`}});if(!a.ok){if(401===a.status){localStorage.removeItem("group_admin_token"),ea(!0),O(!1);return}throw Error("加载配置失败")}let s=await a.json();if(0===s.code){let e=s.data;J(e.groupId),er(e.presets||[]);let a=new Set;e.channels?.forEach(e=>{e.models?.forEach(e=>a.add(e))}),eo(Array.from(a).sort()),e.knowledgeBases&&em(e.knowledgeBases),e.emojiStats&&ex(e.emojiStats),eu(a=>({...a,groupId:e.groupId,groupName:e.groupName||"",presetId:e.presetId||"__default__",systemPrompt:e.systemPrompt||"",enabled:!1!==e.enabled,triggerMode:e.triggerMode||"default",customPrefix:e.customPrefix||"",toolsEnabled:void 0===e.toolsEnabled?"inherit":e.toolsEnabled?"on":"off",imageGenEnabled:void 0===e.imageGenEnabled?"inherit":e.imageGenEnabled?"on":"off",imageGenModel:e.models?.image||"",summaryEnabled:void 0===e.summaryEnabled?"inherit":e.summaryEnabled?"on":"off",summaryModel:e.models?.summary||"",eventEnabled:void 0===e.eventHandler?"inherit":e.eventHandler?"on":"off",emojiThiefEnabled:e.emojiThief?.enabled===void 0?"inherit":e.emojiThief.enabled?"on":"off",emojiThiefSeparateFolder:e.emojiThief?.independent??!0,emojiThiefMaxCount:e.emojiThief?.maxCount??500,emojiThiefStealRate:(e.emojiThief?.probability??100)/100,emojiThiefTriggerRate:(e.emojiThief?.triggerRate??5)/100,emojiThiefTriggerMode:e.emojiThief?.triggerMode||"off",bymEnabled:e.bym?.enabled===void 0?"inherit":e.bym.enabled?"on":"off",bymPresetId:e.bym?.presetId||"__default__",bymPrompt:e.bym?.prompt||"",bymProbability:e.bym?.probability??"inherit",bymModel:e.bym?.modelId||"",bymTemperature:e.bym?.temperature??"inherit",bymMaxTokens:e.bym?.maxTokens??"inherit",bymReplyLength:e.bym?.style?.replyLength||"medium",bymUseEmoji:e.bym?.style?.useEmoji??!0,proactiveChatEnabled:e.bym?.proactive?.enabled===void 0?"inherit":e.bym.proactive.enabled?"on":"off",proactiveChatProbability:e.bym?.proactive?.probability??"inherit",proactiveChatCooldown:e.bym?.proactive?.cooldown??"inherit",proactiveChatMaxDaily:e.bym?.proactive?.maxDaily??"inherit",proactiveChatMinMessages:e.bym?.proactive?.minMessages??5,proactiveChatTimeStart:e.bym?.proactive?.timeRange?.start??8,proactiveChatTimeEnd:e.bym?.proactive?.timeRange?.end??23,chatEnabled:e.chat?.enabled??!0,chatContextLength:e.chat?.contextLength??20,chatStreamReply:e.chat?.streamReply??!0,chatQuoteReply:e.chat?.quoteReply??!1,chatShowThinking:e.chat?.showThinking??!0,chatModel:e.models?.chat||"",listMode:e.listMode||"none",blacklist:e.blacklist||[],whitelist:e.whitelist||[],summaryPushEnabled:e.summary?.push?.enabled||!1,summaryPushIntervalType:e.summary?.push?.intervalType||"day",summaryPushIntervalValue:e.summary?.push?.intervalValue||1,summaryPushHour:e.summary?.push?.pushHour??20,summaryPushMessageCount:e.summary?.push?.messageCount||100,welcomeEnabled:e.events?.welcome?.enabled===void 0?"inherit":e.events.welcome.enabled?"on":"off",welcomeMessage:e.events?.welcome?.message||"",welcomePrompt:e.events?.welcome?.prompt||"",welcomeProbability:e.events?.welcome?.probability??"inherit",goodbyeEnabled:e.events?.goodbye?.enabled===void 0?"inherit":e.events.goodbye.enabled?"on":"off",goodbyePrompt:e.events?.goodbye?.prompt||"",goodbyeProbability:e.events?.goodbye?.probability??"inherit",pokeEnabled:e.events?.poke?.enabled===void 0?"inherit":e.events.poke.enabled?"on":"off",pokeBack:e.events?.poke?.pokeBack||!1,pokeProbability:e.events?.poke?.probability??"inherit",recallEnabled:e.events?.recall?.enabled===void 0?"inherit":e.events.recall.enabled?"on":"off",recallProbability:e.events?.recall?.probability??"inherit",banEnabled:e.events?.ban?.enabled===void 0?"inherit":e.events.ban.enabled?"on":"off",banProbability:e.events?.ban?.probability??"inherit",luckyKingEnabled:e.events?.luckyKing?.enabled===void 0?"inherit":e.events.luckyKing.enabled?"on":"off",luckyKingProbability:e.events?.luckyKing?.probability??"inherit",honorEnabled:e.events?.honor?.enabled===void 0?"inherit":e.events.honor.enabled?"on":"off",honorProbability:e.events?.honor?.probability??"inherit",essenceEnabled:e.events?.essence?.enabled===void 0?"inherit":e.events.essence.enabled?"on":"off",essenceProbability:e.events?.essence?.probability??"inherit",adminEnabled:e.events?.admin?.enabled===void 0?"inherit":e.events.admin.enabled?"on":"off",adminProbability:e.events?.admin?.probability??"inherit",knowledgeIds:e.knowledgeIds||[],imageGenSize:e.imageGen?.size||"1024x1024",imageGenQuality:e.imageGen?.quality||"standard",imageGenDailyLimit:e.imageGen?.maxDailyLimit??0,independentChannelEnabled:e.independentChannel?.hasChannel||!1,independentBaseUrl:e.independentChannel?.baseUrl||"",independentApiKey:e.independentChannel?.apiKey||"",independentAdapterType:e.independentChannel?.adapterType||"openai",independentChannels:e.independentChannel?.channels||[],dailyGroupLimit:e.usageLimit?.dailyGroupLimit||0,dailyUserLimit:e.usageLimit?.dailyUserLimit||0,usageLimitMessage:e.usageLimit?.limitMessage||""}))}}catch(e){Z(e.message)}finally{O(!1)}},[]);(0,s.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("code");if(e){window.history.replaceState({},"","/group-admin"),eS(e);return}let a=localStorage.getItem("group_admin_token");if(!a){ea(!0),O(!1);return}ek(a)},[eS,ek]);let eE=async()=>{if(!es.trim())return void x.toast.error("请输入登录码");el(!0);try{let e=await fetch("/api/group-admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:es.trim().toUpperCase()})}),a=await e.json();0===a.code?(localStorage.setItem("group_admin_token",a.data.token),ea(!1),ei(""),x.toast.success("登录成功"),ek(a.data.token)):x.toast.error(a.message||"登录失败")}catch{x.toast.error("登录失败")}finally{el(!1)}},eP=async()=>{H(!0);try{let e=await fetch("/api/group-admin/config",{method:"PUT",headers:{Authorization:`Bearer ${ew()}`,"Content-Type":"application/json"},body:JSON.stringify({groupName:eb.groupName,systemPrompt:eb.systemPrompt||null,presetId:"__default__"===eb.presetId?"":eb.presetId,enabled:eb.enabled,triggerMode:eb.triggerMode,customPrefix:eb.customPrefix||void 0,toolsEnabled:"inherit"===eb.toolsEnabled?void 0:"on"===eb.toolsEnabled,imageGenEnabled:"inherit"===eb.imageGenEnabled?void 0:"on"===eb.imageGenEnabled,summaryEnabled:"inherit"===eb.summaryEnabled?void 0:"on"===eb.summaryEnabled,eventHandler:"inherit"===eb.eventEnabled?void 0:"on"===eb.eventEnabled,emojiThief:{enabled:"inherit"===eb.emojiThiefEnabled?void 0:"on"===eb.emojiThiefEnabled,independent:eb.emojiThiefSeparateFolder,maxCount:eb.emojiThiefMaxCount,probability:Math.round(100*eb.emojiThiefStealRate),triggerRate:Math.round(100*eb.emojiThiefTriggerRate),triggerMode:eb.emojiThiefTriggerMode},bym:{enabled:"inherit"===eb.bymEnabled?void 0:"on"===eb.bymEnabled,presetId:"__default__"===eb.bymPresetId?void 0:eb.bymPresetId,prompt:eb.bymPrompt||void 0,probability:"inherit"===eb.bymProbability?void 0:eb.bymProbability,modelId:eb.bymModel||void 0,temperature:"inherit"===eb.bymTemperature?void 0:eb.bymTemperature,maxTokens:"inherit"===eb.bymMaxTokens?void 0:eb.bymMaxTokens,proactive:{enabled:"inherit"===eb.proactiveChatEnabled?void 0:"on"===eb.proactiveChatEnabled,probability:"inherit"===eb.proactiveChatProbability?void 0:eb.proactiveChatProbability,cooldown:"inherit"===eb.proactiveChatCooldown?void 0:eb.proactiveChatCooldown,maxDaily:"inherit"===eb.proactiveChatMaxDaily?void 0:eb.proactiveChatMaxDaily,minMessages:eb.proactiveChatMinMessages,timeRange:{start:eb.proactiveChatTimeStart,end:eb.proactiveChatTimeEnd}},style:{replyLength:eb.bymReplyLength,useEmoji:eb.bymUseEmoji}},chat:{enabled:eb.chatEnabled,contextLength:eb.chatContextLength,streamReply:eb.chatStreamReply,quoteReply:eb.chatQuoteReply,showThinking:eb.chatShowThinking},imageGen:{enabled:"inherit"===eb.imageGenEnabled?void 0:"on"===eb.imageGenEnabled,modelId:eb.imageGenModel||void 0,size:eb.imageGenSize,quality:eb.imageGenQuality,maxDailyLimit:eb.imageGenDailyLimit},models:{chat:eb.chatModel||void 0,summary:eb.summaryModel||void 0},listMode:eb.listMode,blacklist:eb.blacklist,whitelist:eb.whitelist,summary:{enabled:"inherit"===eb.summaryEnabled?void 0:"on"===eb.summaryEnabled,modelId:eb.summaryModel||void 0,push:{enabled:eb.summaryPushEnabled,intervalType:eb.summaryPushIntervalType,intervalValue:eb.summaryPushIntervalValue,pushHour:eb.summaryPushHour,messageCount:eb.summaryPushMessageCount}},events:{enabled:"inherit"===eb.eventEnabled?void 0:"on"===eb.eventEnabled,welcome:{enabled:"inherit"===eb.welcomeEnabled?void 0:"on"===eb.welcomeEnabled,message:eb.welcomeMessage||void 0,prompt:eb.welcomePrompt||void 0,probability:"inherit"===eb.welcomeProbability?void 0:eb.welcomeProbability},goodbye:{enabled:"inherit"===eb.goodbyeEnabled?void 0:"on"===eb.goodbyeEnabled,prompt:eb.goodbyePrompt||void 0,probability:"inherit"===eb.goodbyeProbability?void 0:eb.goodbyeProbability},poke:{enabled:"inherit"===eb.pokeEnabled?void 0:"on"===eb.pokeEnabled,pokeBack:eb.pokeBack,probability:"inherit"===eb.pokeProbability?void 0:eb.pokeProbability},recall:{enabled:"inherit"===eb.recallEnabled?void 0:"on"===eb.recallEnabled,probability:"inherit"===eb.recallProbability?void 0:eb.recallProbability},ban:{enabled:"inherit"===eb.banEnabled?void 0:"on"===eb.banEnabled,probability:"inherit"===eb.banProbability?void 0:eb.banProbability},luckyKing:{enabled:"inherit"===eb.luckyKingEnabled?void 0:"on"===eb.luckyKingEnabled,probability:"inherit"===eb.luckyKingProbability?void 0:eb.luckyKingProbability},honor:{enabled:"inherit"===eb.honorEnabled?void 0:"on"===eb.honorEnabled,probability:"inherit"===eb.honorProbability?void 0:eb.honorProbability},essence:{enabled:"inherit"===eb.essenceEnabled?void 0:"on"===eb.essenceEnabled,probability:"inherit"===eb.essenceProbability?void 0:eb.essenceProbability},admin:{enabled:"inherit"===eb.adminEnabled?void 0:"on"===eb.adminEnabled,probability:"inherit"===eb.adminProbability?void 0:eb.adminProbability}},independentChannel:{baseUrl:eb.independentBaseUrl||void 0,apiKey:eb.independentApiKey||void 0,adapterType:eb.independentAdapterType,channels:eb.independentChannels.length>0?eb.independentChannels:void 0},usageLimit:{dailyGroupLimit:eb.dailyGroupLimit,dailyUserLimit:eb.dailyUserLimit,limitMessage:eb.usageLimitMessage||void 0},knowledgeIds:eb.knowledgeIds.length>0?eb.knowledgeIds:void 0})});if(!e.ok){if(401===e.status)return void Z("认证已过期");throw Error("保存失败")}let a=await e.json();if(0===a.code)x.toast.success("配置已保存");else throw Error(a.message||"保存失败")}catch(e){x.toast.error(e.message)}finally{H(!1)}},eT=async e=>{if(confirm("确定要删除这个表情吗？"))try{(await fetch(`/api/group-admin/emoji/delete?file=${encodeURIComponent(e)}`,{method:"DELETE",headers:{Authorization:`Bearer ${ew()}`}})).ok&&(x.toast.success("已删除"),ex({...eh,total:eh.total-1,images:eh.images.filter(a=>a.name!==e)}))}catch{x.toast.error("删除失败")}},eI=async()=>{if(confirm("确定要清空所有表情吗？"))try{(await fetch("/api/group-admin/emoji/clear",{method:"DELETE",headers:{Authorization:`Bearer ${ew()}`}})).ok&&(x.toast.success("已清空"),ex({total:0,images:[]}))}catch{x.toast.error("清空失败")}},eM=[{id:"basic",label:"基础设置",mobileLabel:"基础",icon:(0,a.jsx)(p.Settings,{className:"h-4 w-4"})},{id:"features",label:"功能开关",mobileLabel:"功能",icon:(0,a.jsx)(g.Zap,{className:"h-4 w-4"})},{id:"bym",label:"伪人模式",mobileLabel:"伪人",icon:(0,a.jsx)(j.Sparkles,{className:"h-4 w-4"})},{id:"channel",label:"对话设置",mobileLabel:"对话",icon:(0,a.jsx)(w.MessageSquare,{className:"h-4 w-4"})},{id:"advanced",label:"高级配置",mobileLabel:"高级",icon:(0,a.jsx)(y.BookOpen,{className:"h-4 w-4"})}];return c?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)(u.Loader2,{className:"h-8 w-8 animate-spin text-primary"})}):ee?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-background via-orange-50/30 dark:via-orange-950/10 to-muted",children:(0,a.jsxs)("div",{className:"w-full max-w-md space-y-4",children:[(0,a.jsx)(i.Card,{className:"border-orange-200/50 dark:border-orange-900/30",children:(0,a.jsxs)(i.CardContent,{className:"p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(P.Users,{className:"h-8 w-8 text-orange-600 dark:text-orange-400"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"群管理面板"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"专属于群管理员的配置入口"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(l.Input,{value:es,onChange:e=>ei(e.target.value.toUpperCase()),onKeyDown:e=>"Enter"===e.key&&eE(),placeholder:"输入6位登录码",maxLength:6,className:"text-center text-xl tracking-wider font-mono h-12 border-orange-200 dark:border-orange-900/50 focus-visible:ring-orange-500",autoFocus:!0}),(0,a.jsxs)(t.Button,{className:"w-full h-11 bg-orange-600 hover:bg-orange-700",onClick:eE,disabled:et,children:[et&&(0,a.jsx)(u.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"登录管理面板"]})]})]})}),(0,a.jsx)(i.Card,{className:"bg-muted/50",children:(0,a.jsxs)(i.CardContent,{className:"p-4 space-y-3",children:[(0,a.jsxs)("h3",{className:"font-medium text-sm flex items-center gap-2",children:[(0,a.jsx)(w.MessageSquare,{className:"h-4 w-4 text-orange-600"}),"如何获取登录码？"]}),(0,a.jsxs)("ol",{className:"text-xs text-muted-foreground space-y-2 list-decimal list-inside",children:[(0,a.jsxs)("li",{children:["确保您是目标群的 ",(0,a.jsx)("strong",{children:"管理员"})," 或 ",(0,a.jsx)("strong",{children:"群主"})]}),(0,a.jsxs)("li",{children:["在群内发送命令 ",(0,a.jsx)("code",{className:"bg-background px-1.5 py-0.5 rounded border",children:"#群管理面板"})]}),(0,a.jsx)("li",{children:"Bot 将私聊发送登录码或直接链接"}),(0,a.jsxs)("li",{children:["登录码有效期为 ",(0,a.jsx)("strong",{children:"5分钟"}),"，请尽快使用"]})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-card p-2.5 rounded-lg border",children:[(0,a.jsx)(p.Settings,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"设置群专属人设"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-card p-2.5 rounded-lg border",children:[(0,a.jsx)(g.Zap,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"管理功能开关"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-card p-2.5 rounded-lg border",children:[(0,a.jsx)(E.Bot,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"配置伪人模式"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-card p-2.5 rounded-lg border",children:[(0,a.jsx)(G.Server,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"独立渠道配置"})]})]})]})}):X?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsx)(i.Card,{className:"w-full max-w-sm",children:(0,a.jsxs)(i.CardContent,{className:"pt-6 text-center",children:[(0,a.jsx)(b.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto"}),(0,a.jsx)("h2",{className:"mt-4 text-xl font-semibold",children:X}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"请在群内发送 #群管理面板 重新获取登录码"})]})})}):(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-background",children:[(0,a.jsx)("header",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur border-b shrink-0",children:(0,a.jsx)("div",{className:"container max-w-4xl mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-14",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("h1",{className:"font-semibold truncate",children:eb.groupName||`群 ${$}`}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground font-mono",children:["#",$]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>ek(),disabled:F,className:"h-9 w-9",children:(0,a.jsx)(v.RefreshCw,{className:"h-4 w-4"})}),(0,a.jsxs)(t.Button,{onClick:eP,disabled:F,size:"sm",className:"h-9",children:[F?(0,a.jsx)(u.Loader2,{className:"h-4 w-4 mr-1.5 animate-spin"}):null,(0,a.jsx)("span",{className:"hidden sm:inline",children:"保存"}),(0,a.jsx)("span",{className:"sm:hidden",children:"存"})]}),(0,a.jsx)(t.Button,{variant:"ghost",size:"sm",onClick:()=>{localStorage.removeItem("group_admin_token"),ea(!0),J(""),x.toast.success("已退出登录")},className:"h-9",children:"退出"})]})]})})}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto",children:(0,a.jsxs)("div",{className:"container max-w-4xl mx-auto px-4 py-4 pb-20 sm:pb-4",children:[!e&&(0,a.jsx)("div",{className:"flex gap-1 p-1 bg-muted rounded-lg mb-4 overflow-x-auto",children:eM.map(e=>(0,a.jsxs)("button",{onClick:()=>Y(e.id),className:(0,z.cn)("flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors",W===e.id?"bg-background shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.icon,e.label]},e.id))}),(0,a.jsx)(i.Card,{children:(0,a.jsxs)(i.CardContent,{className:"p-4 sm:p-6",children:["basic"===W&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"群号"}),(0,a.jsx)(l.Input,{value:eb.groupId,disabled:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"群名称"}),(0,a.jsx)(l.Input,{value:eb.groupName,onChange:e=>eu({...eb,groupName:e.target.value}),placeholder:"可选"})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"使用预设"}),(0,a.jsxs)(m.Select,{value:eb.presetId,onValueChange:e=>eu({...eb,presetId:e}),children:[(0,a.jsx)(m.SelectTrigger,{children:(0,a.jsx)(m.SelectValue,{placeholder:"选择预设"})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"__default__",children:"使用默认预设"}),en.map(e=>(0,a.jsx)(m.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"触发模式"}),(0,a.jsxs)(m.Select,{value:eb.triggerMode,onValueChange:e=>eu({...eb,triggerMode:e}),children:[(0,a.jsx)(m.SelectTrigger,{children:(0,a.jsx)(m.SelectValue,{})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"default",children:"默认"}),(0,a.jsx)(m.SelectItem,{value:"at",children:"仅@触发"}),(0,a.jsx)(m.SelectItem,{value:"prefix",children:"仅前缀触发"}),(0,a.jsx)(m.SelectItem,{value:"all",children:"全部消息"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"自定义前缀"}),(0,a.jsx)(l.Input,{value:eb.customPrefix,onChange:e=>eu({...eb,customPrefix:e.target.value}),placeholder:"留空使用全局前缀"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"独立人设"}),(0,a.jsx)(o.Textarea,{value:eb.systemPrompt,onChange:e=>eu({...eb,systemPrompt:e.target.value}),placeholder:"不填写则使用预设配置...",rows:3,className:"font-mono text-sm"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["支持变量: ","{{user_name}}"," ","{{group_name}}"," ","{{date}}"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.Power,{className:"h-4 w-4"}),(0,a.jsx)(n.Label,{children:"启用AI响应"})]}),(0,a.jsx)(d.Switch,{checked:eb.enabled,onCheckedChange:e=>eu({...eb,enabled:e})})]})]}),"features"===W&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"群管理员也可通过命令控制这些功能"}),(0,a.jsx)(D,{icon:(0,a.jsx)(g.Zap,{className:"h-4 w-4"}),title:"工具调用",desc:"搜索、代码执行等",value:eb.toolsEnabled,onChange:e=>eu({...eb,toolsEnabled:e})}),(0,a.jsxs)(D,{icon:(0,a.jsx)(C.Image,{className:"h-4 w-4"}),title:"绘图功能",desc:"文生图、图生图",value:eb.imageGenEnabled,onChange:e=>eu({...eb,imageGenEnabled:e}),children:[(0,a.jsx)(Q,{label:"绘图模型",value:eb.imageGenModel,models:ed,onChange:e=>eu({...eb,imageGenModel:e})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"图片尺寸"}),(0,a.jsxs)(m.Select,{value:eb.imageGenSize,onValueChange:e=>eu({...eb,imageGenSize:e}),children:[(0,a.jsx)(m.SelectTrigger,{children:(0,a.jsx)(m.SelectValue,{})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"1024x1024",children:"1024x1024"}),(0,a.jsx)(m.SelectItem,{value:"1792x1024",children:"1792x1024"}),(0,a.jsx)(m.SelectItem,{value:"1024x1792",children:"1024x1792"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"每日限额"}),(0,a.jsx)(l.Input,{type:"number",min:0,value:eb.imageGenDailyLimit,onChange:e=>eu({...eb,imageGenDailyLimit:parseInt(e.target.value)||0})})]})]})]}),(0,a.jsx)(D,{icon:(0,a.jsx)(w.MessageSquare,{className:"h-4 w-4"}),title:"群聊总结",desc:"AI生成群聊总结",value:eb.summaryEnabled,onChange:e=>eu({...eb,summaryEnabled:e}),children:(0,a.jsx)(Q,{label:"总结模型",value:eb.summaryModel,models:ed,onChange:e=>eu({...eb,summaryModel:e})})}),(0,a.jsxs)(D,{icon:(0,a.jsx)(S.PartyPopper,{className:"h-4 w-4"}),title:"事件处理",desc:"入群欢迎、退群提醒",value:eb.eventEnabled,onChange:e=>eu({...eb,eventEnabled:e}),children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(M.UserPlus,{className:"h-4 w-4 text-green-500"}),(0,a.jsx)(n.Label,{className:"text-sm",children:"入群欢迎"})]}),(0,a.jsx)(A,{value:eb.welcomeEnabled,onChange:e=>eu({...eb,welcomeEnabled:e})})]}),"on"===eb.welcomeEnabled&&(0,a.jsxs)("div",{className:"pl-6 space-y-2",children:[(0,a.jsx)(q,{value:eb.welcomeProbability,onChange:e=>eu({...eb,welcomeProbability:e})}),(0,a.jsx)(o.Textarea,{value:eb.welcomeMessage,onChange:e=>eu({...eb,welcomeMessage:e.target.value}),placeholder:"固定欢迎语（留空用AI）",rows:2,className:"text-sm"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(L.UserMinus,{className:"h-4 w-4 text-red-500"}),(0,a.jsx)(n.Label,{className:"text-sm",children:"退群提醒"})]}),(0,a.jsx)(A,{value:eb.goodbyeEnabled,onChange:e=>eu({...eb,goodbyeEnabled:e})})]}),"on"===eb.goodbyeEnabled&&(0,a.jsx)("div",{className:"pl-6 space-y-2",children:(0,a.jsx)(q,{value:eb.goodbyeProbability,onChange:e=>eu({...eb,goodbyeProbability:e})})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(I.Hand,{className:"h-4 w-4 text-blue-500"}),(0,a.jsx)(n.Label,{className:"text-sm",children:"戳一戳"})]}),(0,a.jsx)(A,{value:eb.pokeEnabled,onChange:e=>eu({...eb,pokeEnabled:e})})]}),"on"===eb.pokeEnabled&&(0,a.jsxs)("div",{className:"pl-6 space-y-2",children:[(0,a.jsx)(q,{value:eb.pokeProbability,onChange:e=>eu({...eb,pokeProbability:e})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Switch,{checked:eb.pokeBack,onCheckedChange:e=>eu({...eb,pokeBack:e})}),(0,a.jsx)(n.Label,{className:"text-xs",children:"戳回去"})]})]})]})]}),(0,a.jsxs)(D,{icon:(0,a.jsx)(k.Palette,{className:"h-4 w-4 text-pink-500"}),title:"表情小偷",desc:"收集并发送表情包",value:eb.emojiThiefEnabled,onChange:e=>eu({...eb,emojiThiefEnabled:e}),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-muted/30",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(n.Label,{className:"text-sm font-medium",children:"独立存储"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"本群表情不与其他群共享"})]}),(0,a.jsx)(d.Switch,{checked:eb.emojiThiefSeparateFolder,onCheckedChange:e=>eu({...eb,emojiThiefSeparateFolder:e})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"最大数量"}),(0,a.jsx)(l.Input,{type:"number",value:eb.emojiThiefMaxCount,onChange:e=>eu({...eb,emojiThiefMaxCount:parseInt(e.target.value)||500})})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"收集概率(%)"}),(0,a.jsx)(l.Input,{type:"number",value:Math.round(100*eb.emojiThiefStealRate),onChange:e=>eu({...eb,emojiThiefStealRate:parseInt(e.target.value)/100})})]})]}),(0,a.jsxs)("div",{className:"p-3 rounded-lg border bg-card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(B.Smile,{className:"h-4 w-4 text-yellow-500"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"表情库"}),(0,a.jsxs)(r.Badge,{variant:"secondary",className:"text-[10px]",children:[eh.total," 张"]})]}),(0,a.jsxs)(t.Button,{variant:"ghost",size:"sm",className:"h-7 text-xs text-destructive",onClick:eI,children:[(0,a.jsx)(U.Trash2,{className:"h-3 w-3 mr-1"})," 清空"]})]}),eh.images.length>0?(0,a.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2 max-h-36 overflow-y-auto",children:eh.images.slice(0,12).map((e,s)=>(0,a.jsx)("div",{className:"relative aspect-square rounded border bg-muted/50 overflow-hidden cursor-pointer",onClick:()=>eC(e),children:(0,a.jsx)("img",{src:e.url,alt:e.name,className:"w-full h-full object-cover"})},s))}):(0,a.jsx)("div",{className:"text-center py-4 text-xs text-muted-foreground",children:"暂无表情"})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-md bg-muted",children:(0,a.jsx)(P.Users,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"用户权限"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"黑白名单"})]})]}),(0,a.jsxs)(m.Select,{value:eb.listMode,onValueChange:e=>eu({...eb,listMode:e}),children:[(0,a.jsx)(m.SelectTrigger,{className:"w-28",children:(0,a.jsx)(m.SelectValue,{})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"none",children:"不启用"}),(0,a.jsx)(m.SelectItem,{value:"blacklist",children:"黑名单"}),(0,a.jsx)(m.SelectItem,{value:"whitelist",children:"白名单"})]})]})]}),"none"!==eb.listMode&&(0,a.jsx)(o.Textarea,{className:"mt-2 font-mono",placeholder:"每行一个QQ号",value:("blacklist"===eb.listMode?eb.blacklist:eb.whitelist).join("\n"),onChange:e=>{let a=e.target.value.split("\n").filter(Boolean);eu({...eb,["blacklist"===eb.listMode?"blacklist":"whitelist"]:a})}})]}),(0,a.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-md bg-muted",children:(0,a.jsx)(T.Clock,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"定时总结推送"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"定期推送群聊总结"})]})]}),(0,a.jsx)(d.Switch,{checked:eb.summaryPushEnabled,onCheckedChange:e=>eu({...eb,summaryPushEnabled:e})})]}),eb.summaryPushEnabled&&(0,a.jsx)("div",{className:"ml-4 pl-4 border-l-2 border-muted space-y-3 mt-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"间隔类型"}),(0,a.jsxs)(m.Select,{value:eb.summaryPushIntervalType,onValueChange:e=>eu({...eb,summaryPushIntervalType:e}),children:[(0,a.jsx)(m.SelectTrigger,{children:(0,a.jsx)(m.SelectValue,{})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"day",children:"按天"}),(0,a.jsx)(m.SelectItem,{value:"hour",children:"按小时"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"间隔值"}),(0,a.jsx)(l.Input,{type:"number",min:1,value:eb.summaryPushIntervalValue,onChange:e=>eu({...eb,summaryPushIntervalValue:parseInt(e.target.value)||1})})]})]})})]})]}),"bym"===W&&(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)(D,{icon:(0,a.jsx)(j.Sparkles,{className:"h-4 w-4 text-purple-500"}),title:"伪人模式",desc:"随机回复，模拟真人聊天",value:eb.bymEnabled,onChange:e=>eu({...eb,bymEnabled:e}),children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"伪人人设"}),(0,a.jsxs)(m.Select,{value:eb.bymPresetId,onValueChange:e=>eu({...eb,bymPresetId:e}),children:[(0,a.jsx)(m.SelectTrigger,{children:(0,a.jsx)(m.SelectValue,{})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"__default__",children:"使用默认预设"}),(0,a.jsx)(m.SelectItem,{value:"__custom__",children:"自定义提示词"}),en.map(e=>(0,a.jsx)(m.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),"__custom__"===eb.bymPresetId&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"自定义提示词"}),(0,a.jsx)(o.Textarea,{value:eb.bymPrompt,onChange:e=>eu({...eb,bymPrompt:e.target.value}),placeholder:"你是一个真实的群友...",rows:3,className:"font-mono text-sm"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{className:"text-sm",children:"触发概率"}),"inherit"===eb.bymProbability?(0,a.jsx)(t.Button,{variant:"outline",size:"sm",className:"w-full",onClick:()=>eu({...eb,bymProbability:.02}),children:"继承全局"}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.Input,{type:"number",min:0,max:100,className:"w-20",value:Math.round(100*eb.bymProbability),onChange:e=>eu({...eb,bymProbability:parseInt(e.target.value)/100})}),(0,a.jsx)("span",{className:"text-sm",children:"%"}),(0,a.jsx)(t.Button,{variant:"ghost",size:"sm",onClick:()=>eu({...eb,bymProbability:"inherit"}),children:(0,a.jsx)(N.X,{className:"h-3 w-3"})})]})]}),(0,a.jsx)(Q,{label:"伪人模型",value:eb.bymModel,models:ed,onChange:e=>eu({...eb,bymModel:e})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{className:"text-sm",children:"温度"}),"inherit"===eb.bymTemperature?(0,a.jsx)(t.Button,{variant:"outline",size:"sm",className:"w-full",onClick:()=>eu({...eb,bymTemperature:.9}),children:"继承全局"}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.Input,{type:"number",min:0,max:2,step:.1,value:eb.bymTemperature,onChange:e=>eu({...eb,bymTemperature:parseFloat(e.target.value)})}),(0,a.jsx)(t.Button,{variant:"ghost",size:"sm",onClick:()=>eu({...eb,bymTemperature:"inherit"}),children:(0,a.jsx)(N.X,{className:"h-3 w-3"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{className:"text-sm",children:"最大Token"}),"inherit"===eb.bymMaxTokens?(0,a.jsx)(t.Button,{variant:"outline",size:"sm",className:"w-full",onClick:()=>eu({...eb,bymMaxTokens:100}),children:"继承全局"}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.Input,{type:"number",min:10,max:2e3,value:eb.bymMaxTokens,onChange:e=>eu({...eb,bymMaxTokens:parseInt(e.target.value)})}),(0,a.jsx)(t.Button,{variant:"ghost",size:"sm",onClick:()=>eu({...eb,bymMaxTokens:"inherit"}),children:(0,a.jsx)(N.X,{className:"h-3 w-3"})})]})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(w.MessageSquare,{className:"h-4 w-4 text-green-500"}),(0,a.jsx)(n.Label,{className:"font-medium",children:"主动发言"})]}),(0,a.jsx)(A,{value:eb.proactiveChatEnabled,onChange:e=>eu({...eb,proactiveChatEnabled:e})})]}),"off"!==eb.proactiveChatEnabled&&(0,a.jsxs)("div",{className:"space-y-3 ml-4 pl-4 border-l-2 border-muted",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"触发概率"}),(0,a.jsxs)(m.Select,{value:"inherit"===eb.proactiveChatProbability?"inherit":String(eb.proactiveChatProbability),onValueChange:e=>eu({...eb,proactiveChatProbability:"inherit"===e?"inherit":parseFloat(e)}),children:[(0,a.jsx)(m.SelectTrigger,{children:(0,a.jsx)(m.SelectValue,{})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"inherit",children:"继承"}),(0,a.jsx)(m.SelectItem,{value:"0.02",children:"2%"}),(0,a.jsx)(m.SelectItem,{value:"0.05",children:"5%"}),(0,a.jsx)(m.SelectItem,{value:"0.1",children:"10%"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"冷却(分钟)"}),(0,a.jsxs)(m.Select,{value:"inherit"===eb.proactiveChatCooldown?"inherit":String(eb.proactiveChatCooldown),onValueChange:e=>eu({...eb,proactiveChatCooldown:"inherit"===e?"inherit":parseInt(e)}),children:[(0,a.jsx)(m.SelectTrigger,{children:(0,a.jsx)(m.SelectValue,{})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"inherit",children:"继承"}),(0,a.jsx)(m.SelectItem,{value:"5",children:"5分钟"}),(0,a.jsx)(m.SelectItem,{value:"10",children:"10分钟"}),(0,a.jsx)(m.SelectItem,{value:"30",children:"30分钟"})]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"活跃时段开始"}),(0,a.jsx)(l.Input,{type:"number",min:0,max:23,value:eb.proactiveChatTimeStart,onChange:e=>eu({...eb,proactiveChatTimeStart:parseInt(e.target.value)||8})})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"活跃时段结束"}),(0,a.jsx)(l.Input,{type:"number",min:0,max:23,value:eb.proactiveChatTimeEnd,onChange:e=>eu({...eb,proactiveChatTimeEnd:parseInt(e.target.value)||23})})]})]})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(B.Smile,{className:"h-4 w-4 text-yellow-500"}),(0,a.jsx)(n.Label,{className:"font-medium",children:"回复风格"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"回复长度"}),(0,a.jsxs)(m.Select,{value:eb.bymReplyLength,onValueChange:e=>eu({...eb,bymReplyLength:e}),children:[(0,a.jsx)(m.SelectTrigger,{children:(0,a.jsx)(m.SelectValue,{})}),(0,a.jsxs)(m.SelectContent,{children:[(0,a.jsx)(m.SelectItem,{value:"short",children:"简短"}),(0,a.jsx)(m.SelectItem,{value:"medium",children:"适中"}),(0,a.jsx)(m.SelectItem,{value:"long",children:"详细"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-5",children:[(0,a.jsx)(d.Switch,{checked:eb.bymUseEmoji,onCheckedChange:e=>eu({...eb,bymUseEmoji:e})}),(0,a.jsx)(n.Label,{className:"text-sm",children:"使用表情"})]})]})]})]})}),"channel"===W&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(w.MessageSquare,{className:"h-4 w-4 text-blue-500"}),(0,a.jsx)(n.Label,{className:"text-base font-medium",children:"聊天配置"})]}),(0,a.jsxs)("div",{className:"space-y-3 p-3 rounded-lg border bg-card",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"上下文长度"}),(0,a.jsx)(l.Input,{type:"number",min:1,max:100,value:eb.chatContextLength,onChange:e=>eu({...eb,chatContextLength:parseInt(e.target.value)||20})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-5",children:[(0,a.jsx)(d.Switch,{checked:eb.chatEnabled,onCheckedChange:e=>eu({...eb,chatEnabled:e})}),(0,a.jsx)(n.Label,{className:"text-sm",children:"启用对话"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Switch,{checked:eb.chatStreamReply,onCheckedChange:e=>eu({...eb,chatStreamReply:e})}),(0,a.jsx)(n.Label,{className:"text-xs",children:"流式回复"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Switch,{checked:eb.chatQuoteReply,onCheckedChange:e=>eu({...eb,chatQuoteReply:e})}),(0,a.jsx)(n.Label,{className:"text-xs",children:"引用回复"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Switch,{checked:eb.chatShowThinking,onCheckedChange:e=>eu({...eb,chatShowThinking:e})}),(0,a.jsx)(n.Label,{className:"text-xs",children:"显示思考"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4 border-t pt-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(G.Server,{className:"h-4 w-4 text-purple-500"}),(0,a.jsx)(n.Label,{className:"text-base font-medium",children:"群独立渠道"})]}),(0,a.jsxs)(t.Button,{variant:"outline",size:"sm",onClick:()=>{ey(null),ef({name:"",baseUrl:"",apiKey:"",adapterType:"openai",models:"",enabled:!0,priority:0,modelsPath:"",chatPath:"",imageTransferMode:"auto",imageCompress:!0,imageQuality:85,imageMaxSize:4096}),eg(!0)},children:[(0,a.jsx)(R.Plus,{className:"h-4 w-4 mr-2"}),"添加渠道"]})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"配置本群专用的API渠道"}),0===eb.independentChannels.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground border rounded-lg border-dashed",children:[(0,a.jsx)(G.Server,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"暂无独立渠道"})]}):(0,a.jsx)("div",{className:"space-y-3",children:eb.independentChannels.map((e,s)=>(0,a.jsx)("div",{className:"p-4 rounded-lg border bg-card",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)("h4",{className:"font-medium",children:e.name}),(0,a.jsx)(r.Badge,{variant:e.enabled?"default":"secondary",children:e.enabled?"启用":"禁用"}),(0,a.jsx)(r.Badge,{variant:"outline",children:e.adapterType})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:e.baseUrl||"使用默认地址"}),(0,a.jsxs)("div",{className:"flex gap-1 mt-2 flex-wrap",children:[e.models.slice(0,3).map(e=>(0,a.jsx)(r.Badge,{variant:"secondary",className:"text-xs",children:e},e)),e.models.length>3&&(0,a.jsxs)(r.Badge,{variant:"secondary",className:"text-xs",children:["+",e.models.length-3]})]})]}),(0,a.jsxs)("div",{className:"flex gap-1 shrink-0",children:[(0,a.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>{ey(s),ef({name:e.name,baseUrl:e.baseUrl,apiKey:e.apiKey,adapterType:e.adapterType,models:e.models.join(","),enabled:e.enabled,priority:e.priority,modelsPath:e.modelsPath||"",chatPath:e.chatPath||"",imageTransferMode:e.imageConfig?.transferMode||"auto",imageCompress:e.imageConfig?.compress??!0,imageQuality:e.imageConfig?.quality??85,imageMaxSize:e.imageConfig?.maxSize??4096}),eg(!0)},children:(0,a.jsx)(p.Settings,{className:"h-4 w-4"})}),(0,a.jsx)(t.Button,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>{if(confirm("确定要删除这个渠道吗？")){let e=[...eb.independentChannels];e.splice(s,1),eu({...eb,independentChannels:e})}},children:(0,a.jsx)(U.Trash2,{className:"h-4 w-4"})})]})]})},e.id))})]})]}),"advanced"===W&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.Bot,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)(n.Label,{children:"模型配置"})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"为本群配置独立模型（留空使用全局）"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,a.jsx)(Q,{label:"对话模型",value:eb.chatModel,models:ed,onChange:e=>eu({...eb,chatModel:e})}),(0,a.jsx)(Q,{label:"总结模型",value:eb.summaryModel,models:ed,onChange:e=>eu({...eb,summaryModel:e})}),(0,a.jsx)(Q,{label:"伪人模型",value:eb.bymModel,models:ed,onChange:e=>eu({...eb,bymModel:e})}),(0,a.jsx)(Q,{label:"绘图模型",value:eb.imageGenModel,models:ed,onChange:e=>eu({...eb,imageGenModel:e})})]})]}),ec.length>0&&(0,a.jsxs)("div",{className:"space-y-3 border-t pt-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(_.Brain,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)(n.Label,{children:"知识库"})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"为本群关联知识库"}),(0,a.jsx)("div",{className:"space-y-2",children:ec.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded border bg-card",children:[(0,a.jsx)(d.Switch,{checked:eb.knowledgeIds.includes(e.id),onCheckedChange:a=>{a?eu({...eb,knowledgeIds:[...eb.knowledgeIds,e.id]}):eu({...eb,knowledgeIds:eb.knowledgeIds.filter(a=>a!==e.id)})}}),(0,a.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})]}),(0,a.jsx)("div",{className:"border-t pt-4 mt-4",children:(0,a.jsx)("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/20",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(b.AlertCircle,{className:"h-5 w-5 text-amber-600 shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-amber-900 dark:text-amber-100",children:"权限说明"}),(0,a.jsx)("p",{className:"text-xs text-amber-800 dark:text-amber-200",children:"群管理面板仅支持配置本群独立渠道，不能修改以下设置："}),(0,a.jsxs)("ul",{className:"text-xs text-amber-800 dark:text-amber-200 list-disc list-inside space-y-0.5 ml-1",children:[(0,a.jsx)("li",{children:"禁用全局模型（仅主管理面板可配置）"}),(0,a.jsx)("li",{children:"其他高级系统配置"})]})]})]})})})]})]})}),(0,a.jsxs)("div",{className:"mt-6 text-center text-xs text-muted-foreground",children:["ChatGPT Plugin 群管理面板 · 群 ",$]})]})}),e&&(0,a.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-background border-t",children:(0,a.jsx)("div",{className:"grid grid-cols-5 h-14",children:eM.map(e=>(0,a.jsxs)("button",{onClick:()=>Y(e.id),className:(0,z.cn)("flex flex-col items-center justify-center gap-0.5 transition-colors",W===e.id?"text-primary":"text-muted-foreground"),children:[e.icon,(0,a.jsx)("span",{className:"text-[10px] font-medium",children:e.mobileLabel})]},e.id))})}),(0,a.jsx)(h.Dialog,{open:!!eN,onOpenChange:e=>!e&&eC(null),children:(0,a.jsx)(h.DialogContent,{className:"max-w-sm p-0 overflow-hidden bg-transparent border-none",children:eN&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:eN.url,alt:eN.name,className:"w-full h-auto rounded-lg shadow-2xl"}),(0,a.jsxs)("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center gap-4",children:[(0,a.jsxs)(t.Button,{variant:"secondary",size:"sm",onClick:()=>eT(eN.name),children:[(0,a.jsx)(U.Trash2,{className:"h-4 w-4 mr-1"})," 删除"]}),(0,a.jsx)(t.Button,{variant:"secondary",size:"sm",onClick:()=>eC(null),children:"关闭"})]})]})})}),(0,a.jsx)(V.ChannelDialog,{open:ep,onOpenChange:eg,channelForm:ev,onChannelFormChange:ef,isEditing:null!==ej,authToken:ew(),onSave:()=>{if(!ev.name||!ev.baseUrl||!ev.apiKey)return void x.toast.error("请填写必要信息");let e={id:null!==ej?eb.independentChannels[ej].id:Math.random().toString(36).substring(7),name:ev.name,baseUrl:ev.baseUrl,apiKey:ev.apiKey,adapterType:ev.adapterType,models:ev.models.split(",").map(e=>e.trim()).filter(Boolean),enabled:ev.enabled,priority:ev.priority,modelsPath:ev.modelsPath||void 0,chatPath:ev.chatPath||void 0,imageConfig:{transferMode:ev.imageTransferMode,compress:ev.imageCompress,quality:ev.imageQuality,maxSize:ev.imageMaxSize}},a=[...eb.independentChannels];null!==ej?a[ej]=e:a.push(e),eu({...eb,independentChannels:a}),eg(!1),x.toast.success(null!==ej?"渠道已更新":"渠道已添加")},onFetchModels:async()=>{if(!ev.baseUrl||!ev.apiKey)return x.toast.error("请先填写 Base URL 和 API Key"),[];try{let e=await fetch("/api/admin/models/fetch",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ew()}`},body:JSON.stringify({baseUrl:ev.baseUrl,apiKey:ev.apiKey,adapterType:ev.adapterType})}),a=await e.json();if(0===a.code)return x.toast.success(`获取到 ${a.data.length} 个模型`),a.data;return x.toast.error(a.message||"获取失败"),[]}catch{return x.toast.error("获取失败"),[]}}})]})}e.s(["default",()=>O])}]);