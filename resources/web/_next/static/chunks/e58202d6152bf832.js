(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5850,e=>{"use strict";let r=(0,e.i(50974).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>r],5850)},84141,e=>{"use strict";var r=e.i(94316);e.s(["Check",()=>r.default])},39079,e=>{"use strict";var r=e.i(69287),t=e.i(39048);function a({className:e,...a}){return(0,r.jsx)("div",{"data-slot":"card",className:(0,t.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm transition-all duration-200","hover:shadow-md dark:border-border/50 dark:shadow-none dark:hover:border-border",e),...a})}function s({className:e,...a}){return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,t.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...a})}function i({className:e,...a}){return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,t.cn)("leading-none font-semibold",e),...a})}function n({className:e,...a}){return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,t.cn)("text-muted-foreground text-sm",e),...a})}function d({className:e,...a}){return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,t.cn)("px-6",e),...a})}e.s(["Card",()=>a,"CardContent",()=>d,"CardDescription",()=>n,"CardHeader",()=>s,"CardTitle",()=>i])},89908,e=>{"use strict";var r=e.i(79333);e.s(["Loader2",()=>r.default])},69895,e=>{"use strict";var r=e.i(69287),t=e.i(39048);function a({className:e,...a}){return(0,r.jsx)("div",{"data-slot":"skeleton",className:(0,t.cn)("bg-accent animate-pulse rounded-md",e),...a})}e.s(["Skeleton",()=>a])},39124,e=>{"use strict";var r=e.i(69287),t=e.i(39048);function a({className:e,type:a,...s}){return(0,r.jsx)("input",{type:a,"data-slot":"input",className:(0,t.cn)("file:text-foreground placeholder:text-muted-foreground/60 selection:bg-primary selection:text-primary-foreground","dark:bg-input/30 border-input h-10 w-full min-w-0 rounded-lg border bg-background/50 px-3 py-2 text-base shadow-xs","transition-all duration-200 outline-none","file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium","disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50","hover:border-ring/50 hover:bg-background","focus-visible:border-primary focus-visible:ring-primary/20 focus-visible:ring-[3px] focus-visible:bg-background","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive","md:text-sm",e),...s})}e.s(["Input",()=>a])},7313,e=>{"use strict";var r=e.i(71317);function t(e){let t=r.useRef({value:e,previous:e});return r.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}e.s(["usePrevious",()=>t])},92407,79789,e=>{"use strict";var r=e.i(69287),t=e.i(71317);e.i(45569);var a=e.i(92024),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let i=(0,a.createSlot)(`Primitive.${s}`),n=t.forwardRef((e,t)=>{let{asChild:a,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,r.jsx)(a?i:s,{...n,ref:t})});return n.displayName=`Primitive.${s}`,{...e,[s]:n}},{});e.s(["Primitive",()=>s],79789);var i=t.forwardRef((e,t)=>(0,r.jsx)(s.label,{...e,ref:t,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));i.displayName="Label";var n=e.i(39048);function d({className:e,...t}){return(0,r.jsx)(i,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}e.s(["Label",()=>d],92407)},9102,e=>{"use strict";var r=e.i(69287),t=e.i(71317),a=e.i(91967),s=e.i(89268),i=e.i(94185),n=e.i(70672),d=e.i(7313),l=e.i(90404),o=e.i(92480),c="Switch",[u,p]=(0,i.createContextScope)(c),[x,h]=u(c),m=t.forwardRef((e,i)=>{let{__scopeSwitch:d,name:l,checked:u,defaultChecked:p,required:h,disabled:m,value:f="on",onCheckedChange:v,form:j,...w}=e,[N,y]=t.useState(null),C=(0,s.useComposedRefs)(i,e=>y(e)),k=t.useRef(!1),S=!N||j||!!N.closest("form"),[P,R]=(0,n.useControllableState)({prop:u,defaultProp:p??!1,onChange:v,caller:c});return(0,r.jsxs)(x,{scope:d,checked:P,disabled:m,children:[(0,r.jsx)(o.Primitive.button,{type:"button",role:"switch","aria-checked":P,"aria-required":h,"data-state":b(P),"data-disabled":m?"":void 0,disabled:m,value:f,...w,ref:C,onClick:(0,a.composeEventHandlers)(e.onClick,e=>{R(e=>!e),S&&(k.current=e.isPropagationStopped(),k.current||e.stopPropagation())})}),S&&(0,r.jsx)(g,{control:N,bubbles:!k.current,name:l,value:f,checked:P,required:h,disabled:m,form:j,style:{transform:"translateX(-100%)"}})]})});m.displayName=c;var f="SwitchThumb",v=t.forwardRef((e,t)=>{let{__scopeSwitch:a,...s}=e,i=h(f,a);return(0,r.jsx)(o.Primitive.span,{"data-state":b(i.checked),"data-disabled":i.disabled?"":void 0,...s,ref:t})});v.displayName=f;var g=t.forwardRef(({__scopeSwitch:e,control:a,checked:i,bubbles:n=!0,...o},c)=>{let u=t.useRef(null),p=(0,s.useComposedRefs)(u,c),x=(0,d.usePrevious)(i),h=(0,l.useSize)(a);return t.useEffect(()=>{let e=u.current;if(!e)return;let r=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(x!==i&&r){let t=new Event("click",{bubbles:n});r.call(e,i),e.dispatchEvent(t)}},[x,i,n]),(0,r.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...o,tabIndex:-1,ref:p,style:{...o.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function b(e){return e?"checked":"unchecked"}g.displayName="SwitchBubbleInput";var j=e.i(39048);function w({className:e,...t}){return(0,r.jsx)(m,{"data-slot":"switch",className:(0,j.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:(0,r.jsx)(v,{"data-slot":"switch-thumb",className:(0,j.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}e.s(["Switch",()=>w],9102)},9960,e=>{"use strict";var r=e.i(69287),t=e.i(71317),a=e.i(79789),s="horizontal",i=["horizontal","vertical"],n=t.forwardRef((e,t)=>{var n;let{decorative:d,orientation:l=s,...o}=e,c=(n=l,i.includes(n))?l:s;return(0,r.jsx)(a.Primitive.div,{"data-orientation":c,...d?{role:"none"}:{"aria-orientation":"vertical"===c?c:void 0,role:"separator"},...o,ref:t})});n.displayName="Separator";var d=e.i(39048);function l({className:e,orientation:t="horizontal",decorative:a=!0,...s}){return(0,r.jsx)(n,{"data-slot":"separator",decorative:a,orientation:t,className:(0,d.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",e),...s})}e.s(["Separator",()=>l],9960)},26812,e=>{"use strict";var r=e.i(69287),t=e.i(94237),a=e.i(39048);let s=(0,t.cva)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function i({className:e,variant:t,...i}){return(0,r.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,a.cn)(s({variant:t}),e),...i})}function n({className:e,...t}){return(0,r.jsx)("div",{"data-slot":"alert-description",className:(0,a.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...t})}e.s(["Alert",()=>i,"AlertDescription",()=>n])},82274,e=>{"use strict";var r=e.i(11228);e.s(["AlertTriangle",()=>r.default])},76038,e=>{"use strict";var r=e.i(69287),t=e.i(71317),a=e.i(39079),s=e.i(64022),i=e.i(39124),n=e.i(92407),d=e.i(9102),l=e.i(69895),o=e.i(9960),c=e.i(26812),u=e.i(98509),p=e.i(79342),x=e.i(5850),h=e.i(89908),m=e.i(84141),f=e.i(72024),v=e.i(13089),g=e.i(94701),b=e.i(82274);function j(){let[e,j]=(0,t.useState)(null),[w,N]=(0,t.useState)(!0),[y,C]=(0,t.useState)(!1),[k,S]=(0,t.useState)("idle"),P=(0,t.useRef)(!0),R=(0,t.useRef)(null),T=(0,t.useCallback)(async e=>{R.current&&clearTimeout(R.current),R.current=setTimeout(async()=>{S("saving");try{await u.configApi.updateAdvanced(e),S("saved"),setTimeout(()=>S("idle"),2e3)}catch(e){p.toast.error("自动保存失败"),console.error(e),S("idle")}},800)},[]);(0,t.useEffect)(()=>{!P.current&&e&&T(e)},[e,T]),(0,t.useEffect)(()=>{(async()=>{try{let e=(await u.configApi.getAdvanced()).data||{};j({...e,web:{...e?.web,port:e?.web?.port??3e3},redis:{...e?.redis,enabled:e?.redis?.enabled??!0,host:e?.redis?.host||"127.0.0.1",port:e?.redis?.port??6379,password:e?.redis?.password??"",db:e?.redis?.db??0}}),setTimeout(()=>{P.current=!1},100)}catch(e){p.toast.error("加载配置失败"),console.error(e)}finally{N(!1)}})()},[]);let A=async()=>{if(e){C(!0);try{await u.configApi.updateAdvanced(e),S("saved"),p.toast.success("配置已保存，部分设置需要重启生效"),setTimeout(()=>S("idle"),2e3)}catch(e){p.toast.error("保存失败"),console.error(e)}finally{C(!1)}}},I=(r,t)=>{if(!e)return;let a=r.split("."),s=JSON.parse(JSON.stringify(e)),i=s;for(let e=0;e<a.length-1;e++)i[a[e]]||(i[a[e]]={}),i=i[a[e]];i[a[a.length-1]]=t,j(s)};return w?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(l.Skeleton,{className:"h-10 w-48"}),(0,r.jsxs)(a.Card,{children:[(0,r.jsx)(a.CardHeader,{children:(0,r.jsx)(l.Skeleton,{className:"h-6 w-32"})}),(0,r.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,r.jsx)(l.Skeleton,{className:"h-10 w-full"}),(0,r.jsx)(l.Skeleton,{className:"h-10 w-full"})]})]})]}):e?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"系统设置"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"配置插件系统级参数"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:["saving"===k&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.Loader2,{className:"inline h-4 w-4 animate-spin mr-1"}),"保存中"]}),"saved"===k&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Check,{className:"inline h-4 w-4 text-green-500 mr-1"}),"已保存"]}),"idle"===k&&"自动保存"]}),(0,r.jsxs)(s.Button,{onClick:A,disabled:y,size:"sm",children:[y?(0,r.jsx)(h.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(x.Save,{className:"mr-2 h-4 w-4"}),"保存"]})]})]}),(0,r.jsxs)(c.Alert,{children:[(0,r.jsx)(b.AlertTriangle,{className:"h-4 w-4"}),(0,r.jsx)(c.AlertDescription,{children:"修改系统设置后需要重启插件才能生效。"})]}),(0,r.jsxs)(a.Card,{children:[(0,r.jsxs)(a.CardHeader,{children:[(0,r.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(g.Globe,{className:"h-5 w-5"}),"Web 服务"]}),(0,r.jsx)(a.CardDescription,{children:"管理面板和 API 服务配置"})]}),(0,r.jsx)(a.CardContent,{className:"space-y-4",children:(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(n.Label,{htmlFor:"webPort",children:"监听端口"}),(0,r.jsx)(i.Input,{id:"webPort",type:"number",min:"1",max:"65535",value:e.web?.port||3e3,onChange:e=>I("web.port",parseInt(e.target.value)),className:"max-w-xs"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"管理面板和 API 服务的监听端口，默认 3000。修改后需要重启生效。"})]})})]}),(0,r.jsxs)(a.Card,{children:[(0,r.jsxs)(a.CardHeader,{children:[(0,r.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(v.Database,{className:"h-5 w-5"}),"Redis 配置"]}),(0,r.jsx)(a.CardDescription,{children:"Redis 缓存服务配置"})]}),(0,r.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(n.Label,{children:"启用 Redis"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"用于缓存和消息队列"})]}),(0,r.jsx)(d.Switch,{checked:e.redis?.enabled??!0,onCheckedChange:e=>I("redis.enabled",e)})]}),e.redis?.enabled&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Separator,{}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(n.Label,{htmlFor:"redisHost",children:"主机地址"}),(0,r.jsx)(i.Input,{id:"redisHost",value:e.redis?.host||"127.0.0.1",onChange:e=>I("redis.host",e.target.value),placeholder:"127.0.0.1"})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(n.Label,{htmlFor:"redisPort",children:"端口"}),(0,r.jsx)(i.Input,{id:"redisPort",type:"number",min:"1",max:"65535",value:e.redis?.port||6379,onChange:e=>I("redis.port",parseInt(e.target.value)),placeholder:"6379"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(n.Label,{htmlFor:"redisPassword",children:"密码"}),(0,r.jsx)(i.Input,{id:"redisPassword",type:"password",value:e.redis?.password||"",onChange:e=>I("redis.password",e.target.value),placeholder:"无密码留空"})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(n.Label,{htmlFor:"redisDb",children:"数据库"}),(0,r.jsx)(i.Input,{id:"redisDb",type:"number",min:"0",max:"15",value:e.redis?.db||0,onChange:e=>I("redis.db",parseInt(e.target.value)),placeholder:"0"})]})]})]})]})]}),(0,r.jsxs)(a.Card,{children:[(0,r.jsxs)(a.CardHeader,{children:[(0,r.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(f.Server,{className:"h-5 w-5"}),"系统信息"]}),(0,r.jsx)(a.CardDescription,{children:"当前运行环境信息"})]}),(0,r.jsx)(a.CardContent,{children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"当前监听端口"}),(0,r.jsx)("span",{className:"font-mono",children:e.web?.port||3e3})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Redis 状态"}),(0,r.jsx)("span",{children:e.redis?.enabled?"已启用":"已禁用"})]})]})})]})]}):(0,r.jsx)("div",{children:"加载失败"})}e.s(["default",()=>j])}]);