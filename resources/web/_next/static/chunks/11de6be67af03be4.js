(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,720,e=>{"use strict";var s=e.i(52542),a=e.i(40418),l=e.i(51200),t=e.i(72029),i=e.i(30243),r=e.i(99573),n=e.i(13107),d=e.i(87126),c=e.i(20308),o=e.i(20650),x=e.i(47686),m=e.i(94518),h=e.i(46048),p=e.i(81080),u=e.i(59475),j=e.i(60381),g=e.i(50974);let N=(0,g.default)("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);var b=e.i(58489),v=e.i(17286),C=e.i(89908);let w=(0,g.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var f=e.i(60713),y=e.i(97058),T=e.i(40204),k=e.i(35771),S=e.i(29144),I=e.i(2823),B=e.i(74940),P=e.i(72024);let H=(0,g.default)("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);var R=e.i(75979),A=e.i(79342),L=e.i(23759),G=e.i(83277);function D(){let[e,g]=(0,a.useState)(!0),[D,M]=(0,a.useState)([]),[z,K]=(0,a.useState)(null),[U,O]=(0,a.useState)(null),[$,W]=(0,a.useState)(!1),[F,Q]=(0,a.useState)("presets"),[q,E]=(0,a.useState)(!1),[V,X]=(0,a.useState)(!1),[Z,J]=(0,a.useState)(!1),[Y,_]=(0,a.useState)(!1),[ee,es]=(0,a.useState)(!1),[ea,el]=(0,a.useState)({name:"",url:"",enabled:!0}),[et,ei]=(0,a.useState)({keywords:"",prompt:"",needImage:!0,enableSplit:!1,splitCols:6,splitRows:4,splitPadding:0}),[er,en]=(0,a.useState)(null),ed=async(e=!0)=>{e&&g(!0);try{let[e,s]=await Promise.all([R.imageGenApi.getPresets(),R.imageGenApi.getConfig()]);M(e.data?.presets||[]),K(e.data?.stats||null),O(s.data||null)}catch(e){A.toast.error("加载失败",{description:e.message})}finally{e&&g(!1)}};(0,a.useEffect)(()=>{ed()},[]);let ec=async()=>{W(!0);try{let e=await R.imageGenApi.reloadPresets();K(e.data?.stats||null),A.toast.success("预设重载成功"),await ed(!1)}catch(e){A.toast.error("重载失败",{description:e.message})}finally{W(!1)}},eo=async()=>{W(!0);try{let e=await R.imageGenApi.updatePresets(),s=e.data?.results||[],a=s.filter(e=>e.success).length;A.toast.success(`更新完成`,{description:`成功 ${a}/${s.length} 个来源`}),await ed(!1)}catch(e){A.toast.error("更新失败",{description:e.message})}finally{W(!1)}},ex=async()=>{if(!ea.name||!ea.url)return void A.toast.error("请填写完整信息");try{await R.imageGenApi.addSource(ea),A.toast.success("来源添加成功"),J(!1),el({name:"",url:"",enabled:!0}),await ed(!1)}catch(e){A.toast.error("添加失败",{description:e.message})}},em=async e=>{try{await R.imageGenApi.deleteSource(e),A.toast.success("来源已删除"),await ed(!1)}catch(e){A.toast.error("删除失败",{description:e.message})}},eh=async()=>{if(!et.keywords||!et.prompt)return void A.toast.error("请填写完整信息");try{let e={keywords:et.keywords.split(/[,，\s]+/).filter(e=>e.trim()),prompt:et.prompt,needImage:et.needImage};et.enableSplit&&(e.splitGrid={cols:et.splitCols,rows:et.splitRows,padding:et.splitPadding}),await R.imageGenApi.addCustomPreset(e),A.toast.success("预设添加成功"),_(!1),ei({keywords:"",prompt:"",needImage:!0,enableSplit:!1,splitCols:6,splitRows:4,splitPadding:0}),await ed(!1)}catch(e){A.toast.error("添加失败",{description:e.message})}},ep=async e=>{try{await R.imageGenApi.deleteCustomPreset(e),A.toast.success("预设已删除"),await ed(!1)}catch(e){A.toast.error("删除失败",{description:e.message})}},eu=async e=>{try{await R.imageGenApi.deleteBuiltinPreset(e),A.toast.success("预设已删除"),await ed(!1)}catch(e){A.toast.error("删除失败",{description:e.message})}},ej=async(e,s)=>{try{await R.imageGenApi.deleteRemotePreset(e,s),A.toast.success("预设已删除"),await ed(!1)}catch(e){A.toast.error("删除失败",{description:e.message})}},eg=async()=>{if(er){if(!er.keywords||!er.prompt)return void A.toast.error("请填写完整信息");try{let e={keywords:er.keywords.split(/[,，\s]+/).filter(e=>e.trim()),prompt:er.prompt,needImage:er.needImage};er.enableSplit?e.splitGrid={cols:er.splitCols,rows:er.splitRows,padding:er.splitPadding||0}:e.splitGrid=null,"custom"===er.source?await R.imageGenApi.updateCustomPreset(er.uid,e):"builtin"===er.source?await R.imageGenApi.updateBuiltinPreset(er.uid,e):await R.imageGenApi.updateRemotePreset(er.source,er.uid,e),A.toast.success("预设已更新"),es(!1),en(null),await ed(!1)}catch(e){A.toast.error("保存失败",{description:e.message})}}},eN=async e=>{try{await R.imageGenApi.updateConfig(e),O(s=>s?{...s,...e}:s),A.toast.success("配置已保存")}catch(e){A.toast.error("保存失败",{description:e.message})}};return e?(0,s.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6",children:[(0,s.jsx)(d.Skeleton,{className:"h-8 w-48"}),(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-4",children:[1,2,3,4].map(e=>(0,s.jsx)(d.Skeleton,{className:"h-24"},e))}),(0,s.jsx)(d.Skeleton,{className:"h-96"})]}):(0,s.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold flex items-center gap-2",children:[(0,s.jsx)(S.Wand2,{className:"h-6 w-6 sm:h-8 sm:w-8"}),"绘图预设管理"]}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1 text-sm sm:text-base",children:"管理 AI 绘图的预设模板和来源"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",className:"flex-1 sm:flex-none",onClick:ec,disabled:$,children:[$?(0,s.jsx)(C.Loader2,{className:"h-4 w-4 mr-1 sm:mr-2 animate-spin"}):(0,s.jsx)(y.RefreshCw,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"重载预设"}),(0,s.jsx)("span",{className:"sm:hidden",children:"重载"})]}),(0,s.jsxs)(t.Button,{size:"sm",className:"flex-1 sm:flex-none",onClick:eo,disabled:$,children:[$?(0,s.jsx)(C.Loader2,{className:"h-4 w-4 mr-1 sm:mr-2 animate-spin"}):(0,s.jsx)(b.Download,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"从云端更新"}),(0,s.jsx)("span",{className:"sm:hidden",children:"更新"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-3 sm:gap-4 grid-cols-2 md:grid-cols-4",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{className:"pb-2",children:(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"总预设数"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:z?.total||0})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{className:"pb-2",children:(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"内置预设"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:z?.builtin||0})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{className:"pb-2",children:(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"云端预设"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:z?.remote||0})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{className:"pb-2",children:(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"自定义预设"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:z?.custom||0})})]})]}),(0,s.jsxs)(p.Tabs,{value:F,onValueChange:Q,className:"space-y-4",children:[(0,s.jsxs)(p.TabsList,{className:"w-full sm:w-auto flex flex-wrap h-auto gap-1 p-1",children:[(0,s.jsx)(p.TabsTrigger,{value:"presets",className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"预设列表"}),(0,s.jsx)(p.TabsTrigger,{value:"sources",className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"预设来源"}),(0,s.jsx)(p.TabsTrigger,{value:"custom",className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"自定义"}),(0,s.jsx)(p.TabsTrigger,{value:"settings",className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"设置"})]}),(0,s.jsx)(p.TabsContent,{value:"presets",children:(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"所有预设"}),(0,s.jsx)(l.CardDescription,{children:"当前已加载的所有绘图预设模板"})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)(x.ScrollArea,{className:"h-[400px] sm:h-[500px]",children:(0,s.jsx)("div",{className:"min-w-[600px]",children:(0,s.jsxs)(h.Table,{children:[(0,s.jsx)(h.TableHeader,{children:(0,s.jsxs)(h.TableRow,{children:[(0,s.jsx)(h.TableHead,{className:"w-12",children:"#"}),(0,s.jsx)(h.TableHead,{className:"w-48",children:"关键词"}),(0,s.jsx)(h.TableHead,{children:"提示词"}),(0,s.jsx)(h.TableHead,{className:"w-24",children:"需要图片"}),(0,s.jsx)(h.TableHead,{className:"w-24",children:"切割"}),(0,s.jsx)(h.TableHead,{className:"w-32",children:"来源"}),(0,s.jsx)(h.TableHead,{className:"w-16",children:"操作"})]})}),(0,s.jsx)(h.TableBody,{children:D.map((e,a)=>{var l;return(0,s.jsxs)(h.TableRow,{children:[(0,s.jsx)(h.TableCell,{className:"font-mono text-muted-foreground",children:a+1}),(0,s.jsx)(h.TableCell,{children:(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.keywords.map((e,a)=>(0,s.jsx)(n.Badge,{variant:"outline",className:"text-xs",children:e},a))})}),(0,s.jsx)(h.TableCell,{className:"max-w-md",children:(0,s.jsxs)("p",{className:"truncate text-sm text-muted-foreground",title:e.prompt,children:[e.prompt.substring(0,100),"..."]})}),(0,s.jsx)(h.TableCell,{children:e.needImage?(0,s.jsxs)(n.Badge,{variant:"secondary",children:[(0,s.jsx)(v.Image,{className:"w-3 h-3 mr-1"}),"需要"]}):(0,s.jsx)(n.Badge,{variant:"outline",children:"不需要"})}),(0,s.jsx)(h.TableCell,{children:e.splitGrid?(0,s.jsxs)(n.Badge,{variant:"secondary",children:[(0,s.jsx)(H,{className:"w-3 h-3 mr-1"}),e.splitGrid.cols,"×",e.splitGrid.rows]}):(0,s.jsx)(n.Badge,{variant:"outline",children:"-"})}),(0,s.jsx)(h.TableCell,{children:"builtin"===(l=e.source)?(0,s.jsxs)(n.Badge,{variant:"secondary",children:[(0,s.jsx)(I.Box,{className:"w-3 h-3 mr-1"}),"内置"]}):"custom"===l?(0,s.jsxs)(n.Badge,{variant:"default",children:[(0,s.jsx)(w,{className:"w-3 h-3 mr-1"}),"自定义"]}):(0,s.jsxs)(n.Badge,{variant:"outline",children:[(0,s.jsx)(N,{className:"w-3 h-3 mr-1"}),l]})}),(0,s.jsx)(h.TableCell,{children:(0,s.jsxs)("div",{className:"flex gap-1",children:[e.uid&&(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>{en({uid:e.uid||"",source:e.source,keywords:e.keywords.join(", "),prompt:e.prompt,needImage:e.needImage,enableSplit:!!(e.splitGrid?.cols&&e.splitGrid?.rows),splitCols:e.splitGrid?.cols||6,splitRows:e.splitGrid?.rows||4,splitPadding:e.splitGrid?.padding||0,outputWidth:e.outputWidth||0,outputHeight:e.outputHeight||0}),es(!0)},children:(0,s.jsx)(w,{className:"h-4 w-4"})}),"custom"===e.source&&(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>{let s=U?.customPresets?.findIndex(s=>s.uid===e.uid);void 0!==s&&s>=0&&ep(s)},children:(0,s.jsx)(k.Trash2,{className:"h-4 w-4 text-destructive"})}),"builtin"===e.source&&e.uid&&(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>eu(e.uid),children:(0,s.jsx)(k.Trash2,{className:"h-4 w-4 text-destructive"})}),"builtin"!==e.source&&"custom"!==e.source&&e.uid&&(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>ej(e.source,e.uid),children:(0,s.jsx)(k.Trash2,{className:"h-4 w-4 text-destructive"})})]})})]},a)})})]})})})})]})}),(0,s.jsx)(p.TabsContent,{value:"sources",children:(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(l.CardTitle,{children:"预设来源"}),(0,s.jsx)(l.CardDescription,{children:"管理远程预设数据源"})]}),(0,s.jsxs)(t.Button,{onClick:()=>J(!0),children:[(0,s.jsx)(f.Plus,{className:"h-4 w-4 mr-2"}),"添加来源"]})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsxs)(h.Table,{children:[(0,s.jsx)(h.TableHeader,{children:(0,s.jsxs)(h.TableRow,{children:[(0,s.jsx)(h.TableHead,{children:"名称"}),(0,s.jsx)(h.TableHead,{children:"URL"}),(0,s.jsx)(h.TableHead,{className:"w-24",children:"状态"}),(0,s.jsx)(h.TableHead,{className:"w-24",children:"预设数"}),(0,s.jsx)(h.TableHead,{className:"w-24",children:"操作"})]})}),(0,s.jsxs)(h.TableBody,{children:[U?.presetSources?.map((e,a)=>(0,s.jsxs)(h.TableRow,{children:[(0,s.jsx)(h.TableCell,{className:"font-medium",children:e.name}),(0,s.jsx)(h.TableCell,{className:"font-mono text-sm text-muted-foreground",children:e.url}),(0,s.jsx)(h.TableCell,{children:e.enabled?(0,s.jsx)(n.Badge,{variant:"default",children:"启用"}):(0,s.jsx)(n.Badge,{variant:"secondary",children:"禁用"})}),(0,s.jsx)(h.TableCell,{children:z?.sources?.find(s=>s.name===e.name)?.count||0}),(0,s.jsx)(h.TableCell,{children:(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>em(a),children:(0,s.jsx)(k.Trash2,{className:"h-4 w-4 text-destructive"})})})]},a)),(!U?.presetSources||0===U.presetSources.length)&&(0,s.jsx)(h.TableRow,{children:(0,s.jsx)(h.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"暂无预设来源，点击上方按钮添加"})})]})]})})]})}),(0,s.jsx)(p.TabsContent,{value:"custom",children:(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(l.CardTitle,{children:"自定义预设"}),(0,s.jsx)(l.CardDescription,{children:"创建自己的绘图预设模板"})]}),(0,s.jsxs)(t.Button,{onClick:()=>_(!0),children:[(0,s.jsx)(f.Plus,{className:"h-4 w-4 mr-2"}),"添加预设"]})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsxs)(h.Table,{children:[(0,s.jsx)(h.TableHeader,{children:(0,s.jsxs)(h.TableRow,{children:[(0,s.jsx)(h.TableHead,{className:"w-48",children:"关键词"}),(0,s.jsx)(h.TableHead,{children:"提示词"}),(0,s.jsx)(h.TableHead,{className:"w-24",children:"需要图片"}),(0,s.jsx)(h.TableHead,{className:"w-24",children:"操作"})]})}),(0,s.jsxs)(h.TableBody,{children:[U?.customPresets?.map((e,a)=>(0,s.jsxs)(h.TableRow,{children:[(0,s.jsx)(h.TableCell,{children:(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.keywords.map((e,a)=>(0,s.jsx)(n.Badge,{variant:"outline",className:"text-xs",children:e},a))})}),(0,s.jsx)(h.TableCell,{className:"max-w-md",children:(0,s.jsxs)("p",{className:"truncate text-sm",title:e.prompt,children:[e.prompt.substring(0,80),"..."]})}),(0,s.jsx)(h.TableCell,{children:e.needImage?(0,s.jsx)(n.Badge,{variant:"secondary",children:"需要"}):(0,s.jsx)(n.Badge,{variant:"outline",children:"不需要"})}),(0,s.jsx)(h.TableCell,{children:(0,s.jsxs)("div",{className:"flex gap-1",children:[e.uid&&(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>{en({uid:e.uid,source:"custom",keywords:e.keywords.join(", "),prompt:e.prompt,needImage:e.needImage,enableSplit:!!(e.splitGrid?.cols&&e.splitGrid?.rows),splitCols:e.splitGrid?.cols||6,splitRows:e.splitGrid?.rows||4,splitPadding:e.splitGrid?.padding||0,outputWidth:0,outputHeight:0}),es(!0)},children:(0,s.jsx)(w,{className:"h-4 w-4"})}),(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>ep(a),children:(0,s.jsx)(k.Trash2,{className:"h-4 w-4 text-destructive"})})]})})]},a)),(!U?.customPresets||0===U.customPresets.length)&&(0,s.jsx)(h.TableRow,{children:(0,s.jsx)(h.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"暂无自定义预设，点击上方按钮添加"})})]})]})})]})}),(0,s.jsxs)(p.TabsContent,{value:"settings",className:"space-y-4",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"功能开关"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(r.Label,{children:"启用绘图功能"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"可使用 #文生图、#图生图、#文生视频、#图生视频 等命令"})]}),(0,s.jsx)(c.Switch,{checked:U?.enabled??!0,onCheckedChange:e=>eN({enabled:e})})]})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(P.Server,{className:"h-5 w-5"}),"API配置"]}),(0,s.jsx)(l.CardDescription,{children:"支持多个API，会按顺序轮询和故障转移"})]}),(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",onClick:()=>{let e=[...U?.apis||[],{baseUrl:"",apiKey:"",models:[]}];O(s=>s?{...s,apis:e}:s),eN({apis:e})},children:[(0,s.jsx)(f.Plus,{className:"h-4 w-4 mr-1"})," 添加API"]})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(U?.apis||[]).map((e,a)=>(0,s.jsxs)("div",{className:"p-4 border rounded-lg space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-sm font-medium",children:["API ",a+1]}),(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{let e=[...U?.apis||[]];e.splice(a,1),O(s=>s?{...s,apis:e}:s),eN({apis:e})},children:(0,s.jsx)(B.X,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{className:"text-xs",children:"API地址"}),(0,s.jsx)(i.Input,{value:e.baseUrl||"",onChange:e=>{let s=[...U?.apis||[]];s[a]={...s[a],baseUrl:e.target.value},O(e=>e?{...e,apis:s}:e)},onBlur:()=>U&&eN({apis:U.apis}),placeholder:"https://api.openai.com"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{className:"text-xs",children:"API密钥"}),(0,s.jsx)(i.Input,{type:"password",value:e.apiKey||"",onChange:e=>{let s=[...U?.apis||[]];s[a]={...s[a],apiKey:e.target.value},O(e=>e?{...e,apis:s}:e)},onBlur:()=>U&&eN({apis:U.apis}),placeholder:"sk-..."})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(r.Label,{className:"text-xs",children:["可用模型 (",e.models?.length||0,")"]}),(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",className:"h-7 text-xs",disabled:!e.baseUrl,onClick:async()=>{if(e.baseUrl)try{let s=await R.channelsApi.fetchModels({adapterType:"openai",baseUrl:e.baseUrl,apiKey:e.apiKey}),l=s?.data?.models||[],t=[...U?.apis||[]];t[a]={...t[a],models:l},O(e=>e?{...e,apis:t}:e),eN({apis:t}),A.toast.success(`获取到 ${l.length} 个模型`)}catch{A.toast.error("获取模型失败")}},children:[(0,s.jsx)(y.RefreshCw,{className:"h-3 w-3 mr-1"})," 获取模型"]})]}),e.models&&e.models.length>0&&(0,s.jsxs)("div",{className:"flex flex-wrap gap-1 max-h-24 overflow-y-auto p-2 bg-muted/50 rounded",children:[e.models.slice(0,30).map(e=>(0,s.jsx)(n.Badge,{variant:"secondary",className:"text-xs",children:e},e)),e.models.length>30&&(0,s.jsxs)(n.Badge,{variant:"outline",className:"text-xs",children:["+",e.models.length-30]})]})]})]},a)),(!U?.apis||0===U.apis.length)&&(0,s.jsx)("div",{className:"text-center py-6 text-sm text-muted-foreground border border-dashed rounded-lg",children:"暂无API配置，点击上方按钮添加"})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"模型配置"}),(0,s.jsx)(l.CardDescription,{children:"选择用于图片和视频生成的模型"})]}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"图片模型"}),(0,s.jsxs)(G.Collapsible,{open:q,onOpenChange:E,children:[(0,s.jsx)(G.CollapsibleTrigger,{asChild:!0,children:(0,s.jsxs)(t.Button,{variant:"outline",className:"w-full justify-between",children:[(0,s.jsx)("span",{className:"truncate",children:U?.model||"选择模型"}),(0,s.jsx)(T.Settings,{className:`h-4 w-4 shrink-0 transition-transform ${q?"rotate-90":""}`})]})}),(0,s.jsx)(G.CollapsibleContent,{className:"mt-2",children:(0,s.jsx)("div",{className:"border rounded-lg p-3",children:(0,s.jsx)(L.ModelSelector,{value:U?.model?[U.model]:[],allModels:Array.from(new Set((U?.apis||[]).flatMap(e=>e.models||[]))),onChange:e=>{eN({model:e[0]||""}),e.length>0&&E(!1)},singleSelect:!0,allowCustom:!0})})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"视频模型"}),(0,s.jsxs)(G.Collapsible,{open:V,onOpenChange:X,children:[(0,s.jsx)(G.CollapsibleTrigger,{asChild:!0,children:(0,s.jsxs)(t.Button,{variant:"outline",className:"w-full justify-between",children:[(0,s.jsx)("span",{className:"truncate",children:U?.videoModel||"选择模型"}),(0,s.jsx)(T.Settings,{className:`h-4 w-4 shrink-0 transition-transform ${V?"rotate-90":""}`})]})}),(0,s.jsx)(G.CollapsibleContent,{className:"mt-2",children:(0,s.jsx)("div",{className:"border rounded-lg p-3",children:(0,s.jsx)(L.ModelSelector,{value:U?.videoModel?[U.videoModel]:[],allModels:Array.from(new Set((U?.apis||[]).flatMap(e=>e.models||[]))),onChange:e=>{eN({videoModel:e[0]||""}),e.length>0&&X(!1)},singleSelect:!0,allowCustom:!0})})})]})]})]}),(0,s.jsx)(u.Separator,{}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"超时时间 (毫秒)"}),(0,s.jsx)(i.Input,{type:"number",value:U?.timeout||6e5,onChange:e=>O(s=>s?{...s,timeout:parseInt(e.target.value)||6e5}:s),onBlur:()=>U&&eN({timeout:U.timeout})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"最大图片数"}),(0,s.jsx)(i.Input,{type:"number",value:U?.maxImages||3,onChange:e=>O(s=>s?{...s,maxImages:parseInt(e.target.value)||3}:s),onBlur:()=>U&&eN({maxImages:U.maxImages})})]})]})]})]})]})]}),(0,s.jsx)(m.Dialog,{open:Z,onOpenChange:J,children:(0,s.jsxs)(m.DialogContent,{className:"w-[95vw] max-w-lg",children:[(0,s.jsxs)(m.DialogHeader,{children:[(0,s.jsx)(m.DialogTitle,{children:"添加预设来源"}),(0,s.jsx)(m.DialogDescription,{children:"添加一个新的远程预设数据源"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"名称"}),(0,s.jsx)(i.Input,{value:ea.name,onChange:e=>el(s=>({...s,name:e.target.value})),placeholder:"例如：云端预设"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"URL"}),(0,s.jsx)(i.Input,{value:ea.url,onChange:e=>el(s=>({...s,url:e.target.value})),placeholder:"https://example.com/presets.json"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.Switch,{checked:ea.enabled,onCheckedChange:e=>el(s=>({...s,enabled:e}))}),(0,s.jsx)(r.Label,{children:"立即启用"})]})]}),(0,s.jsxs)(m.DialogFooter,{children:[(0,s.jsx)(t.Button,{variant:"outline",onClick:()=>J(!1),children:"取消"}),(0,s.jsx)(t.Button,{onClick:ex,children:"添加"})]})]})}),(0,s.jsx)(m.Dialog,{open:Y,onOpenChange:_,children:(0,s.jsxs)(m.DialogContent,{className:"w-[95vw] max-w-2xl",children:[(0,s.jsxs)(m.DialogHeader,{children:[(0,s.jsx)(m.DialogTitle,{children:"添加自定义预设"}),(0,s.jsx)(m.DialogDescription,{children:"创建一个新的绘图预设模板"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"触发关键词"}),(0,s.jsx)(i.Input,{value:et.keywords,onChange:e=>ei(s=>({...s,keywords:e.target.value})),placeholder:"用逗号或空格分隔，例如：风景化, 风景"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"用户发送这些关键词会触发此预设"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"提示词 (Prompt)"}),(0,s.jsx)(o.Textarea,{value:et.prompt,onChange:e=>ei(s=>({...s,prompt:e.target.value})),placeholder:"请输入发送给 AI 的提示词...",rows:6})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.Switch,{checked:et.needImage,onCheckedChange:e=>ei(s=>({...s,needImage:e}))}),(0,s.jsx)(r.Label,{children:"需要用户提供图片"})]}),(0,s.jsx)(u.Separator,{}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.Switch,{checked:et.enableSplit,onCheckedChange:e=>ei(s=>({...s,enableSplit:e}))}),(0,s.jsx)(r.Label,{children:"启用图片切割（表情包模式）"})]}),et.enableSplit&&(0,s.jsxs)(n.Badge,{variant:"secondary",children:[(0,s.jsx)(H,{className:"w-3 h-3 mr-1"}),et.splitCols,"×",et.splitRows," ="," ",et.splitCols*et.splitRows,"个"]})]}),et.enableSplit&&(0,s.jsxs)("div",{className:"p-4 border rounded-lg bg-muted/30 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs text-blue-700 dark:text-blue-300",children:[(0,s.jsx)(j.AlertCircle,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"表情切割说明"}),(0,s.jsx)("p",{children:"生成的图片将按网格切割成多个小图，通常用于Q版表情包生成。建议在提示词中指定生成 4K/16:9 图片以获得最佳效果。"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{className:"text-sm",children:"列数 (cols)"}),(0,s.jsx)(i.Input,{type:"number",min:1,max:10,value:et.splitCols,onChange:e=>ei(s=>({...s,splitCols:parseInt(e.target.value)||6}))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{className:"text-sm",children:"行数 (rows)"}),(0,s.jsx)(i.Input,{type:"number",min:1,max:10,value:et.splitRows,onChange:e=>ei(s=>({...s,splitRows:parseInt(e.target.value)||4}))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{className:"text-sm",children:"边距 (px)"}),(0,s.jsx)(i.Input,{type:"number",min:0,max:50,value:et.splitPadding,onChange:e=>ei(s=>({...s,splitPadding:parseInt(e.target.value)||0}))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{className:"p-2 bg-muted rounded",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"总表情数："}),(0,s.jsxs)("span",{className:"font-medium ml-1",children:[et.splitCols*et.splitRows," 个"]})]}),(0,s.jsxs)("div",{className:"p-2 bg-muted rounded",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"单个尺寸(4K)："}),(0,s.jsxs)("span",{className:"font-medium ml-1",children:["约 ",Math.floor(3840/et.splitCols),"×",Math.floor(2160/et.splitRows)," px"]})]})]})]})]})]}),(0,s.jsxs)(m.DialogFooter,{children:[(0,s.jsx)(t.Button,{variant:"outline",onClick:()=>_(!1),children:"取消"}),(0,s.jsx)(t.Button,{onClick:eh,children:"添加"})]})]})}),(0,s.jsx)(m.Dialog,{open:ee,onOpenChange:es,children:(0,s.jsxs)(m.DialogContent,{className:"w-[95vw] max-w-2xl",children:[(0,s.jsxs)(m.DialogHeader,{children:[(0,s.jsx)(m.DialogTitle,{children:"编辑预设"}),(0,s.jsxs)(m.DialogDescription,{children:["修改",er?.source==="custom"?"自定义":"云端","预设的内容"]})]}),er&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"触发关键词"}),(0,s.jsx)(i.Input,{value:er.keywords,onChange:e=>en(s=>s?{...s,keywords:e.target.value}:null),placeholder:"用逗号或空格分隔，例如：风景化, 风景"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"用户发送这些关键词会触发此预设"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"提示词 (Prompt)"}),(0,s.jsx)(o.Textarea,{value:er.prompt,onChange:e=>en(s=>s?{...s,prompt:e.target.value}:null),placeholder:"请输入发送给 AI 的提示词...",rows:8})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.Switch,{checked:er.needImage,onCheckedChange:e=>en(s=>s?{...s,needImage:e}:null)}),(0,s.jsx)(r.Label,{children:"需要用户提供图片"})]}),(0,s.jsx)(u.Separator,{}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.Switch,{checked:er.enableSplit,onCheckedChange:e=>en(s=>s?{...s,enableSplit:e}:null)}),(0,s.jsx)(r.Label,{children:"启用图片切割（表情包模式）"})]}),er.enableSplit&&(0,s.jsxs)(n.Badge,{variant:"secondary",children:[(0,s.jsx)(H,{className:"w-3 h-3 mr-1"}),er.splitCols,"×",er.splitRows," ="," ",er.splitCols*er.splitRows,"个"]})]}),er.enableSplit&&(0,s.jsxs)("div",{className:"p-4 border rounded-lg bg-muted/30 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs text-blue-700 dark:text-blue-300",children:[(0,s.jsx)(j.AlertCircle,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"表情切割说明"}),(0,s.jsx)("p",{children:"生成的图片将按网格切割成多个小图，通常用于Q版表情包生成。建议在提示词中指定生成 4K/16:9 图片以获得最佳效果。"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{className:"text-sm",children:"列数 (cols)"}),(0,s.jsx)(i.Input,{type:"number",min:1,max:10,value:er.splitCols,onChange:e=>en(s=>s?{...s,splitCols:parseInt(e.target.value)||6}:null)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{className:"text-sm",children:"行数 (rows)"}),(0,s.jsx)(i.Input,{type:"number",min:1,max:10,value:er.splitRows,onChange:e=>en(s=>s?{...s,splitRows:parseInt(e.target.value)||4}:null)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{className:"text-sm",children:"边距 (px)"}),(0,s.jsx)(i.Input,{type:"number",min:0,max:50,value:er.splitPadding,onChange:e=>en(s=>s?{...s,splitPadding:parseInt(e.target.value)||0}:null)})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{className:"p-2 bg-muted rounded",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"总表情数："}),(0,s.jsxs)("span",{className:"font-medium ml-1",children:[er.splitCols*er.splitRows," 个"]})]}),(0,s.jsxs)("div",{className:"p-2 bg-muted rounded",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"单个尺寸(4K)："}),(0,s.jsxs)("span",{className:"font-medium ml-1",children:["约 ",Math.floor(3840/er.splitCols),"×",Math.floor(2160/er.splitRows)," px"]})]})]})]})]})]}),(0,s.jsxs)(m.DialogFooter,{children:[(0,s.jsx)(t.Button,{variant:"outline",onClick:()=>{es(!1),en(null)},children:"取消"}),(0,s.jsx)(t.Button,{onClick:eg,children:"保存"})]})]})})]})}e.s(["default",()=>D],720)}]);